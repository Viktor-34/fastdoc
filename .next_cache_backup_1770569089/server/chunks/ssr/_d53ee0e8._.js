module.exports=[4987,(a,b,c)=>{"use strict";function d(a){let{widthInt:b,heightInt:c,blurWidth:d,blurHeight:e,blurDataURL:f,objectFit:g}=a,h=d?40*d:b,i=e?40*e:c,j=h&&i?"viewBox='0 0 "+h+" "+i+"'":"";return"%3Csvg xmlns='http://www.w3.org/2000/svg' "+j+"%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3CfeColorMatrix values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1' result='s'/%3E%3CfeFlood x='0' y='0' width='100%25' height='100%25'/%3E%3CfeComposite operator='out' in='s'/%3E%3CfeComposite in2='SourceGraphic'/%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage width='100%25' height='100%25' x='0' y='0' preserveAspectRatio='"+(j?"none":"contain"===g?"xMidYMid":"cover"===g?"xMidYMid slice":"none")+"' style='filter: url(%23b);' href='"+f+"'/%3E%3C/svg%3E"}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"getImageBlurSvg",{enumerable:!0,get:function(){return d}})},345,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(c,{VALID_LOADERS:function(){return d},imageConfigDefault:function(){return e}});let d=["default","imgix","cloudinary","akamai","custom"],e={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:60,formats:["image/webp"],dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:void 0,unoptimized:!1}},94915,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"getImgProps",{enumerable:!0,get:function(){return i}}),a.r(92434);let d=a.r(4987),e=a.r(345),f=["-moz-initial","fill","none","scale-down",void 0];function g(a){return void 0!==a.default}function h(a){return void 0===a?a:"number"==typeof a?Number.isFinite(a)?a:NaN:"string"==typeof a&&/^[0-9]+$/.test(a)?parseInt(a,10):NaN}function i(a,b){var c,i;let j,k,l,{src:m,sizes:n,unoptimized:o=!1,priority:p=!1,loading:q,className:r,quality:s,width:t,height:u,fill:v=!1,style:w,overrideSrc:x,onLoad:y,onLoadingComplete:z,placeholder:A="empty",blurDataURL:B,fetchPriority:C,decoding:D="async",layout:E,objectFit:F,objectPosition:G,lazyBoundary:H,lazyRoot:I,...J}=a,{imgConf:K,showAltText:L,blurComplete:M,defaultLoader:N}=b,O=K||e.imageConfigDefault;if("allSizes"in O)j=O;else{let a=[...O.deviceSizes,...O.imageSizes].sort((a,b)=>a-b),b=O.deviceSizes.sort((a,b)=>a-b),d=null==(c=O.qualities)?void 0:c.sort((a,b)=>a-b);j={...O,allSizes:a,deviceSizes:b,qualities:d}}if(void 0===N)throw Object.defineProperty(Error("images.loaderFile detected but the file is missing default export.\nRead more: https://nextjs.org/docs/messages/invalid-images-config"),"__NEXT_ERROR_CODE",{value:"E163",enumerable:!1,configurable:!0});let P=J.loader||N;delete J.loader,delete J.srcSet;let Q="__next_img_default"in P;if(Q){if("custom"===j.loader)throw Object.defineProperty(Error('Image with src "'+m+'" is missing "loader" prop.\nRead more: https://nextjs.org/docs/messages/next-image-missing-loader'),"__NEXT_ERROR_CODE",{value:"E252",enumerable:!1,configurable:!0})}else{let a=P;P=b=>{let{config:c,...d}=b;return a(d)}}if(E){"fill"===E&&(v=!0);let a={intrinsic:{maxWidth:"100%",height:"auto"},responsive:{width:"100%",height:"auto"}}[E];a&&(w={...w,...a});let b={responsive:"100vw",fill:"100vw"}[E];b&&!n&&(n=b)}let R="",S=h(t),T=h(u);if((i=m)&&"object"==typeof i&&(g(i)||void 0!==i.src)){let a=g(m)?m.default:m;if(!a.src)throw Object.defineProperty(Error("An object should only be passed to the image component src parameter if it comes from a static image import. It must include src. Received "+JSON.stringify(a)),"__NEXT_ERROR_CODE",{value:"E460",enumerable:!1,configurable:!0});if(!a.height||!a.width)throw Object.defineProperty(Error("An object should only be passed to the image component src parameter if it comes from a static image import. It must include height and width. Received "+JSON.stringify(a)),"__NEXT_ERROR_CODE",{value:"E48",enumerable:!1,configurable:!0});if(k=a.blurWidth,l=a.blurHeight,B=B||a.blurDataURL,R=a.src,!v)if(S||T){if(S&&!T){let b=S/a.width;T=Math.round(a.height*b)}else if(!S&&T){let b=T/a.height;S=Math.round(a.width*b)}}else S=a.width,T=a.height}let U=!p&&("lazy"===q||void 0===q);(!(m="string"==typeof m?m:R)||m.startsWith("data:")||m.startsWith("blob:"))&&(o=!0,U=!1),j.unoptimized&&(o=!0),Q&&!j.dangerouslyAllowSVG&&m.split("?",1)[0].endsWith(".svg")&&(o=!0);let V=h(s),W=Object.assign(v?{position:"absolute",height:"100%",width:"100%",left:0,top:0,right:0,bottom:0,objectFit:F,objectPosition:G}:{},L?{}:{color:"transparent"},w),X=M||"empty"===A?null:"blur"===A?'url("data:image/svg+xml;charset=utf-8,'+(0,d.getImageBlurSvg)({widthInt:S,heightInt:T,blurWidth:k,blurHeight:l,blurDataURL:B||"",objectFit:W.objectFit})+'")':'url("'+A+'")',Y=f.includes(W.objectFit)?"fill"===W.objectFit?"100% 100%":"cover":W.objectFit,Z=X?{backgroundSize:Y,backgroundPosition:W.objectPosition||"50% 50%",backgroundRepeat:"no-repeat",backgroundImage:X}:{},$=function(a){let{config:b,src:c,unoptimized:d,width:e,quality:f,sizes:g,loader:h}=a;if(d)return{src:c,srcSet:void 0,sizes:void 0};let{widths:i,kind:j}=function(a,b,c){let{deviceSizes:d,allSizes:e}=a;if(c){let a=/(^|\s)(1?\d?\d)vw/g,b=[];for(let d;d=a.exec(c);)b.push(parseInt(d[2]));if(b.length){let a=.01*Math.min(...b);return{widths:e.filter(b=>b>=d[0]*a),kind:"w"}}return{widths:e,kind:"w"}}return"number"!=typeof b?{widths:d,kind:"w"}:{widths:[...new Set([b,2*b].map(a=>e.find(b=>b>=a)||e[e.length-1]))],kind:"x"}}(b,e,g),k=i.length-1;return{sizes:g||"w"!==j?g:"100vw",srcSet:i.map((a,d)=>h({config:b,src:c,quality:f,width:a})+" "+("w"===j?a:d+1)+j).join(", "),src:h({config:b,src:c,quality:f,width:i[k]})}}({config:j,src:m,unoptimized:o,width:S,quality:V,sizes:n,loader:P});return{props:{...J,loading:U?"lazy":q,fetchPriority:C,width:S,height:T,decoding:D,className:r,style:{...W,...Z},sizes:$.sizes,srcSet:$.srcSet,src:x||$.src},meta:{unoptimized:o,priority:p,placeholder:A,fill:v}}}},94613,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return f}});let d=a.r(72131),e=()=>{};function f(a){var b;let{headManager:c,reduceComponentsToState:f}=a;function g(){if(c&&c.mountedInstances){let b=d.Children.toArray(Array.from(c.mountedInstances).filter(Boolean));c.updateHead(f(b,a))}}return null==c||null==(b=c.mountedInstances)||b.add(a.children),g(),e(()=>{var b;return null==c||null==(b=c.mountedInstances)||b.add(a.children),()=>{var b;null==c||null==(b=c.mountedInstances)||b.delete(a.children)}}),e(()=>(c&&(c._pendingUpdate=g),()=>{c&&(c._pendingUpdate=g)})),null}},59231,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AmpContext},92966,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HeadManagerContext},57268,(a,b,c)=>{"use strict";function d(a){let{ampFirst:b=!1,hybrid:c=!1,hasQuery:d=!1}=void 0===a?{}:a;return b||c&&d}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"isInAmpMode",{enumerable:!0,get:function(){return d}})},58018,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(c,{default:function(){return p},defaultHead:function(){return l}});let d=a.r(33354),e=a.r(46058),f=a.r(87924),g=e._(a.r(72131)),h=d._(a.r(94613)),i=a.r(59231),j=a.r(92966),k=a.r(57268);function l(a){void 0===a&&(a=!1);let b=[(0,f.jsx)("meta",{charSet:"utf-8"},"charset")];return a||b.push((0,f.jsx)("meta",{name:"viewport",content:"width=device-width"},"viewport")),b}function m(a,b){return"string"==typeof b||"number"==typeof b?a:b.type===g.default.Fragment?a.concat(g.default.Children.toArray(b.props.children).reduce((a,b)=>"string"==typeof b||"number"==typeof b?a:a.concat(b),[])):a.concat(b)}a.r(92434);let n=["name","httpEquiv","charSet","itemProp"];function o(a,b){let{inAmpMode:c}=b;return a.reduce(m,[]).reverse().concat(l(c).reverse()).filter(function(){let a=new Set,b=new Set,c=new Set,d={};return e=>{let f=!0,g=!1;if(e.key&&"number"!=typeof e.key&&e.key.indexOf("$")>0){g=!0;let b=e.key.slice(e.key.indexOf("$")+1);a.has(b)?f=!1:a.add(b)}switch(e.type){case"title":case"base":b.has(e.type)?f=!1:b.add(e.type);break;case"meta":for(let a=0,b=n.length;a<b;a++){let b=n[a];if(e.props.hasOwnProperty(b))if("charSet"===b)c.has(b)?f=!1:c.add(b);else{let a=e.props[b],c=d[b]||new Set;("name"!==b||!g)&&c.has(a)?f=!1:(c.add(a),d[b]=c)}}}return f}}()).reverse().map((a,b)=>{let c=a.key||b;return g.default.cloneElement(a,{key:c})})}let p=function(a){let{children:b}=a,c=(0,g.useContext)(i.AmpStateContext),d=(0,g.useContext)(j.HeadManagerContext);return(0,f.jsx)(h.default,{reduceComponentsToState:o,headManager:d,inAmpMode:(0,k.isInAmpMode)(c),children:b})};("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},4486,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ImageConfigContext},53773,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.RouterContext},2305,(a,b,c)=>{"use strict";function d(a){var b;let{config:c,src:d,width:e,quality:f}=a,g=f||(null==(b=c.qualities)?void 0:b.reduce((a,b)=>Math.abs(b-75)<Math.abs(a-75)?b:a))||75;return c.path+"?url="+encodeURIComponent(d)+"&w="+e+"&q="+g+(d.startsWith("/_next/static/media/"),"")}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return e}}),d.__next_img_default=!0;let e=d},67161,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"Image",{enumerable:!0,get:function(){return u}});let d=a.r(33354),e=a.r(46058),f=a.r(87924),g=e._(a.r(72131)),h=d._(a.r(35112)),i=d._(a.r(58018)),j=a.r(94915),k=a.r(345),l=a.r(4486);a.r(92434);let m=a.r(53773),n=d._(a.r(2305)),o=a.r(8591),p={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1};function q(a,b,c,d,e,f,g){let h=null==a?void 0:a.src;a&&a["data-loaded-src"]!==h&&(a["data-loaded-src"]=h,("decode"in a?a.decode():Promise.resolve()).catch(()=>{}).then(()=>{if(a.parentElement&&a.isConnected){if("empty"!==b&&e(!0),null==c?void 0:c.current){let b=new Event("load");Object.defineProperty(b,"target",{writable:!1,value:a});let d=!1,e=!1;c.current({...b,nativeEvent:b,currentTarget:a,target:a,isDefaultPrevented:()=>d,isPropagationStopped:()=>e,persist:()=>{},preventDefault:()=>{d=!0,b.preventDefault()},stopPropagation:()=>{e=!0,b.stopPropagation()}})}(null==d?void 0:d.current)&&d.current(a)}}))}function r(a){return g.use?{fetchPriority:a}:{fetchpriority:a}}globalThis.__NEXT_IMAGE_IMPORTED=!0;let s=(0,g.forwardRef)((a,b)=>{let{src:c,srcSet:d,sizes:e,height:h,width:i,decoding:j,className:k,style:l,fetchPriority:m,placeholder:n,loading:p,unoptimized:s,fill:t,onLoadRef:u,onLoadingCompleteRef:v,setBlurComplete:w,setShowAltText:x,sizesInput:y,onLoad:z,onError:A,...B}=a,C=(0,g.useCallback)(a=>{a&&(A&&(a.src=a.src),a.complete&&q(a,n,u,v,w,s,y))},[c,n,u,v,w,A,s,y]),D=(0,o.useMergedRef)(b,C);return(0,f.jsx)("img",{...B,...r(m),loading:p,width:i,height:h,decoding:j,"data-nimg":t?"fill":"1",className:k,style:l,sizes:e,srcSet:d,src:c,ref:D,onLoad:a=>{q(a.currentTarget,n,u,v,w,s,y)},onError:a=>{x(!0),"empty"!==n&&w(!0),A&&A(a)}})});function t(a){let{isAppRouter:b,imgAttributes:c}=a,d={as:"image",imageSrcSet:c.srcSet,imageSizes:c.sizes,crossOrigin:c.crossOrigin,referrerPolicy:c.referrerPolicy,...r(c.fetchPriority)};return b&&h.default.preload?(h.default.preload(c.src,d),null):(0,f.jsx)(i.default,{children:(0,f.jsx)("link",{rel:"preload",href:c.srcSet?void 0:c.src,...d},"__nimg-"+c.src+c.srcSet+c.sizes)})}let u=(0,g.forwardRef)((a,b)=>{let c=(0,g.useContext)(m.RouterContext),d=(0,g.useContext)(l.ImageConfigContext),e=(0,g.useMemo)(()=>{var a;let b=p||d||k.imageConfigDefault,c=[...b.deviceSizes,...b.imageSizes].sort((a,b)=>a-b),e=b.deviceSizes.sort((a,b)=>a-b),f=null==(a=b.qualities)?void 0:a.sort((a,b)=>a-b);return{...b,allSizes:c,deviceSizes:e,qualities:f}},[d]),{onLoad:h,onLoadingComplete:i}=a,o=(0,g.useRef)(h);(0,g.useEffect)(()=>{o.current=h},[h]);let q=(0,g.useRef)(i);(0,g.useEffect)(()=>{q.current=i},[i]);let[r,u]=(0,g.useState)(!1),[v,w]=(0,g.useState)(!1),{props:x,meta:y}=(0,j.getImgProps)(a,{defaultLoader:n.default,imgConf:e,blurComplete:r,showAltText:v});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(s,{...x,unoptimized:y.unoptimized,placeholder:y.placeholder,fill:y.fill,onLoadRef:o,onLoadingCompleteRef:q,setBlurComplete:u,setShowAltText:w,sizesInput:a.sizes,ref:b}),y.priority?(0,f.jsx)(t,{isAppRouter:!c,imgAttributes:x}):null]})});("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},33095,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(c,{default:function(){return i},getImageProps:function(){return h}});let d=a.r(33354),e=a.r(94915),f=a.r(67161),g=d._(a.r(2305));function h(a){let{props:b}=(0,e.getImgProps)(a,{defaultLoader:g.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[a,c]of Object.entries(b))void 0===c&&delete b[a];return{props:b}}let i=f.Image},71987,(a,b,c)=>{b.exports=a.r(33095)},79698,a=>{"use strict";let b;a.s(["default",()=>eb],79698);var c,d,e,f,g,h,i,j,k,l,m=a.i(87924),n=a.i(72131),o=a.i(50944),p=a.i(75003),q=a.i(38246),r=a.i(70106);let s=(0,r.default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),t=(0,r.default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),u=(0,r.default)("file-down",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),v=(0,r.default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),w=(0,r.default)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),x=(0,r.default)("file-stack",[["path",{d:"M11 21a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-8a1 1 0 0 1 1-1",key:"likhh7"}],["path",{d:"M16 16a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1",key:"17ky3x"}],["path",{d:"M21 6a2 2 0 0 0-.586-1.414l-2-2A2 2 0 0 0 17 2h-3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1z",key:"1hyeo0"}]]),y=(0,r.default)("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),z=["basic","context","advantages","products","terms","gallery","contacts"],A=a=>`${a}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,B=a=>({type:"item",id:a.id,productId:a.productId,name:a.name,description:a.description??"",qty:Number.isFinite(a.qty)?a.qty:1,price:Number.isFinite(a.price)?a.price:0,discount:Number.isFinite(a.discount)?a.discount:0,unit:a.unit??"шт"}),C=(a="Вариант 1")=>({id:A("variant"),name:a,description:"",isRecommended:!0,rows:[]}),D=(a,b)=>{let c=C("Вариант 1");return{workspaceId:a,title:"Новое коммерческое предложение",items:[],currency:"RUB",pricingMode:"variants",productVariants:[c],activeVariantId:c.id,productsView:{showDiscountColumn:!0,showUnitColumn:!0},includeVat:!0,vatRate:20,advantages:[],advantagesColumns:3,visibleSections:[...z],status:"draft",createdBy:b,updatedBy:b,version:1}},E=[{value:"prepaid",label:"100% предоплата"},{value:"50-50",label:"50% предоплата / 50% по завершении"},{value:"postpaid",label:"Постоплата"},{value:"custom",label:"Свои условия"}];function F(a){return"item"===a.type}function G(a){if("variants"!==a.pricingMode||!Array.isArray(a.productVariants)||0===a.productVariants.length)return null;if(a.activeVariantId){let b=a.productVariants.find(b=>b.id===a.activeVariantId);if(b)return b}return a.productVariants.find(a=>a.isRecommended)??a.productVariants[0]}function H(a){let b=G(a);if(b)return b?b.rows.filter(F).map(a=>({id:a.id,productId:a.productId,name:a.name,description:a.description,qty:a.qty,price:a.price,discount:a.discount,unit:a.unit})):[];return Array.isArray(a.items)?a.items:[]}function I(a){let b=a.qty*a.price;return a.discount&&a.discount>0?b*(1-a.discount/100):b}function J(a){return a.reduce((a,b)=>a+I(b),0)}function K(a){let b=J(H(a));return a.includeVat&&a.vatRate>0?b*(1+a.vatRate/100):b}function L(a){return a.includeVat&&0!==a.vatRate?J(H(a))*(a.vatRate/100):0}function M(a){let b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return a.replace(/[&<>"']/g,a=>b[a])}function N(a,b="RUB"){return`${a.toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2})} ${({RUB:"₽",USD:"$",EUR:"€"})[b]||b}`}function O(a){return a.toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2})}var P=a.i(15618),Q=a.i(87682),R=a.i(40695);let S="var(--field-border)";function T({value:a,onChange:b,disabled:c}){let[d,e]=(0,n.useState)([]),[f,g]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/clients");if(!a.ok)throw Error("Failed to fetch clients");let b=await a.json();e(b)}catch(a){console.error("Failed to load clients:",a)}finally{g(!1)}})()},[]);let h=d.find(b=>b.id===a),i=h?h.name:void 0;return(0,m.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,m.jsxs)(Q.Select,{value:a??"none",onValueChange:a=>{"none"===a?b(null):b(a)},disabled:c||f,children:[(0,m.jsx)(Q.SelectTrigger,{id:"client",className:"!h-[42px] w-full min-w-0 flex-1 rounded-lg border bg-white px-4 py-0 text-sm font-medium text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",style:{borderColor:S},children:(0,m.jsx)(Q.SelectValue,{placeholder:f?"Загрузка...":"Без клиента",children:i||(f?"Загрузка...":"Без клиента")})}),(0,m.jsxs)(Q.SelectContent,{className:"border-[var(--field-border)] bg-white",children:[(0,m.jsx)(Q.SelectItem,{value:"none",className:"focus:bg-[#FAEFEB] focus:text-[#3d3d3a]",children:"Без клиента"}),d.map(a=>(0,m.jsx)(Q.SelectItem,{value:a.id,className:"focus:bg-[#FAEFEB] focus:text-[#3d3d3a]",children:(0,m.jsxs)("div",{className:"flex flex-col",children:[(0,m.jsx)("span",{className:"font-medium",children:a.name}),a.company&&(0,m.jsx)("span",{className:"text-xs",style:{color:"#73726c"},children:a.company})]})},a.id))]})]}),(0,m.jsxs)(R.Button,{type:"button",variant:"outline",onClick:()=>window.open("/clients/new","_blank"),className:"!h-[42px] shrink-0 rounded-lg border bg-white px-3 transition-colors hover:bg-[#FAFAF7] focus-visible:border-[var(--field-focus)] focus-visible:ring-[var(--field-ring)]",style:{borderColor:S,color:"#3d3d3a"},title:"Создать нового клиента",disabled:c,children:[(0,m.jsx)(P.Plus,{className:"h-4 w-4"}),(0,m.jsx)("span",{className:"text-sm font-medium",children:"Создать нового"})]})]})}function U({proposal:a,onUpdate:b}){let[c,d]=(0,n.useState)(null),e=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(!a.clientId){d(null),e.current=null;return}fetch(`/api/clients/${a.clientId}`).then(a=>a.ok?a.json():null).then(a=>d(a)).catch(()=>d(null))},[a.clientId]),(0,n.useEffect)(()=>{c&&!a.recipientName&&e.current!==a.clientId&&(b("recipientName",c.middleName?`Уважаемый ${c.name} ${c.middleName}!`:`Уважаемый ${c.name}!`),e.current=a.clientId??null)},[c,a.clientId,a.recipientName,b]),(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Клиент"}),(0,m.jsx)(T,{value:a.clientId??null,onChange:a=>b("clientId",a??void 0)}),(0,m.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Выберите клиента из списка или оставьте пустым"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"proposal-title",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Название коммерческого предложения"}),(0,m.jsx)("input",{id:"proposal-title",type:"text",value:a.title,onChange:a=>b("title",a.target.value),placeholder:"Например: Разработка корпоративного сайта",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"recipient-name",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Обращение"}),(0,m.jsx)("input",{id:"recipient-name",type:"text",value:a.recipientName||"",onChange:a=>b("recipientName",a.target.value),placeholder:"Уважаемый Иван Петрович!",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,m.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Заполняется автоматически при выборе клиента"})]})]})}function V({proposal:a,onUpdate:b}){return(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"problem-desc",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Описание ситуации клиента (Point A)"}),(0,m.jsx)("textarea",{id:"problem-desc",value:a.problemDesc||"",onChange:a=>b("problemDesc",a.target.value),placeholder:"Опишите текущую ситуацию клиента, его проблемы или потребности...",rows:4,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"}),(0,m.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Покажите, что вы понимаете проблему клиента"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"solution-desc",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Предлагаемое решение (Point B)"}),(0,m.jsx)("textarea",{id:"solution-desc",value:a.solutionDesc||"",onChange:a=>b("solutionDesc",a.target.value),placeholder:"Опишите, как ваше предложение решит проблему клиента...",rows:4,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"}),(0,m.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Объясните выгоды и результаты для клиента"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"additional-desc",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Дополнительное описание"}),(0,m.jsx)("textarea",{id:"additional-desc",value:a.additionalDesc||"",onChange:a=>b("additionalDesc",a.target.value),placeholder:"Дополнительная информация, преимущества, гарантии...",rows:3,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"}),(0,m.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Необязательное поле для дополнительной информации"})]})]})}var W=a.i(71987);let X=(0,r.default)("image-plus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);var Y=a.i(81560);function Z({proposal:a,onUpdate:b}){let c=(0,n.useMemo)(()=>a.advantages??[],[a.advantages]),d=a.advantagesColumns??3,e=(0,n.useCallback)(a=>{b("advantages",a)},[b]),f=(0,n.useCallback)(()=>{if(c.length>=3)return;let a=[...c,{id:`adv-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,title:"",description:""}];e(a),3===a.length&&d<3&&b("advantagesColumns",3)},[c,d,b,e]),g=(0,n.useCallback)(a=>{e(c.filter((b,c)=>c!==a))},[c,e]),h=(0,n.useCallback)((a,b)=>{e(c.map((c,d)=>d===a?{...c,...b}:c))},[c,e]),i=(0,n.useCallback)(async(a,b)=>{if(b)try{let c=new FormData;c.append("file",b);let d=await fetch("/api/upload",{method:"POST",body:c});if(!d.ok)throw Error(await d.text());let e=await d.json();h(a,{iconUrl:e.url})}catch(a){console.error("Failed to upload advantage icon:",a),alert("Не удалось загрузить иконку")}},[h]);return(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"mb-2 block text-sm font-medium",style:{color:"#3d3d3a"},children:"Преимущества"}),(0,m.jsxs)("p",{className:"text-xs",style:{color:"#73726c"},children:["Добавьте до ",3," карточек: иконка, заголовок и описание."]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"advantages-columns",className:"mb-2 block text-sm font-medium",style:{color:"#3d3d3a"},children:"Колонки в блоке"}),(0,m.jsxs)("select",{id:"advantages-columns",value:d,onChange:a=>b("advantagesColumns",Number(a.target.value)),className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-[#3d3d3a] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",children:[(0,m.jsx)("option",{value:1,children:"1 колонка"}),(0,m.jsx)("option",{value:2,children:"2 колонки"}),(0,m.jsx)("option",{value:3,children:"3 колонки"})]})]}),(0,m.jsx)("div",{className:"space-y-4",children:c.map((a,b)=>(0,m.jsxs)("div",{className:"space-y-4 rounded-lg border bg-[#FAFAFA] p-4",style:{borderColor:"hsl(30deg 3.3% 11.8% / 15%)"},children:[(0,m.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,m.jsxs)("p",{className:"text-sm font-medium",style:{color:"#3d3d3a"},children:["Карточка ",b+1]}),(0,m.jsx)("button",{type:"button",onClick:()=>g(b),className:"rounded-md p-2 text-[#73726c] transition-colors hover:bg-[#f4f2ec] hover:text-red-600","aria-label":"Удалить карточку",children:(0,m.jsx)(Y.Trash2,{className:"h-4 w-4"})})]}),(0,m.jsxs)("div",{className:"flex items-center gap-3",children:[(0,m.jsxs)("label",{className:"relative flex h-16 w-16 cursor-pointer items-center justify-center overflow-hidden rounded-full border border-dashed bg-white",style:{borderColor:"hsl(30deg 3.3% 11.8% / 25%)"},children:[a.iconUrl?(0,m.jsx)(W.default,{src:a.iconUrl,alt:"Иконка преимущества",width:64,height:64,className:"h-full w-full object-cover"}):(0,m.jsx)(X,{className:"h-5 w-5",style:{color:"#a5a29b"}}),(0,m.jsx)("input",{type:"file",accept:"image/*",className:"absolute inset-0 cursor-pointer opacity-0",onChange:a=>{i(b,a.target.files?.[0]??null)}})]}),(0,m.jsx)("p",{className:"text-xs",style:{color:"#73726c"},children:"Иконка (PNG/JPG)"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"mb-2 block text-sm font-medium",style:{color:"#3d3d3a"},children:"Заголовок"}),(0,m.jsx)("input",{type:"text",value:a.title,onChange:a=>h(b,{title:a.target.value}),placeholder:"Например: Прозрачная смета",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-[#3d3d3a] placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"mb-2 block text-sm font-medium",style:{color:"#3d3d3a"},children:"Описание"}),(0,m.jsx)("textarea",{value:a.description,onChange:a=>h(b,{description:a.target.value}),placeholder:"Короткое описание преимущества",rows:3,className:"w-full resize-y rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-[#3d3d3a] placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})]})]},a.id??b))}),c.length<3&&(0,m.jsxs)("button",{type:"button",onClick:f,className:"inline-flex items-center gap-2 rounded-lg border bg-white px-4 py-2 text-sm font-medium text-[#3d3d3a] transition-colors hover:bg-[#f4f2ec]",style:{borderColor:"hsl(30deg 3.3% 11.8% / 15%)"},children:[(0,m.jsx)(P.Plus,{className:"h-4 w-4"}),"Добавить карточку"]})]})}var $=a.i(35112);function _(a){let b=Object.prototype.toString.call(a);return"[object Window]"===b||"[object global]"===b}function aa(a){return"nodeType"in a}function ab(a){var b,c;return a?_(a)?a:aa(a)&&null!=(b=null==(c=a.ownerDocument)?void 0:c.defaultView)?b:window:window}function ac(a){let{Document:b}=ab(a);return a instanceof b}function ad(a){return!_(a)&&a instanceof ab(a).HTMLElement}function ae(a){return a instanceof ab(a).SVGElement}function af(a){return a?_(a)?a.document:aa(a)?ac(a)?a:ad(a)||ae(a)?a.ownerDocument:document:document:document}let ag=n.useEffect;function ah(a){let b=(0,n.useRef)(a);return ag(()=>{b.current=a}),(0,n.useCallback)(function(){for(var a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];return null==b.current?void 0:b.current(...c)},[])}function ai(a,b){void 0===b&&(b=[a]);let c=(0,n.useRef)(a);return ag(()=>{c.current!==a&&(c.current=a)},b),c}function aj(a,b){let c=(0,n.useRef)();return(0,n.useMemo)(()=>{let b=a(c.current);return c.current=b,b},[...b])}function ak(a){let b=ah(a),c=(0,n.useRef)(null),d=(0,n.useCallback)(a=>{a!==c.current&&(null==b||b(a,c.current)),c.current=a},[]);return[c,d]}function al(a){let b=(0,n.useRef)();return(0,n.useEffect)(()=>{b.current=a},[a]),b.current}let am={};function an(a,b){return(0,n.useMemo)(()=>{if(b)return b;let c=null==am[a]?0:am[a]+1;return am[a]=c,a+"-"+c},[a,b])}function ao(a){return function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return d.reduce((b,c)=>{for(let[d,e]of Object.entries(c)){let c=b[d];null!=c&&(b[d]=c+a*e)}return b},{...b})}}let ap=ao(1),aq=ao(-1);function ar(a){if(!a)return!1;let{KeyboardEvent:b}=ab(a.target);return b&&a instanceof b}function as(a){if(function(a){if(!a)return!1;let{TouchEvent:b}=ab(a.target);return b&&a instanceof b}(a)){if(a.touches&&a.touches.length){let{clientX:b,clientY:c}=a.touches[0];return{x:b,y:c}}else if(a.changedTouches&&a.changedTouches.length){let{clientX:b,clientY:c}=a.changedTouches[0];return{x:b,y:c}}}return"clientX"in a&&"clientY"in a?{x:a.clientX,y:a.clientY}:null}let at=Object.freeze({Translate:{toString(a){if(!a)return;let{x:b,y:c}=a;return"translate3d("+(b?Math.round(b):0)+"px, "+(c?Math.round(c):0)+"px, 0)"}},Scale:{toString(a){if(!a)return;let{scaleX:b,scaleY:c}=a;return"scaleX("+b+") scaleY("+c+")"}},Transform:{toString(a){if(a)return[at.Translate.toString(a),at.Scale.toString(a)].join(" ")}},Transition:{toString(a){let{property:b,duration:c,easing:d}=a;return b+" "+c+"ms "+d}}}),au="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]",av={display:"none"};function aw(a){let{id:b,value:c}=a;return n.default.createElement("div",{id:b,style:av},c)}function ax(a){let{id:b,announcement:c,ariaLiveType:d="assertive"}=a;return n.default.createElement("div",{id:b,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":d,"aria-atomic":!0},c)}let ay=(0,n.createContext)(null),az={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},aA={onDragStart(a){let{active:b}=a;return"Picked up draggable item "+b.id+"."},onDragOver(a){let{active:b,over:c}=a;return c?"Draggable item "+b.id+" was moved over droppable area "+c.id+".":"Draggable item "+b.id+" is no longer over a droppable area."},onDragEnd(a){let{active:b,over:c}=a;return c?"Draggable item "+b.id+" was dropped over droppable area "+c.id:"Draggable item "+b.id+" was dropped."},onDragCancel(a){let{active:b}=a;return"Dragging was cancelled. Draggable item "+b.id+" was dropped."}};function aB(a){let{announcements:b=aA,container:c,hiddenTextDescribedById:d,screenReaderInstructions:e=az}=a,{announce:f,announcement:g}=function(){let[a,b]=(0,n.useState)("");return{announce:(0,n.useCallback)(a=>{null!=a&&b(a)},[]),announcement:a}}(),h=an("DndLiveRegion"),[i,j]=(0,n.useState)(!1);(0,n.useEffect)(()=>{j(!0)},[]);var k=(0,n.useMemo)(()=>({onDragStart(a){let{active:c}=a;f(b.onDragStart({active:c}))},onDragMove(a){let{active:c,over:d}=a;b.onDragMove&&f(b.onDragMove({active:c,over:d}))},onDragOver(a){let{active:c,over:d}=a;f(b.onDragOver({active:c,over:d}))},onDragEnd(a){let{active:c,over:d}=a;f(b.onDragEnd({active:c,over:d}))},onDragCancel(a){let{active:c,over:d}=a;f(b.onDragCancel({active:c,over:d}))}}),[f,b]);let l=(0,n.useContext)(ay);if((0,n.useEffect)(()=>{if(!l)throw Error("useDndMonitor must be used within a children of <DndContext>");return l(k)},[k,l]),!i)return null;let m=n.default.createElement(n.default.Fragment,null,n.default.createElement(aw,{id:d,value:e.draggable}),n.default.createElement(ax,{id:h,announcement:g}));return c?(0,$.createPortal)(m,c):m}function aC(){}function aD(a,b){return(0,n.useMemo)(()=>({sensor:a,options:null!=b?b:{}}),[a,b])}!function(a){a.DragStart="dragStart",a.DragMove="dragMove",a.DragEnd="dragEnd",a.DragCancel="dragCancel",a.DragOver="dragOver",a.RegisterDroppable="registerDroppable",a.SetDroppableDisabled="setDroppableDisabled",a.UnregisterDroppable="unregisterDroppable"}(c||(c={}));let aE=Object.freeze({x:0,y:0});function aF(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))}function aG(a,b){let{data:{value:c}}=a,{data:{value:d}}=b;return c-d}function aH(a,b){let{data:{value:c}}=a,{data:{value:d}}=b;return d-c}function aI(a){let{left:b,top:c,height:d,width:e}=a;return[{x:b,y:c},{x:b+e,y:c},{x:b,y:c+d},{x:b+e,y:c+d}]}function aJ(a,b){if(!a||0===a.length)return null;let[c]=a;return b?c[b]:c}function aK(a,b,c){return void 0===b&&(b=a.left),void 0===c&&(c=a.top),{x:b+.5*a.width,y:c+.5*a.height}}let aL=a=>{let{collisionRect:b,droppableRects:c,droppableContainers:d}=a,e=aK(b,b.left,b.top),f=[];for(let a of d){let{id:b}=a,d=c.get(b);if(d){let c=aF(aK(d),e);f.push({id:b,data:{droppableContainer:a,value:c}})}}return f.sort(aG)},aM=a=>{let{collisionRect:b,droppableRects:c,droppableContainers:d}=a,e=[];for(let a of d){let{id:d}=a,f=c.get(d);if(f){let c=function(a,b){let c=Math.max(b.top,a.top),d=Math.max(b.left,a.left),e=Math.min(b.left+b.width,a.left+a.width),f=Math.min(b.top+b.height,a.top+a.height);if(d<e&&c<f){let g=b.width*b.height,h=a.width*a.height,i=(e-d)*(f-c);return Number((i/(g+h-i)).toFixed(4))}return 0}(f,b);c>0&&e.push({id:d,data:{droppableContainer:a,value:c}})}}return e.sort(aH)};function aN(a,b){return a&&b?{x:a.left-b.left,y:a.top-b.top}:aE}let aO=function(a){return function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return d.reduce((b,c)=>({...b,top:b.top+a*c.y,bottom:b.bottom+a*c.y,left:b.left+a*c.x,right:b.right+a*c.x}),{...b})}}(1),aP={ignoreTransform:!1};function aQ(a,b){void 0===b&&(b=aP);let c=a.getBoundingClientRect();if(b.ignoreTransform){let{transform:b,transformOrigin:d}=ab(a).getComputedStyle(a);b&&(c=function(a,b,c){let d=function(a){if(a.startsWith("matrix3d(")){let b=a.slice(9,-1).split(/, /);return{x:+b[12],y:+b[13],scaleX:+b[0],scaleY:+b[5]}}if(a.startsWith("matrix(")){let b=a.slice(7,-1).split(/, /);return{x:+b[4],y:+b[5],scaleX:+b[0],scaleY:+b[3]}}return null}(b);if(!d)return a;let{scaleX:e,scaleY:f,x:g,y:h}=d,i=a.left-g-(1-e)*parseFloat(c),j=a.top-h-(1-f)*parseFloat(c.slice(c.indexOf(" ")+1)),k=e?a.width/e:a.width,l=f?a.height/f:a.height;return{width:k,height:l,top:j,right:i+k,bottom:j+l,left:i}}(c,b,d))}let{top:d,left:e,width:f,height:g,bottom:h,right:i}=c;return{top:d,left:e,width:f,height:g,bottom:h,right:i}}function aR(a){return aQ(a,{ignoreTransform:!0})}function aS(a,b){let c=[];return a?function d(e){var f;if(null!=b&&c.length>=b||!e)return c;if(ac(e)&&null!=e.scrollingElement&&!c.includes(e.scrollingElement))return c.push(e.scrollingElement),c;if(!ad(e)||ae(e)||c.includes(e))return c;let g=ab(a).getComputedStyle(e);return(e!==a&&function(a,b){void 0===b&&(b=ab(a).getComputedStyle(a));let c=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{let d=b[a];return"string"==typeof d&&c.test(d)})}(e,g)&&c.push(e),void 0===(f=g)&&(f=ab(e).getComputedStyle(e)),"fixed"===f.position)?c:d(e.parentNode)}(a):c}function aT(a){let[b]=aS(a,1);return null!=b?b:null}function aU(a){return _(a)?a.scrollX:a.scrollLeft}function aV(a){return _(a)?a.scrollY:a.scrollTop}function aW(a){return{x:aU(a),y:aV(a)}}function aX(a){let b={x:0,y:0},c={height:a.clientHeight,width:a.clientWidth},d={x:a.scrollWidth-c.width,y:a.scrollHeight-c.height},e=a.scrollTop<=b.y,f=a.scrollLeft<=b.x;return{isTop:e,isLeft:f,isBottom:a.scrollTop>=d.y,isRight:a.scrollLeft>=d.x,maxScroll:d,minScroll:b}}!function(a){a[a.Forward=1]="Forward",a[a.Backward=-1]="Backward"}(d||(d={}));let aY={x:.2,y:.2};function aZ(a){return a.reduce((a,b)=>ap(a,aW(b)),aE)}let a$=[["x",["left","right"],function(a){return a.reduce((a,b)=>a+aU(b),0)}],["y",["top","bottom"],function(a){return a.reduce((a,b)=>a+aV(b),0)}]];class a_{constructor(a,b){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;let c=aS(b),d=aZ(c);for(let[b,e,f]of(this.rect={...a},this.width=a.width,this.height=a.height,a$))for(let a of e)Object.defineProperty(this,a,{get:()=>{let e=f(c),g=d[b]-e;return this.rect[a]+g},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class a0{constructor(a){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(a=>{var b;return null==(b=this.target)?void 0:b.removeEventListener(...a)})},this.target=a}add(a,b,c){var d;null==(d=this.target)||d.addEventListener(a,b,c),this.listeners.push([a,b,c])}}function a1(a,b){let c=Math.abs(a.x),d=Math.abs(a.y);return"number"==typeof b?Math.sqrt(c**2+d**2)>b:"x"in b&&"y"in b?c>b.x&&d>b.y:"x"in b?c>b.x:"y"in b&&d>b.y}function a2(a){a.preventDefault()}function a3(a){a.stopPropagation()}!function(a){a.Click="click",a.DragStart="dragstart",a.Keydown="keydown",a.ContextMenu="contextmenu",a.Resize="resize",a.SelectionChange="selectionchange",a.VisibilityChange="visibilitychange"}(e||(e={})),function(a){a.Space="Space",a.Down="ArrowDown",a.Right="ArrowRight",a.Left="ArrowLeft",a.Up="ArrowUp",a.Esc="Escape",a.Enter="Enter",a.Tab="Tab"}(f||(f={}));let a4={start:[f.Space,f.Enter],cancel:[f.Esc],end:[f.Space,f.Enter,f.Tab]},a5=(a,b)=>{let{currentCoordinates:c}=b;switch(a.code){case f.Right:return{...c,x:c.x+25};case f.Left:return{...c,x:c.x-25};case f.Down:return{...c,y:c.y+25};case f.Up:return{...c,y:c.y-25}}};class a6{constructor(a){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=a;let{event:{target:b}}=a;this.props=a,this.listeners=new a0(af(b)),this.windowListeners=new a0(ab(b)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(e.Resize,this.handleCancel),this.windowListeners.add(e.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(e.Keydown,this.handleKeyDown))}handleStart(){let{activeNode:a,onStart:b}=this.props,c=a.node.current;c&&function(a,b){if(void 0===b&&(b=aQ),!a)return;let{top:c,left:d,bottom:e,right:f}=b(a);aT(a)&&(e<=0||f<=0||c>=window.innerHeight||d>=window.innerWidth)&&a.scrollIntoView({block:"center",inline:"center"})}(c),b(aE)}handleKeyDown(a){if(ar(a)){let{active:b,context:c,options:d}=this.props,{keyboardCodes:e=a4,coordinateGetter:g=a5,scrollBehavior:h="smooth"}=d,{code:i}=a;if(e.end.includes(i))return void this.handleEnd(a);if(e.cancel.includes(i))return void this.handleCancel(a);let{collisionRect:j}=c.current,k=j?{x:j.left,y:j.top}:aE;this.referenceCoordinates||(this.referenceCoordinates=k);let l=g(a,{active:b,context:c.current,currentCoordinates:k});if(l){let b=aq(l,k),d={x:0,y:0},{scrollableAncestors:e}=c.current;for(let c of e){let e=a.code,{isTop:g,isRight:i,isLeft:j,isBottom:k,maxScroll:m,minScroll:n}=aX(c),o=function(a){if(a===document.scrollingElement){let{innerWidth:a,innerHeight:b}=window;return{top:0,left:0,right:a,bottom:b,width:a,height:b}}let{top:b,left:c,right:d,bottom:e}=a.getBoundingClientRect();return{top:b,left:c,right:d,bottom:e,width:a.clientWidth,height:a.clientHeight}}(c),p={x:Math.min(e===f.Right?o.right-o.width/2:o.right,Math.max(e===f.Right?o.left:o.left+o.width/2,l.x)),y:Math.min(e===f.Down?o.bottom-o.height/2:o.bottom,Math.max(e===f.Down?o.top:o.top+o.height/2,l.y))},q=e===f.Right&&!i||e===f.Left&&!j,r=e===f.Down&&!k||e===f.Up&&!g;if(q&&p.x!==l.x){let a=c.scrollLeft+b.x,g=e===f.Right&&a<=m.x||e===f.Left&&a>=n.x;if(g&&!b.y)return void c.scrollTo({left:a,behavior:h});g?d.x=c.scrollLeft-a:d.x=e===f.Right?c.scrollLeft-m.x:c.scrollLeft-n.x,d.x&&c.scrollBy({left:-d.x,behavior:h});break}if(r&&p.y!==l.y){let a=c.scrollTop+b.y,g=e===f.Down&&a<=m.y||e===f.Up&&a>=n.y;if(g&&!b.x)return void c.scrollTo({top:a,behavior:h});g?d.y=c.scrollTop-a:d.y=e===f.Down?c.scrollTop-m.y:c.scrollTop-n.y,d.y&&c.scrollBy({top:-d.y,behavior:h});break}}this.handleMove(a,ap(aq(l,this.referenceCoordinates),d))}}}handleMove(a,b){let{onMove:c}=this.props;a.preventDefault(),c(b)}handleEnd(a){let{onEnd:b}=this.props;a.preventDefault(),this.detach(),b()}handleCancel(a){let{onCancel:b}=this.props;a.preventDefault(),this.detach(),b()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function a7(a){return!!(a&&"distance"in a)}function a8(a){return!!(a&&"delay"in a)}a6.activators=[{eventName:"onKeyDown",handler:(a,b,c)=>{let{keyboardCodes:d=a4,onActivation:e}=b,{active:f}=c,{code:g}=a.nativeEvent;if(d.start.includes(g)){let b=f.activatorNode.current;return(!b||a.target===b)&&(a.preventDefault(),null==e||e({event:a.nativeEvent}),!0)}return!1}}];class a9{constructor(a,b,c){var d;void 0===c&&(c=function(a){let{EventTarget:b}=ab(a);return a instanceof b?a:af(a)}(a.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=a,this.events=b;let{event:e}=a,{target:f}=e;this.props=a,this.events=b,this.document=af(f),this.documentListeners=new a0(this.document),this.listeners=new a0(c),this.windowListeners=new a0(ab(f)),this.initialCoordinates=null!=(d=as(e))?d:aE,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){let{events:a,props:{options:{activationConstraint:b,bypassActivationConstraint:c}}}=this;if(this.listeners.add(a.move.name,this.handleMove,{passive:!1}),this.listeners.add(a.end.name,this.handleEnd),a.cancel&&this.listeners.add(a.cancel.name,this.handleCancel),this.windowListeners.add(e.Resize,this.handleCancel),this.windowListeners.add(e.DragStart,a2),this.windowListeners.add(e.VisibilityChange,this.handleCancel),this.windowListeners.add(e.ContextMenu,a2),this.documentListeners.add(e.Keydown,this.handleKeydown),b){if(null!=c&&c({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(a8(b)){this.timeoutId=setTimeout(this.handleStart,b.delay),this.handlePending(b);return}if(a7(b))return void this.handlePending(b)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(a,b){let{active:c,onPending:d}=this.props;d(c,a,this.initialCoordinates,b)}handleStart(){let{initialCoordinates:a}=this,{onStart:b}=this.props;a&&(this.activated=!0,this.documentListeners.add(e.Click,a3,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(e.SelectionChange,this.removeTextSelection),b(a))}handleMove(a){var b;let{activated:c,initialCoordinates:d,props:e}=this,{onMove:f,options:{activationConstraint:g}}=e;if(!d)return;let h=null!=(b=as(a))?b:aE,i=aq(d,h);if(!c&&g){if(a7(g)){if(null!=g.tolerance&&a1(i,g.tolerance))return this.handleCancel();if(a1(i,g.distance))return this.handleStart()}return a8(g)&&a1(i,g.tolerance)?this.handleCancel():void this.handlePending(g,i)}a.cancelable&&a.preventDefault(),f(h)}handleEnd(){let{onAbort:a,onEnd:b}=this.props;this.detach(),this.activated||a(this.props.active),b()}handleCancel(){let{onAbort:a,onCancel:b}=this.props;this.detach(),this.activated||a(this.props.active),b()}handleKeydown(a){a.code===f.Esc&&this.handleCancel()}removeTextSelection(){var a;null==(a=this.document.getSelection())||a.removeAllRanges()}}let ba={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class bb extends a9{constructor(a){let{event:b}=a;super(a,ba,af(b.target))}}bb.activators=[{eventName:"onPointerDown",handler:(a,b)=>{let{nativeEvent:c}=a,{onActivation:d}=b;return!!c.isPrimary&&0===c.button&&(null==d||d({event:c}),!0)}}];!function(a){a[a.RightClick=2]="RightClick"}(g||(g={}));!function(a){a[a.Pointer=0]="Pointer",a[a.DraggableRect=1]="DraggableRect"}(h||(h={})),function(a){a[a.TreeOrder=0]="TreeOrder",a[a.ReversedTreeOrder=1]="ReversedTreeOrder"}(i||(i={}));let bc={x:{[d.Backward]:!1,[d.Forward]:!1},y:{[d.Backward]:!1,[d.Forward]:!1}};!function(a){a[a.Always=0]="Always",a[a.BeforeDragging=1]="BeforeDragging",a[a.WhileDragging=2]="WhileDragging"}(j||(j={})),(k||(k={})).Optimized="optimized";let bd=new Map;function be(a,b){return aj(c=>a?c||("function"==typeof b?b(a):a):null,[b,a])}function bf(a){let{callback:b,disabled:c}=a;ah(b);let d=(0,n.useMemo)(()=>{},[c]);return(0,n.useEffect)(()=>()=>null==d?void 0:d.disconnect(),[d]),d}function bg(a){return new a_(aQ(a),a)}function bh(a,b,c){void 0===b&&(b=bg);let[d,e]=(0,n.useState)(null);function f(){e(d=>{if(!a)return null;if(!1===a.isConnected){var e;return null!=(e=null!=d?d:c)?e:null}let f=b(a);return JSON.stringify(d)===JSON.stringify(f)?d:f})}let g=function(a){let{callback:b,disabled:c}=a,d=ah(b),e=(0,n.useMemo)(()=>{},[d,c]);return(0,n.useEffect)(()=>()=>null==e?void 0:e.disconnect(),[e]),e}({callback(b){if(a)for(let c of b){let{type:b,target:d}=c;if("childList"===b&&d instanceof HTMLElement&&d.contains(a)){f();break}}}}),h=bf({callback:f});return ag(()=>{f(),a?(null==h||h.observe(a),null==g||g.observe(document.body,{childList:!0,subtree:!0})):(null==h||h.disconnect(),null==g||g.disconnect())},[a]),d}let bi=[];function bj(a,b){void 0===b&&(b=[]);let c=(0,n.useRef)(null);return(0,n.useEffect)(()=>{c.current=null},b),(0,n.useEffect)(()=>{let b=a!==aE;b&&!c.current&&(c.current=a),!b&&c.current&&(c.current=null)},[a]),c.current?aq(a,c.current):aE}function bk(a){return(0,n.useMemo)(()=>a?function(a){let b=a.innerWidth,c=a.innerHeight;return{top:0,left:0,right:b,bottom:c,width:b,height:c}}(a):null,[a])}let bl=[],bm=[{sensor:bb,options:{}},{sensor:a6,options:{}}],bn={current:{}},bo={draggable:{measure:aR},droppable:{measure:aR,strategy:j.WhileDragging,frequency:k.Optimized},dragOverlay:{measure:aQ}};class bp extends Map{get(a){var b;return null!=a&&null!=(b=super.get(a))?b:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(a=>{let{disabled:b}=a;return!b})}getNodeFor(a){var b,c;return null!=(b=null==(c=this.get(a))?void 0:c.node.current)?b:void 0}}let bq={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new bp,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:aC},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:bo,measureDroppableContainers:aC,windowRect:null,measuringScheduled:!1},br={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:aC,draggableNodes:new Map,over:null,measureDroppableContainers:aC},bs=(0,n.createContext)(br),bt=(0,n.createContext)(bq);function bu(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new bp}}}function bv(a,b){switch(b.type){case c.DragStart:return{...a,draggable:{...a.draggable,initialCoordinates:b.initialCoordinates,active:b.active}};case c.DragMove:if(null==a.draggable.active)return a;return{...a,draggable:{...a.draggable,translate:{x:b.coordinates.x-a.draggable.initialCoordinates.x,y:b.coordinates.y-a.draggable.initialCoordinates.y}}};case c.DragEnd:case c.DragCancel:return{...a,draggable:{...a.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case c.RegisterDroppable:{let{element:c}=b,{id:d}=c,e=new bp(a.droppable.containers);return e.set(d,c),{...a,droppable:{...a.droppable,containers:e}}}case c.SetDroppableDisabled:{let{id:c,key:d,disabled:e}=b,f=a.droppable.containers.get(c);if(!f||d!==f.key)return a;let g=new bp(a.droppable.containers);return g.set(c,{...f,disabled:e}),{...a,droppable:{...a.droppable,containers:g}}}case c.UnregisterDroppable:{let{id:c,key:d}=b,e=a.droppable.containers.get(c);if(!e||d!==e.key)return a;let f=new bp(a.droppable.containers);return f.delete(c),{...a,droppable:{...a.droppable,containers:f}}}default:return a}}function bw(a){let{disabled:b}=a,{active:c,activatorEvent:d,draggableNodes:e}=(0,n.useContext)(bs),f=al(d),g=al(null==c?void 0:c.id);return(0,n.useEffect)(()=>{if(!b&&!d&&f&&null!=g){if(!ar(f)||document.activeElement===f.target)return;let a=e.get(g);if(!a)return;let{activatorNode:b,node:c}=a;(b.current||c.current)&&requestAnimationFrame(()=>{for(let a of[b.current,c.current]){if(!a)continue;let b=a.matches(au)?a:a.querySelector(au);if(b){b.focus();break}}})}},[d,b,e,g,f]),null}let bx=(0,n.createContext)({...aE,scaleX:1,scaleY:1});!function(a){a[a.Uninitialized=0]="Uninitialized",a[a.Initializing=1]="Initializing",a[a.Initialized=2]="Initialized"}(l||(l={}));let by=(0,n.memo)(function(a){var b,e,f,g,k,m;let{id:o,accessibility:p,autoScroll:q=!0,children:r,sensors:s=bm,collisionDetection:t=aM,measuring:u,modifiers:v,...w}=a,[x,y]=(0,n.useReducer)(bv,void 0,bu),[z,A]=function(){let[a]=(0,n.useState)(()=>new Set),b=(0,n.useCallback)(b=>(a.add(b),()=>a.delete(b)),[a]);return[(0,n.useCallback)(b=>{let{type:c,event:d}=b;a.forEach(a=>{var b;return null==(b=a[c])?void 0:b.call(a,d)})},[a]),b]}(),[B,C]=(0,n.useState)(l.Uninitialized),D=B===l.Initialized,{draggable:{active:E,nodes:F,translate:G},droppable:{containers:H}}=x,I=null!=E?F.get(E):null,J=(0,n.useRef)({initial:null,translated:null}),K=(0,n.useMemo)(()=>{var a;return null!=E?{id:E,data:null!=(a=null==I?void 0:I.data)?a:bn,rect:J}:null},[E,I]),L=(0,n.useRef)(null),[M,N]=(0,n.useState)(null),[O,P]=(0,n.useState)(null),Q=ai(w,Object.values(w)),R=an("DndDescribedBy",o),S=(0,n.useMemo)(()=>H.getEnabled(),[H]),T=(0,n.useMemo)(()=>({draggable:{...bo.draggable,...null==u?void 0:u.draggable},droppable:{...bo.droppable,...null==u?void 0:u.droppable},dragOverlay:{...bo.dragOverlay,...null==u?void 0:u.dragOverlay}}),[null==u?void 0:u.draggable,null==u?void 0:u.droppable,null==u?void 0:u.dragOverlay]),{droppableRects:U,measureDroppableContainers:V,measuringScheduled:W}=function(a,b){let{dragging:c,dependencies:d,config:e}=b,[f,g]=(0,n.useState)(null),{frequency:h,measure:i,strategy:k}=e,l=(0,n.useRef)(a),m=function(){switch(k){case j.Always:return!1;case j.BeforeDragging:return c;default:return!c}}(),o=ai(m),p=(0,n.useCallback)(function(a){void 0===a&&(a=[]),o.current||g(b=>null===b?a:b.concat(a.filter(a=>!b.includes(a))))},[o]),q=(0,n.useRef)(null),r=aj(b=>{if(m&&!c)return bd;if(!b||b===bd||l.current!==a||null!=f){let b=new Map;for(let c of a){if(!c)continue;if(f&&f.length>0&&!f.includes(c.id)&&c.rect.current){b.set(c.id,c.rect.current);continue}let a=c.node.current,d=a?new a_(i(a),a):null;c.rect.current=d,d&&b.set(c.id,d)}return b}return b},[a,f,c,m,i]);return(0,n.useEffect)(()=>{l.current=a},[a]),(0,n.useEffect)(()=>{m||p()},[c,m]),(0,n.useEffect)(()=>{f&&f.length>0&&g(null)},[JSON.stringify(f)]),(0,n.useEffect)(()=>{m||"number"!=typeof h||null!==q.current||(q.current=setTimeout(()=>{p(),q.current=null},h))},[h,m,p,...d]),{droppableRects:r,measureDroppableContainers:p,measuringScheduled:null!=f}}(S,{dragging:D,dependencies:[G.x,G.y],config:T.droppable}),X=function(a,b){let c=null!=b?a.get(b):void 0,d=c?c.node.current:null;return aj(a=>{var c;return null==b?null:null!=(c=null!=d?d:a)?c:null},[d,b])}(F,E),Y=(0,n.useMemo)(()=>O?as(O):null,[O]),Z=function(){let a=(null==M?void 0:M.autoScrollEnabled)===!1,b="object"==typeof q?!1===q.enabled:!1===q,c=D&&!a&&!b;return"object"==typeof q?{...q,enabled:c}:{enabled:c}}(),_=be(X,T.draggable.measure);!function(a){let{activeNode:b,measure:c,initialRect:d,config:e=!0}=a,f=(0,n.useRef)(!1),{x:g,y:h}="boolean"==typeof e?{x:e,y:e}:e;ag(()=>{if(!g&&!h||!b){f.current=!1;return}if(f.current||!d)return;let a=null==b?void 0:b.node.current;if(!a||!1===a.isConnected)return;let e=aN(c(a),d);if(g||(e.x=0),h||(e.y=0),f.current=!0,Math.abs(e.x)>0||Math.abs(e.y)>0){let b=aT(a);b&&b.scrollBy({top:e.y,left:e.x})}},[b,g,h,d,c])}({activeNode:null!=E?F.get(E):null,config:Z.layoutShiftCompensation,initialRect:_,measure:T.draggable.measure});let aa=bh(X,T.draggable.measure,_),ac=bh(X?X.parentElement:null),ae=(0,n.useRef)({activatorEvent:null,active:null,activeNode:X,collisionRect:null,collisions:null,droppableRects:U,draggableNodes:F,draggingNode:null,draggingNodeRect:null,droppableContainers:H,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),af=H.getNodeFor(null==(b=ae.current.over)?void 0:b.id),ah=function(a){let{measure:b}=a,[c,d]=(0,n.useState)(null),e=bf({callback:(0,n.useCallback)(a=>{for(let{target:c}of a)if(ad(c)){d(a=>{let d=b(c);return a?{...a,width:d.width,height:d.height}:d});break}},[b])}),[f,g]=ak((0,n.useCallback)(a=>{let c=function(a){if(!a)return null;if(a.children.length>1)return a;let b=a.children[0];return ad(b)?b:a}(a);null==e||e.disconnect(),c&&(null==e||e.observe(c)),d(c?b(c):null)},[b,e]));return(0,n.useMemo)(()=>({nodeRef:f,rect:c,setRef:g}),[c,f,g])}({measure:T.dragOverlay.measure}),am=null!=(e=ah.nodeRef.current)?e:X,ao=D?null!=(f=ah.rect)?f:aa:null,aq=!!(ah.nodeRef.current&&ah.rect),ar=function(a){let b=be(a);return aN(a,b)}(aq?null:aa),at=bk(am?ab(am):null),au=function(a){let b=(0,n.useRef)(a),c=aj(c=>a?c&&c!==bi&&a&&b.current&&a.parentNode===b.current.parentNode?c:aS(a):bi,[a]);return(0,n.useEffect)(()=>{b.current=a},[a]),c}(D?null!=af?af:X:null),av=function(a,b){void 0===b&&(b=aQ);let[c]=a,d=bk(c?ab(c):null),[e,f]=(0,n.useState)(bl);function g(){f(()=>a.length?a.map(a=>new a_(b(a),a)):bl)}let h=bf({callback:g});return ag(()=>{null==h||h.disconnect(),g(),a.forEach(a=>null==h?void 0:h.observe(a))},[a]),e}(au),aw=function(a,b){let{transform:c,...d}=b;return null!=a&&a.length?a.reduce((a,b)=>b({transform:a,...d}),c):c}(v,{transform:{x:G.x-ar.x,y:G.y-ar.y,scaleX:1,scaleY:1},activatorEvent:O,active:K,activeNodeRect:aa,containerNodeRect:ac,draggingNodeRect:ao,over:ae.current.over,overlayNodeRect:ah.rect,scrollableAncestors:au,scrollableAncestorRects:av,windowRect:at}),ax=Y?ap(Y,G):null,az=function(a){let[b,c]=(0,n.useState)(null),d=(0,n.useRef)(a),e=(0,n.useCallback)(a=>{var b;let d=(b=a.target,null);d&&c(a=>a?(a.set(d,aW(d)),new Map(a)):null)},[]);return(0,n.useEffect)(()=>{let b=d.current;if(a!==b){f(b);let g=a.map(a=>{var b;let c=(b=0,null);return c?(c.addEventListener("scroll",e,{passive:!0}),[c,aW(c)]):null}).filter(a=>null!=a);c(g.length?new Map(g):null),d.current=a}return()=>{f(a),f(b)};function f(a){a.forEach(a=>{let b=null;null==b||b.removeEventListener("scroll",e)})}},[e,a]),(0,n.useMemo)(()=>a.length?b?Array.from(b.values()).reduce((a,b)=>ap(a,b),aE):aZ(a):aE,[a,b])}(au),aA=bj(az),aC=bj(az,[aa]),aD=ap(aw,aA),aF=ao?aO(ao,aw):null,aG=K&&aF?t({active:K,collisionRect:aF,droppableRects:U,droppableContainers:S,pointerCoordinates:ax}):null,aH=aJ(aG,"id"),[aI,aK]=(0,n.useState)(null),aL=(k=aq?aw:ap(aw,aC),m=null!=(g=null==aI?void 0:aI.rect)?g:null,{...k,scaleX:m&&aa?m.width/aa.width:1,scaleY:m&&aa?m.height/aa.height:1}),aP=(0,n.useRef)(null),aR=(0,n.useCallback)((a,b)=>{let{sensor:d,options:e}=b;if(null==L.current)return;let f=F.get(L.current);if(!f)return;let g=a.nativeEvent,h=new d({active:L.current,activeNode:f,event:g,options:e,context:ae,onAbort(a){if(!F.get(a))return;let{onDragAbort:b}=Q.current,c={id:a};null==b||b(c),z({type:"onDragAbort",event:c})},onPending(a,b,c,d){if(!F.get(a))return;let{onDragPending:e}=Q.current,f={id:a,constraint:b,initialCoordinates:c,offset:d};null==e||e(f),z({type:"onDragPending",event:f})},onStart(a){let b=L.current;if(null==b)return;let d=F.get(b);if(!d)return;let{onDragStart:e}=Q.current,f={activatorEvent:g,active:{id:b,data:d.data,rect:J}};(0,$.unstable_batchedUpdates)(()=>{null==e||e(f),C(l.Initializing),y({type:c.DragStart,initialCoordinates:a,active:b}),z({type:"onDragStart",event:f}),N(aP.current),P(g)})},onMove(a){y({type:c.DragMove,coordinates:a})},onEnd:i(c.DragEnd),onCancel:i(c.DragCancel)});function i(a){return async function(){let{active:b,collisions:d,over:e,scrollAdjustedTranslate:f}=ae.current,h=null;if(b&&f){let{cancelDrop:i}=Q.current;h={activatorEvent:g,active:b,collisions:d,delta:f,over:e},a===c.DragEnd&&"function"==typeof i&&await Promise.resolve(i(h))&&(a=c.DragCancel)}L.current=null,(0,$.unstable_batchedUpdates)(()=>{y({type:a}),C(l.Uninitialized),aK(null),N(null),P(null),aP.current=null;let b=a===c.DragEnd?"onDragEnd":"onDragCancel";if(h){let a=Q.current[b];null==a||a(h),z({type:b,event:h})}})}}aP.current=h},[F]),aU=(0,n.useCallback)((a,b)=>(c,d)=>{let e=c.nativeEvent,f=F.get(d);null!==L.current||!f||e.dndKit||e.defaultPrevented||!0===a(c,b.options,{active:f})&&(e.dndKit={capturedBy:b.sensor},L.current=d,aR(c,b))},[F,aR]),aV=(0,n.useMemo)(()=>s.reduce((a,b)=>{let{sensor:c}=b;return[...a,...c.activators.map(a=>({eventName:a.eventName,handler:aU(a.handler,b)}))]},[]),[s,aU]);(0,n.useEffect)(()=>{},s.map(a=>{let{sensor:b}=a;return b})),ag(()=>{aa&&B===l.Initializing&&C(l.Initialized)},[aa,B]),(0,n.useEffect)(()=>{let{onDragMove:a}=Q.current,{active:b,activatorEvent:c,collisions:d,over:e}=ae.current;if(!b||!c)return;let f={active:b,activatorEvent:c,collisions:d,delta:{x:aD.x,y:aD.y},over:e};(0,$.unstable_batchedUpdates)(()=>{null==a||a(f),z({type:"onDragMove",event:f})})},[aD.x,aD.y]),(0,n.useEffect)(()=>{let{active:a,activatorEvent:b,collisions:c,droppableContainers:d,scrollAdjustedTranslate:e}=ae.current;if(!a||null==L.current||!b||!e)return;let{onDragOver:f}=Q.current,g=d.get(aH),h=g&&g.rect.current?{id:g.id,rect:g.rect.current,data:g.data,disabled:g.disabled}:null,i={active:a,activatorEvent:b,collisions:c,delta:{x:e.x,y:e.y},over:h};(0,$.unstable_batchedUpdates)(()=>{aK(h),null==f||f(i),z({type:"onDragOver",event:i})})},[aH]),ag(()=>{ae.current={activatorEvent:O,active:K,activeNode:X,collisionRect:aF,collisions:aG,droppableRects:U,draggableNodes:F,draggingNode:am,draggingNodeRect:ao,droppableContainers:H,over:aI,scrollableAncestors:au,scrollAdjustedTranslate:aD},J.current={initial:ao,translated:aF}},[K,X,aG,aF,F,am,ao,U,H,aI,au,aD]),function(a){let{acceleration:b,activator:c=h.Pointer,canScroll:e,draggingRect:f,enabled:g,interval:j=5,order:k=i.TreeOrder,pointerCoordinates:l,scrollableAncestors:m,scrollableAncestorRects:o,delta:p,threshold:q}=a,r=function(a){let{delta:b,disabled:c}=a,e=al(b);return aj(a=>{if(c||!e||!a)return bc;let f={x:Math.sign(b.x-e.x),y:Math.sign(b.y-e.y)};return{x:{[d.Backward]:a.x[d.Backward]||-1===f.x,[d.Forward]:a.x[d.Forward]||1===f.x},y:{[d.Backward]:a.y[d.Backward]||-1===f.y,[d.Forward]:a.y[d.Forward]||1===f.y}}},[c,b,e])}({delta:p,disabled:!g}),[s,t]=function(){let a=(0,n.useRef)(null);return[(0,n.useCallback)((b,c)=>{a.current=setInterval(b,c)},[]),(0,n.useCallback)(()=>{null!==a.current&&(clearInterval(a.current),a.current=null)},[])]}(),u=(0,n.useRef)({x:0,y:0}),v=(0,n.useRef)({x:0,y:0}),w=(0,n.useMemo)(()=>{switch(c){case h.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case h.DraggableRect:return f}},[c,f,l]),x=(0,n.useRef)(null),y=(0,n.useCallback)(()=>{let a=x.current;if(!a)return;let b=u.current.x*v.current.x,c=u.current.y*v.current.y;a.scrollBy(b,c)},[]),z=(0,n.useMemo)(()=>k===i.TreeOrder?[...m].reverse():m,[k,m]);(0,n.useEffect)(()=>{if(!g||!m.length||!w)return void t();for(let a of z){if((null==e?void 0:e(a))===!1)continue;let c=o[m.indexOf(a)];if(!c)continue;let{direction:f,speed:g}=function(a,b,c,e,f){let{top:g,left:h,right:i,bottom:j}=c;void 0===e&&(e=10),void 0===f&&(f=aY);let{isTop:k,isBottom:l,isLeft:m,isRight:n}=aX(a),o={x:0,y:0},p={x:0,y:0},q={height:b.height*f.y,width:b.width*f.x};return!k&&g<=b.top+q.height?(o.y=d.Backward,p.y=e*Math.abs((b.top+q.height-g)/q.height)):!l&&j>=b.bottom-q.height&&(o.y=d.Forward,p.y=e*Math.abs((b.bottom-q.height-j)/q.height)),!n&&i>=b.right-q.width?(o.x=d.Forward,p.x=e*Math.abs((b.right-q.width-i)/q.width)):!m&&h<=b.left+q.width&&(o.x=d.Backward,p.x=e*Math.abs((b.left+q.width-h)/q.width)),{direction:o,speed:p}}(a,c,w,b,q);for(let a of["x","y"])r[a][f[a]]||(g[a]=0,f[a]=0);if(g.x>0||g.y>0){t(),x.current=a,s(y,j),u.current=g,v.current=f;return}}u.current={x:0,y:0},v.current={x:0,y:0},t()},[b,y,e,t,g,j,JSON.stringify(w),JSON.stringify(r),s,m,z,o,JSON.stringify(q)])}({...Z,delta:G,draggingRect:aF,pointerCoordinates:ax,scrollableAncestors:au,scrollableAncestorRects:av});let a$=(0,n.useMemo)(()=>({active:K,activeNode:X,activeNodeRect:aa,activatorEvent:O,collisions:aG,containerNodeRect:ac,dragOverlay:ah,draggableNodes:F,droppableContainers:H,droppableRects:U,over:aI,measureDroppableContainers:V,scrollableAncestors:au,scrollableAncestorRects:av,measuringConfiguration:T,measuringScheduled:W,windowRect:at}),[K,X,aa,O,aG,ac,ah,F,H,U,aI,V,au,av,T,W,at]),a0=(0,n.useMemo)(()=>({activatorEvent:O,activators:aV,active:K,activeNodeRect:aa,ariaDescribedById:{draggable:R},dispatch:y,draggableNodes:F,over:aI,measureDroppableContainers:V}),[O,aV,K,aa,y,R,F,aI,V]);return n.default.createElement(ay.Provider,{value:A},n.default.createElement(bs.Provider,{value:a0},n.default.createElement(bt.Provider,{value:a$},n.default.createElement(bx.Provider,{value:aL},r)),n.default.createElement(bw,{disabled:(null==p?void 0:p.restoreFocus)===!1})),n.default.createElement(aB,{...p,hiddenTextDescribedById:R}))}),bz=(0,n.createContext)(null),bA="button",bB={timeout:25},bC={position:"fixed",touchAction:"none"},bD=a=>ar(a)?"transform 250ms ease":void 0;b={styles:{active:{opacity:"0"}}},a=>{let{active:c,dragOverlay:d}=a,e={},{styles:f,className:g}=b;if(null!=f&&f.active)for(let[a,b]of Object.entries(f.active))void 0!==b&&(e[a]=c.node.style.getPropertyValue(a),c.node.style.setProperty(a,b));if(null!=f&&f.dragOverlay)for(let[a,b]of Object.entries(f.dragOverlay))void 0!==b&&d.node.style.setProperty(a,b);return null!=g&&g.active&&c.node.classList.add(g.active),null!=g&&g.dragOverlay&&d.node.classList.add(g.dragOverlay),function(){for(let[a,b]of Object.entries(e))c.node.style.setProperty(a,b);null!=g&&g.active&&c.node.classList.remove(g.active)}};function bE(a,b,c){let d=a.slice();return d.splice(c<0?d.length+c:c,0,d.splice(b,1)[0]),d}function bF(a){return null!==a&&a>=0}let bG=a=>{let{rects:b,activeIndex:c,overIndex:d,index:e}=a,f=bE(b,d,c),g=b[e],h=f[e];return h&&g?{x:h.left-g.left,y:h.top-g.top,scaleX:h.width/g.width,scaleY:h.height/g.height}:null},bH={scaleX:1,scaleY:1},bI=a=>{var b;let{activeIndex:c,activeNodeRect:d,index:e,rects:f,overIndex:g}=a,h=null!=(b=f[c])?b:d;if(!h)return null;if(e===c){let a=f[g];return a?{x:0,y:c<g?a.top+a.height-(h.top+h.height):a.top-h.top,...bH}:null}let i=function(a,b,c){let d=a[b],e=a[b-1],f=a[b+1];return d?c<b?e?d.top-(e.top+e.height):f?f.top-(d.top+d.height):0:f?f.top-(d.top+d.height):e?d.top-(e.top+e.height):0:0}(f,e,c);return e>c&&e<=g?{x:0,y:-h.height-i,...bH}:e<c&&e>=g?{x:0,y:h.height+i,...bH}:{x:0,y:0,...bH}},bJ="Sortable",bK=n.default.createContext({activeIndex:-1,containerId:bJ,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:bG,disabled:{draggable:!1,droppable:!1}});function bL(a){let{children:b,id:c,items:d,strategy:e=bG,disabled:f=!1}=a,{active:g,dragOverlay:h,droppableRects:i,over:j,measureDroppableContainers:k}=(0,n.useContext)(bt),l=an(bJ,c),m=null!==h.rect,o=(0,n.useMemo)(()=>d.map(a=>"object"==typeof a&&"id"in a?a.id:a),[d]),p=null!=g,q=g?o.indexOf(g.id):-1,r=j?o.indexOf(j.id):-1,s=(0,n.useRef)(o),t=!function(a,b){if(a===b)return!0;if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}(o,s.current),u=-1!==r&&-1===q||t,v="boolean"==typeof f?{draggable:f,droppable:f}:f;ag(()=>{t&&p&&k(o)},[t,o,p,k]),(0,n.useEffect)(()=>{s.current=o},[o]);let w=(0,n.useMemo)(()=>({activeIndex:q,containerId:l,disabled:v,disableTransforms:u,items:o,overIndex:r,useDragOverlay:m,sortedRects:o.reduce((a,b,c)=>{let d=i.get(b);return d&&(a[c]=d),a},Array(o.length)),strategy:e}),[q,l,v.draggable,v.droppable,u,o,r,i,m,e]);return n.default.createElement(bK.Provider,{value:w},b)}let bM=a=>{let{id:b,items:c,activeIndex:d,overIndex:e}=a;return bE(c,d,e).indexOf(b)},bN=a=>{let{containerId:b,isSorting:c,wasDragging:d,index:e,items:f,newIndex:g,previousItems:h,previousContainerId:i,transition:j}=a;return!!j&&!!d&&(h===f||e!==g)&&(!!c||g!==e&&b===i)},bO={duration:200,easing:"ease"},bP="transform",bQ=at.Transition.toString({property:bP,duration:0,easing:"linear"}),bR={roleDescription:"sortable"};function bS(a){if(!a)return!1;let b=a.data.current;return!!b&&"sortable"in b&&"object"==typeof b.sortable&&"containerId"in b.sortable&&"items"in b.sortable&&"index"in b.sortable}let bT=[f.Down,f.Right,f.Up,f.Left],bU=(a,b)=>{let{context:{active:c,collisionRect:d,droppableRects:e,droppableContainers:g,over:h,scrollableAncestors:i}}=b;if(bT.includes(a.code)){if(a.preventDefault(),!c||!d)return;let b=[];g.getEnabled().forEach(c=>{if(!c||null!=c&&c.disabled)return;let g=e.get(c.id);if(g)switch(a.code){case f.Down:d.top<g.top&&b.push(c);break;case f.Up:d.top>g.top&&b.push(c);break;case f.Left:d.left>g.left&&b.push(c);break;case f.Right:d.left<g.left&&b.push(c)}});let j=(a=>{let{collisionRect:b,droppableRects:c,droppableContainers:d}=a,e=aI(b),f=[];for(let a of d){let{id:b}=a,d=c.get(b);if(d){let c=aI(d),g=Number((e.reduce((a,b,d)=>a+aF(c[d],b),0)/4).toFixed(4));f.push({id:b,data:{droppableContainer:a,value:g}})}}return f.sort(aG)})({active:c,collisionRect:d,droppableRects:e,droppableContainers:b,pointerCoordinates:null}),k=aJ(j,"id");if(k===(null==h?void 0:h.id)&&j.length>1&&(k=j[1].id),null!=k){let a=g.get(c.id),b=g.get(k),f=b?e.get(b.id):null,h=null==b?void 0:b.node.current;if(h&&f&&a&&b){let c=aS(h).some((a,b)=>i[b]!==a),e=bV(a,b),g=function(a,b){return!!bS(a)&&!!bS(b)&&!!bV(a,b)&&a.data.current.sortable.index<b.data.current.sortable.index}(a,b),j=c||!e?{x:0,y:0}:{x:g?d.width-f.width:0,y:g?d.height-f.height:0},k={x:f.left,y:f.top};return j.x&&j.y?k:aq(k,j)}}}};function bV(a,b){return!!bS(a)&&!!bS(b)&&a.data.current.sortable.containerId===b.data.current.sortable.containerId}var bW=a.i(34157),bW=bW;let bX=(0,r.default)("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),bY=(0,r.default)("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);var bZ=a.i(96221);let b$=(0,r.default)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),b_=(0,r.default)("percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),b0=(0,r.default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),b1=(0,r.default)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);var b2=a.i(53071),b3=a.i(7554),b4=a.i(70121),b5=a.i(50104),b6=a.i(25152),b7=a.i(30553),b8=a.i(37738),b9=a.i(7827),ca=a.i(96743),cb=a.i(86228),cc=a.i(22297),cd=a.i(92843),ce=a.i(4691),cf=a.i(92616),cg=a.i(77192),ch=a.i(24050),ci=a.i(11011),cj=a.i(46872),ck=a.i(41852),cl=a.i(52081),cm=["Enter"," "],cn=["ArrowUp","PageDown","End"],co=["ArrowDown","PageUp","Home",...cn],cp={ltr:[...cm,"ArrowRight"],rtl:[...cm,"ArrowLeft"]},cq={ltr:["ArrowLeft"],rtl:["ArrowRight"]},cr="Menu",[cs,ct,cu]=(0,b8.createCollection)(cr),[cv,cw]=(0,b5.createContextScope)(cr,[cu,ce.createPopperScope,ch.createRovingFocusGroupScope]),cx=(0,ce.createPopperScope)(),cy=(0,ch.createRovingFocusGroupScope)(),[cz,cA]=cv(cr),[cB,cC]=cv(cr),cD=a=>{let{__scopeMenu:b,open:c=!1,children:d,dir:e,onOpenChange:f,modal:g=!0}=a,h=cx(b),[i,j]=n.useState(null),k=n.useRef(!1),l=(0,cj.useCallbackRef)(f),o=(0,b9.useDirection)(e);return n.useEffect(()=>{let a=()=>{k.current=!0,document.addEventListener("pointerdown",b,{capture:!0,once:!0}),document.addEventListener("pointermove",b,{capture:!0,once:!0})},b=()=>k.current=!1;return document.addEventListener("keydown",a,{capture:!0}),()=>{document.removeEventListener("keydown",a,{capture:!0}),document.removeEventListener("pointerdown",b,{capture:!0}),document.removeEventListener("pointermove",b,{capture:!0})}},[]),(0,m.jsx)(ce.Root,{...h,children:(0,m.jsx)(cz,{scope:b,open:c,onOpenChange:l,content:i,onContentChange:j,children:(0,m.jsx)(cB,{scope:b,onClose:n.useCallback(()=>l(!1),[l]),isUsingKeyboardRef:k,dir:o,modal:g,children:d})})})};cD.displayName=cr;var cE=n.forwardRef((a,b)=>{let{__scopeMenu:c,...d}=a,e=cx(c);return(0,m.jsx)(ce.Anchor,{...e,...d,ref:b})});cE.displayName="MenuAnchor";var cF="MenuPortal",[cG,cH]=cv(cF,{forceMount:void 0}),cI=a=>{let{__scopeMenu:b,forceMount:c,children:d,container:e}=a,f=cA(cF,b);return(0,m.jsx)(cG,{scope:b,forceMount:c,children:(0,m.jsx)(cg.Presence,{present:c||f.open,children:(0,m.jsx)(cf.Portal,{asChild:!0,container:e,children:d})})})};cI.displayName=cF;var cJ="MenuContent",[cK,cL]=cv(cJ),cM=n.forwardRef((a,b)=>{let c=cH(cJ,a.__scopeMenu),{forceMount:d=c.forceMount,...e}=a,f=cA(cJ,a.__scopeMenu),g=cC(cJ,a.__scopeMenu);return(0,m.jsx)(cs.Provider,{scope:a.__scopeMenu,children:(0,m.jsx)(cg.Presence,{present:d||f.open,children:(0,m.jsx)(cs.Slot,{scope:a.__scopeMenu,children:g.modal?(0,m.jsx)(cN,{...e,ref:b}):(0,m.jsx)(cO,{...e,ref:b})})})})}),cN=n.forwardRef((a,b)=>{let c=cA(cJ,a.__scopeMenu),d=n.useRef(null),e=(0,b4.useComposedRefs)(b,d);return n.useEffect(()=>{let a=d.current;if(a)return(0,ck.hideOthers)(a)},[]),(0,m.jsx)(cQ,{...a,ref:e,trapFocus:c.open,disableOutsidePointerEvents:c.open,disableOutsideScroll:!0,onFocusOutside:(0,b3.composeEventHandlers)(a.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>c.onOpenChange(!1)})}),cO=n.forwardRef((a,b)=>{let c=cA(cJ,a.__scopeMenu);return(0,m.jsx)(cQ,{...a,ref:b,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>c.onOpenChange(!1)})}),cP=(0,ci.createSlot)("MenuContent.ScrollLock"),cQ=n.forwardRef((a,b)=>{let{__scopeMenu:c,loop:d=!1,trapFocus:e,onOpenAutoFocus:f,onCloseAutoFocus:g,disableOutsidePointerEvents:h,onEntryFocus:i,onEscapeKeyDown:j,onPointerDownOutside:k,onFocusOutside:l,onInteractOutside:o,onDismiss:p,disableOutsideScroll:q,...r}=a,s=cA(cJ,c),t=cC(cJ,c),u=cx(c),v=cy(c),w=ct(c),[x,y]=n.useState(null),z=n.useRef(null),A=(0,b4.useComposedRefs)(b,z,s.onContentChange),B=n.useRef(0),C=n.useRef(""),D=n.useRef(0),E=n.useRef(null),F=n.useRef("right"),G=n.useRef(0),H=q?cl.RemoveScroll:n.Fragment;n.useEffect(()=>()=>window.clearTimeout(B.current),[]),(0,cb.useFocusGuards)();let I=n.useCallback(a=>F.current===E.current?.side&&function(a,b){return!!b&&function(a,b){let{x:c,y:d}=a,e=!1;for(let a=0,f=b.length-1;a<b.length;f=a++){let g=b[a],h=b[f],i=g.x,j=g.y,k=h.x,l=h.y;j>d!=l>d&&c<(k-i)*(d-j)/(l-j)+i&&(e=!e)}return e}({x:a.clientX,y:a.clientY},b)}(a,E.current?.area),[]);return(0,m.jsx)(cK,{scope:c,searchRef:C,onItemEnter:n.useCallback(a=>{I(a)&&a.preventDefault()},[I]),onItemLeave:n.useCallback(a=>{I(a)||(z.current?.focus(),y(null))},[I]),onTriggerLeave:n.useCallback(a=>{I(a)&&a.preventDefault()},[I]),pointerGraceTimerRef:D,onPointerGraceIntentChange:n.useCallback(a=>{E.current=a},[]),children:(0,m.jsx)(H,{...q?{as:cP,allowPinchZoom:!0}:void 0,children:(0,m.jsx)(cc.FocusScope,{asChild:!0,trapped:e,onMountAutoFocus:(0,b3.composeEventHandlers)(f,a=>{a.preventDefault(),z.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:g,children:(0,m.jsx)(ca.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:h,onEscapeKeyDown:j,onPointerDownOutside:k,onFocusOutside:l,onInteractOutside:o,onDismiss:p,children:(0,m.jsx)(ch.Root,{asChild:!0,...v,dir:t.dir,orientation:"vertical",loop:d,currentTabStopId:x,onCurrentTabStopIdChange:y,onEntryFocus:(0,b3.composeEventHandlers)(i,a=>{t.isUsingKeyboardRef.current||a.preventDefault()}),preventScrollOnEntryFocus:!0,children:(0,m.jsx)(ce.Content,{role:"menu","aria-orientation":"vertical","data-state":de(s.open),"data-radix-menu-content":"",dir:t.dir,...u,...r,ref:A,style:{outline:"none",...r.style},onKeyDown:(0,b3.composeEventHandlers)(r.onKeyDown,a=>{let b=a.target.closest("[data-radix-menu-content]")===a.currentTarget,c=a.ctrlKey||a.altKey||a.metaKey,d=1===a.key.length;b&&("Tab"===a.key&&a.preventDefault(),!c&&d&&(a=>{let b=C.current+a,c=w().filter(a=>!a.disabled),d=document.activeElement,e=c.find(a=>a.ref.current===d)?.textValue,f=function(a,b,c){var d;let e=b.length>1&&Array.from(b).every(a=>a===b[0])?b[0]:b,f=c?a.indexOf(c):-1,g=(d=Math.max(f,0),a.map((b,c)=>a[(d+c)%a.length]));1===e.length&&(g=g.filter(a=>a!==c));let h=g.find(a=>a.toLowerCase().startsWith(e.toLowerCase()));return h!==c?h:void 0}(c.map(a=>a.textValue),b,e),g=c.find(a=>a.textValue===f)?.ref.current;!function a(b){C.current=b,window.clearTimeout(B.current),""!==b&&(B.current=window.setTimeout(()=>a(""),1e3))}(b),g&&setTimeout(()=>g.focus())})(a.key));let e=z.current;if(a.target!==e||!co.includes(a.key))return;a.preventDefault();let f=w().filter(a=>!a.disabled).map(a=>a.ref.current);cn.includes(a.key)&&f.reverse(),function(a){let b=document.activeElement;for(let c of a)if(c===b||(c.focus(),document.activeElement!==b))return}(f)}),onBlur:(0,b3.composeEventHandlers)(a.onBlur,a=>{a.currentTarget.contains(a.target)||(window.clearTimeout(B.current),C.current="")}),onPointerMove:(0,b3.composeEventHandlers)(a.onPointerMove,dh(a=>{let b=a.target,c=G.current!==a.clientX;a.currentTarget.contains(b)&&c&&(F.current=a.clientX>G.current?"right":"left",G.current=a.clientX)}))})})})})})})});cM.displayName=cJ;var cR=n.forwardRef((a,b)=>{let{__scopeMenu:c,...d}=a;return(0,m.jsx)(b7.Primitive.div,{role:"group",...d,ref:b})});cR.displayName="MenuGroup";var cS=n.forwardRef((a,b)=>{let{__scopeMenu:c,...d}=a;return(0,m.jsx)(b7.Primitive.div,{...d,ref:b})});cS.displayName="MenuLabel";var cT="MenuItem",cU="menu.itemSelect",cV=n.forwardRef((a,b)=>{let{disabled:c=!1,onSelect:d,...e}=a,f=n.useRef(null),g=cC(cT,a.__scopeMenu),h=cL(cT,a.__scopeMenu),i=(0,b4.useComposedRefs)(b,f),j=n.useRef(!1);return(0,m.jsx)(cW,{...e,ref:i,disabled:c,onClick:(0,b3.composeEventHandlers)(a.onClick,()=>{let a=f.current;if(!c&&a){let b=new CustomEvent(cU,{bubbles:!0,cancelable:!0});a.addEventListener(cU,a=>d?.(a),{once:!0}),(0,b7.dispatchDiscreteCustomEvent)(a,b),b.defaultPrevented?j.current=!1:g.onClose()}}),onPointerDown:b=>{a.onPointerDown?.(b),j.current=!0},onPointerUp:(0,b3.composeEventHandlers)(a.onPointerUp,a=>{j.current||a.currentTarget?.click()}),onKeyDown:(0,b3.composeEventHandlers)(a.onKeyDown,a=>{let b=""!==h.searchRef.current;c||b&&" "===a.key||cm.includes(a.key)&&(a.currentTarget.click(),a.preventDefault())})})});cV.displayName=cT;var cW=n.forwardRef((a,b)=>{let{__scopeMenu:c,disabled:d=!1,textValue:e,...f}=a,g=cL(cT,c),h=cy(c),i=n.useRef(null),j=(0,b4.useComposedRefs)(b,i),[k,l]=n.useState(!1),[o,p]=n.useState("");return n.useEffect(()=>{let a=i.current;a&&p((a.textContent??"").trim())},[f.children]),(0,m.jsx)(cs.ItemSlot,{scope:c,disabled:d,textValue:e??o,children:(0,m.jsx)(ch.Item,{asChild:!0,...h,focusable:!d,children:(0,m.jsx)(b7.Primitive.div,{role:"menuitem","data-highlighted":k?"":void 0,"aria-disabled":d||void 0,"data-disabled":d?"":void 0,...f,ref:j,onPointerMove:(0,b3.composeEventHandlers)(a.onPointerMove,dh(a=>{d?g.onItemLeave(a):(g.onItemEnter(a),a.defaultPrevented||a.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:(0,b3.composeEventHandlers)(a.onPointerLeave,dh(a=>g.onItemLeave(a))),onFocus:(0,b3.composeEventHandlers)(a.onFocus,()=>l(!0)),onBlur:(0,b3.composeEventHandlers)(a.onBlur,()=>l(!1))})})})}),cX=n.forwardRef((a,b)=>{let{checked:c=!1,onCheckedChange:d,...e}=a;return(0,m.jsx)(c3,{scope:a.__scopeMenu,checked:c,children:(0,m.jsx)(cV,{role:"menuitemcheckbox","aria-checked":df(c)?"mixed":c,...e,ref:b,"data-state":dg(c),onSelect:(0,b3.composeEventHandlers)(e.onSelect,()=>d?.(!!df(c)||!c),{checkForDefaultPrevented:!1})})})});cX.displayName="MenuCheckboxItem";var cY="MenuRadioGroup",[cZ,c$]=cv(cY,{value:void 0,onValueChange:()=>{}}),c_=n.forwardRef((a,b)=>{let{value:c,onValueChange:d,...e}=a,f=(0,cj.useCallbackRef)(d);return(0,m.jsx)(cZ,{scope:a.__scopeMenu,value:c,onValueChange:f,children:(0,m.jsx)(cR,{...e,ref:b})})});c_.displayName=cY;var c0="MenuRadioItem",c1=n.forwardRef((a,b)=>{let{value:c,...d}=a,e=c$(c0,a.__scopeMenu),f=c===e.value;return(0,m.jsx)(c3,{scope:a.__scopeMenu,checked:f,children:(0,m.jsx)(cV,{role:"menuitemradio","aria-checked":f,...d,ref:b,"data-state":dg(f),onSelect:(0,b3.composeEventHandlers)(d.onSelect,()=>e.onValueChange?.(c),{checkForDefaultPrevented:!1})})})});c1.displayName=c0;var c2="MenuItemIndicator",[c3,c4]=cv(c2,{checked:!1}),c5=n.forwardRef((a,b)=>{let{__scopeMenu:c,forceMount:d,...e}=a,f=c4(c2,c);return(0,m.jsx)(cg.Presence,{present:d||df(f.checked)||!0===f.checked,children:(0,m.jsx)(b7.Primitive.span,{...e,ref:b,"data-state":dg(f.checked)})})});c5.displayName=c2;var c6=n.forwardRef((a,b)=>{let{__scopeMenu:c,...d}=a;return(0,m.jsx)(b7.Primitive.div,{role:"separator","aria-orientation":"horizontal",...d,ref:b})});c6.displayName="MenuSeparator";var c7=n.forwardRef((a,b)=>{let{__scopeMenu:c,...d}=a,e=cx(c);return(0,m.jsx)(ce.Arrow,{...e,...d,ref:b})});c7.displayName="MenuArrow";var[c8,c9]=cv("MenuSub"),da="MenuSubTrigger",db=n.forwardRef((a,b)=>{let c=cA(da,a.__scopeMenu),d=cC(da,a.__scopeMenu),e=c9(da,a.__scopeMenu),f=cL(da,a.__scopeMenu),g=n.useRef(null),{pointerGraceTimerRef:h,onPointerGraceIntentChange:i}=f,j={__scopeMenu:a.__scopeMenu},k=n.useCallback(()=>{g.current&&window.clearTimeout(g.current),g.current=null},[]);return n.useEffect(()=>k,[k]),n.useEffect(()=>{let a=h.current;return()=>{window.clearTimeout(a),i(null)}},[h,i]),(0,m.jsx)(cE,{asChild:!0,...j,children:(0,m.jsx)(cW,{id:e.triggerId,"aria-haspopup":"menu","aria-expanded":c.open,"aria-controls":e.contentId,"data-state":de(c.open),...a,ref:(0,b4.composeRefs)(b,e.onTriggerChange),onClick:b=>{a.onClick?.(b),a.disabled||b.defaultPrevented||(b.currentTarget.focus(),c.open||c.onOpenChange(!0))},onPointerMove:(0,b3.composeEventHandlers)(a.onPointerMove,dh(b=>{f.onItemEnter(b),!b.defaultPrevented&&(a.disabled||c.open||g.current||(f.onPointerGraceIntentChange(null),g.current=window.setTimeout(()=>{c.onOpenChange(!0),k()},100)))})),onPointerLeave:(0,b3.composeEventHandlers)(a.onPointerLeave,dh(a=>{k();let b=c.content?.getBoundingClientRect();if(b){let d=c.content?.dataset.side,e="right"===d,g=b[e?"left":"right"],i=b[e?"right":"left"];f.onPointerGraceIntentChange({area:[{x:a.clientX+(e?-5:5),y:a.clientY},{x:g,y:b.top},{x:i,y:b.top},{x:i,y:b.bottom},{x:g,y:b.bottom}],side:d}),window.clearTimeout(h.current),h.current=window.setTimeout(()=>f.onPointerGraceIntentChange(null),300)}else{if(f.onTriggerLeave(a),a.defaultPrevented)return;f.onPointerGraceIntentChange(null)}})),onKeyDown:(0,b3.composeEventHandlers)(a.onKeyDown,b=>{let e=""!==f.searchRef.current;a.disabled||e&&" "===b.key||cp[d.dir].includes(b.key)&&(c.onOpenChange(!0),c.content?.focus(),b.preventDefault())})})})});db.displayName=da;var dc="MenuSubContent",dd=n.forwardRef((a,b)=>{let c=cH(cJ,a.__scopeMenu),{forceMount:d=c.forceMount,...e}=a,f=cA(cJ,a.__scopeMenu),g=cC(cJ,a.__scopeMenu),h=c9(dc,a.__scopeMenu),i=n.useRef(null),j=(0,b4.useComposedRefs)(b,i);return(0,m.jsx)(cs.Provider,{scope:a.__scopeMenu,children:(0,m.jsx)(cg.Presence,{present:d||f.open,children:(0,m.jsx)(cs.Slot,{scope:a.__scopeMenu,children:(0,m.jsx)(cQ,{id:h.contentId,"aria-labelledby":h.triggerId,...e,ref:j,align:"start",side:"rtl"===g.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:a=>{g.isUsingKeyboardRef.current&&i.current?.focus(),a.preventDefault()},onCloseAutoFocus:a=>a.preventDefault(),onFocusOutside:(0,b3.composeEventHandlers)(a.onFocusOutside,a=>{a.target!==h.trigger&&f.onOpenChange(!1)}),onEscapeKeyDown:(0,b3.composeEventHandlers)(a.onEscapeKeyDown,a=>{g.onClose(),a.preventDefault()}),onKeyDown:(0,b3.composeEventHandlers)(a.onKeyDown,a=>{let b=a.currentTarget.contains(a.target),c=cq[g.dir].includes(a.key);b&&c&&(f.onOpenChange(!1),h.trigger?.focus(),a.preventDefault())})})})})})});function de(a){return a?"open":"closed"}function df(a){return"indeterminate"===a}function dg(a){return df(a)?"indeterminate":a?"checked":"unchecked"}function dh(a){return b=>"mouse"===b.pointerType?a(b):void 0}dd.displayName=dc;var di="DropdownMenu",[dj,dk]=(0,b5.createContextScope)(di,[cw]),dl=cw(),[dm,dn]=dj(di),dp=a=>{let{__scopeDropdownMenu:b,children:c,dir:d,open:e,defaultOpen:f,onOpenChange:g,modal:h=!0}=a,i=dl(b),j=n.useRef(null),[k,l]=(0,b6.useControllableState)({prop:e,defaultProp:f??!1,onChange:g,caller:di});return(0,m.jsx)(dm,{scope:b,triggerId:(0,cd.useId)(),triggerRef:j,contentId:(0,cd.useId)(),open:k,onOpenChange:l,onOpenToggle:n.useCallback(()=>l(a=>!a),[l]),modal:h,children:(0,m.jsx)(cD,{...i,open:k,onOpenChange:l,dir:d,modal:h,children:c})})};dp.displayName=di;var dq="DropdownMenuTrigger",dr=n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,disabled:d=!1,...e}=a,f=dn(dq,c),g=dl(c);return(0,m.jsx)(cE,{asChild:!0,...g,children:(0,m.jsx)(b7.Primitive.button,{type:"button",id:f.triggerId,"aria-haspopup":"menu","aria-expanded":f.open,"aria-controls":f.open?f.contentId:void 0,"data-state":f.open?"open":"closed","data-disabled":d?"":void 0,disabled:d,...e,ref:(0,b4.composeRefs)(b,f.triggerRef),onPointerDown:(0,b3.composeEventHandlers)(a.onPointerDown,a=>{!d&&0===a.button&&!1===a.ctrlKey&&(f.onOpenToggle(),f.open||a.preventDefault())}),onKeyDown:(0,b3.composeEventHandlers)(a.onKeyDown,a=>{!d&&(["Enter"," "].includes(a.key)&&f.onOpenToggle(),"ArrowDown"===a.key&&f.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});dr.displayName=dq;var ds=a=>{let{__scopeDropdownMenu:b,...c}=a,d=dl(b);return(0,m.jsx)(cI,{...d,...c})};ds.displayName="DropdownMenuPortal";var dt="DropdownMenuContent",du=n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dn(dt,c),f=dl(c),g=n.useRef(!1);return(0,m.jsx)(cM,{id:e.contentId,"aria-labelledby":e.triggerId,...f,...d,ref:b,onCloseAutoFocus:(0,b3.composeEventHandlers)(a.onCloseAutoFocus,a=>{g.current||e.triggerRef.current?.focus(),g.current=!1,a.preventDefault()}),onInteractOutside:(0,b3.composeEventHandlers)(a.onInteractOutside,a=>{let b=a.detail.originalEvent,c=0===b.button&&!0===b.ctrlKey,d=2===b.button||c;(!e.modal||d)&&(g.current=!0)}),style:{...a.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});du.displayName=dt,n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dl(c);return(0,m.jsx)(cR,{...e,...d,ref:b})}).displayName="DropdownMenuGroup",n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dl(c);return(0,m.jsx)(cS,{...e,...d,ref:b})}).displayName="DropdownMenuLabel";var dv=n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dl(c);return(0,m.jsx)(cV,{...e,...d,ref:b})});dv.displayName="DropdownMenuItem",n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dl(c);return(0,m.jsx)(cX,{...e,...d,ref:b})}).displayName="DropdownMenuCheckboxItem",n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dl(c);return(0,m.jsx)(c_,{...e,...d,ref:b})}).displayName="DropdownMenuRadioGroup",n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dl(c);return(0,m.jsx)(c1,{...e,...d,ref:b})}).displayName="DropdownMenuRadioItem",n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dl(c);return(0,m.jsx)(c5,{...e,...d,ref:b})}).displayName="DropdownMenuItemIndicator",n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dl(c);return(0,m.jsx)(c6,{...e,...d,ref:b})}).displayName="DropdownMenuSeparator",n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dl(c);return(0,m.jsx)(c7,{...e,...d,ref:b})}).displayName="DropdownMenuArrow",n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dl(c);return(0,m.jsx)(db,{...e,...d,ref:b})}).displayName="DropdownMenuSubTrigger",n.forwardRef((a,b)=>{let{__scopeDropdownMenu:c,...d}=a,e=dl(c);return(0,m.jsx)(dd,{...e,...d,ref:b,style:{...a.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}).displayName="DropdownMenuSubContent",a.i(6406),a.i(11989),(0,r.default)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var dw=a.i(97895);function dx({...a}){return(0,m.jsx)(dp,{"data-slot":"dropdown-menu",...a})}function dy({...a}){return(0,m.jsx)(dr,{"data-slot":"dropdown-menu-trigger",...a})}function dz({className:a,sideOffset:b=4,...c}){return(0,m.jsx)(ds,{children:(0,m.jsx)(du,{"data-slot":"dropdown-menu-content",sideOffset:b,className:(0,dw.cn)("bg-white text-neutral-950 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border border-neutral-200 p-1 shadow-md dark:bg-neutral-950 dark:text-neutral-50 dark:border-neutral-800",a),...c})})}function dA({className:a,inset:b,variant:c="default",...d}){return(0,m.jsx)(dv,{"data-slot":"dropdown-menu-item","data-inset":b,"data-variant":c,className:(0,dw.cn)("focus:bg-neutral-100 focus:text-neutral-900 data-[variant=destructive]:text-red-500 data-[variant=destructive]:focus:bg-red-500/10 dark:data-[variant=destructive]:focus:bg-red-500/20 data-[variant=destructive]:focus:text-red-500 data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-neutral-500 relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 dark:focus:bg-neutral-800 dark:focus:text-neutral-50 dark:data-[variant=destructive]:text-red-900 dark:data-[variant=destructive]:focus:bg-red-900/10 dark:dark:data-[variant=destructive]:focus:bg-red-900/20 dark:data-[variant=destructive]:focus:text-red-900 dark:[&_svg:not([class*='text-'])]:text-neutral-400",a),...d})}let dB="var(--field-border)",dC="#3d3d3a",dD="#73726c",dE=a=>`${a}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,dF=a=>"item"===a.type,dG=a=>({id:a.id,productId:a.productId,name:a.name,description:a.description,qty:a.qty,price:a.price,discount:a.discount,unit:a.unit}),dH=(a,b=!1)=>({id:dE("variant"),name:a,description:"",isRecommended:b,rows:[]}),dI=(a={})=>({type:"item",id:dE("item"),name:a.name??"",description:a.description??"",qty:Number.isFinite(a.qty)?Number(a.qty):1,price:Number.isFinite(a.price)?Number(a.price):0,discount:Number.isFinite(a.discount)?Number(a.discount):0,unit:a.unit??"шт",productId:a.productId,groupId:a.groupId}),dJ=(a,b)=>new Intl.NumberFormat("ru-RU",{style:"currency",currency:b,maximumFractionDigits:2}).format(a);function dK({id:a,className:b,style:d,children:e}){let{attributes:f,listeners:g,setActivatorNodeRef:h,setNodeRef:i,transform:j,transition:k,isDragging:l}=function(a){var b,d,e,f;let{animateLayoutChanges:g=bN,attributes:h,disabled:i,data:j,getNewIndex:k=bM,id:l,strategy:m,resizeObserverConfig:o,transition:p=bO}=a,{items:q,containerId:r,activeIndex:s,disabled:t,disableTransforms:u,sortedRects:v,overIndex:w,useDragOverlay:x,strategy:y}=(0,n.useContext)(bK),z=(b=i,d=t,"boolean"==typeof b?{draggable:b,droppable:!1}:{draggable:null!=(e=null==b?void 0:b.draggable)?e:d.draggable,droppable:null!=(f=null==b?void 0:b.droppable)?f:d.droppable}),A=q.indexOf(l),B=(0,n.useMemo)(()=>({sortable:{containerId:r,index:A,items:q},...j}),[r,j,A,q]),C=(0,n.useMemo)(()=>q.slice(q.indexOf(l)),[q,l]),{rect:D,node:E,isOver:F,setNodeRef:G}=function(a){let{data:b,disabled:d=!1,id:e,resizeObserverConfig:f}=a,g=an("Droppable"),{active:h,dispatch:i,over:j,measureDroppableContainers:k}=(0,n.useContext)(bs),l=(0,n.useRef)({disabled:d}),m=(0,n.useRef)(!1),o=(0,n.useRef)(null),p=(0,n.useRef)(null),{disabled:q,updateMeasurementsFor:r,timeout:s}={...bB,...f},t=ai(null!=r?r:e),u=bf({callback:(0,n.useCallback)(()=>{if(!m.current){m.current=!0;return}null!=p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{k(Array.isArray(t.current)?t.current:[t.current]),p.current=null},s)},[s]),disabled:q||!h}),[v,w]=ak((0,n.useCallback)((a,b)=>{u&&(b&&(u.unobserve(b),m.current=!1),a&&u.observe(a))},[u])),x=ai(b);return(0,n.useEffect)(()=>{u&&v.current&&(u.disconnect(),m.current=!1,u.observe(v.current))},[v,u]),(0,n.useEffect)(()=>(i({type:c.RegisterDroppable,element:{id:e,key:g,disabled:d,node:v,rect:o,data:x}}),()=>i({type:c.UnregisterDroppable,key:g,id:e})),[e]),(0,n.useEffect)(()=>{d!==l.current.disabled&&(i({type:c.SetDroppableDisabled,id:e,key:g,disabled:d}),l.current.disabled=d)},[e,g,d,i]),{active:h,rect:o,isOver:(null==j?void 0:j.id)===e,node:v,over:j,setNodeRef:w}}({id:l,data:B,disabled:z.droppable,resizeObserverConfig:{updateMeasurementsFor:C,...o}}),{active:H,activatorEvent:I,activeNodeRect:J,attributes:K,setNodeRef:L,listeners:M,isDragging:N,over:O,setActivatorNodeRef:P,transform:Q}=function(a){let{id:b,data:c,disabled:d=!1,attributes:e}=a,f=an("Draggable"),{activators:g,activatorEvent:h,active:i,activeNodeRect:j,ariaDescribedById:k,draggableNodes:l,over:m}=(0,n.useContext)(bs),{role:o=bA,roleDescription:p="draggable",tabIndex:q=0}=null!=e?e:{},r=(null==i?void 0:i.id)===b,s=(0,n.useContext)(r?bx:bz),[t,u]=ak(),[v,w]=ak(),x=(0,n.useMemo)(()=>g.reduce((a,c)=>{let{eventName:d,handler:e}=c;return a[d]=a=>{e(a,b)},a},{}),[g,b]),y=ai(c);return ag(()=>(l.set(b,{id:b,key:f,node:t,activatorNode:v,data:y}),()=>{let a=l.get(b);a&&a.key===f&&l.delete(b)}),[l,b]),{active:i,activatorEvent:h,activeNodeRect:j,attributes:(0,n.useMemo)(()=>({role:o,tabIndex:q,"aria-disabled":d,"aria-pressed":!!r&&o===bA||void 0,"aria-roledescription":p,"aria-describedby":k.draggable}),[d,o,q,r,p,k.draggable]),isDragging:r,listeners:d?void 0:x,node:t,over:m,setNodeRef:u,setActivatorNodeRef:w,transform:s}}({id:l,data:B,attributes:{...bR,...h},disabled:z.draggable}),R=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return(0,n.useMemo)(()=>a=>{b.forEach(b=>b(a))},b)}(G,L),S=!!H,T=S&&!u&&bF(s)&&bF(w),U=!x&&N,V=U&&T?Q:null,W=T?null!=V?V:(null!=m?m:y)({rects:v,activeNodeRect:J,activeIndex:s,overIndex:w,index:A}):null,X=bF(s)&&bF(w)?k({id:l,items:q,activeIndex:s,overIndex:w}):A,Y=null==H?void 0:H.id,Z=(0,n.useRef)({activeId:Y,items:q,newIndex:X,containerId:r}),$=q!==Z.current.items,_=g({active:H,containerId:r,isDragging:N,isSorting:S,id:l,index:A,items:q,newIndex:Z.current.newIndex,previousItems:Z.current.items,previousContainerId:Z.current.containerId,transition:p,wasDragging:null!=Z.current.activeId}),aa=function(a){let{disabled:b,index:c,node:d,rect:e}=a,[f,g]=(0,n.useState)(null),h=(0,n.useRef)(c);return ag(()=>{if(!b&&c!==h.current&&d.current){let a=e.current;if(a){let b=aQ(d.current,{ignoreTransform:!0}),c={x:a.left-b.left,y:a.top-b.top,scaleX:a.width/b.width,scaleY:a.height/b.height};(c.x||c.y)&&g(c)}}c!==h.current&&(h.current=c)},[b,c,d,e]),(0,n.useEffect)(()=>{f&&g(null)},[f]),f}({disabled:!_,index:A,node:E,rect:D});return(0,n.useEffect)(()=>{S&&Z.current.newIndex!==X&&(Z.current.newIndex=X),r!==Z.current.containerId&&(Z.current.containerId=r),q!==Z.current.items&&(Z.current.items=q)},[S,X,r,q]),(0,n.useEffect)(()=>{if(Y===Z.current.activeId)return;if(null!=Y&&null==Z.current.activeId){Z.current.activeId=Y;return}let a=setTimeout(()=>{Z.current.activeId=Y},50);return()=>clearTimeout(a)},[Y]),{active:H,activeIndex:s,attributes:K,data:B,rect:D,index:A,newIndex:X,items:q,isOver:F,isSorting:S,isDragging:N,listeners:M,node:E,overIndex:w,over:O,setNodeRef:R,setActivatorNodeRef:P,setDroppableNodeRef:G,setDraggableNodeRef:L,transform:null!=aa?aa:W,transition:aa||$&&Z.current.newIndex===A?bQ:(!U||ar(I))&&p&&(S||_)?at.Transition.toString({...p,property:bP}):void 0}}({id:a}),o={...d,transform:at.Transform.toString(j),transition:k,opacity:l?.9:1,zIndex:l?2:1,position:"relative"};return(0,m.jsx)("tr",{ref:i,className:b,style:o,children:e({attributes:f,listeners:g,setActivatorNodeRef:h})})}function dL({proposal:a,onUpdate:b}){var c;let[d,e]=(0,n.useState)(!1),[f,g]=(0,n.useState)([]),[h,i]=(0,n.useState)([]),[j,k]=(0,n.useState)(""),[l,o]=(0,n.useState)(!1),[p,q]=(0,n.useState)(new Set),r=(0,n.useMemo)(()=>(a=>{if("variants"===a.pricingMode&&Array.isArray(a.productVariants)&&a.productVariants.length>0)return a.productVariants;let b=Array.isArray(a.items)?a.items:[];return[{...dH("Вариант 1",!0),rows:b.map(a=>dI({id:a.id||dE("item"),productId:a.productId,name:a.name,description:a.description,qty:a.qty,price:a.price,discount:a.discount,unit:a.unit}))}]})(a),[a]),s=(0,n.useMemo)(()=>({showDiscountColumn:a.productsView?.showDiscountColumn??!0,showUnitColumn:a.productsView?.showUnitColumn??!0}),[a.productsView]),t=r.some(b=>b.id===a.activeVariantId)?a.activeVariantId:r[0]?.id,u=(0,n.useMemo)(()=>r.find(a=>a.id===t)??r[0]??null,[r,t]),v=(0,n.useCallback)((a,c)=>{let d=a.some(a=>a.id===c)?c:a[0]?.id,e=a.find(a=>a.id===d)??a[0],f=(e?.rows??[]).filter(dF).map(dG);b("pricingMode","variants"),b("productVariants",a),b("activeVariantId",d),b("productsView",s),b("items",f)},[b,s]);(0,n.useEffect)(()=>{"variants"===a.pricingMode&&Array.isArray(a.productVariants)&&0!==a.productVariants.length&&a.activeVariantId&&a.productsView||v(r,t)},[a.pricingMode,a.productVariants,a.activeVariantId,a.productsView,t,v,r]);let w=(0,n.useCallback)(a=>{u&&t&&v(r.map(b=>b.id===t?{...b,rows:a(b.rows)}:b),t)},[u,t,v,r]),x=(0,n.useCallback)(async()=>{o(!0);try{let a=await fetch("/api/products");if(a.ok){let b=await a.json(),c=Array.isArray(b.products)?b.products:[];g(c),i(c)}}catch(a){console.error("Failed to fetch catalog products:",a)}finally{o(!1)}},[]);(0,n.useEffect)(()=>{d&&0===f.length&&x()},[f.length,x,d]),(0,n.useEffect)(()=>{if(!j.trim())return void i(f);let a=j.toLowerCase();i(f.filter(b=>b.name.toLowerCase().includes(a)||b.sku?.toLowerCase().includes(a)||b.description?.toLowerCase().includes(a)))},[f,j]);let y=(0,n.useMemo)(()=>u?u.rows.filter(dF):[],[u]),z=J(y),A=L({...a,items:y}),B=K({...a,items:y}),C={RUB:"₽",USD:"$",EUR:"€"}[c=a.currency]??c,D=3+ +!!s.showUnitColumn+ +!!s.showDiscountColumn,E=a=>{u&&t&&v(r.map(b=>b.id===t?{...b,...a}:b),t)},F=()=>{w(a=>[...a,{id:dE("group"),type:"group",title:`Группа ${a.filter(a=>"group"===a.type).length+1}`}])},G=()=>{w(a=>{let b=[...a].reverse().find(a=>"group"===a.type);return[...a,dI({groupId:b?.id})]})},H=(a,b)=>{w(c=>c.map(c=>c.id===a&&"item"===c.type?{...c,...b}:c))},M=a=>{w(b=>b.filter(b=>b.id!==a))},N=(0,n.useMemo)(()=>u?u.rows.map(a=>a.id):[],[u]),O=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return(0,n.useMemo)(()=>[...b].filter(a=>null!=a),[...b])}(aD(bb,{activationConstraint:{distance:6}}),aD(a6,{coordinateGetter:bU})),Q=(0,n.useCallback)(a=>{let{active:b,over:c}=a;c&&b.id!==c.id&&w(a=>{let d=a.findIndex(a=>a.id===String(b.id)),e=a.findIndex(a=>a.id===String(c.id));return d<0||e<0||d===e?a:bE(a,d,e)})},[w]),R="inline-flex items-center gap-1.5 rounded-md border bg-white px-2.5 py-1.5 text-[13px] font-medium transition-colors hover:bg-[#fafaf7] focus:outline-none focus:ring-2 focus:ring-[var(--field-ring)]";return(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{className:"space-y-0",children:[(0,m.jsxs)("div",{className:"relative z-[1] -mb-px flex flex-wrap items-end gap-2",children:[r.map(b=>{let c=b.id===t;return(0,m.jsxs)("button",{type:"button",onClick:()=>{v(r,b.id)},className:"rounded-t-xl border px-4 py-2 text-left transition-colors",style:{borderColor:dB,borderBottomColor:c?"#ffffff":dB,backgroundColor:c?"#ffffff":"rgb(243, 242, 240)",color:dC,minWidth:180,zIndex:c?2:1},children:[(0,m.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,m.jsx)("span",{className:"text-sm font-semibold",children:b.name}),b.isRecommended?(0,m.jsx)("span",{className:"rounded-full bg-[#3CB371] px-2 py-0.5 text-[10px] font-semibold text-white",children:"Рекомендуем"}):null]}),(0,m.jsx)("p",{className:"mt-1 text-xs",style:{color:dD},children:dJ(J(b.rows.filter(dF)),a.currency)})]},b.id)}),r.length<3?(0,m.jsx)("button",{type:"button",onClick:()=>{if(r.length>=3)return;let a=dH(`Вариант ${r.length+1}`),b=r.map(a=>({...a,isRecommended:!!a.isRecommended}));b.some(a=>a.isRecommended)||(b[0]={...b[0],isRecommended:!0}),v([...b,a],a.id)},className:"inline-flex min-w-[180px] items-center rounded-t-xl border px-4 py-2 text-left transition-colors hover:bg-[#eceae3] focus:outline-none focus:ring-2 focus:ring-[var(--field-ring)]",style:{color:dC,borderColor:dB,backgroundColor:"rgb(243, 242, 240)"},children:(0,m.jsx)("span",{className:"text-sm font-semibold",children:"+ Вариант"})}):null]}),u?(0,m.jsxs)("div",{className:"rounded-b-xl rounded-tr-xl border bg-white p-4",style:{borderColor:dB},children:[(0,m.jsxs)("div",{className:"grid gap-4 md:grid-cols-[1.4fr_1fr]",children:[(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{className:"mb-2 flex h-7 items-center gap-2",children:[(0,m.jsx)("label",{className:"text-sm font-medium",style:{color:dC},children:"Название варианта"}),(0,m.jsxs)("button",{type:"button",onClick:()=>{var a;return a=u.id,void v(r.map(b=>({...b,isRecommended:b.id===a})),t)},className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium transition-colors hover:bg-[#f4f2ec] focus:outline-none focus:ring-2 focus:ring-[var(--field-ring)]",style:{color:dC},"aria-label":"Отметить вариант как рекомендуемый",title:"Отметить вариант как рекомендуемый",children:[(0,m.jsx)(b1,{className:`h-3.5 w-3.5 ${u.isRecommended?"fill-current":""}`,style:{color:u.isRecommended?"#3CB371":dD}}),"Рекомендуем"]})]}),(0,m.jsx)("input",{type:"text",value:u.name,onChange:a=>E({name:a.target.value}),className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",placeholder:"Вариант Стандартный"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{className:"mb-2 flex h-7 items-center",children:(0,m.jsx)("label",{className:"text-sm font-medium",style:{color:dC},children:"Описание варианта"})}),(0,m.jsx)("input",{type:"text",value:u.description??"",onChange:a=>E({description:a.target.value}),className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",placeholder:"Краткое описание"})]})]}),(0,m.jsxs)("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-2",children:[(0,m.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,m.jsxs)("button",{type:"button",onClick:G,className:R,style:{color:dC,borderColor:dB},children:[(0,m.jsx)(P.Plus,{className:"h-3.5 w-3.5"}),"Товар"]}),(0,m.jsxs)("button",{type:"button",onClick:F,className:R,style:{color:dC,borderColor:dB},children:[(0,m.jsx)(bX,{className:"h-3.5 w-3.5"}),"Группа"]}),(0,m.jsxs)("button",{type:"button",onClick:()=>e(!0),className:R,style:{color:dC,borderColor:dB},children:[(0,m.jsx)(b$,{className:"h-3.5 w-3.5"}),"Из каталога"]}),(0,m.jsxs)("button",{type:"button",onClick:()=>{var a;return a={showDiscountColumn:!s.showDiscountColumn},void b("productsView",{...s,...a})},className:R,style:{color:dC,borderColor:dB},children:[(0,m.jsx)(b_,{className:"h-3.5 w-3.5"}),s.showDiscountColumn?"Скрыть скидку":"Показать скидку"]})]}),r.length>1?(0,m.jsx)("button",{type:"button",onClick:()=>{if(!u||r.length<=1)return;let a=r.filter(a=>a.id!==u.id);a.some(a=>a.isRecommended)||(a[0]={...a[0],isRecommended:!0}),v(a,a[0]?.id)},className:"inline-flex h-8 w-8 items-center justify-center rounded-md border bg-white transition-colors hover:bg-rose-50 focus:outline-none focus:ring-2 focus:ring-[var(--field-ring)]",style:{color:"#b91c1c",borderColor:dB},"aria-label":"Удалить вариант",title:"Удалить вариант",children:(0,m.jsx)(Y.Trash2,{className:"h-4 w-4"})}):null]})]}):null]}),(0,m.jsx)(b2.Sheet,{open:d,onOpenChange:e,children:(0,m.jsxs)(b2.SheetContent,{side:"right",className:"w-full gap-0 border-l bg-[#F3F2F0] p-0 sm:max-w-xl",style:{borderColor:dB},children:[(0,m.jsxs)(b2.SheetHeader,{className:"border-b px-5 py-4",style:{borderColor:dB},children:[(0,m.jsx)(b2.SheetTitle,{className:"text-[15px] font-semibold tracking-[-0.2px]",style:{color:dC},children:"Добавить из каталога"}),(0,m.jsx)(b2.SheetDescription,{className:"text-[13px] leading-5",style:{color:dD},children:"Выберите товары для добавления в активный вариант"})]}),(0,m.jsxs)("div",{className:"flex min-h-0 flex-1 flex-col gap-3 p-4",children:[(0,m.jsxs)("div",{className:"relative",children:[(0,m.jsx)(b0,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2",style:{color:dD}}),(0,m.jsx)("input",{type:"text",value:j,onChange:a=>k(a.target.value),placeholder:"Поиск по названию или артикулу...",className:"w-full rounded-lg border border-[var(--field-border)] bg-white py-2.5 pl-10 pr-4 text-sm placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})]}),(0,m.jsx)("div",{className:"min-h-0 flex-1 overflow-y-auto rounded-lg border bg-white p-2",style:{borderColor:dB},children:l?(0,m.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,m.jsx)(bZ.Loader2,{className:"h-6 w-6 animate-spin text-[var(--field-focus)]"}),(0,m.jsx)("span",{className:"ml-2 text-sm",style:{color:dD},children:"Загрузка каталога..."})]}):0===h.length?(0,m.jsxs)("div",{className:"py-12 text-center",children:[(0,m.jsx)(b$,{className:"mx-auto h-10 w-10",style:{color:"#c8c6be"}}),(0,m.jsx)("p",{className:"mt-2 text-sm",style:{color:dD},children:j?"Товары не найдены":"Каталог пуст"})]}):(0,m.jsx)("div",{className:"space-y-2",children:h.map(b=>{let c,d=p.has(b.id),e=(c=b.id,y.some(a=>a.productId===c));return(0,m.jsx)("button",{type:"button",disabled:e,onClick:()=>{var a;return a=b.id,void q(b=>{let c=new Set(b);return c.has(a)?c.delete(a):c.add(a),c})},className:`w-full rounded-lg border p-3 text-left transition-colors ${e?"cursor-not-allowed opacity-70":"hover:bg-[#fafaf7]"}`,style:{borderColor:d?"#C6613F":e?"#d7d3c7":dB,backgroundColor:e?"#f5f4ef":d?"#FAEFEB":"#ffffff",...d?{boxShadow:"0 0 0 1px rgba(198, 97, 63, 0.18)"}:{}},children:(0,m.jsxs)("div",{className:"flex items-start gap-3",children:[(0,m.jsx)("div",{className:"mt-0.5 flex h-5 w-5 shrink-0 items-center justify-center rounded border",style:{borderColor:d?"#C6613F":dB,backgroundColor:e?"#d9d7cc":d?"#C6613F":"#ffffff"},children:(d||e)&&(0,m.jsx)(bW.default,{className:"h-3.5 w-3.5",style:{color:e?"#73726c":"#ffffff"}})}),(0,m.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[(0,m.jsx)("span",{className:"truncate text-sm font-medium",style:{color:dC},children:b.name}),b.sku?(0,m.jsx)("span",{className:"shrink-0 whitespace-nowrap text-xs",style:{color:dD},children:b.sku}):null,(0,m.jsx)("span",{className:"ml-auto shrink-0 whitespace-nowrap text-sm font-semibold",style:{color:dC},children:dJ(b.basePrice,a.currency)}),e?(0,m.jsx)("span",{className:"shrink-0 whitespace-nowrap text-xs",style:{color:dD},children:"Уже добавлен"}):null]})]})},b.id)})})}),p.size>0?(0,m.jsxs)("div",{className:"rounded-lg border bg-white p-3",style:{borderColor:dB},children:[(0,m.jsxs)("p",{className:"mb-2 text-xs",style:{color:dD},children:["Выбрано товаров: ",p.size]}),(0,m.jsxs)("button",{type:"button",onClick:()=>{u&&(w(a=>{let b=[...a].reverse().find(a=>"group"===a.type),c=[];return p.forEach(a=>{let d=f.find(b=>b.id===a);d&&c.push(dI({productId:d.id,name:d.name,description:d.description??"",qty:1,price:Number(d.basePrice)||0,unit:"шт",discount:0,groupId:b?.id}))}),[...a,...c]}),q(new Set),e(!1),k(""))},className:"w-full rounded-lg bg-[#C6613F] px-4 py-2.5 text-sm font-medium text-white transition-colors hover:bg-[#b95738] focus:outline-none focus:ring-2 focus:ring-[var(--field-ring)]",children:["Добавить выбранные (",p.size,")"]})]}):null]})]})}),u&&0!==u.rows.length?(0,m.jsxs)("div",{className:"overflow-hidden rounded-lg border text-[12px]",style:{borderColor:dB},children:[(0,m.jsx)(by,{sensors:O,collisionDetection:aL,onDragEnd:Q,children:(0,m.jsx)(bL,{items:N,strategy:bI,children:(0,m.jsx)("div",{className:"overflow-x-auto",children:(0,m.jsxs)("table",{className:"w-full min-w-[980px] table-fixed border-collapse",children:[(0,m.jsx)("thead",{style:{backgroundColor:"#FAFAFA"},children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{className:"w-[44px] border-b border-r border-[#E3E1D9] px-1 py-2 text-center text-[11px] font-semibold uppercase tracking-wide",style:{color:dD},children:(0,m.jsxs)(dx,{children:[(0,m.jsx)(dy,{asChild:!0,children:(0,m.jsx)("button",{type:"button",className:"inline-flex h-7 w-7 items-center justify-center rounded-md border bg-white text-[#3d3d3a] hover:bg-[#f4f2ec] focus:outline-none focus:ring-1 focus:ring-[var(--field-ring)]",style:{borderColor:dB},"aria-label":"Добавить строку",children:(0,m.jsx)(P.Plus,{className:"h-4 w-4"})})}),(0,m.jsxs)(dz,{align:"start",sideOffset:6,className:"w-56 border-[#E3E1D9]",children:[(0,m.jsxs)(dA,{onSelect:()=>G(),children:[(0,m.jsx)(P.Plus,{className:"h-4 w-4"}),"Добавить товар"]}),(0,m.jsxs)(dA,{onSelect:()=>F(),children:[(0,m.jsx)(bX,{className:"h-4 w-4"}),"Добавить группу товаров"]})]})]})}),(0,m.jsx)("th",{className:"border-b border-r border-[#E3E1D9] px-2 py-2 text-left text-[11px] font-semibold uppercase tracking-wide",style:{color:dD},children:"Наименование"}),(0,m.jsx)("th",{className:"w-[90px] border-b border-r border-[#E3E1D9] px-2 py-2 text-right text-[11px] font-semibold uppercase tracking-wide",style:{color:dD},children:"Кол-во"}),s.showUnitColumn?(0,m.jsx)("th",{className:"w-[72px] border-b border-r border-[#E3E1D9] px-2 py-2 text-left text-[11px] font-semibold uppercase tracking-wide",style:{color:dD},children:"Ед."}):null,(0,m.jsxs)("th",{className:"w-[120px] border-b border-r border-[#E3E1D9] px-2 py-2 text-right text-[11px] font-semibold uppercase tracking-wide",style:{color:dD},children:["Цена, ",C]}),s.showDiscountColumn?(0,m.jsx)("th",{className:"w-[76px] border-b border-r border-[#E3E1D9] px-2 py-2 text-right text-[11px] font-semibold uppercase tracking-wide",style:{color:dD},children:"Скидка"}):null,(0,m.jsxs)("th",{className:"w-[140px] border-b border-r border-[#E3E1D9] px-2 py-2 text-right text-[11px] font-semibold uppercase tracking-wide",style:{color:dD},children:["Сумма, ",C]}),(0,m.jsx)("th",{className:"w-[44px] border-b border-[#E3E1D9] px-1 py-2 text-right text-[11px] font-semibold uppercase tracking-wide",style:{color:dD}})]})}),(0,m.jsx)("tbody",{className:"bg-white",style:{borderTop:`1px solid ${dB}`},children:u.rows.map(a=>{if("group"===a.type)return(0,m.jsx)(dK,{id:a.id,style:{borderTop:`1px solid ${dB}`,backgroundColor:"rgb(243, 242, 240)"},children:({attributes:b,listeners:c,setActivatorNodeRef:d})=>(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("td",{className:"border-r border-[#E3E1D9] px-1 py-1.5 text-center",children:(0,m.jsx)("button",{type:"button",ref:d,...b,...c,className:"inline-flex h-7 w-7 cursor-grab items-center justify-center rounded-md text-[#73726c] hover:bg-[#e8e6de] active:cursor-grabbing","aria-label":"Перетащить строку группы",children:(0,m.jsx)(bY,{className:"h-4 w-4"})})}),(0,m.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,m.jsx)("input",{type:"text",value:a.title,onChange:b=>{var c,d;return c=a.id,d=b.target.value,void w(a=>a.map(a=>a.id===c&&"group"===a.type?{...a,title:d}:a))},className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-2 text-[12px] font-semibold text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",placeholder:"Название группы"})}),(0,m.jsx)("td",{colSpan:D,className:"border-r border-[#E3E1D9] px-2 py-1.5"}),(0,m.jsx)("td",{className:"px-1 py-1.5 text-center",children:(0,m.jsx)("button",{type:"button",onClick:()=>M(a.id),className:"inline-flex h-7 w-7 items-center justify-center rounded-md hover:bg-rose-50",style:{color:"#b91c1c"},children:(0,m.jsx)(Y.Trash2,{className:"h-4 w-4"})})})]})},a.id);let b=I(a);return(0,m.jsx)(dK,{id:a.id,style:{borderTop:`1px solid ${dB}`},className:"hover:bg-[#fafaf7]",children:({attributes:c,listeners:d,setActivatorNodeRef:e})=>(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("td",{className:"border-r border-[#E3E1D9] px-1 py-1.5 text-center",children:(0,m.jsx)("button",{type:"button",ref:e,...c,...d,className:"inline-flex h-7 w-7 cursor-grab items-center justify-center rounded-md text-[#73726c] hover:bg-[#f1f0eb] active:cursor-grabbing","aria-label":"Перетащить строку товара",children:(0,m.jsx)(bY,{className:"h-4 w-4"})})}),(0,m.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,m.jsx)("input",{type:"text",value:a.name,onChange:b=>H(a.id,{name:b.target.value}),className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-2 text-[12px] text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",placeholder:"Название товара"})}),(0,m.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,m.jsx)("input",{type:"number",min:"0",step:"0.01",value:a.qty,onChange:b=>H(a.id,{qty:Number(b.target.value)||0}),className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-2 text-right text-[12px] text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})}),s.showUnitColumn?(0,m.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,m.jsx)("input",{type:"text",value:a.unit??"шт",onChange:b=>H(a.id,{unit:b.target.value}),className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-2 text-[12px] text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})}):null,(0,m.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,m.jsx)("input",{type:"number",min:"0",step:"0.01",value:a.price,onChange:b=>H(a.id,{price:Number(b.target.value)||0}),className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-2 text-right text-[12px] text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})}),s.showDiscountColumn?(0,m.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,m.jsx)("input",{type:"number",min:"0",max:"100",step:"0.1",value:a.discount??0,onChange:b=>H(a.id,{discount:Number(b.target.value)||0}),className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-1.5 text-right text-[12px] text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})}):null,(0,m.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5 text-right text-[12px] font-semibold tabular-nums",style:{color:dC},children:new Intl.NumberFormat("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).format(b)}),(0,m.jsx)("td",{className:"px-1 py-1.5 text-center",children:(0,m.jsx)("button",{type:"button",onClick:()=>M(a.id),className:"inline-flex h-7 w-7 items-center justify-center rounded-md hover:bg-rose-50",style:{color:"#b91c1c"},children:(0,m.jsx)(Y.Trash2,{className:"h-4 w-4"})})})]})},a.id)})})]})})})}),(0,m.jsx)("div",{className:"border-t px-2 py-2",style:{borderColor:dB,backgroundColor:"#FAFAFA"},children:(0,m.jsxs)("div",{className:"ml-auto w-full max-w-[320px] space-y-1 text-[12px]",style:{color:dC},children:[(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsx)("span",{children:"Сумма без НДС"}),(0,m.jsx)("span",{className:"font-medium",children:dJ(z,a.currency)})]}),a.includeVat?(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("span",{children:["НДС (",a.vatRate,"%)"]}),(0,m.jsx)("span",{className:"font-medium",children:dJ(A,a.currency)})]}):null,(0,m.jsxs)("div",{className:"flex items-center justify-between border-t pt-2 text-[12px] font-semibold",style:{borderColor:dB},children:[(0,m.jsx)("span",{children:"Итого"}),(0,m.jsx)("span",{children:dJ(B,a.currency)})]})]})})]}):(0,m.jsxs)("div",{className:"rounded-lg border border-dashed bg-[#FAFAFA] px-6 py-12 text-center",style:{borderColor:dB},children:[(0,m.jsx)(b$,{className:"mx-auto h-12 w-12 text-slate-400"}),(0,m.jsx)("p",{className:"mt-3 text-sm font-medium",style:{color:dC},children:"Нет товаров или услуг"}),(0,m.jsx)("p",{className:"mt-1 text-xs",style:{color:dD},children:"Добавьте позиции вручную, группами или из каталога"})]})]})}function dM({proposal:a,onUpdate:b}){let c="custom"===a.paymentTerms;return(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"deadline",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Сроки выполнения"}),(0,m.jsx)("input",{id:"deadline",type:"text",value:a.deadline||"",onChange:a=>b("deadline",a.target.value),placeholder:"Например: 2 недели, до 31.12.2024",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,m.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Укажите примерный срок выполнения работ"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"payment-terms",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Условия оплаты"}),(0,m.jsx)("select",{id:"payment-terms",value:a.paymentTerms||"prepaid",onChange:a=>b("paymentTerms",a.target.value),className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",children:E.map(a=>(0,m.jsx)("option",{value:a.value,children:a.label},a.value))})]}),c&&(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"payment-custom",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Свои условия оплаты"}),(0,m.jsx)("textarea",{id:"payment-custom",value:a.paymentCustom||"",onChange:a=>b("paymentCustom",a.target.value),placeholder:"Опишите свои условия оплаты...",rows:3,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"valid-until",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Срок действия КП"}),(0,m.jsx)("input",{id:"valid-until",type:"date",value:a.validUntil?new Date(a.validUntil).toISOString().split("T")[0]:"",onChange:a=>b("validUntil",a.target.value?new Date(a.target.value):void 0),className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,m.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"По умолчанию +30 дней от даты создания"})]}),(0,m.jsxs)("div",{className:"flex items-center gap-3 rounded-lg bg-[#FAFAFA] p-4",children:[(0,m.jsx)("input",{id:"include-vat",type:"checkbox",checked:a.includeVat,onChange:a=>b("includeVat",a.target.checked),className:"h-4 w-4 rounded border-[var(--field-border)] text-[var(--field-focus)] focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,m.jsx)("label",{htmlFor:"include-vat",className:"flex-1 text-sm font-medium",style:{color:"#3d3d3a"},children:"Включить НДС"}),a.includeVat&&(0,m.jsxs)("div",{className:"flex items-center gap-2",children:[(0,m.jsx)("label",{htmlFor:"vat-rate",className:"text-sm",style:{color:"#3d3d3a"},children:"Ставка:"}),(0,m.jsx)("input",{id:"vat-rate",type:"number",min:"0",max:"100",step:"1",value:a.vatRate,onChange:a=>b("vatRate",parseInt(a.target.value)||0),className:"w-16 rounded-lg border border-[var(--field-border)] bg-white px-2 py-1 text-sm text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,m.jsx)("span",{className:"text-sm",style:{color:"#3d3d3a"},children:"%"})]})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Примечания"}),(0,m.jsx)("textarea",{id:"notes",value:a.notes||"",onChange:a=>b("notes",a.target.value),placeholder:"Дополнительные условия, примечания...",rows:3,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"}),(0,m.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Необязательное поле для дополнительных примечаний"})]})]})}let dN=(0,r.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var dO=a.i(62213),dO=dO;let dP=(0,r.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),dQ="hsl(30deg 3.3% 11.8% / 15%)",dR="#3d3d3a",dS="#73726c";function dT({proposal:a,onUpdate:b}){let[c,d]=(0,n.useState)(!1),e=a.galleryImages||[],f=(0,n.useCallback)(async a=>{if(!a||0===a.length)return;let c=6-e.length;if(c<=0)return void alert("Максимум 6 изображений в галерее");let f=Array.from(a).slice(0,c);d(!0);try{let a=f.map(async a=>{let b=new FormData;b.append("file",a);let c=await fetch("/api/upload",{method:"POST",body:b});if(!c.ok)throw Error("Upload failed");return(await c.json()).url}),c=await Promise.all(a);b("galleryImages",[...e,...c])}catch(a){console.error("Failed to upload images:",a),alert("Не удалось загрузить изображения")}finally{d(!1)}},[e,b]),g=(0,n.useCallback)(a=>{b("galleryImages",e.filter((b,c)=>c!==a))},[e,b]),h=(0,n.useCallback)(a=>{a.preventDefault(),a.stopPropagation()},[]),i=(0,n.useCallback)(a=>{a.preventDefault(),a.stopPropagation(),f(a.dataTransfer.files)},[f]);return(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("h3",{className:"mb-2 text-sm font-medium",style:{color:dR},children:"Галерея изображений"}),(0,m.jsx)("p",{className:"text-xs",style:{color:dS},children:"Добавьте до 6 изображений для демонстрации ваших работ или продукта"})]}),e.length<6&&(0,m.jsxs)("div",{onDragOver:h,onDrop:i,className:"relative rounded-lg border border-dashed bg-[#FAFAFA] px-6 py-8 text-center transition-colors",style:{borderColor:dQ},children:[(0,m.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:a=>f(a.target.files),disabled:c,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed"}),(0,m.jsx)(dN,{className:"mx-auto h-12 w-12",style:{color:dS}}),(0,m.jsx)("p",{className:"mt-2 text-sm font-medium",style:{color:dR},children:c?"Загрузка...":"Перетащите изображения или нажмите для выбора"}),(0,m.jsxs)("p",{className:"mt-1 text-xs",style:{color:dS},children:["PNG, JPG до 5MB. Осталось слотов: ",6-e.length]})]}),e.length>0&&(0,m.jsx)("div",{className:"grid grid-cols-2 gap-4",children:e.map((a,b)=>(0,m.jsxs)("div",{className:"group relative aspect-video overflow-hidden rounded-lg border bg-white",style:{borderColor:dQ},children:[(0,m.jsx)("img",{src:a,alt:`Gallery image ${b+1}`,className:"h-full w-full object-cover"}),(0,m.jsx)("button",{type:"button",onClick:()=>g(b),className:"absolute right-2 top-2 rounded-full bg-[#3d3d3a] p-1.5 text-white opacity-0 transition-opacity group-hover:opacity-100 hover:bg-red-600",title:"Удалить изображение",children:(0,m.jsx)(dO.default,{className:"h-4 w-4"})})]},b))}),0===e.length&&(0,m.jsxs)("div",{className:"rounded-lg border bg-[#FAFAFA] px-6 py-8 text-center",style:{borderColor:dQ},children:[(0,m.jsx)(dP,{className:"mx-auto h-12 w-12",style:{color:dS,opacity:.55}}),(0,m.jsx)("p",{className:"mt-3 text-sm font-medium",style:{color:dR},children:"Галерея пуста"}),(0,m.jsx)("p",{className:"mt-1 text-xs",style:{color:dS},children:"Добавьте изображения, чтобы они отображались в КП"})]})]})}function dU({proposal:a,onUpdate:b}){return(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"cta-text",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Призыв к действию (CTA)"}),(0,m.jsx)("textarea",{id:"cta-text",value:a.ctaText||"",onChange:a=>b("ctaText",a.target.value),placeholder:"Свяжитесь с нами для уточнения деталей и согласования сроков...",rows:3,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"}),(0,m.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Призыв к действию для клиента (например, «Свяжитесь с нами...»)"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"cta-phone",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Телефон для связи"}),(0,m.jsx)("input",{id:"cta-phone",type:"tel",value:a.ctaPhone||"",onChange:a=>b("ctaPhone",a.target.value),placeholder:"+7 (999) 123-45-67",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,m.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Телефон будет отображаться в конце КП"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"cta-email",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Email для связи"}),(0,m.jsx)("input",{id:"cta-email",type:"email",value:a.ctaEmail||"",onChange:a=>b("ctaEmail",a.target.value),placeholder:"info@company.ru",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,m.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Email будет отображаться в конце КП"})]}),(0,m.jsx)("div",{className:"rounded-lg border bg-[#FAEFEB] p-4",style:{borderColor:"#D8A18E"},children:(0,m.jsxs)("p",{className:"text-sm",style:{color:"#A04F33"},children:["💡 ",(0,m.jsx)("strong",{children:"Совет:"})," Если вы не заполните контакты здесь, они будут автоматически взяты из настроек вашего профиля компании."]})})]})}let dV=(0,r.default)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),dW=(0,r.default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),dX=[{id:"preset-minimal",name:"Минимальный",description:"Только основное: товары и условия",category:"minimal",defaults:{},sections:["basic","products","terms"],isDefault:!1},{id:"preset-standard",name:"Стандартный",description:"С описанием проблемы и решения",category:"standard",defaults:{},sections:["basic","context","advantages","products","terms","contacts"],isDefault:!0},{id:"preset-portfolio",name:"С портфолио",description:"Включает галерею работ",category:"with-gallery",defaults:{},sections:["basic","context","advantages","products","terms","gallery","contacts"],isDefault:!1}],dY={minimal:dV,standard:dW,"with-gallery":dP,custom:x};function dZ({onSelect:a,onClose:b}){let[c,d]=(0,n.useState)([]),[e,f]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/proposal-templates");if(a.ok){let b=await a.json();d(b)}}catch(a){console.error("Failed to fetch templates:",a)}finally{f(!1)}})()},[]);let g=c.some(a=>a.isDefault),h=[...dX.map(a=>({...a,isDefault:!g&&a.isDefault})),...c],i=c=>{a(c),b()};return(0,m.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,m.jsxs)("div",{className:"w-full max-w-3xl rounded-2xl bg-white p-6 shadow-2xl",children:[(0,m.jsxs)("div",{className:"mb-6",children:[(0,m.jsx)("h2",{className:"text-2xl font-bold text-slate-900",children:"Выберите шаблон"}),(0,m.jsx)("p",{className:"mt-1 text-sm text-slate-600",children:"Начните с готового шаблона или создайте КП с нуля"})]}),e?(0,m.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,m.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-[#C6613F] border-t-transparent"})}):(0,m.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[(0,m.jsxs)("button",{type:"button",onClick:()=>i(null),className:"group flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-slate-300 p-6 text-center transition-all hover:border-[#C6613F] hover:bg-[#FAEFEB]",children:[(0,m.jsx)("div",{className:"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-slate-100 text-slate-500 transition-colors group-hover:bg-[#F3DFD8] group-hover:text-[var(--field-focus)]",children:(0,m.jsx)(P.Plus,{className:"h-6 w-6"})}),(0,m.jsx)("h3",{className:"font-semibold text-slate-900",children:"Пустой"}),(0,m.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:"Начать с нуля"})]}),h.map(a=>{let b=dY[a.category||"custom"]||x,c=a.id.startsWith("preset-");return(0,m.jsxs)("button",{type:"button",onClick:()=>i(a),className:`group flex flex-col items-center rounded-xl border-2 p-6 text-center transition-all hover:border-[#C6613F] hover:bg-[#FAEFEB] ${a.isDefault?"border-[#D8A18E] bg-[#FAEFEB]":"border-slate-200 bg-white"}`,children:[(0,m.jsx)("div",{className:`mb-3 flex h-12 w-12 items-center justify-center rounded-full transition-colors ${a.isDefault?"bg-[#F3DFD8] text-[var(--field-focus)]":"bg-slate-100 text-slate-500 group-hover:bg-[#F3DFD8] group-hover:text-[var(--field-focus)]"}`,children:(0,m.jsx)(b,{className:"h-6 w-6"})}),(0,m.jsx)("h3",{className:"font-semibold text-slate-900",children:a.name}),a.description&&(0,m.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:a.description}),(0,m.jsxs)("div",{className:"mt-3 flex flex-wrap justify-center gap-1",children:[a.sections.slice(0,4).map(a=>(0,m.jsxs)("span",{className:"rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-medium text-slate-600",children:["basic"===a&&"Основное","context"===a&&"Контекст","advantages"===a&&"Преимущества","products"===a&&"Товары","terms"===a&&"Условия","gallery"===a&&"Галерея","contacts"===a&&"Контакты"]},a)),a.sections.length>4&&(0,m.jsxs)("span",{className:"rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-medium text-slate-600",children:["+",a.sections.length-4]})]}),a.isDefault&&(0,m.jsx)("span",{className:"mt-2 rounded-full bg-[#C6613F] px-2 py-0.5 text-[10px] font-medium text-white",children:"По умолчанию"}),!c&&!a.isDefault&&(0,m.jsx)("span",{className:"mt-2 rounded-full bg-slate-200 px-2 py-0.5 text-[10px] font-medium text-slate-600",children:"Пользовательский"})]},a.id)})]}),(0,m.jsx)("div",{className:"mt-6 flex justify-end",children:(0,m.jsx)("button",{type:"button",onClick:b,className:"rounded-lg px-4 py-2 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-100",children:"Отмена"})})]})})}var d$=a.i(99464);let d_=["basic","context","advantages","products","terms","gallery","contacts"],d0=["problemDesc","solutionDesc","additionalDesc","items","currency","pricingMode","productVariants","activeVariantId","productsView","deadline","paymentTerms","paymentCustom","includeVat","vatRate","galleryImages","advantages","advantagesColumns","ctaText","notes"],d1=new Set(d_),d2=a=>"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?`${a}-${crypto.randomUUID()}`:`${a}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,d3=a=>null==a?a:JSON.parse(JSON.stringify(a)),d4=a=>{if(!Array.isArray(a))return[...d_];let b=Array.from(new Set(a.filter(a=>"string"==typeof a&&d1.has(a))));return b.length>0?b:[...d_]},d5=async a=>{let b=await a.text();try{let c=JSON.parse(b);return c.message||c.error||b||`HTTP ${a.status}`}catch{return b||`HTTP ${a.status}`}};function d6({isOpen:a,proposal:b,visibleSections:c,onClose:d,onTemplatesChanged:e}){let[f,g]=(0,n.useState)([]),[h,i]=(0,n.useState)(!1),[j,k]=(0,n.useState)(!1),[l,o]=(0,n.useState)(null),[p,q]=(0,n.useState)(""),[r,s]=(0,n.useState)(""),[t,u]=(0,n.useState)(!1),v=f.length>0,w=(0,n.useCallback)(async()=>{i(!0);try{let a=await fetch("/api/proposal-templates");if(!a.ok)throw Error(await d5(a));let b=await a.json();g(b)}catch(a){console.error("Failed to load templates:",a),alert("Не удалось загрузить шаблоны")}finally{i(!1)}},[]);(0,n.useEffect)(()=>{a&&w()},[a,w]);let x=(0,n.useMemo)(()=>[...f].sort((a,b)=>a.isDefault===b.isDefault?0:a.isDefault?-1:1),[f]),y=async()=>{let a=p.trim();if(!a)return void alert("Введите название шаблона");k(!0);try{let{defaults:d,sections:f}={defaults:(a=>{if("object"!=typeof a||null===a||Array.isArray(a))return{};let b={};for(let c of d0){if(!(c in a))continue;let d=a[c];void 0!==d&&(b[c]=d3(d))}return b})(b),sections:d4(c??b.visibleSections)},g=await fetch("/api/proposal-templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:a,description:r.trim()||null,category:"custom",defaults:d,sections:f,isDefault:t})});if(!g.ok)throw Error(await d5(g));q(""),s(""),u(!1),await w(),e?.(),alert("Шаблон сохранён")}catch(a){console.error("Failed to create template:",a),alert(`Не удалось сохранить шаблон: ${a instanceof Error?a.message:"Ошибка"}`)}finally{k(!1)}},z=async(a,b)=>{o(a);try{let c=await fetch("/api/proposal-templates",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a,...b})});if(!c.ok)throw Error(await d5(c));await w(),e?.()}finally{o(null)}},A=async a=>{let b=window.prompt("Новое название шаблона",a.name);if(null===b)return;let c=b.trim();if(!c)return void alert("Название не может быть пустым");try{await z(a.id,{name:c})}catch(a){console.error("Failed to rename template:",a),alert(`Не удалось переименовать шаблон: ${a instanceof Error?a.message:"Ошибка"}`)}},B=async a=>{let b=window.prompt("Описание шаблона (можно оставить пустым)",a.description??"");if(null!==b)try{await z(a.id,{description:b})}catch(a){console.error("Failed to update description:",a),alert(`Не удалось обновить описание: ${a instanceof Error?a.message:"Ошибка"}`)}},C=async a=>{if(!a.isDefault)try{await z(a.id,{isDefault:!0})}catch(a){console.error("Failed to set default template:",a),alert(`Не удалось обновить шаблон по умолчанию: ${a instanceof Error?a.message:"Ошибка"}`)}},D=async a=>{if(window.confirm(`Удалить шаблон \xab${a.name}\xbb?`)){o(a.id);try{let b=await fetch("/api/proposal-templates",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id})});if(!b.ok)throw Error(await d5(b));await w(),e?.()}catch(a){console.error("Failed to delete template:",a),alert(`Не удалось удалить шаблон: ${a instanceof Error?a.message:"Ошибка"}`)}finally{o(null)}}};return a?(0,m.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,m.jsxs)("div",{className:"w-full max-w-4xl rounded-2xl bg-white p-6 shadow-2xl",children:[(0,m.jsxs)("div",{className:"mb-6",children:[(0,m.jsx)("h2",{className:"text-2xl font-bold text-slate-900",children:"Шаблоны"}),(0,m.jsx)("p",{className:"mt-1 text-sm text-slate-600",children:"Сохраняйте текущее КП как шаблон и управляйте шаблонами команды"})]}),(0,m.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[1.2fr_1fr]",children:[(0,m.jsxs)("section",{className:"rounded-xl border border-slate-200 p-4",children:[(0,m.jsx)("h3",{className:"mb-3 text-sm font-semibold text-slate-800",children:"Новый шаблон из текущего КП"}),(0,m.jsxs)("div",{className:"space-y-3",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"template-name",className:"mb-1 block text-xs font-medium text-slate-600",children:"Название"}),(0,m.jsx)("input",{id:"template-name",value:p,onChange:a=>q(a.target.value),placeholder:"Например: Продажа услуг / Базовый",className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 outline-none transition focus:border-[#C6613F]"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{htmlFor:"template-description",className:"mb-1 block text-xs font-medium text-slate-600",children:"Описание"}),(0,m.jsx)("textarea",{id:"template-description",value:r,onChange:a=>s(a.target.value),rows:3,placeholder:"Кратко: для какого сценария используется",className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 outline-none transition focus:border-[#C6613F]"})]}),(0,m.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-700",children:[(0,m.jsx)("input",{type:"checkbox",checked:t,onChange:a=>u(a.target.checked),className:"h-4 w-4 rounded border-slate-300 accent-[#C6613F]"}),"Сделать шаблоном по умолчанию"]}),(0,m.jsxs)("button",{type:"button",disabled:j,onClick:y,className:"inline-flex h-9 items-center gap-2 rounded-xl bg-[#C6613F] px-4 text-sm font-medium text-white transition hover:bg-[#A04F33] disabled:opacity-60",children:[j?(0,m.jsx)(bZ.Loader2,{className:"h-4 w-4 animate-spin"}):null,"Сохранить как шаблон"]})]})]}),(0,m.jsxs)("section",{className:"rounded-xl border border-slate-200 p-4",children:[(0,m.jsx)("h3",{className:"mb-3 text-sm font-semibold text-slate-800",children:"Мои шаблоны"}),h?(0,m.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,m.jsx)(bZ.Loader2,{className:"h-6 w-6 animate-spin text-[#C6613F]"})}):v?(0,m.jsx)("div",{className:"space-y-2",children:x.map(a=>{let b=l===a.id;return(0,m.jsxs)("div",{className:`rounded-lg border p-3 ${a.isDefault?"border-[#D8A18E] bg-[#FAEFEB]":"border-slate-200 bg-white"}`,children:[(0,m.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:a.name}),a.description?(0,m.jsx)("p",{className:"mt-0.5 text-xs text-slate-500",children:a.description}):null]}),a.isDefault?(0,m.jsx)("span",{className:"rounded-full bg-[#C6613F] px-2 py-0.5 text-[10px] font-medium text-white",children:"По умолчанию"}):null]}),(0,m.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,m.jsxs)("button",{type:"button",disabled:b,onClick:()=>A(a),className:"inline-flex h-7 items-center gap-1 rounded-md border border-slate-300 px-2 text-xs text-slate-700 transition hover:bg-slate-50 disabled:opacity-60",children:[(0,m.jsx)(d$.Pencil,{className:"h-3.5 w-3.5"}),"Переименовать"]}),(0,m.jsxs)("button",{type:"button",disabled:b,onClick:()=>B(a),className:"inline-flex h-7 items-center gap-1 rounded-md border border-slate-300 px-2 text-xs text-slate-700 transition hover:bg-slate-50 disabled:opacity-60",children:[(0,m.jsx)(d$.Pencil,{className:"h-3.5 w-3.5"}),"Описание"]}),(0,m.jsxs)("button",{type:"button",disabled:b||a.isDefault,onClick:()=>C(a),className:"inline-flex h-7 items-center gap-1 rounded-md border border-slate-300 px-2 text-xs text-slate-700 transition hover:bg-slate-50 disabled:opacity-60",children:[(0,m.jsx)(b1,{className:"h-3.5 w-3.5"}),"По умолчанию"]}),(0,m.jsxs)("button",{type:"button",disabled:b,onClick:()=>D(a),className:"inline-flex h-7 items-center gap-1 rounded-md border border-red-200 px-2 text-xs text-red-700 transition hover:bg-red-50 disabled:opacity-60",children:[b?(0,m.jsx)(bZ.Loader2,{className:"h-3.5 w-3.5 animate-spin"}):(0,m.jsx)(Y.Trash2,{className:"h-3.5 w-3.5"}),"Удалить"]})]})]},a.id)})}):(0,m.jsx)("p",{className:"text-sm text-slate-500",children:"Пока нет пользовательских шаблонов"})]})]}),(0,m.jsx)("div",{className:"mt-6 flex justify-end",children:(0,m.jsx)("button",{type:"button",onClick:d,className:"rounded-lg px-4 py-2 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-100",children:"Закрыть"})})]})}):null}let d7=[{id:"basic",title:"Основное",icon:"📄"},{id:"context",title:"Контекст",icon:"💡"},{id:"advantages",title:"Преимущества",icon:"✨"},{id:"products",title:"Продукты",icon:"📦"},{id:"terms",title:"Условия",icon:"📋"},{id:"gallery",title:"Галерея",icon:"🖼️"},{id:"contacts",title:"Контакты",icon:"📞"}],d8=["basic","context","advantages","products","terms","gallery","contacts"],d9="hsl(30deg 3.3% 11.8% / 15%)",ea="#3d3d3a";function eb(){let{data:a,status:b}=(0,p.useSession)(),c=(0,o.useSearchParams)().get("proposalId")??void 0,{proposal:d,updateField:e,save:f,exportPdf:g,isLoading:h,isSaving:i,isDirty:j,lastSaved:k}=function({proposalId:a,workspaceId:b,userId:c}){let d=(0,o.useRouter)(),[e,f]=(0,n.useState)(()=>D(b,c)),[g,h]=(0,n.useState)(!1),[i,j]=(0,n.useState)(!1),[k,l]=(0,n.useState)(!1),[m,p]=(0,n.useState)(null),q=(0,n.useRef)(null);(0,n.useEffect)(()=>{a&&(h(!0),fetch(`/api/proposals/${a}`).then(a=>{if(404===a.status)return null;if(!a.ok)throw Error(`Не удалось загрузить КП (${a.status})`);return a.json()}).then(e=>{var g;if(!e){console.warn(`Proposal not found: ${a}`),f(D(b,c)),l(!1),p(null);let e=new URLSearchParams(window.location.search);e.delete("proposalId");let g=e.toString();d.replace(g?`${window.location.pathname}?${g}`:window.location.pathname,{scroll:!1});return}f({...(a=>{let b=Array.isArray(a.productVariants)?a.productVariants:[],c=b.length>0?b:[{...C("Вариант 1"),rows:Array.isArray(a.items)?a.items.map(a=>B({...a,id:a.id||A("item")})):[]}],d=c.some(b=>b.id===a.activeVariantId)?a.activeVariantId:c[0]?.id;return{...a,pricingMode:"variants",productVariants:c,activeVariantId:d,productsView:{showDiscountColumn:a.productsView?.showDiscountColumn??!0,showUnitColumn:a.productsView?.showUnitColumn??!0}}})(e),visibleSections:Array.isArray(g=e.visibleSections)&&0!==g.length?Array.from(new Set(g)):[...z]}),l(!1),p(new Date(e.updatedAt||Date.now()))}).catch(a=>{console.error("Failed to load proposal:",a),alert("Не удалось загрузить коммерческое предложение")}).finally(()=>h(!1)))},[a,d,c,b]);let r=(0,n.useCallback)((a,b)=>{f(c=>({...c,[a]:b})),l(!0)},[]),s=(0,n.useCallback)(a=>{let b={...a,id:A("item")};f(a=>({...a,items:[...a.items,b],..."variants"===a.pricingMode&&Array.isArray(a.productVariants)&&a.productVariants.length>0?{productVariants:a.productVariants.map(c=>c.id===a.activeVariantId?{...c,rows:[...c.rows,B(b)]}:c)}:{}})),l(!0)},[]),t=(0,n.useCallback)(a=>{f(b=>({...b,items:b.items.filter(b=>b.id!==a),..."variants"===b.pricingMode&&Array.isArray(b.productVariants)?{productVariants:b.productVariants.map(b=>({...b,rows:b.rows.filter(b=>b.id!==a)}))}:{}})),l(!0)},[]),u=(0,n.useCallback)((a,b)=>{f(c=>({...c,items:c.items.map(c=>c.id===a?{...c,...b}:c),..."variants"===c.pricingMode&&Array.isArray(c.productVariants)?{productVariants:c.productVariants.map(c=>({...c,rows:c.rows.map(c=>"item"===c.type&&c.id===a?{...c,...b}:c)}))}:{}})),l(!0)},[]),v=(0,n.useCallback)(async(a=!0)=>{if(!b||!c)return a&&alert("Ошибка: не удалось определить пользователя. Обновите страницу."),!1;let g=(e.title??"").trim();j(!0);try{let b=await fetch("/api/proposals",{method:e.id?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,title:g,updatedBy:c})});if(!b.ok){let a=await b.text(),c=(a=>{if(!a)return"Ошибка сервера";try{let b=JSON.parse(a);if("Validation error"===b.error&&Array.isArray(b.details)&&b.details.length>0)return b.details[0]?.message||"Ошибка валидации";if("string"==typeof b.message&&b.message.trim().length>0)return b.message;if("string"==typeof b.error&&b.error.trim().length>0)return b.error}catch{}return a})(a);throw b.status>=500&&console.error("Server error response:",a),Error(c||"Ошибка сервера")}let h=await b.json();if(f(h),l(!1),p(new Date),!e.id&&h.id){let a=new URLSearchParams(window.location.search);a.set("proposalId",h.id),d.replace(`${window.location.pathname}?${a.toString()}`,{scroll:!1})}return a&&alert("Коммерческое предложение сохранено"),!0}catch(b){if(console.error("Failed to save proposal:",b),a){let a=b instanceof Error?b.message:"Неизвестная ошибка";alert(`Не удалось сохранить коммерческое предложение: ${a}`)}return!1}finally{j(!1)}},[e,c,b,d]),w=(0,n.useCallback)(async()=>{await v(!0)},[v]);(0,n.useEffect)(()=>(q.current&&clearTimeout(q.current),k&&e.id&&!i&&(q.current=setTimeout(()=>{console.log("[Autosave] Saving..."),v(!1)},3e3)),()=>{q.current&&clearTimeout(q.current)}),[k,e.id,i,v]);let x=(0,n.useCallback)(async()=>{if(!e.id)return void alert("Сохраните коммерческое предложение перед экспортом в PDF");try{let a=await fetch("/api/pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proposalId:e.id})});if(!a.ok)throw Error(await a.text());let b=await a.blob(),c=URL.createObjectURL(b),d=document.createElement("a");d.href=c,d.download=`${e.title||"proposal"}.pdf`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c)}catch(a){console.error("Failed to export PDF:",a),alert("Не удалось экспортировать PDF")}},[e]);return{proposal:e,updateField:r,addItem:s,removeItem:t,updateItem:u,save:w,exportPdf:x,isLoading:g,isSaving:i,isDirty:k,lastSaved:m}}({proposalId:c,workspaceId:a?.user?.workspaceId??"",userId:a?.user?.id??""}),[l,r]=(0,n.useState)("basic"),[E,P]=(0,n.useState)(!c),[Q,R]=(0,n.useState)(!1),[S,T]=(0,n.useState)(d8),[W,X]=(0,n.useState)(null),[Y,$]=(0,n.useState)(null),[_,aa]=(0,n.useState)(1),[ab,ac]=(0,n.useState)(!1),ad=(0,n.useRef)(null),ae=function(a,b=500){let[c,d]=(0,n.useState)(a);return(0,n.useEffect)(()=>{let c=setTimeout(()=>d(a),b);return()=>clearTimeout(c)},[a,b]),c}(d,500);(0,n.useEffect)(()=>{if(d.visibleSections&&d.visibleSections.length>0)return void T(d.visibleSections);T(d8)},[d.visibleSections]),(0,n.useEffect)(()=>{if("authenticated"!==b)return;let a=!0;return fetch("/api/workspace/settings").then(a=>a.ok?a.json():null).then(b=>{a&&b&&X(b)}).catch(()=>{if(!a)return}),()=>{a=!1}},[b]),(0,n.useEffect)(()=>{let a=a=>{a?.data&&"resize"===a.data.type&&"number"==typeof a.data.height&&$(a.data.height)};return window.addEventListener("message",a),()=>window.removeEventListener("message",a)},[]),(0,n.useEffect)(()=>{let a=ad.current;if(!a)return;let b=()=>{let b=a.clientWidth;b&&aa(Math.min(1,b/794))};b();let c=new ResizeObserver(b);return c.observe(a),()=>c.disconnect()},[]);let af=(0,n.useMemo)(()=>{let a=a=>S.includes(a),b=a("basic"),c=a("context"),d=a("advantages"),e=a("products"),f=a("terms"),g=a("gallery"),h=a("contacts");return{...ae,title:b?ae.title:"",recipientName:b?ae.recipientName:void 0,problemDesc:c?ae.problemDesc:void 0,solutionDesc:c?ae.solutionDesc:void 0,additionalDesc:c?ae.additionalDesc:void 0,advantages:d?ae.advantages:[],advantagesColumns:d?ae.advantagesColumns:void 0,items:e?ae.items:[],pricingMode:e?ae.pricingMode:"single",productVariants:e?ae.productVariants:[],activeVariantId:e?ae.activeVariantId:void 0,productsView:e?ae.productsView:void 0,deadline:f?ae.deadline:void 0,paymentTerms:f?ae.paymentTerms:void 0,paymentCustom:f?ae.paymentCustom:void 0,validUntil:f?ae.validUntil:void 0,notes:f?ae.notes:void 0,galleryImages:g?ae.galleryImages:[],ctaText:h?ae.ctaText:void 0,ctaPhone:h?ae.ctaPhone:void 0,ctaEmail:h?ae.ctaEmail:void 0}},[ae,S]),ag=(0,n.useMemo)(()=>{try{return function(a){let b,{proposal:c,workspace:d,client:e}=a,f=H(c),g=G(c),h=c.productsView?.showUnitColumn!==!1,i=c.productsView?.showDiscountColumn!==!1,j=5+ +!!h+ +!!i,k=function(a="RUB"){return({RUB:"₽",USD:"$",EUR:"€"})[a]||a}(c.currency),l=Array.isArray(g?.rows)?g.rows:[],m=l.length>0,n=m||f.length>0,o=J(f),p=L(c),q=K(c),r=Array.isArray(c.advantages)?c.advantages:[],s="number"==typeof c.advantagesColumns?Math.min(3,Math.max(1,c.advantagesColumns)):3,t=r.length>=3?3:s,u=Array.isArray(c.visibleSections)?c.visibleSections:null,v=a=>!u||u.includes(a);return`<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>${M(c.title)}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      font-size: 14px;
      line-height: 1.6;
      color: #1a1a1a;
      padding: 40px;
      background: #ffffff;
    }
    
    @media print {
      body {
        padding: 0;
      }
    }
    
    @page {
      size: A4;
      margin: 20mm 15mm;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e5e5e5;
    }
    
    .logo {
      max-width: 200px;
      max-height: 80px;
    }
    
    .company-info {
      text-align: right;
      font-size: 12px;
      color: #666;
    }
    
    h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 20px;
      color: #1a1a1a;
    }
    
    .greeting {
      font-size: 16px;
      margin-bottom: 20px;
    }
    
    .section {
      margin-bottom: 25px;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
      color: #333;
    }
    
    .section-content {
      font-size: 14px;
      line-height: 1.8;
      color: #444;
      white-space: pre-wrap;
    }

    .advantages-grid {
      display: grid;
      grid-template-columns: repeat(var(--advantages-columns, 3), minmax(0, 1fr));
      gap: 12px;
      margin-top: 10px;
    }

    .advantage-card {
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 14px;
      background: #fafafa;
      min-height: 130px;
    }

    .advantage-icon {
      width: 42px;
      height: 42px;
      border-radius: 9999px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f0f0f0;
      margin-bottom: 10px;
      font-size: 18px;
    }

    .advantage-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .advantage-title {
      font-size: 14px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 6px;
      line-height: 1.3;
    }

    .advantage-description {
      font-size: 12px;
      line-height: 1.45;
      color: #4b5563;
      white-space: pre-wrap;
    }
    
    .price-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 13px;
    }
    
    .price-table th {
      background-color: #f5f5f5;
      padding: 12px 10px;
      text-align: left;
      font-weight: 600;
      border: 1px solid #ddd;
    }
    
    .price-table td {
      padding: 10px;
      border: 1px solid #ddd;
    }
    
    .price-table tr:nth-child(even) {
      background-color: #fafafa;
    }
    
    .price-table .text-right {
      text-align: right;
    }
    
    .price-table .text-center {
      text-align: center;
    }

    .price-table .group-row td {
      background-color: #f3f2f0;
      font-weight: 600;
      color: #3d3d3a;
    }

    .variant-meta {
      margin: 12px 0 8px;
      padding: 10px 12px;
      border-radius: 10px;
      background: #f7f6f3;
      border: 1px solid #e6e4de;
    }

    .variant-name {
      font-size: 13px;
      font-weight: 600;
      color: #252525;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .variant-badge {
      padding: 2px 8px;
      border-radius: 9999px;
      font-size: 10px;
      font-weight: 600;
      background: #3cb371;
      color: #fff;
    }

    .variant-description {
      margin-top: 6px;
      font-size: 12px;
      color: #666;
      white-space: pre-wrap;
    }
    
    .totals {
      margin-top: 10px;
      text-align: right;
    }
    
    .totals-row {
      display: flex;
      justify-content: flex-end;
      padding: 5px 0;
      font-size: 14px;
    }
    
    .totals-row.total {
      font-size: 18px;
      font-weight: 700;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 2px solid #333;
    }
    
    .totals-label {
      margin-right: 20px;
    }
    
    .totals-value {
      min-width: 150px;
      text-align: right;
      font-weight: 600;
    }
    
    .terms {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 8px;
    }
    
    .term-item {
      font-size: 13px;
    }
    
    .term-label {
      font-weight: 600;
      color: #666;
      margin-bottom: 5px;
    }
    
    .term-value {
      color: #333;
    }
    
    .gallery {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    
    .gallery img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      object-fit: cover;
    }
    
    .cta {
      margin: 30px 0;
      padding: 20px;
      background-color: #f0f0f0;
      border-radius: 8px;
      text-align: center;
    }
    
    .cta-text {
      font-size: 15px;
      margin-bottom: 15px;
    }
    
    .cta-contacts {
      font-size: 14px;
      font-weight: 600;
    }
    
    .footer {
      margin-top: 50px;
      padding-top: 20px;
      border-top: 1px solid #ddd;
      font-size: 11px;
      color: #666;
    }
    
    .requisites {
      margin-bottom: 20px;
    }
    
    .requisites-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 10px;
    }
    
    .signatures {
      display: flex;
      justify-content: flex-end;
      gap: 30px;
      margin-top: 30px;
    }
    
    .signature-item img {
      max-width: 150px;
      max-height: 80px;
    }
  </style>
</head>
<body>
  <!-- Шапка -->
  <div class="header">
    <div>
      ${d?.logoUrl?`<img src="${M(d.logoUrl)}" alt="Logo" class="logo">`:""}
    </div>
    <div class="company-info">
      ${d?.companyName?`<div><strong>${M(d.companyName)}</strong></div>`:""}
      ${d?.inn?`<div>ИНН: ${M(d.inn)}</div>`:""}
    </div>
  </div>

  <!-- Заголовок -->
  ${v("basic")&&c.title?`<h1>${M(c.title)}</h1>`:""}

  <!-- Обращение -->
  ${v("basic")&&c.recipientName?`<div class="greeting">${M(c.recipientName)}</div>`:""}

  <!-- Описание проблемы (Point A) -->
  ${v("context")&&c.problemDesc?`
    <div class="section">
      <div class="section-content">${M(c.problemDesc)}</div>
    </div>
  `:""}

  <!-- Предлагаемое решение (Point B) -->
  ${v("context")&&c.solutionDesc?`
    <div class="section">
      <div class="section-content">${M(c.solutionDesc)}</div>
    </div>
  `:""}

  <!-- Дополнительное описание -->
  ${v("context")&&c.additionalDesc?`
    <div class="section">
      <div class="section-content">${M(c.additionalDesc)}</div>
    </div>
  `:""}

  <!-- Преимущества -->
  ${v("advantages")&&r.length>0?`
    <div class="section">
      <div class="section-title">Преимущества</div>
      <div class="advantages-grid" style="--advantages-columns: ${t}">
        ${r.map(a=>`
          <div class="advantage-card">
            <div class="advantage-icon">
              ${a.iconUrl?`<img src="${M(a.iconUrl)}" alt="Иконка преимущества">`:"★"}
            </div>
            <div class="advantage-title">${M(a.title||"Без названия")}</div>
            <div class="advantage-description">${M(a.description||"")}</div>
          </div>
        `).join("")}
      </div>
    </div>
  `:""}

  <!-- Таблица товаров/услуг -->
  ${v("products")&&n?`
    ${g?`
      <div class="variant-meta">
        <div class="variant-name">
          ${M(g.name)}
          ${g.isRecommended?'<span class="variant-badge">Рекомендуем</span>':""}
        </div>
        ${g.description?`<div class="variant-description">${M(g.description)}</div>`:""}
      </div>
    `:""}
    <table class="price-table">
      <thead>
        <tr>
          <th>№</th>
          <th>Наименование</th>
          <th class="text-center">Кол-во</th>
          ${h?'<th class="text-center">Ед.</th>':""}
          <th class="text-right">Цена, ${k}</th>
          ${i?'<th class="text-right">Скидка</th>':""}
          <th class="text-right">Сумма, ${k}</th>
        </tr>
      </thead>
      <tbody>
        ${m?(b=0,l.map(a=>F(a)?(b+=1,`
                <tr>
                  <td class="text-center">${b}</td>
                  <td>
                    <strong>${M(a.name)}</strong>
                    ${a.description?`<br><small style="color: #666;">${M(a.description)}</small>`:""}
                  </td>
                  <td class="text-center">${a.qty}</td>
                  ${h?`<td class="text-center">${M(a.unit||"шт")}</td>`:""}
                  <td class="text-right">${O(a.price)}</td>
                  ${i?`<td class="text-right">${a.discount?`${a.discount}%`:"0%"}</td>`:""}
                  <td class="text-right"><strong>${O(I(a))}</strong></td>
                </tr>
              `):`
                  <tr class="group-row">
                    <td colspan="${j}">${M(a.title||"Группа")}</td>
                  </tr>
                `).join("")):f.map((a,b)=>`
          <tr>
            <td class="text-center">${b+1}</td>
            <td>
              <strong>${M(a.name)}</strong>
              ${a.description?`<br><small style="color: #666;">${M(a.description)}</small>`:""}
            </td>
            <td class="text-center">${a.qty}</td>
            ${h?`<td class="text-center">${M(a.unit||"шт")}</td>`:""}
            <td class="text-right">${O(a.price)}</td>
            ${i?`<td class="text-right">${a.discount?`${a.discount}%`:"0%"}</td>`:""}
            <td class="text-right"><strong>${O(I(a))}</strong></td>
          </tr>
        `).join("")}
      </tbody>
    </table>

    <!-- Итоги -->
    <div class="totals">
      <div class="totals-row">
        <span class="totals-label">Итого:</span>
        <span class="totals-value">${N(o,c.currency)}</span>
      </div>
      ${c.includeVat?`
        <div class="totals-row">
          <span class="totals-label">НДС ${c.vatRate}%:</span>
          <span class="totals-value">${N(p,c.currency)}</span>
        </div>
        <div class="totals-row total">
          <span class="totals-label">Всего с НДС:</span>
          <span class="totals-value">${N(q,c.currency)}</span>
        </div>
      `:`
        <div class="totals-row total">
          <span class="totals-label">Всего:</span>
          <span class="totals-value">${N(q,c.currency)}</span>
        </div>
      `}
    </div>
  `:""}

  <!-- Условия -->
  ${v("terms")&&(c.deadline||c.paymentTerms||c.validUntil)?`
    <div class="terms">
      ${c.deadline?`
        <div class="term-item">
          <div class="term-label">Срок выполнения:</div>
          <div class="term-value">${M(c.deadline)}</div>
        </div>
      `:""}
      ${c.paymentTerms?`
        <div class="term-item">
          <div class="term-label">Условия оплаты:</div>
          <div class="term-value">${"prepaid"===c.paymentTerms?"100% предоплата":"50-50"===c.paymentTerms?"50% предоплата / 50% по завершении":"postpaid"===c.paymentTerms?"Постоплата":c.paymentCustom?M(c.paymentCustom):M(c.paymentTerms)}</div>
        </div>
      `:""}
      ${c.validUntil?`
        <div class="term-item">
          <div class="term-label">Срок действия предложения:</div>
          <div class="term-value">${new Date(c.validUntil).toLocaleDateString("ru-RU")}</div>
        </div>
      `:""}
    </div>
  `:""}

  <!-- Галерея -->
  ${v("gallery")&&c.galleryImages&&c.galleryImages.length>0?`
    <div class="section">
      <div class="section-title">Примеры работ</div>
      <div class="gallery">
        ${c.galleryImages.map(a=>`<img src="${M(a)}" alt="Portfolio image">`).join("")}
      </div>
    </div>
  `:""}

  <!-- CTA -->
  ${v("contacts")&&(c.ctaText||c.ctaPhone||c.ctaEmail)?`
    <div class="cta">
      ${c.ctaText?`<div class="cta-text">${M(c.ctaText)}</div>`:""}
      <div class="cta-contacts">
        ${c.ctaPhone?`📞 ${M(c.ctaPhone)}`:""}
        ${c.ctaPhone&&c.ctaEmail?" • ":""}
        ${c.ctaEmail?`✉️ ${M(c.ctaEmail)}`:""}
      </div>
    </div>
  `:""}

  <!-- Примечания -->
  ${v("terms")&&c.notes?`
    <div class="section">
      <div class="section-title">Примечания</div>
      <div class="section-content">${M(c.notes)}</div>
    </div>
  `:""}

  <!-- Футер с реквизитами -->
  ${d?`
    <div class="footer">
      <div class="requisites">
        <div><strong>Реквизиты:</strong></div>
        <div class="requisites-grid">
          ${d.companyName?`<div>Наименование: ${M(d.companyName)}</div>`:""}
          ${d.inn?`<div>ИНН: ${M(d.inn)}</div>`:""}
          ${d.ogrn?`<div>ОГРН: ${M(d.ogrn)}</div>`:""}
          ${d.legalAddress?`<div style="grid-column: 1 / -1;">Юр. адрес: ${M(d.legalAddress)}</div>`:""}
          ${d.bankName?`<div>Банк: ${M(d.bankName)}</div>`:""}
          ${d.bik?`<div>БИК: ${M(d.bik)}</div>`:""}
          ${d.accountNumber?`<div style="grid-column: 1 / -1;">Р/С: ${M(d.accountNumber)}</div>`:""}
        </div>
      </div>
      
      ${d.signatureUrl||d.stampUrl?`
        <div class="signatures">
          ${d.signatureUrl?`
            <div class="signature-item">
              <img src="${M(d.signatureUrl)}" alt="Подпись">
            </div>
          `:""}
          ${d.stampUrl?`
            <div class="signature-item">
              <img src="${M(d.stampUrl)}" alt="Печать">
            </div>
          `:""}
        </div>
      `:""}
    </div>
  `:""}

  <script>
    // Автоматическая высота для iframe
    if (window.parent !== window) {
      function sendHeight() {
        const height = document.documentElement.scrollHeight;
        window.parent.postMessage({ type: 'resize', height: height }, '*');
      }
      window.addEventListener('load', sendHeight);
      window.addEventListener('resize', sendHeight);
      // Отправляем высоту сразу
      setTimeout(sendHeight, 100);
    }
  </script>
</body>
</html>`}({proposal:af,workspace:W??void 0})}catch(a){return console.error("Failed to render preview html:",a),'<!doctype html><html><body style="font-family: sans-serif; padding: 24px;">Не удалось собрать превью.</body></html>'}},[af,W]),ah=Math.max(Y??0,1123);(0,n.useEffect)(()=>{S.includes(l)||r(S[0]??"basic")},[l,S]);let ai="products"===l;(0,n.useEffect)(()=>{ac(ai)},[ai]);let aj=async()=>{if(!d.id)return void alert("Сохраните КП перед предпросмотром");try{let a=await fetch(`/api/proposals/${d.id}/share`,{method:"POST"});if(!a.ok)throw Error("Не удалось создать ссылку для предпросмотра");let{token:b}=await a.json();window.open(`/p/${b}`,"_blank")}catch(a){console.error("Preview error:",a),alert("Не удалось открыть предпросмотр")}},ak="flex cursor-pointer items-center justify-center gap-2 rounded-xl border bg-white px-4 py-2 text-sm font-medium text-[#0F172B] tracking-[-0.42px] transition hover:bg-slate-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#C6613F] disabled:cursor-not-allowed disabled:opacity-50",al={"--tw-shadow":"0 1px 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .06)), 0 0 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .3))","--tw-shadow-color":"rgba(0, 0, 0, 0.1)",boxShadow:"var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow)",borderColor:"hsl(30deg 3.3% 11.8% / 15%)"},am=(0,n.useMemo)(()=>{switch(l){case"basic":return(0,m.jsx)(U,{proposal:d,onUpdate:e});case"context":return(0,m.jsx)(V,{proposal:d,onUpdate:e});case"products":return(0,m.jsx)(dL,{proposal:d,onUpdate:e});case"advantages":return(0,m.jsx)(Z,{proposal:d,onUpdate:e});case"terms":return(0,m.jsx)(dM,{proposal:d,onUpdate:e});case"gallery":return(0,m.jsx)(dT,{proposal:d,onUpdate:e});case"contacts":return(0,m.jsx)(dU,{proposal:d,onUpdate:e});default:return null}},[l,d,e]);return"loading"===b?(0,m.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-[#F3F2F0]",children:(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsx)("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-[#C6613F] border-t-transparent mx-auto"}),(0,m.jsx)("p",{className:"mt-4 text-sm text-slate-600",children:"Загрузка сессии..."})]})}):h?(0,m.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-[#F3F2F0]",children:(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsx)("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-[#C6613F] border-t-transparent mx-auto"}),(0,m.jsx)("p",{className:"mt-4 text-sm text-slate-600",children:"Загрузка коммерческого предложения..."})]})}):(0,m.jsxs)("div",{className:"min-h-screen w-full bg-[#F3F2F0] py-6 text-slate-900",children:[(0,m.jsxs)("div",{className:"mx-auto flex w-full max-w-[1400px] flex-col gap-6 px-6",children:[(0,m.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,m.jsxs)(q.default,{href:"/",className:ak,style:al,children:[(0,m.jsx)(s,{className:"h-4 w-4"}),"Вернуться назад"]}),(0,m.jsxs)("div",{className:"flex flex-1 items-center justify-center",children:[(0,m.jsx)("h1",{className:"text-xl font-semibold text-slate-800",children:d.title||"Новое КП"}),i?(0,m.jsxs)("span",{className:"ml-3 flex items-center gap-1.5 rounded-full bg-[#FAEFEB] px-3 py-1 text-xs font-medium text-[#A04F33]",children:[(0,m.jsx)("span",{className:"h-2 w-2 animate-pulse rounded-full bg-[#C6613F]"}),"Сохранение..."]}):j?(0,m.jsx)("span",{className:"ml-3 rounded-full bg-amber-100 px-3 py-1 text-xs font-medium text-amber-800",children:"Не сохранено"}):k?(0,m.jsxs)("span",{className:"ml-3 rounded-full bg-green-100 px-3 py-1 text-xs font-medium text-green-800",children:["Сохранено в ",k.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})]}):null]}),(0,m.jsxs)("div",{className:"flex items-center gap-3",children:[(0,m.jsxs)("button",{className:ak,style:al,onClick:()=>P(!0),children:[(0,m.jsx)(y,{className:"h-4 w-4"}),"Применить шаблон"]}),(0,m.jsxs)("button",{className:ak,style:al,onClick:()=>R(!0),children:[(0,m.jsx)(x,{className:"h-4 w-4"}),"Шаблоны"]}),(0,m.jsxs)("button",{className:ak,style:al,onClick:aj,disabled:!d.id,children:[(0,m.jsx)(v,{className:"h-4 w-4"}),"Предпросмотр"]}),(0,m.jsxs)("button",{className:ak,style:al,onClick:g,disabled:!d.id,children:[(0,m.jsx)(u,{className:"h-4 w-4"}),"PDF"]}),(0,m.jsxs)("button",{className:"flex cursor-pointer items-center justify-center gap-2 h-9 rounded-xl bg-[#C6613F] px-4 text-sm font-medium text-[#FAFAFA] shadow-[0px_1px_2px_0px_rgba(10,10,10,0.06)] transition hover:bg-[#A04F33] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#C6613F] disabled:cursor-not-allowed disabled:opacity-60",onClick:f,disabled:i,children:[(0,m.jsx)(t,{className:"h-4 w-4"}),i?"Сохранение...":"Сохранить"]})]})]}),(0,m.jsxs)("div",{className:"flex gap-6",children:[(0,m.jsx)("aside",{className:"w-64 flex-shrink-0",children:(0,m.jsxs)("div",{className:"sticky top-6 rounded-[0.75rem] bg-white p-4",style:{"--tw-shadow":"0 1px 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .06)), 0 0 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .3))","--tw-shadow-color":"rgba(0, 0, 0, 0.1)",boxShadow:"var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow)"},children:[(0,m.jsx)("h2",{className:"mb-3 text-xs font-semibold uppercase tracking-wide",style:{color:ea},children:"Разделы"}),(0,m.jsx)("nav",{className:"space-y-1",children:d7.map(a=>{let b=S.includes(a.id),c=l===a.id;return(0,m.jsxs)("div",{role:"button",tabIndex:0,onClick:()=>{b&&r(a.id)},onKeyDown:c=>{("Enter"===c.key||" "===c.key)&&(c.preventDefault(),b&&r(a.id))},className:`flex w-full items-center gap-3 rounded-lg px-3 py-2 text-left text-sm font-medium tracking-[-0.42px] transition ${c?"bg-[#FAFAFA] text-[#FF5929]":"hover:bg-[#FAFAFA]"} ${b?"cursor-pointer":"cursor-default"}`,style:c?void 0:{color:b?"#3d3d3a":"#a8a39a"},children:[(0,m.jsx)("span",{className:"text-lg",children:a.icon}),(0,m.jsx)("span",{className:"flex-1",children:a.title}),(0,m.jsx)("button",{type:"button",role:"switch","aria-checked":b,onClick:b=>{var c;b.stopPropagation(),c=a.id,T(a=>{let b=a.includes(c)?a.filter(a=>a!==c):[...a,c];return 0===b.length?a:(e("visibleSections",b),b)})},className:`relative inline-flex h-[12px] w-[22px] shrink-0 items-center rounded-full border transition ${b?"border-[#C6613F] bg-[#C6613F]":"border-slate-200 bg-slate-200"}`,children:(0,m.jsx)("span",{className:`inline-block h-[10px] w-[10px] transform rounded-full bg-white shadow transition ${b?"translate-x-[10px]":"translate-x-[1px]"}`})})]},a.id)})})]})}),(0,m.jsx)("main",{className:"flex-1 min-w-0",children:(0,m.jsxs)("div",{className:"rounded-[0.75rem] bg-white p-6",style:{"--tw-shadow":"0 1px 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .06)), 0 0 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .3))","--tw-shadow-color":"rgba(0, 0, 0, 0.1)",boxShadow:"var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow)"},children:[(0,m.jsxs)("div",{className:"mb-6",children:[(0,m.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,m.jsx)("h2",{className:"text-lg font-semibold",style:{color:"#3d3d3a"},children:d7.find(a=>a.id===l)?.title}),ai?(0,m.jsxs)("button",{type:"button",onClick:()=>ac(a=>!a),className:"hidden xl:inline-flex h-8 items-center gap-1.5 rounded-lg border bg-white px-2.5 text-xs font-medium tracking-[-0.2px] text-[#3d3d3a] transition hover:bg-[#FAFAFA] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#C6613F]",style:{borderColor:d9,boxShadow:"0 1px 1px 0 rgba(0,0,0,0.06), 0 0 1px 0 rgba(0,0,0,0.3)"},title:ab?"Показать превью":"Скрыть превью","aria-label":ab?"Показать превью":"Скрыть превью",children:[ab?(0,m.jsx)(w,{className:"h-4 w-4"}):(0,m.jsx)(v,{className:"h-4 w-4"}),ab?"Показать превью":"Скрыть превью"]}):null]}),(0,m.jsx)("div",{className:"mt-1 h-1 w-12 rounded-full bg-[#C6613F]"})]}),(0,m.jsx)("div",{className:ai&&ab?"max-w-none":"max-w-3xl",children:am})]})}),ai&&ab?null:(0,m.jsx)("aside",{className:"hidden xl:block w-[360px] flex-shrink-0",children:(0,m.jsxs)("div",{className:"sticky top-6 rounded-[0.75rem] bg-white p-4",style:{"--tw-shadow":"0 1px 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .06)), 0 0 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .3))","--tw-shadow-color":"rgba(0, 0, 0, 0.1)",boxShadow:"var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow)"},children:[(0,m.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,m.jsx)("h2",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:ea},children:"Превью"}),(0,m.jsx)("span",{className:"text-[10px] font-medium uppercase tracking-wide",style:{color:"#73726c"},children:"Live"})]}),(0,m.jsx)("div",{className:"overflow-hidden rounded-lg border bg-white",style:{borderColor:d9},children:(0,m.jsx)("div",{ref:ad,className:"max-h-[calc(100vh-12rem)] overflow-auto bg-[#f6f5f3]",children:(0,m.jsx)("div",{style:{width:`${794*_}px`,height:`${ah*_}px`,margin:"0 auto",position:"relative"},children:(0,m.jsx)("div",{style:{width:"794px",height:`${ah}px`,transform:`scale(${_})`,transformOrigin:"top left",position:"absolute",top:0,left:0},children:(0,m.jsx)("iframe",{title:"Предпросмотр коммерческого предложения",className:"border-0",srcDoc:ag,style:{width:"794px",height:`${ah}px`,display:"block"}})})})})})]})})]})]}),E&&(0,m.jsx)(dZ,{onSelect:a=>{if(P(!1),a){let b=d4(a.sections),c=(a=>{let b=d3(a);if(!b)return{};if(Array.isArray(b.items)&&(b.items=b.items.map(a=>({...a,id:d2("item")}))),Array.isArray(b.advantages)&&(b.advantages=b.advantages.map(a=>({...a,id:d2("adv")}))),Array.isArray(b.productVariants)){let a=new Map,c=b.productVariants.map(b=>{let c=b.id,d=d2("variant");a.set(c,d);let e=new Map,f=Array.isArray(b.rows)?b.rows:[];for(let a of f)"group"===a.type&&e.set(a.id,d2("group"));let g=f.map(a=>{if("group"===a.type){let b=e.get(a.id)??d2("group");return{...a,id:b}}return{...a,id:d2("item"),groupId:a.groupId?e.get(a.groupId)??void 0:void 0}});return{...b,id:d,rows:g}}),d=b.activeVariantId?a.get(b.activeVariantId)??c[0]?.id:c[0]?.id;b.productVariants=c,b.activeVariantId=d}return b})(a.defaults);T(b),e("visibleSections",b),Object.entries(c).forEach(([a,b])=>{e(a,b)})}},onClose:()=>P(!1)}),Q&&(0,m.jsx)(d6,{isOpen:Q,proposal:d,visibleSections:S,onClose:()=>R(!1)})]})}}];

//# sourceMappingURL=_d53ee0e8._.js.map