{"version":3,"sources":["turbopack:///[project]/lib/types/proposal.ts","turbopack:///[project]/lib/pdf/renderProposal.ts","turbopack:///[project]/lib/pdf/launchBrowser.ts","turbopack:///[project]/lib/pdf/cache.ts"],"sourcesContent":["// –¢–∏–ø—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ (Proposals)\n\nexport type PricingMode = \"single\" | \"variants\";\n\nexport interface ProposalItem {\n  id: string;\n  productId?: string; // –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞\n  name: string;\n  description?: string;\n  qty: number;\n  price: number;\n  discount?: number; // –í –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö\n  unit?: string; // \"—à—Ç\", \"—á–∞—Å\", \"–º–µ—Å—è—Ü\" –∏ —Ç.–¥.\n}\n\nexport interface ProductVariantGroupRow {\n  id: string;\n  type: \"group\";\n  title: string;\n}\n\nexport interface ProductVariantItemRow extends ProposalItem {\n  type: \"item\";\n  groupId?: string;\n}\n\nexport type ProductVariantRow = ProductVariantGroupRow | ProductVariantItemRow;\n\nexport interface ProductVariant {\n  id: string;\n  name: string;\n  description?: string;\n  isRecommended?: boolean;\n  currency?: string;\n  rows: ProductVariantRow[];\n}\n\nexport interface ProductsViewSettings {\n  showDiscountColumn?: boolean;\n  showUnitColumn?: boolean;\n}\n\nexport interface AdvantageItem {\n  id?: string;\n  iconUrl?: string;\n  title: string;\n  description: string;\n}\n\nexport interface Proposal {\n  id?: string;\n  workspaceId: string;\n  clientId?: string;\n\n  // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n  title: string;\n  recipientName?: string; // \"–£–≤–∞–∂–∞–µ–º—ã–π –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤–∏—á!\"\n\n  // –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ä–µ—à–µ–Ω–∏–µ\n  problemDesc?: string; // –û–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ (Point A)\n  solutionDesc?: string; // –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ (Point B)\n  additionalDesc?: string; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ\n\n  // –¢–æ–≤–∞—Ä—ã/—É—Å–ª—É–≥–∏\n  items: ProposalItem[]; // legacy/single mode\n  currency: string; // \"RUB\", \"USD\", \"EUR\"\n  pricingMode?: PricingMode;\n  productVariants?: ProductVariant[];\n  activeVariantId?: string;\n  productsView?: ProductsViewSettings;\n\n  // –£—Å–ª–æ–≤–∏—è\n  deadline?: string; // –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ: \"2 –Ω–µ–¥–µ–ª–∏\", \"–¥–æ 31.12.2024\"\n  paymentTerms?: string; // \"prepaid\" | \"50-50\" | \"postpaid\" | \"custom\"\n  paymentCustom?: string; // –ï—Å–ª–∏ paymentTerms = \"custom\"\n  validUntil?: Date | string; // –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ö–ü\n\n  // –ù–î–°\n  includeVat: boolean;\n  vatRate: number; // –í –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö\n\n  // –ì–∞–ª–µ—Ä–µ—è\n  galleryImages?: string[]; // –ú–∞—Å—Å–∏–≤ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π\n\n  // –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞\n  advantages?: AdvantageItem[];\n  advantagesColumns?: 1 | 2 | 3;\n\n  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ä–∞–∑–¥–µ–ª–æ–≤\n  visibleSections?: string[];\n\n  // CTA (–ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é)\n  ctaText?: string;\n  ctaPhone?: string;\n  ctaEmail?: string;\n\n  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ\n  notes?: string;\n\n  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ\n  version?: number;\n  status?: \"draft\" | \"sent\" | \"accepted\" | \"rejected\";\n  createdBy?: string;\n  updatedBy?: string;\n  createdAt?: Date | string;\n  updatedAt?: Date | string;\n}\n\n// –û–ø—Ü–∏–∏ –æ–ø–ª–∞—Ç—ã (–ø—Ä–µ—Å–µ—Ç—ã)\nexport const PAYMENT_TERMS_OPTIONS = [\n  { value: \"prepaid\", label: \"100% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞\" },\n  { value: \"50-50\", label: \"50% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ / 50% –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏\" },\n  { value: \"postpaid\", label: \"–ü–æ—Å—Ç–æ–ø–ª–∞—Ç–∞\" },\n  { value: \"custom\", label: \"–°–≤–æ–∏ —É—Å–ª–æ–≤–∏—è\" },\n] as const;\n\nexport type PaymentTermsValue = typeof PAYMENT_TERMS_OPTIONS[number][\"value\"];\n\n// –í–∞–ª—é—Ç—ã\nexport const CURRENCY_OPTIONS = [\n  { value: \"RUB\", label: \"‚ÇΩ –†—É–±–ª—å\", symbol: \"‚ÇΩ\" },\n  { value: \"USD\", label: \"$ –î–æ–ª–ª–∞—Ä\", symbol: \"$\" },\n  { value: \"EUR\", label: \"‚Ç¨ –ï–≤—Ä–æ\", symbol: \"‚Ç¨\" },\n] as const;\n\nexport type CurrencyValue = typeof CURRENCY_OPTIONS[number][\"value\"];\n\nexport function isProductVariantItemRow(row: ProductVariantRow): row is ProductVariantItemRow {\n  return row.type === \"item\";\n}\n\nexport function getVariantItems(variant: ProductVariant | null | undefined): ProposalItem[] {\n  if (!variant) return [];\n  return variant.rows.filter(isProductVariantItemRow).map((row) => ({\n    id: row.id,\n    productId: row.productId,\n    name: row.name,\n    description: row.description,\n    qty: row.qty,\n    price: row.price,\n    discount: row.discount,\n    unit: row.unit,\n  }));\n}\n\nexport function getActiveVariant(proposal: Proposal): ProductVariant | null {\n  if (proposal.pricingMode !== \"variants\" || !Array.isArray(proposal.productVariants) || proposal.productVariants.length === 0) {\n    return null;\n  }\n  if (proposal.activeVariantId) {\n    const byActiveId = proposal.productVariants.find((variant) => variant.id === proposal.activeVariantId);\n    if (byActiveId) return byActiveId;\n  }\n  const recommended = proposal.productVariants.find((variant) => variant.isRecommended);\n  return recommended ?? proposal.productVariants[0];\n}\n\nexport function getProposalItems(proposal: Proposal): ProposalItem[] {\n  const activeVariant = getActiveVariant(proposal);\n  if (activeVariant) {\n    return getVariantItems(activeVariant);\n  }\n  return Array.isArray(proposal.items) ? proposal.items : [];\n}\n\n// –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤\nexport function calculateItemTotal(item: ProposalItem): number {\n  const subtotal = item.qty * item.price;\n  if (item.discount && item.discount > 0) {\n    return subtotal * (1 - item.discount / 100);\n  }\n  return subtotal;\n}\n\nexport function calculateProposalSubtotal(items: ProposalItem[]): number {\n  return items.reduce((sum, item) => sum + calculateItemTotal(item), 0);\n}\n\nexport function calculateProposalTotal(proposal: Proposal): number {\n  const subtotal = calculateProposalSubtotal(getProposalItems(proposal));\n  if (proposal.includeVat && proposal.vatRate > 0) {\n    return subtotal * (1 + proposal.vatRate / 100);\n  }\n  return subtotal;\n}\n\nexport function calculateVatAmount(proposal: Proposal): number {\n  if (!proposal.includeVat || proposal.vatRate === 0) return 0;\n  const subtotal = calculateProposalSubtotal(getProposalItems(proposal));\n  return subtotal * (proposal.vatRate / 100);\n}\n","import type { ProductVariantRow, Proposal, ProposalItem } from '@/lib/types/proposal';\nimport {\n  calculateItemTotal,\n  calculateProposalSubtotal,\n  calculateVatAmount,\n  calculateProposalTotal,\n  getActiveVariant,\n  getProposalItems,\n  isProductVariantItemRow,\n} from '@/lib/types/proposal';\n\ninterface RenderProposalOptions {\n  proposal: Proposal;\n  workspace?: {\n    logoUrl?: string | null;\n    signatureUrl?: string | null;\n    stampUrl?: string | null;\n    companyName?: string | null;\n    inn?: string | null;\n    ogrn?: string | null;\n    legalAddress?: string | null;\n    bankName?: string | null;\n    bik?: string | null;\n    accountNumber?: string | null;\n  };\n  client?: {\n    name: string;\n    email: string;\n    company?: string | null;\n    middleName?: string | null;\n    position?: string | null;\n  } | null;\n}\n\nfunction escapeHtml(text: string): string {\n  const map: Record<string, string> = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#039;',\n  };\n  return text.replace(/[&<>\"']/g, (m) => map[m]);\n}\n\nfunction formatPrice(amount: number, currency: string = 'RUB'): string {\n  const symbols: Record<string, string> = {\n    RUB: '‚ÇΩ',\n    USD: '$',\n    EUR: '‚Ç¨',\n  };\n  return `${amount.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ${symbols[currency] || currency}`;\n}\n\nfunction formatAmount(amount: number): string {\n  return amount.toLocaleString('ru-RU', {\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  });\n}\n\nfunction getCurrencySymbol(currency: string = 'RUB'): string {\n  const symbols: Record<string, string> = {\n    RUB: '‚ÇΩ',\n    USD: '$',\n    EUR: '‚Ç¨',\n  };\n  return symbols[currency] || currency;\n}\n\nexport function renderProposalToHtml(options: RenderProposalOptions): string {\n  const { proposal, workspace, client } = options;\n\n  const renderedItems = getProposalItems(proposal);\n  const activeVariant = getActiveVariant(proposal);\n  const showUnitColumn = proposal.productsView?.showUnitColumn !== false;\n  const showDiscountColumn = proposal.productsView?.showDiscountColumn !== false;\n  const tableColumnCount = 5 + (showUnitColumn ? 1 : 0) + (showDiscountColumn ? 1 : 0);\n  const currencySymbol = getCurrencySymbol(proposal.currency);\n  const variantRows: ProductVariantRow[] = Array.isArray(activeVariant?.rows) ? activeVariant.rows : [];\n  const hasVariantRows = variantRows.length > 0;\n  const hasProductsToRender = hasVariantRows || renderedItems.length > 0;\n  const subtotal = calculateProposalSubtotal(renderedItems);\n  const vatAmount = calculateVatAmount(proposal);\n  const total = calculateProposalTotal(proposal);\n  const advantages = Array.isArray(proposal.advantages) ? proposal.advantages : [];\n  const advantagesColumns =\n    typeof proposal.advantagesColumns === 'number'\n      ? Math.min(3, Math.max(1, proposal.advantagesColumns))\n      : 3;\n  const effectiveAdvantagesColumns = advantages.length >= 3 ? 3 : advantagesColumns;\n  const visibleSections = Array.isArray(proposal.visibleSections)\n    ? proposal.visibleSections\n    : null;\n  const isSectionVisible = (id: string) => !visibleSections || visibleSections.includes(id);\n\n  return `<!DOCTYPE html>\n<html lang=\"ru\">\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n  <title>${escapeHtml(proposal.title)}</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    \n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n      font-size: 14px;\n      line-height: 1.6;\n      color: #1a1a1a;\n      padding: 40px;\n      background: #ffffff;\n    }\n    \n    @media print {\n      body {\n        padding: 0;\n      }\n    }\n    \n    @page {\n      size: A4;\n      margin: 20mm 15mm;\n    }\n    \n    .header {\n      display: flex;\n      justify-content: space-between;\n      align-items: flex-start;\n      margin-bottom: 30px;\n      padding-bottom: 20px;\n      border-bottom: 2px solid #e5e5e5;\n    }\n    \n    .logo {\n      max-width: 200px;\n      max-height: 80px;\n    }\n    \n    .company-info {\n      text-align: right;\n      font-size: 12px;\n      color: #666;\n    }\n    \n    h1 {\n      font-size: 24px;\n      font-weight: 700;\n      margin-bottom: 20px;\n      color: #1a1a1a;\n    }\n    \n    .greeting {\n      font-size: 16px;\n      margin-bottom: 20px;\n    }\n    \n    .section {\n      margin-bottom: 25px;\n    }\n    \n    .section-title {\n      font-size: 16px;\n      font-weight: 600;\n      margin-bottom: 10px;\n      color: #333;\n    }\n    \n    .section-content {\n      font-size: 14px;\n      line-height: 1.8;\n      color: #444;\n      white-space: pre-wrap;\n    }\n\n    .advantages-grid {\n      display: grid;\n      grid-template-columns: repeat(var(--advantages-columns, 3), minmax(0, 1fr));\n      gap: 12px;\n      margin-top: 10px;\n    }\n\n    .advantage-card {\n      border: 1px solid #e5e7eb;\n      border-radius: 12px;\n      padding: 14px;\n      background: #fafafa;\n      min-height: 130px;\n    }\n\n    .advantage-icon {\n      width: 42px;\n      height: 42px;\n      border-radius: 9999px;\n      overflow: hidden;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: #f0f0f0;\n      margin-bottom: 10px;\n      font-size: 18px;\n    }\n\n    .advantage-icon img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n    }\n\n    .advantage-title {\n      font-size: 14px;\n      font-weight: 600;\n      color: #111827;\n      margin-bottom: 6px;\n      line-height: 1.3;\n    }\n\n    .advantage-description {\n      font-size: 12px;\n      line-height: 1.45;\n      color: #4b5563;\n      white-space: pre-wrap;\n    }\n    \n    .price-table {\n      width: 100%;\n      border-collapse: collapse;\n      margin: 20px 0;\n      font-size: 13px;\n    }\n    \n    .price-table th {\n      background-color: #f5f5f5;\n      padding: 12px 10px;\n      text-align: left;\n      font-weight: 600;\n      border: 1px solid #ddd;\n    }\n    \n    .price-table td {\n      padding: 10px;\n      border: 1px solid #ddd;\n    }\n    \n    .price-table tr:nth-child(even) {\n      background-color: #fafafa;\n    }\n    \n    .price-table .text-right {\n      text-align: right;\n    }\n    \n    .price-table .text-center {\n      text-align: center;\n    }\n\n    .price-table .group-row td {\n      background-color: #f3f2f0;\n      font-weight: 600;\n      color: #3d3d3a;\n    }\n\n    .variant-meta {\n      margin: 12px 0 8px;\n      padding: 10px 12px;\n      border-radius: 10px;\n      background: #f7f6f3;\n      border: 1px solid #e6e4de;\n    }\n\n    .variant-name {\n      font-size: 13px;\n      font-weight: 600;\n      color: #252525;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .variant-badge {\n      padding: 2px 8px;\n      border-radius: 9999px;\n      font-size: 10px;\n      font-weight: 600;\n      background: #3cb371;\n      color: #fff;\n    }\n\n    .variant-description {\n      margin-top: 6px;\n      font-size: 12px;\n      color: #666;\n      white-space: pre-wrap;\n    }\n    \n    .totals {\n      margin-top: 10px;\n      text-align: right;\n    }\n    \n    .totals-row {\n      display: flex;\n      justify-content: flex-end;\n      padding: 5px 0;\n      font-size: 14px;\n    }\n    \n    .totals-row.total {\n      font-size: 18px;\n      font-weight: 700;\n      margin-top: 10px;\n      padding-top: 10px;\n      border-top: 2px solid #333;\n    }\n    \n    .totals-label {\n      margin-right: 20px;\n    }\n    \n    .totals-value {\n      min-width: 150px;\n      text-align: right;\n      font-weight: 600;\n    }\n    \n    .terms {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 20px;\n      margin: 20px 0;\n      padding: 15px;\n      background-color: #f9f9f9;\n      border-radius: 8px;\n    }\n    \n    .term-item {\n      font-size: 13px;\n    }\n    \n    .term-label {\n      font-weight: 600;\n      color: #666;\n      margin-bottom: 5px;\n    }\n    \n    .term-value {\n      color: #333;\n    }\n    \n    .gallery {\n      display: grid;\n      grid-template-columns: repeat(3, 1fr);\n      gap: 15px;\n      margin: 20px 0;\n    }\n    \n    .gallery img {\n      width: 100%;\n      height: auto;\n      border-radius: 8px;\n      object-fit: cover;\n    }\n    \n    .cta {\n      margin: 30px 0;\n      padding: 20px;\n      background-color: #f0f0f0;\n      border-radius: 8px;\n      text-align: center;\n    }\n    \n    .cta-text {\n      font-size: 15px;\n      margin-bottom: 15px;\n    }\n    \n    .cta-contacts {\n      font-size: 14px;\n      font-weight: 600;\n    }\n    \n    .footer {\n      margin-top: 50px;\n      padding-top: 20px;\n      border-top: 1px solid #ddd;\n      font-size: 11px;\n      color: #666;\n    }\n    \n    .requisites {\n      margin-bottom: 20px;\n    }\n    \n    .requisites-grid {\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 8px;\n      margin-top: 10px;\n    }\n    \n    .signatures {\n      display: flex;\n      justify-content: flex-end;\n      gap: 30px;\n      margin-top: 30px;\n    }\n    \n    .signature-item img {\n      max-width: 150px;\n      max-height: 80px;\n    }\n  </style>\n</head>\n<body>\n  <!-- –®–∞–ø–∫–∞ -->\n  <div class=\"header\">\n    <div>\n      ${workspace?.logoUrl ? `<img src=\"${escapeHtml(workspace.logoUrl)}\" alt=\"Logo\" class=\"logo\">` : ''}\n    </div>\n    <div class=\"company-info\">\n      ${workspace?.companyName ? `<div><strong>${escapeHtml(workspace.companyName)}</strong></div>` : ''}\n      ${workspace?.inn ? `<div>–ò–ù–ù: ${escapeHtml(workspace.inn)}</div>` : ''}\n    </div>\n  </div>\n\n  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->\n  ${isSectionVisible('basic') && proposal.title ? `<h1>${escapeHtml(proposal.title)}</h1>` : ''}\n\n  <!-- –û–±—Ä–∞—â–µ–Ω–∏–µ -->\n  ${isSectionVisible('basic') && proposal.recipientName ? `<div class=\"greeting\">${escapeHtml(proposal.recipientName)}</div>` : ''}\n\n  <!-- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (Point A) -->\n  ${isSectionVisible('context') && proposal.problemDesc ? `\n    <div class=\"section\">\n      <div class=\"section-content\">${escapeHtml(proposal.problemDesc)}</div>\n    </div>\n  ` : ''}\n\n  <!-- –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ (Point B) -->\n  ${isSectionVisible('context') && proposal.solutionDesc ? `\n    <div class=\"section\">\n      <div class=\"section-content\">${escapeHtml(proposal.solutionDesc)}</div>\n    </div>\n  ` : ''}\n\n  <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ -->\n  ${isSectionVisible('context') && proposal.additionalDesc ? `\n    <div class=\"section\">\n      <div class=\"section-content\">${escapeHtml(proposal.additionalDesc)}</div>\n    </div>\n  ` : ''}\n\n  <!-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ -->\n  ${isSectionVisible('advantages') && advantages.length > 0 ? `\n    <div class=\"section\">\n      <div class=\"section-title\">–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞</div>\n      <div class=\"advantages-grid\" style=\"--advantages-columns: ${effectiveAdvantagesColumns}\">\n        ${advantages.map((item) => `\n          <div class=\"advantage-card\">\n            <div class=\"advantage-icon\">\n              ${item.iconUrl ? `<img src=\"${escapeHtml(item.iconUrl)}\" alt=\"–ò–∫–æ–Ω–∫–∞ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞\">` : '‚òÖ'}\n            </div>\n            <div class=\"advantage-title\">${escapeHtml(item.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</div>\n            <div class=\"advantage-description\">${escapeHtml(item.description || '')}</div>\n          </div>\n        `).join('')}\n      </div>\n    </div>\n  ` : ''}\n\n  <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤/—É—Å–ª—É–≥ -->\n  ${isSectionVisible('products') && hasProductsToRender ? `\n    ${activeVariant ? `\n      <div class=\"variant-meta\">\n        <div class=\"variant-name\">\n          ${escapeHtml(activeVariant.name)}\n          ${activeVariant.isRecommended ? '<span class=\"variant-badge\">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º</span>' : ''}\n        </div>\n        ${activeVariant.description ? `<div class=\"variant-description\">${escapeHtml(activeVariant.description)}</div>` : ''}\n      </div>\n    ` : ''}\n    <table class=\"price-table\">\n      <thead>\n        <tr>\n          <th>‚Ññ</th>\n          <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>\n          <th class=\"text-center\">–ö–æ–ª-–≤–æ</th>\n          ${showUnitColumn ? '<th class=\"text-center\">–ï–¥.</th>' : ''}\n          <th class=\"text-right\">–¶–µ–Ω–∞, ${currencySymbol}</th>\n          ${showDiscountColumn ? '<th class=\"text-right\">–°–∫–∏–¥–∫–∞</th>' : ''}\n          <th class=\"text-right\">–°—É–º–º–∞, ${currencySymbol}</th>\n        </tr>\n      </thead>\n      <tbody>\n        ${hasVariantRows ? (() => {\n          let itemIndex = 0;\n          return variantRows\n            .map((row) => {\n              if (!isProductVariantItemRow(row)) {\n                return `\n                  <tr class=\"group-row\">\n                    <td colspan=\"${tableColumnCount}\">${escapeHtml(row.title || '–ì—Ä—É–ø–ø–∞')}</td>\n                  </tr>\n                `;\n              }\n\n              itemIndex += 1;\n              const item = row as ProposalItem;\n              return `\n                <tr>\n                  <td class=\"text-center\">${itemIndex}</td>\n                  <td>\n                    <strong>${escapeHtml(item.name)}</strong>\n                    ${item.description ? `<br><small style=\"color: #666;\">${escapeHtml(item.description)}</small>` : ''}\n                  </td>\n                  <td class=\"text-center\">${item.qty}</td>\n                  ${showUnitColumn ? `<td class=\"text-center\">${escapeHtml(item.unit || '—à—Ç')}</td>` : ''}\n                  <td class=\"text-right\">${formatAmount(item.price)}</td>\n                  ${showDiscountColumn ? `<td class=\"text-right\">${item.discount ? `${item.discount}%` : '0%'}</td>` : ''}\n                  <td class=\"text-right\"><strong>${formatAmount(calculateItemTotal(item))}</strong></td>\n                </tr>\n              `;\n            })\n            .join('');\n        })() : renderedItems.map((item: ProposalItem, index: number) => `\n          <tr>\n            <td class=\"text-center\">${index + 1}</td>\n            <td>\n              <strong>${escapeHtml(item.name)}</strong>\n              ${item.description ? `<br><small style=\"color: #666;\">${escapeHtml(item.description)}</small>` : ''}\n            </td>\n            <td class=\"text-center\">${item.qty}</td>\n            ${showUnitColumn ? `<td class=\"text-center\">${escapeHtml(item.unit || '—à—Ç')}</td>` : ''}\n            <td class=\"text-right\">${formatAmount(item.price)}</td>\n            ${showDiscountColumn ? `<td class=\"text-right\">${item.discount ? `${item.discount}%` : '0%'}</td>` : ''}\n            <td class=\"text-right\"><strong>${formatAmount(calculateItemTotal(item))}</strong></td>\n          </tr>\n        `).join('')}\n      </tbody>\n    </table>\n\n    <!-- –ò—Ç–æ–≥–∏ -->\n    <div class=\"totals\">\n      <div class=\"totals-row\">\n        <span class=\"totals-label\">–ò—Ç–æ–≥–æ:</span>\n        <span class=\"totals-value\">${formatPrice(subtotal, proposal.currency)}</span>\n      </div>\n      ${proposal.includeVat ? `\n        <div class=\"totals-row\">\n          <span class=\"totals-label\">–ù–î–° ${proposal.vatRate}%:</span>\n          <span class=\"totals-value\">${formatPrice(vatAmount, proposal.currency)}</span>\n        </div>\n        <div class=\"totals-row total\">\n          <span class=\"totals-label\">–í—Å–µ–≥–æ —Å –ù–î–°:</span>\n          <span class=\"totals-value\">${formatPrice(total, proposal.currency)}</span>\n        </div>\n      ` : `\n        <div class=\"totals-row total\">\n          <span class=\"totals-label\">–í—Å–µ–≥–æ:</span>\n          <span class=\"totals-value\">${formatPrice(total, proposal.currency)}</span>\n        </div>\n      `}\n    </div>\n  ` : ''}\n\n  <!-- –£—Å–ª–æ–≤–∏—è -->\n  ${isSectionVisible('terms') && (proposal.deadline || proposal.paymentTerms || proposal.validUntil) ? `\n    <div class=\"terms\">\n      ${proposal.deadline ? `\n        <div class=\"term-item\">\n          <div class=\"term-label\">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</div>\n          <div class=\"term-value\">${escapeHtml(proposal.deadline)}</div>\n        </div>\n      ` : ''}\n      ${proposal.paymentTerms ? `\n        <div class=\"term-item\">\n          <div class=\"term-label\">–£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã:</div>\n          <div class=\"term-value\">${\n            proposal.paymentTerms === 'prepaid' ? '100% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞' :\n            proposal.paymentTerms === '50-50' ? '50% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ / 50% –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏' :\n            proposal.paymentTerms === 'postpaid' ? '–ü–æ—Å—Ç–æ–ø–ª–∞—Ç–∞' :\n            proposal.paymentCustom ? escapeHtml(proposal.paymentCustom) : escapeHtml(proposal.paymentTerms)\n          }</div>\n        </div>\n      ` : ''}\n      ${proposal.validUntil ? `\n        <div class=\"term-item\">\n          <div class=\"term-label\">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:</div>\n          <div class=\"term-value\">${new Date(proposal.validUntil).toLocaleDateString('ru-RU')}</div>\n        </div>\n      ` : ''}\n    </div>\n  ` : ''}\n\n  <!-- –ì–∞–ª–µ—Ä–µ—è -->\n  ${isSectionVisible('gallery') && proposal.galleryImages && proposal.galleryImages.length > 0 ? `\n    <div class=\"section\">\n      <div class=\"section-title\">–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç</div>\n      <div class=\"gallery\">\n        ${proposal.galleryImages.map((url: string) => `<img src=\"${escapeHtml(url)}\" alt=\"Portfolio image\">`).join('')}\n      </div>\n    </div>\n  ` : ''}\n\n  <!-- CTA -->\n  ${isSectionVisible('contacts') && (proposal.ctaText || proposal.ctaPhone || proposal.ctaEmail) ? `\n    <div class=\"cta\">\n      ${proposal.ctaText ? `<div class=\"cta-text\">${escapeHtml(proposal.ctaText)}</div>` : ''}\n      <div class=\"cta-contacts\">\n        ${proposal.ctaPhone ? `üìû ${escapeHtml(proposal.ctaPhone)}` : ''}\n        ${proposal.ctaPhone && proposal.ctaEmail ? ' ‚Ä¢ ' : ''}\n        ${proposal.ctaEmail ? `‚úâÔ∏è ${escapeHtml(proposal.ctaEmail)}` : ''}\n      </div>\n    </div>\n  ` : ''}\n\n  <!-- –ü—Ä–∏–º–µ—á–∞–Ω–∏—è -->\n  ${isSectionVisible('terms') && proposal.notes ? `\n    <div class=\"section\">\n      <div class=\"section-title\">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</div>\n      <div class=\"section-content\">${escapeHtml(proposal.notes)}</div>\n    </div>\n  ` : ''}\n\n  <!-- –§—É—Ç–µ—Ä —Å —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º–∏ -->\n  ${workspace ? `\n    <div class=\"footer\">\n      <div class=\"requisites\">\n        <div><strong>–†–µ–∫–≤–∏–∑–∏—Ç—ã:</strong></div>\n        <div class=\"requisites-grid\">\n          ${workspace.companyName ? `<div>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ: ${escapeHtml(workspace.companyName)}</div>` : ''}\n          ${workspace.inn ? `<div>–ò–ù–ù: ${escapeHtml(workspace.inn)}</div>` : ''}\n          ${workspace.ogrn ? `<div>–û–ì–†–ù: ${escapeHtml(workspace.ogrn)}</div>` : ''}\n          ${workspace.legalAddress ? `<div style=\"grid-column: 1 / -1;\">–Æ—Ä. –∞–¥—Ä–µ—Å: ${escapeHtml(workspace.legalAddress)}</div>` : ''}\n          ${workspace.bankName ? `<div>–ë–∞–Ω–∫: ${escapeHtml(workspace.bankName)}</div>` : ''}\n          ${workspace.bik ? `<div>–ë–ò–ö: ${escapeHtml(workspace.bik)}</div>` : ''}\n          ${workspace.accountNumber ? `<div style=\"grid-column: 1 / -1;\">–†/–°: ${escapeHtml(workspace.accountNumber)}</div>` : ''}\n        </div>\n      </div>\n      \n      ${workspace.signatureUrl || workspace.stampUrl ? `\n        <div class=\"signatures\">\n          ${workspace.signatureUrl ? `\n            <div class=\"signature-item\">\n              <img src=\"${escapeHtml(workspace.signatureUrl)}\" alt=\"–ü–æ–¥–ø–∏—Å—å\">\n            </div>\n          ` : ''}\n          ${workspace.stampUrl ? `\n            <div class=\"signature-item\">\n              <img src=\"${escapeHtml(workspace.stampUrl)}\" alt=\"–ü–µ—á–∞—Ç—å\">\n            </div>\n          ` : ''}\n        </div>\n      ` : ''}\n    </div>\n  ` : ''}\n\n  <script>\n    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è iframe\n    if (window.parent !== window) {\n      function sendHeight() {\n        const height = document.documentElement.scrollHeight;\n        window.parent.postMessage({ type: 'resize', height: height }, '*');\n      }\n      window.addEventListener('load', sendHeight);\n      window.addEventListener('resize', sendHeight);\n      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—ã—Å–æ—Ç—É —Å—Ä–∞–∑—É\n      setTimeout(sendHeight, 100);\n    }\n  </script>\n</body>\n</html>`;\n}\n","import os from 'node:os';\nimport path from 'node:path';\nimport { access } from 'node:fs/promises';\nimport { constants as fsConstants } from 'node:fs';\n\ntype PuppeteerModule = typeof import('puppeteer-core');\n\nasync function fileIsExecutable(candidate: string) {\n  try {\n    await access(candidate, fsConstants.X_OK);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nasync function resolveLocalExecutable(): Promise<string | null> {\n  if (process.env.CHROME_EXECUTABLE_PATH?.trim()) {\n    const explicit = process.env.CHROME_EXECUTABLE_PATH.trim();\n    if (await fileIsExecutable(explicit)) {\n      return explicit;\n    }\n    console.warn('[pdf] –£–∫–∞–∑–∞–Ω–Ω—ã–π CHROME_EXECUTABLE_PATH –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', explicit);\n  }\n\n  const platform = os.platform();\n  const candidates: string[] = [];\n\n  if (platform === 'darwin') {\n    candidates.push('/Applications/Google Chrome.app/Contents/MacOS/Google Chrome');\n    candidates.push('/Applications/Chromium.app/Contents/MacOS/Chromium');\n    candidates.push('/Applications/Microsoft Edge.app/Contents/MacOS/Microsoft Edge');\n    if (process.env.HOME) {\n      candidates.push(\n        path.join(\n          process.env.HOME,\n          'Applications/Google Chrome.app/Contents/MacOS/Google Chrome',\n        ),\n      );\n    }\n  } else if (platform === 'win32') {\n    const roots = [\n      process.env.LOCALAPPDATA,\n      process.env.PROGRAMFILES,\n      process.env['PROGRAMFILES(X86)'],\n    ].filter(Boolean) as string[];\n    const suffix = path.join('Google', 'Chrome', 'Application', 'chrome.exe');\n    for (const root of roots) {\n      candidates.push(path.join(root, suffix));\n    }\n    candidates.push('C:\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe');\n    candidates.push('C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe');\n  } else {\n    candidates.push('/usr/bin/google-chrome');\n    candidates.push('/usr/bin/chromium');\n    candidates.push('/usr/bin/chromium-browser');\n    candidates.push('/snap/bin/chromium');\n  }\n\n  for (const candidate of candidates) {\n    try {\n      if (candidate && (await fileIsExecutable(candidate))) {\n        return candidate;\n      }\n    } catch {\n      // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—É—Ç–∏\n    }\n  }\n\n  return null;\n}\n\nasync function launchWithSparticuz(puppeteer: PuppeteerModule['default']) {\n  const chromiumModule = await import('@sparticuz/chromium');\n  const chromium = chromiumModule.default;\n  const executablePath = await chromium.executablePath();\n  return puppeteer.launch({\n    args: chromium.args,\n    defaultViewport: { width: 1280, height: 720 },\n    executablePath: executablePath ?? undefined,\n    headless: true,\n  });\n}\n\nfunction isServerlessEnvironment() {\n  return (\n    process.platform === 'linux' ||\n    Boolean(process.env.AWS_REGION) ||\n    Boolean(process.env.AWS_EXECUTION_ENV) ||\n    Boolean(process.env.VERCEL) ||\n    Boolean(process.env.NETLIFY) ||\n    Boolean(process.env.CHROME_BINARY_PATH)\n  );\n}\n\nexport async function launchPdfBrowser() {\n  const puppeteerModule = await import('puppeteer-core');\n  const puppeteer = puppeteerModule.default;\n\n  if (isServerlessEnvironment()) {\n    return launchWithSparticuz(puppeteer);\n  }\n\n  const executablePath = await resolveLocalExecutable();\n  if (executablePath) {\n    try {\n      return await puppeteer.launch({\n        executablePath,\n        headless: true,\n        args: ['--no-sandbox', '--disable-gpu'],\n      });\n    } catch (error) {\n      console.warn('[pdf] –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π Chrome, –∏—Å–ø–æ–ª—å–∑—É–µ–º @sparticuz/chromium.', error);\n    }\n  } else {\n    console.warn('[pdf] –õ–æ–∫–∞–ª—å–Ω—ã–π Chrome –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ @sparticuz/chromium.');\n  }\n\n  return launchWithSparticuz(puppeteer);\n}\n","import { createHash } from 'crypto';\nimport { promises as fs } from 'fs';\nimport { join } from 'path';\n\n/**\n * –°–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è PDF —Ñ–∞–π–ª–æ–≤\n * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ PDF –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n */\n\nconst CACHE_DIR = join(process.cwd(), '.cache', 'pdf');\nconst MAX_CACHE_AGE_MS = 1000 * 60 * 60 * 24; // 24 —á–∞—Å–∞\nconst MAX_CACHE_SIZE_MB = 500; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–µ—à–∞ –≤ –ú–ë\n\ninterface CacheEntry {\n  buffer: Buffer;\n  timestamp: number;\n  size: number;\n}\n\n/**\n * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –∫–µ—à–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞\n */\nexport function generateCacheKey(documentId: string, jsonContent: string): string {\n  const hash = createHash('sha256');\n  hash.update(`${documentId}:${jsonContent}`);\n  return hash.digest('hex');\n}\n\n/**\n * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∫–µ—à–∞\n */\nasync function ensureCacheDir(): Promise<void> {\n  try {\n    await fs.mkdir(CACHE_DIR, { recursive: true });\n  } catch (error) {\n    console.error('Failed to create cache directory:', error);\n  }\n}\n\n/**\n * –ü–æ–ª—É—á–∞–µ—Ç –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–µ—à–∞\n */\nfunction getCachePath(key: string): string {\n  return join(CACHE_DIR, `${key}.pdf`);\n}\n\n/**\n * –ü–æ–ª—É—á–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞ –∫–µ—à–∞\n */\nasync function getCacheMeta(key: string): Promise<{ exists: boolean; size: number; age: number } | null> {\n  try {\n    const path = getCachePath(key);\n    const stats = await fs.stat(path);\n    const age = Date.now() - stats.mtimeMs;\n    \n    return {\n      exists: true,\n      size: stats.size,\n      age,\n    };\n  } catch {\n    return null;\n  }\n}\n\n/**\n * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤–∞–ª–∏–¥–µ–Ω –ª–∏ –∫–µ—à\n */\nasync function isCacheValid(key: string): Promise<boolean> {\n  const meta = await getCacheMeta(key);\n  if (!meta || !meta.exists) return false;\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑—Ä–∞—Å—Ç –∫–µ—à–∞\n  if (meta.age > MAX_CACHE_AGE_MS) {\n    await deleteCacheEntry(key);\n    return false;\n  }\n  \n  return true;\n}\n\n/**\n * –ü–æ–ª—É—á–∞–µ—Ç PDF –∏–∑ –∫–µ—à–∞\n */\nexport async function getCachedPdf(key: string): Promise<Buffer | null> {\n  try {\n    const valid = await isCacheValid(key);\n    if (!valid) return null;\n    \n    const path = getCachePath(key);\n    const buffer = await fs.readFile(path);\n    \n    console.log(`[PDF Cache] HIT: ${key}`);\n    return buffer;\n  } catch (error) {\n    console.error(`[PDF Cache] Error reading cache:`, error);\n    return null;\n  }\n}\n\n/**\n * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç PDF –≤ –∫–µ—à\n */\nexport async function setCachedPdf(key: string, buffer: Buffer): Promise<void> {\n  try {\n    await ensureCacheDir();\n    const path = getCachePath(key);\n    await fs.writeFile(path, buffer);\n    \n    console.log(`[PDF Cache] SET: ${key} (${(buffer.length / 1024).toFixed(2)} KB)`);\n    \n    // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ –æ—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã\n    cleanupCache().catch(err => console.error('[PDF Cache] Cleanup error:', err));\n  } catch (error) {\n    console.error(`[PDF Cache] Error writing cache:`, error);\n  }\n}\n\n/**\n * –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –∏–∑ –∫–µ—à–∞\n */\nasync function deleteCacheEntry(key: string): Promise<void> {\n  try {\n    const path = getCachePath(key);\n    await fs.unlink(path);\n    console.log(`[PDF Cache] DELETE: ${key}`);\n  } catch (error) {\n    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è\n  }\n}\n\n/**\n * –û—á–∏—â–∞–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏ –∫–µ—à–∞\n */\nasync function cleanupCache(): Promise<void> {\n  try {\n    await ensureCacheDir();\n    const files = await fs.readdir(CACHE_DIR);\n    \n    let totalSize = 0;\n    const entries: Array<{ file: string; mtime: number; size: number }> = [];\n    \n    // –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö\n    for (const file of files) {\n      if (!file.endsWith('.pdf')) continue;\n      \n      try {\n        const path = join(CACHE_DIR, file);\n        const stats = await fs.stat(path);\n        const age = Date.now() - stats.mtimeMs;\n        \n        // –£–¥–∞–ª—è–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–∞–π–ª—ã\n        if (age > MAX_CACHE_AGE_MS) {\n          await fs.unlink(path);\n          console.log(`[PDF Cache] Removed expired: ${file}`);\n          continue;\n        }\n        \n        entries.push({ file, mtime: stats.mtimeMs, size: stats.size });\n        totalSize += stats.size;\n      } catch {\n        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤\n      }\n    }\n    \n    // –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –∫–µ—à–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç, —É–¥–∞–ª—è–µ–º —Å–∞–º—ã–µ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã\n    const maxSizeBytes = MAX_CACHE_SIZE_MB * 1024 * 1024;\n    if (totalSize > maxSizeBytes) {\n      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ—Ç —Å—Ç–∞—Ä—ã—Ö –∫ –Ω–æ–≤—ã–º)\n      entries.sort((a, b) => a.mtime - b.mtime);\n      \n      for (const entry of entries) {\n        if (totalSize <= maxSizeBytes) break;\n        \n        try {\n          await fs.unlink(join(CACHE_DIR, entry.file));\n          totalSize -= entry.size;\n          console.log(`[PDF Cache] Removed to free space: ${entry.file}`);\n        } catch {\n          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è\n        }\n      }\n    }\n    \n    console.log(`[PDF Cache] Cleanup complete. Total size: ${(totalSize / 1024 / 1024).toFixed(2)} MB`);\n  } catch (error) {\n    console.error('[PDF Cache] Cleanup failed:', error);\n  }\n}\n\n/**\n * –û—á–∏—â–∞–µ—Ç –≤–µ—Å—å –∫–µ—à\n */\nexport async function clearCache(): Promise<void> {\n  try {\n    await ensureCacheDir();\n    const files = await fs.readdir(CACHE_DIR);\n    \n    for (const file of files) {\n      if (file.endsWith('.pdf')) {\n        await fs.unlink(join(CACHE_DIR, file));\n      }\n    }\n    \n    console.log('[PDF Cache] Cache cleared');\n  } catch (error) {\n    console.error('[PDF Cache] Clear cache failed:', error);\n  }\n}\n\n/**\n * –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–µ—à–∞\n */\nexport async function getCacheStats(): Promise<{\n  count: number;\n  totalSize: number;\n  oldestEntry: number | null;\n  newestEntry: number | null;\n}> {\n  try {\n    await ensureCacheDir();\n    const files = await fs.readdir(CACHE_DIR);\n    \n    let count = 0;\n    let totalSize = 0;\n    let oldestEntry: number | null = null;\n    let newestEntry: number | null = null;\n    \n    for (const file of files) {\n      if (!file.endsWith('.pdf')) continue;\n      \n      try {\n        const path = join(CACHE_DIR, file);\n        const stats = await fs.stat(path);\n        \n        count++;\n        totalSize += stats.size;\n        \n        if (!oldestEntry || stats.mtimeMs < oldestEntry) {\n          oldestEntry = stats.mtimeMs;\n        }\n        if (!newestEntry || stats.mtimeMs > newestEntry) {\n          newestEntry = stats.mtimeMs;\n        }\n      } catch {\n        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤\n      }\n    }\n    \n    return { count, totalSize, oldestEntry, newestEntry };\n  } catch {\n    return { count: 0, totalSize: 0, oldestEntry: null, newestEntry: null };\n  }\n}\n\n\n\n"],"names":[],"mappings":"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"}