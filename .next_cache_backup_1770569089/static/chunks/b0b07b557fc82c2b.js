(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10708,e=>{"use strict";e.s(["Label",()=>i],10708);var t=e.i(43476),s=e.i(71645),r=e.i(48425),a=s.forwardRef((e,s)=>(0,t.jsx)(r.Primitive.label,{...e,ref:s,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||(null==(s=e.onMouseDown)||s.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));a.displayName="Label";var l=e.i(47163);function i(e){let{className:s,...r}=e;return(0,t.jsx)(a,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...r})}},31278,e=>{"use strict";e.s(["Loader2",()=>t],31278);let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},48303,e=>{"use strict";e.s(["SiteHeader",()=>r]);var t=e.i(43476),s=e.i(11522);function r(e){let{label:r,title:a,description:l,actions:i}=e;return(0,t.jsx)("header",{className:"sticky top-0 z-20 border-b border-neutral-200 bg-white",children:(0,t.jsxs)("div",{className:"flex w-full items-center justify-between gap-3 px-4 py-3 md:px-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(s.SidebarTrigger,{className:"-ml-1"}),(0,t.jsx)("span",{className:"h-6 w-px bg-neutral-200","aria-hidden":"true"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[r&&(0,t.jsx)("span",{className:"text-xs text-neutral-500",children:r}),(0,t.jsx)("h1",{className:"text-base font-medium text-neutral-900",children:a}),l&&(0,t.jsx)("p",{className:"text-xs text-neutral-500",children:l})]})]}),i?(0,t.jsx)("div",{className:"shrink-0",children:i}):null]})})}},70065,e=>{"use strict";e.s(["Card",()=>r,"CardContent",()=>n,"CardDescription",()=>i,"CardFooter",()=>c,"CardHeader",()=>a,"CardTitle",()=>l]);var t=e.i(43476),s=e.i(47163);function r(e){let{className:r,...a}=e;return(0,t.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-white text-neutral-950 flex flex-col gap-6 rounded-xl border border-neutral-200 py-6 shadow-sm dark:bg-neutral-950 dark:text-neutral-50 dark:border-neutral-800",r),...a})}function a(e){let{className:r,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto]",r),...a})}function l(e){let{className:r,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",r),...a})}function i(e){let{className:r,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-neutral-500 text-sm dark:text-neutral-400",r),...a})}function n(e){let{className:r,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",r),...a})}function c(e){let{className:r,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-footer",className:(0,s.cn)("flex items-center px-6 [.border-t]:pt-6",r),...a})}},7233,e=>{"use strict";e.s(["Plus",()=>t],7233);let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},37669,e=>{"use strict";e.s(["ProductForm",()=>v]);var t=e.i(43476),s=e.i(71645),r=e.i(18566),a=e.i(31278),l=e.i(7233),i=e.i(27612),n=e.i(67881),c=e.i(70065),o=e.i(23750),d=e.i(10708),m=e.i(62870),u=e.i(69035),x=e.i(61512),p=e.i(74703),h=e.i(47163),b=e.i(46696);let y=["RUB","USD","EUR"],j="hsl(30deg 3.3% 11.8% / 15%)",f="#3d3d3a",N="#73726c",g={label:"",qty:1,unitPrice:0,discount:0};function v(e){var v;let{productId:k,initialState:w,workspaceId:P=p.DEFAULT_WORKSPACE_ID}=e,C=(0,r.useRouter)(),[I,S]=(0,s.useState)(!1),[F,L]=(0,s.useState)(!1),[T,q]=(0,s.useState)({}),[E,U]=(0,s.useState)(()=>{var e,t,s;return{name:"",sku:"",description:"",currency:"RUB",basePrice:0,...w,priceItems:null!=(s=null!=(t=null==w||null==(e=w.priceItems)?void 0:e.map(e=>{var t,s,r;return{...g,...e,qty:null!=(t=e.qty)?t:1,unitPrice:null!=(s=e.unitPrice)?s:0,discount:null!=(r=e.discount)?r:0}}))?t:null==w?void 0:w.priceItems)?s:[]}}),B=(0,s.useMemo)(()=>E.priceItems.reduce((e,t)=>{let s=Number.isFinite(t.qty)?t.qty:0,r=Number.isFinite(t.unitPrice)?t.unitPrice:0;return e+s*Math.max(r*(1-(Number.isFinite(t.discount)?t.discount:0)/100),0)},0),[E.priceItems]),R=e=>{let{name:t,value:s}=e.target;U(e=>({...e,[t]:"basePrice"===t?Number(s):s}))},_=async()=>{let e=(e=>{let t={};return(!e.name||e.name.trim().length<3)&&(t.name="Введите название (минимум 3 символа)."),e.name.trim().length>120&&(t.name="Максимальная длина — 120 символов."),e.sku&&!/^[A-Za-z0-9-_]+$/.test(e.sku)&&(t.sku="Разрешены латиница, цифры, дефис и подчёркивание."),e.sku&&e.sku.length>32&&(t.sku="Максимальная длина — 32 символа."),e.description&&e.description.length>500&&(t.description="Максимальная длина — 500 символов."),e.currency||(t.currency="Выберите валюту."),(!Number.isFinite(e.basePrice)||e.basePrice<0)&&(t.basePrice="Цена должна быть неотрицательным числом."),e.priceItems.length&&(t.priceItems=e.priceItems.map(e=>!e.label||e.label.trim().length<2?"Название строки должно содержать минимум 2 символа.":!Number.isFinite(e.qty)||e.qty<1?"Количество должно быть больше нуля.":!Number.isFinite(e.unitPrice)||e.unitPrice<0?"Цена строки должна быть неотрицательной.":!Number.isFinite(e.discount)||e.discount<0||e.discount>100?"Скидка должна быть от 0 до 100.":""),t.priceItems.every(e=>""===e)&&delete t.priceItems),t})(E);if(q(e),Object.keys(e).length)return void b.toast.error("Проверьте заполненные поля");S(!0);try{let e={name:E.name.trim(),sku:E.sku.trim()||null,description:E.description.trim()||null,currency:E.currency,basePrice:Number(E.basePrice),workspaceId:P,priceItems:E.priceItems.map(e=>({id:e.id,label:e.label.trim(),qty:Number(e.qty)||1,unitPrice:Number(e.unitPrice)||0,discount:Number(e.discount)||0}))},t=await fetch("/api/products",(0,x.withWorkspaceHeader)({method:k?"PUT":"POST",headers:{"content-type":"application/json"},body:JSON.stringify(k?{id:k,...e}:e)}));if(!t.ok){let e=await t.text();throw Error(e||"Не удалось сохранить товар")}b.toast.success(k?"Товар обновлён":"Товар создан"),C.push("/catalog"),C.refresh()}catch(e){b.toast.error(e instanceof Error?e.message:"Ошибка сохранения")}finally{S(!1)}},D=async()=>{if(k&&window.confirm("Удалить товар? Действие нельзя отменить.")){L(!0);try{let e=await fetch("/api/products",(0,x.withWorkspaceHeader)({method:"DELETE",headers:{"content-type":"application/json"},body:JSON.stringify({id:k})}));if(!e.ok){let t=await e.text();throw Error(t||"Не удалось удалить товар")}b.toast.success("Товар удалён"),C.push("/catalog"),C.refresh()}catch(e){b.toast.error(e instanceof Error?e.message:"Ошибка удаления")}finally{L(!1)}}},A=(e,t)=>{U(s=>{let r=[...s.priceItems];return r[e]={...r[e],...t},{...s,priceItems:r}})};return(0,t.jsxs)(c.Card,{className:"w-full rounded-[0.75rem] border-0 bg-white px-0 py-0 shadow-none",style:{boxShadow:"0 1px 1px 0 rgba(0, 0, 0, 0.06), 0 0 1px 0 rgba(0, 0, 0, 0.3)"},children:[(0,t.jsxs)(c.CardContent,{className:"space-y-6 px-4 py-6 md:px-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"name",className:"mb-2 block text-sm font-medium",style:{color:f},children:"Название *"}),(0,t.jsx)(o.Input,{id:"name",name:"name",autoComplete:"off",placeholder:"Например, Тариф ‘Старт’",value:E.name,onChange:R}),T.name&&(0,t.jsx)("p",{className:"mt-2 text-sm text-rose-600",children:T.name})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-[1.2fr_1fr_auto]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"sku",className:"mb-2 block text-sm font-medium",style:{color:f},children:"SKU"}),(0,t.jsx)(o.Input,{id:"sku",name:"sku",autoComplete:"off",placeholder:"A-100-BASE",value:null!=(v=E.sku)?v:"",onChange:R}),(0,t.jsx)("p",{className:"mt-1.5 text-xs",style:{color:N},children:"Технический идентификатор для поиска и интеграций."}),T.sku&&(0,t.jsx)("p",{className:"mt-2 text-sm text-rose-600",children:T.sku})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"basePrice",className:"mb-2 block text-sm font-medium",style:{color:f},children:"Базовая цена *"}),(0,t.jsx)(o.Input,{id:"basePrice",name:"basePrice",type:"number",min:"0",step:"0.01",value:Number.isFinite(E.basePrice)?E.basePrice:0,onChange:e=>U(t=>({...t,basePrice:Number(e.target.value)}))}),T.basePrice&&(0,t.jsx)("p",{className:"mt-2 text-sm text-rose-600",children:T.basePrice})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{className:"mb-2 block text-sm font-medium",style:{color:f},children:"Валюта *"}),(0,t.jsxs)(m.Select,{value:E.currency,onValueChange:e=>U(t=>({...t,currency:e})),children:[(0,t.jsx)(m.SelectTrigger,{className:"w-full",style:{borderColor:j},children:(0,t.jsx)(m.SelectValue,{placeholder:"Выберите валюту"})}),(0,t.jsx)(m.SelectContent,{children:y.map(e=>(0,t.jsx)(m.SelectItem,{value:e,children:e},e))})]}),T.currency&&(0,t.jsx)("p",{className:"mt-2 text-sm text-rose-600",children:T.currency})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-base font-semibold",style:{color:f},children:"Расшифровка (опционально)"}),(0,t.jsxs)("p",{className:"text-sm",style:{color:N},children:["Строки подтягиваются в блок «Таблица цен». Итоговая сумма:"," ",(0,t.jsx)("span",{className:"font-medium",style:{color:f},children:new Intl.NumberFormat("ru-RU",{style:"currency",currency:E.currency||"RUB"}).format(B)})]})]}),(0,t.jsxs)(n.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>U(e=>({...e,priceItems:[...e.priceItems,{...g}]})),children:[(0,t.jsx)(l.Plus,{className:"mr-2 h-4 w-4"})," Добавить позицию"]})]}),0===E.priceItems.length?(0,t.jsx)("div",{className:"rounded-lg border border-dashed px-4 py-6 text-sm",style:{borderColor:j,color:N,backgroundColor:"rgb(243, 242, 240)"},children:"Позиции отсутствуют. Добавьте строки, если хотите детализировать стоимость."}):(0,t.jsx)("div",{className:"space-y-4",children:E.priceItems.map((e,s)=>{var r;let a=null==(r=T.priceItems)?void 0:r[s];return(0,t.jsxs)("div",{className:"grid gap-4 rounded-xl border p-4 md:grid-cols-[1.5fr_repeat(3,1fr)_auto]",style:{borderColor:j},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{className:"mb-2 block text-sm font-medium",style:{color:f},children:"Название"}),(0,t.jsx)(o.Input,{value:e.label,onChange:e=>A(s,{label:e.target.value}),placeholder:"Например, Внедрение"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{className:"mb-2 block text-sm font-medium",style:{color:f},children:"Кол-во"}),(0,t.jsx)(o.Input,{type:"number",min:"1",value:e.qty,onChange:e=>A(s,{qty:Number(e.target.value)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{className:"mb-2 block text-sm font-medium",style:{color:f},children:"Цена"}),(0,t.jsx)(o.Input,{type:"number",min:"0",step:"0.01",value:e.unitPrice,onChange:e=>A(s,{unitPrice:Number(e.target.value)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{className:"mb-2 block text-sm font-medium",style:{color:f},children:"Скидка %"}),(0,t.jsx)(o.Input,{type:"number",min:"0",max:"100",step:"0.1",value:e.discount,onChange:e=>A(s,{discount:Number(e.target.value)})})]}),(0,t.jsx)("div",{className:"flex items-start justify-end",children:(0,t.jsx)(n.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{U(e=>{let t=[...e.priceItems];return t.splice(s,1),{...e,priceItems:t}})},children:(0,t.jsx)(i.Trash2,{className:"h-4 w-4 text-rose-500"})})}),a&&(0,t.jsx)("p",{className:"md:col-span-5 text-sm text-rose-600",children:a})]},s)})})]})]}),(0,t.jsx)(u.Separator,{style:{backgroundColor:j}}),(0,t.jsxs)(c.CardFooter,{className:"flex flex-col gap-3 py-6 md:flex-row md:items-center md:justify-between",children:[(0,t.jsx)("p",{className:"text-sm",style:{color:N},children:"Убедитесь, что все данные актуальны. Изменения сразу появятся в редакторе документов."}),(0,t.jsxs)("div",{className:"flex gap-2",children:[k&&(0,t.jsxs)(n.Button,{type:"button",variant:"ghost",className:(0,h.cn)("text-rose-600 hover:bg-rose-50",F&&"pointer-events-none opacity-70"),onClick:D,children:[F?(0,t.jsx)(a.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Удалить"]}),(0,t.jsxs)(n.Button,{type:"button",onClick:_,disabled:I,children:[I?(0,t.jsx)(a.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):null,k?"Сохранить":"Создать"]})]})]})]})}}]);