(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,88143,(e,t,r)=>{"use strict";function n(e){let{widthInt:t,heightInt:r,blurWidth:n,blurHeight:a,blurDataURL:l,objectFit:o}=e,i=n?40*n:t,s=a?40*a:r,d=i&&s?"viewBox='0 0 "+i+" "+s+"'":"";return"%3Csvg xmlns='http://www.w3.org/2000/svg' "+d+"%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3CfeColorMatrix values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1' result='s'/%3E%3CfeFlood x='0' y='0' width='100%25' height='100%25'/%3E%3CfeComposite operator='out' in='s'/%3E%3CfeComposite in2='SourceGraphic'/%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage width='100%25' height='100%25' x='0' y='0' preserveAspectRatio='"+(d?"none":"contain"===o?"xMidYMid":"cover"===o?"xMidYMid slice":"none")+"' style='filter: url(%23b);' href='"+l+"'/%3E%3C/svg%3E"}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"getImageBlurSvg",{enumerable:!0,get:function(){return n}})},87690,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(r,{VALID_LOADERS:function(){return n},imageConfigDefault:function(){return a}});let n=["default","imgix","cloudinary","akamai","custom"],a={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:60,formats:["image/webp"],dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:void 0,unoptimized:!1}},8927,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"getImgProps",{enumerable:!0,get:function(){return s}}),e.r(33525);let n=e.r(88143),a=e.r(87690),l=["-moz-initial","fill","none","scale-down",void 0];function o(e){return void 0!==e.default}function i(e){return void 0===e?e:"number"==typeof e?Number.isFinite(e)?e:NaN:"string"==typeof e&&/^[0-9]+$/.test(e)?parseInt(e,10):NaN}function s(e,t){var r,s;let d,c,u,{src:p,sizes:f,unoptimized:m=!1,priority:h=!1,loading:x,className:g,quality:v,width:b,height:y,fill:w=!1,style:j,overrideSrc:N,onLoad:C,onLoadingComplete:k,placeholder:E="empty",blurDataURL:D,fetchPriority:S,decoding:M="async",layout:R,objectFit:F,objectPosition:A,lazyBoundary:P,lazyRoot:I,...O}=e,{imgConf:T,showAltText:_,blurComplete:z,defaultLoader:L}=t,V=T||a.imageConfigDefault;if("allSizes"in V)d=V;else{let e=[...V.deviceSizes,...V.imageSizes].sort((e,t)=>e-t),t=V.deviceSizes.sort((e,t)=>e-t),n=null==(r=V.qualities)?void 0:r.sort((e,t)=>e-t);d={...V,allSizes:e,deviceSizes:t,qualities:n}}if(void 0===L)throw Object.defineProperty(Error("images.loaderFile detected but the file is missing default export.\nRead more: https://nextjs.org/docs/messages/invalid-images-config"),"__NEXT_ERROR_CODE",{value:"E163",enumerable:!1,configurable:!0});let U=O.loader||L;delete O.loader,delete O.srcSet;let B="__next_img_default"in U;if(B){if("custom"===d.loader)throw Object.defineProperty(Error('Image with src "'+p+'" is missing "loader" prop.\nRead more: https://nextjs.org/docs/messages/next-image-missing-loader'),"__NEXT_ERROR_CODE",{value:"E252",enumerable:!1,configurable:!0})}else{let e=U;U=t=>{let{config:r,...n}=t;return e(n)}}if(R){"fill"===R&&(w=!0);let e={intrinsic:{maxWidth:"100%",height:"auto"},responsive:{width:"100%",height:"auto"}}[R];e&&(j={...j,...e});let t={responsive:"100vw",fill:"100vw"}[R];t&&!f&&(f=t)}let H="",q=i(b),K=i(y);if((s=p)&&"object"==typeof s&&(o(s)||void 0!==s.src)){let e=o(p)?p.default:p;if(!e.src)throw Object.defineProperty(Error("An object should only be passed to the image component src parameter if it comes from a static image import. It must include src. Received "+JSON.stringify(e)),"__NEXT_ERROR_CODE",{value:"E460",enumerable:!1,configurable:!0});if(!e.height||!e.width)throw Object.defineProperty(Error("An object should only be passed to the image component src parameter if it comes from a static image import. It must include height and width. Received "+JSON.stringify(e)),"__NEXT_ERROR_CODE",{value:"E48",enumerable:!1,configurable:!0});if(c=e.blurWidth,u=e.blurHeight,D=D||e.blurDataURL,H=e.src,!w)if(q||K){if(q&&!K){let t=q/e.width;K=Math.round(e.height*t)}else if(!q&&K){let t=K/e.height;q=Math.round(e.width*t)}}else q=e.width,K=e.height}let G=!h&&("lazy"===x||void 0===x);(!(p="string"==typeof p?p:H)||p.startsWith("data:")||p.startsWith("blob:"))&&(m=!0,G=!1),d.unoptimized&&(m=!0),B&&!d.dangerouslyAllowSVG&&p.split("?",1)[0].endsWith(".svg")&&(m=!0);let X=i(v),W=Object.assign(w?{position:"absolute",height:"100%",width:"100%",left:0,top:0,right:0,bottom:0,objectFit:F,objectPosition:A}:{},_?{}:{color:"transparent"},j),Y=z||"empty"===E?null:"blur"===E?'url("data:image/svg+xml;charset=utf-8,'+(0,n.getImageBlurSvg)({widthInt:q,heightInt:K,blurWidth:c,blurHeight:u,blurDataURL:D||"",objectFit:W.objectFit})+'")':'url("'+E+'")',J=l.includes(W.objectFit)?"fill"===W.objectFit?"100% 100%":"cover":W.objectFit,$=Y?{backgroundSize:J,backgroundPosition:W.objectPosition||"50% 50%",backgroundRepeat:"no-repeat",backgroundImage:Y}:{},Z=function(e){let{config:t,src:r,unoptimized:n,width:a,quality:l,sizes:o,loader:i}=e;if(n)return{src:r,srcSet:void 0,sizes:void 0};let{widths:s,kind:d}=function(e,t,r){let{deviceSizes:n,allSizes:a}=e;if(r){let e=/(^|\s)(1?\d?\d)vw/g,t=[];for(let n;n=e.exec(r);)t.push(parseInt(n[2]));if(t.length){let e=.01*Math.min(...t);return{widths:a.filter(t=>t>=n[0]*e),kind:"w"}}return{widths:a,kind:"w"}}return"number"!=typeof t?{widths:n,kind:"w"}:{widths:[...new Set([t,2*t].map(e=>a.find(t=>t>=e)||a[a.length-1]))],kind:"x"}}(t,a,o),c=s.length-1;return{sizes:o||"w"!==d?o:"100vw",srcSet:s.map((e,n)=>i({config:t,src:r,quality:l,width:e})+" "+("w"===d?e:n+1)+d).join(", "),src:i({config:t,src:r,quality:l,width:s[c]})}}({config:d,src:p,unoptimized:m,width:q,quality:X,sizes:f,loader:U});return{props:{...O,loading:G?"lazy":x,fetchPriority:S,width:q,height:K,decoding:M,className:g,style:{...W,...$},sizes:Z.sizes,srcSet:Z.srcSet,src:N||Z.src},meta:{unoptimized:m,priority:h,placeholder:E,fill:w}}}},98879,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return i}});let n=e.r(71645),a="undefined"==typeof window,l=a?()=>{}:n.useLayoutEffect,o=a?()=>{}:n.useEffect;function i(e){let{headManager:t,reduceComponentsToState:r}=e;function i(){if(t&&t.mountedInstances){let a=n.Children.toArray(Array.from(t.mountedInstances).filter(Boolean));t.updateHead(r(a,e))}}if(a){var s;null==t||null==(s=t.mountedInstances)||s.add(e.children),i()}return l(()=>{var r;return null==t||null==(r=t.mountedInstances)||r.add(e.children),()=>{var r;null==t||null==(r=t.mountedInstances)||r.delete(e.children)}}),l(()=>(t&&(t._pendingUpdate=i),()=>{t&&(t._pendingUpdate=i)})),o(()=>(t&&t._pendingUpdate&&(t._pendingUpdate(),t._pendingUpdate=null),()=>{t&&t._pendingUpdate&&(t._pendingUpdate(),t._pendingUpdate=null)})),null}},58908,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"AmpStateContext",{enumerable:!0,get:function(){return n}});let n=e.r(55682)._(e.r(71645)).default.createContext({})},15986,(e,t,r)=>{"use strict";function n(e){let{ampFirst:t=!1,hybrid:r=!1,hasQuery:n=!1}=void 0===e?{}:e;return t||r&&n}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isInAmpMode",{enumerable:!0,get:function(){return n}})},25633,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(r,{default:function(){return h},defaultHead:function(){return u}});let n=e.r(55682),a=e.r(90809),l=e.r(43476),o=a._(e.r(71645)),i=n._(e.r(98879)),s=e.r(58908),d=e.r(42732),c=e.r(15986);function u(e){void 0===e&&(e=!1);let t=[(0,l.jsx)("meta",{charSet:"utf-8"},"charset")];return e||t.push((0,l.jsx)("meta",{name:"viewport",content:"width=device-width"},"viewport")),t}function p(e,t){return"string"==typeof t||"number"==typeof t?e:t.type===o.default.Fragment?e.concat(o.default.Children.toArray(t.props.children).reduce((e,t)=>"string"==typeof t||"number"==typeof t?e:e.concat(t),[])):e.concat(t)}e.r(33525);let f=["name","httpEquiv","charSet","itemProp"];function m(e,t){let{inAmpMode:r}=t;return e.reduce(p,[]).reverse().concat(u(r).reverse()).filter(function(){let e=new Set,t=new Set,r=new Set,n={};return a=>{let l=!0,o=!1;if(a.key&&"number"!=typeof a.key&&a.key.indexOf("$")>0){o=!0;let t=a.key.slice(a.key.indexOf("$")+1);e.has(t)?l=!1:e.add(t)}switch(a.type){case"title":case"base":t.has(a.type)?l=!1:t.add(a.type);break;case"meta":for(let e=0,t=f.length;e<t;e++){let t=f[e];if(a.props.hasOwnProperty(t))if("charSet"===t)r.has(t)?l=!1:r.add(t);else{let e=a.props[t],r=n[t]||new Set;("name"!==t||!o)&&r.has(e)?l=!1:(r.add(e),n[t]=r)}}}return l}}()).reverse().map((e,t)=>{let r=e.key||t;return o.default.cloneElement(e,{key:r})})}let h=function(e){let{children:t}=e,r=(0,o.useContext)(s.AmpStateContext),n=(0,o.useContext)(d.HeadManagerContext);return(0,l.jsx)(i.default,{reduceComponentsToState:m,headManager:n,inAmpMode:(0,c.isInAmpMode)(r),children:t})};("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},18556,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ImageConfigContext",{enumerable:!0,get:function(){return l}});let n=e.r(55682)._(e.r(71645)),a=e.r(87690),l=n.default.createContext(a.imageConfigDefault)},65856,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"RouterContext",{enumerable:!0,get:function(){return n}});let n=e.r(55682)._(e.r(71645)).default.createContext(null)},1948,(e,t,r)=>{"use strict";function n(e){var t;let{config:r,src:n,width:a,quality:l}=e,o=l||(null==(t=r.qualities)?void 0:t.reduce((e,t)=>Math.abs(t-75)<Math.abs(e-75)?t:e))||75;return r.path+"?url="+encodeURIComponent(n)+"&w="+a+"&q="+o+(n.startsWith("/_next/static/media/"),"")}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return a}}),n.__next_img_default=!0;let a=n},5500,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"Image",{enumerable:!0,get:function(){return y}});let n=e.r(55682),a=e.r(90809),l=e.r(43476),o=a._(e.r(71645)),i=n._(e.r(74080)),s=n._(e.r(25633)),d=e.r(8927),c=e.r(87690),u=e.r(18556);e.r(33525);let p=e.r(65856),f=n._(e.r(1948)),m=e.r(18581),h={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1};function x(e,t,r,n,a,l,o){let i=null==e?void 0:e.src;e&&e["data-loaded-src"]!==i&&(e["data-loaded-src"]=i,("decode"in e?e.decode():Promise.resolve()).catch(()=>{}).then(()=>{if(e.parentElement&&e.isConnected){if("empty"!==t&&a(!0),null==r?void 0:r.current){let t=new Event("load");Object.defineProperty(t,"target",{writable:!1,value:e});let n=!1,a=!1;r.current({...t,nativeEvent:t,currentTarget:e,target:e,isDefaultPrevented:()=>n,isPropagationStopped:()=>a,persist:()=>{},preventDefault:()=>{n=!0,t.preventDefault()},stopPropagation:()=>{a=!0,t.stopPropagation()}})}(null==n?void 0:n.current)&&n.current(e)}}))}function g(e){return o.use?{fetchPriority:e}:{fetchpriority:e}}"undefined"==typeof window&&(globalThis.__NEXT_IMAGE_IMPORTED=!0);let v=(0,o.forwardRef)((e,t)=>{let{src:r,srcSet:n,sizes:a,height:i,width:s,decoding:d,className:c,style:u,fetchPriority:p,placeholder:f,loading:h,unoptimized:v,fill:b,onLoadRef:y,onLoadingCompleteRef:w,setBlurComplete:j,setShowAltText:N,sizesInput:C,onLoad:k,onError:E,...D}=e,S=(0,o.useCallback)(e=>{e&&(E&&(e.src=e.src),e.complete&&x(e,f,y,w,j,v,C))},[r,f,y,w,j,E,v,C]),M=(0,m.useMergedRef)(t,S);return(0,l.jsx)("img",{...D,...g(p),loading:h,width:s,height:i,decoding:d,"data-nimg":b?"fill":"1",className:c,style:u,sizes:a,srcSet:n,src:r,ref:M,onLoad:e=>{x(e.currentTarget,f,y,w,j,v,C)},onError:e=>{N(!0),"empty"!==f&&j(!0),E&&E(e)}})});function b(e){let{isAppRouter:t,imgAttributes:r}=e,n={as:"image",imageSrcSet:r.srcSet,imageSizes:r.sizes,crossOrigin:r.crossOrigin,referrerPolicy:r.referrerPolicy,...g(r.fetchPriority)};return t&&i.default.preload?(i.default.preload(r.src,n),null):(0,l.jsx)(s.default,{children:(0,l.jsx)("link",{rel:"preload",href:r.srcSet?void 0:r.src,...n},"__nimg-"+r.src+r.srcSet+r.sizes)})}let y=(0,o.forwardRef)((e,t)=>{let r=(0,o.useContext)(p.RouterContext),n=(0,o.useContext)(u.ImageConfigContext),a=(0,o.useMemo)(()=>{var e;let t=h||n||c.imageConfigDefault,r=[...t.deviceSizes,...t.imageSizes].sort((e,t)=>e-t),a=t.deviceSizes.sort((e,t)=>e-t),l=null==(e=t.qualities)?void 0:e.sort((e,t)=>e-t);return{...t,allSizes:r,deviceSizes:a,qualities:l}},[n]),{onLoad:i,onLoadingComplete:s}=e,m=(0,o.useRef)(i);(0,o.useEffect)(()=>{m.current=i},[i]);let x=(0,o.useRef)(s);(0,o.useEffect)(()=>{x.current=s},[s]);let[g,y]=(0,o.useState)(!1),[w,j]=(0,o.useState)(!1),{props:N,meta:C}=(0,d.getImgProps)(e,{defaultLoader:f.default,imgConf:a,blurComplete:g,showAltText:w});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(v,{...N,unoptimized:C.unoptimized,placeholder:C.placeholder,fill:C.fill,onLoadRef:m,onLoadingCompleteRef:x,setBlurComplete:y,setShowAltText:j,sizesInput:e.sizes,ref:t}),C.priority?(0,l.jsx)(b,{isAppRouter:!r,imgAttributes:N}):null]})});("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},94909,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(r,{default:function(){return s},getImageProps:function(){return i}});let n=e.r(55682),a=e.r(8927),l=e.r(5500),o=n._(e.r(1948));function i(e){let{props:t}=(0,a.getImgProps)(e,{defaultLoader:o.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let s=l.Image},57688,(e,t,r)=>{t.exports=e.r(94909)},40104,e=>{"use strict";let t;e.s(["default",()=>an],40104);var r,n,a,l,o,i,s,d,c,u,p=e.i(43476),f=e.i(71645),m=e.i(18566),h=e.i(17255),x=e.i(22016),g=e.i(75254);let v=(0,g.default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),b=(0,g.default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),y=(0,g.default)("file-down",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),w=(0,g.default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),j=(0,g.default)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),N=(0,g.default)("file-stack",[["path",{d:"M11 21a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-8a1 1 0 0 1 1-1",key:"likhh7"}],["path",{d:"M16 16a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1",key:"17ky3x"}],["path",{d:"M21 6a2 2 0 0 0-.586-1.414l-2-2A2 2 0 0 0 17 2h-3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1z",key:"1hyeo0"}]]),C=(0,g.default)("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]),k=["basic","context","advantages","products","terms","gallery","contacts"],E=e=>"".concat(e,"-").concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),D=e=>{var t,r;return{type:"item",id:e.id,productId:e.productId,name:e.name,description:null!=(t=e.description)?t:"",qty:Number.isFinite(e.qty)?e.qty:1,price:Number.isFinite(e.price)?e.price:0,discount:Number.isFinite(e.discount)?e.discount:0,unit:null!=(r=e.unit)?r:"шт"}},S=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Вариант 1";return{id:E("variant"),name:e,description:"",isRecommended:!0,rows:[]}},M=(e,t)=>{let r=S("Вариант 1");return{workspaceId:e,title:"Новое коммерческое предложение",items:[],currency:"RUB",pricingMode:"variants",productVariants:[r],activeVariantId:r.id,productsView:{showDiscountColumn:!0,showUnitColumn:!0},includeVat:!0,vatRate:20,advantages:[],advantagesColumns:3,visibleSections:[...k],status:"draft",createdBy:t,updatedBy:t,version:1}},R=[{value:"prepaid",label:"100% предоплата"},{value:"50-50",label:"50% предоплата / 50% по завершении"},{value:"postpaid",label:"Постоплата"},{value:"custom",label:"Свои условия"}];function F(e){return"item"===e.type}function A(e){if("variants"!==e.pricingMode||!Array.isArray(e.productVariants)||0===e.productVariants.length)return null;if(e.activeVariantId){let t=e.productVariants.find(t=>t.id===e.activeVariantId);if(t)return t}let t=e.productVariants.find(e=>e.isRecommended);return null!=t?t:e.productVariants[0]}function P(e){let t=A(e);if(t)return t?t.rows.filter(F).map(e=>({id:e.id,productId:e.productId,name:e.name,description:e.description,qty:e.qty,price:e.price,discount:e.discount,unit:e.unit})):[];return Array.isArray(e.items)?e.items:[]}function I(e){let t=e.qty*e.price;return e.discount&&e.discount>0?t*(1-e.discount/100):t}function O(e){return e.reduce((e,t)=>e+I(t),0)}function T(e){let t=O(P(e));return e.includeVat&&e.vatRate>0?t*(1+e.vatRate/100):t}function _(e){return e.includeVat&&0!==e.vatRate?O(P(e))*(e.vatRate/100):0}function z(e){let t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])}function L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"RUB";return"".concat(e.toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2})," ").concat({RUB:"₽",USD:"$",EUR:"€"}[t]||t)}function V(e){return e.toLocaleString("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2})}var U=e.i(7233),B=e.i(62870),H=e.i(67881);let q="var(--field-border)";function K(e){let{value:t,onChange:r,disabled:n}=e,[a,l]=(0,f.useState)([]),[o,i]=(0,f.useState)(!0);(0,f.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/clients");if(!e.ok)throw Error("Failed to fetch clients");let t=await e.json();l(t)}catch(e){console.error("Failed to load clients:",e)}finally{i(!1)}})()},[]);let s=a.find(e=>e.id===t),d=s?s.name:void 0;return(0,p.jsxs)("div",{className:"flex w-full items-center gap-2",children:[(0,p.jsxs)(B.Select,{value:null!=t?t:"none",onValueChange:e=>{"none"===e?r(null):r(e)},disabled:n||o,children:[(0,p.jsx)(B.SelectTrigger,{id:"client",className:"!h-[42px] w-full min-w-0 flex-1 rounded-lg border bg-white px-4 py-0 text-sm font-medium text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",style:{borderColor:q},children:(0,p.jsx)(B.SelectValue,{placeholder:o?"Загрузка...":"Без клиента",children:d||(o?"Загрузка...":"Без клиента")})}),(0,p.jsxs)(B.SelectContent,{className:"border-[var(--field-border)] bg-white",children:[(0,p.jsx)(B.SelectItem,{value:"none",className:"focus:bg-[#FAEFEB] focus:text-[#3d3d3a]",children:"Без клиента"}),a.map(e=>(0,p.jsx)(B.SelectItem,{value:e.id,className:"focus:bg-[#FAEFEB] focus:text-[#3d3d3a]",children:(0,p.jsxs)("div",{className:"flex flex-col",children:[(0,p.jsx)("span",{className:"font-medium",children:e.name}),e.company&&(0,p.jsx)("span",{className:"text-xs",style:{color:"#73726c"},children:e.company})]})},e.id))]})]}),(0,p.jsxs)(H.Button,{type:"button",variant:"outline",onClick:()=>window.open("/clients/new","_blank"),className:"!h-[42px] shrink-0 rounded-lg border bg-white px-3 transition-colors hover:bg-[#FAFAF7] focus-visible:border-[var(--field-focus)] focus-visible:ring-[var(--field-ring)]",style:{borderColor:q,color:"#3d3d3a"},title:"Создать нового клиента",disabled:n,children:[(0,p.jsx)(U.Plus,{className:"h-4 w-4"}),(0,p.jsx)("span",{className:"text-sm font-medium",children:"Создать нового"})]})]})}function G(e){var t;let{proposal:r,onUpdate:n}=e,[a,l]=(0,f.useState)(null),o=(0,f.useRef)(null);return(0,f.useEffect)(()=>{if(!r.clientId){l(null),o.current=null;return}fetch("/api/clients/".concat(r.clientId)).then(e=>e.ok?e.json():null).then(e=>l(e)).catch(()=>l(null))},[r.clientId]),(0,f.useEffect)(()=>{if(a&&!r.recipientName){var e;o.current!==r.clientId&&(n("recipientName",a.middleName?"Уважаемый ".concat(a.name," ").concat(a.middleName,"!"):"Уважаемый ".concat(a.name,"!")),o.current=null!=(e=r.clientId)?e:null)}},[a,r.clientId,r.recipientName,n]),(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Клиент"}),(0,p.jsx)(K,{value:null!=(t=r.clientId)?t:null,onChange:e=>n("clientId",null!=e?e:void 0)}),(0,p.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Выберите клиента из списка или оставьте пустым"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"proposal-title",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Название коммерческого предложения"}),(0,p.jsx)("input",{id:"proposal-title",type:"text",value:r.title,onChange:e=>n("title",e.target.value),placeholder:"Например: Разработка корпоративного сайта",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"recipient-name",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Обращение"}),(0,p.jsx)("input",{id:"recipient-name",type:"text",value:r.recipientName||"",onChange:e=>n("recipientName",e.target.value),placeholder:"Уважаемый Иван Петрович!",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,p.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Заполняется автоматически при выборе клиента"})]})]})}function X(e){let{proposal:t,onUpdate:r}=e;return(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"problem-desc",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Описание ситуации клиента (Point A)"}),(0,p.jsx)("textarea",{id:"problem-desc",value:t.problemDesc||"",onChange:e=>r("problemDesc",e.target.value),placeholder:"Опишите текущую ситуацию клиента, его проблемы или потребности...",rows:4,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"}),(0,p.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Покажите, что вы понимаете проблему клиента"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"solution-desc",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Предлагаемое решение (Point B)"}),(0,p.jsx)("textarea",{id:"solution-desc",value:t.solutionDesc||"",onChange:e=>r("solutionDesc",e.target.value),placeholder:"Опишите, как ваше предложение решит проблему клиента...",rows:4,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"}),(0,p.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Объясните выгоды и результаты для клиента"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"additional-desc",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Дополнительное описание"}),(0,p.jsx)("textarea",{id:"additional-desc",value:t.additionalDesc||"",onChange:e=>r("additionalDesc",e.target.value),placeholder:"Дополнительная информация, преимущества, гарантии...",rows:3,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"}),(0,p.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Необязательное поле для дополнительной информации"})]})]})}var W=e.i(57688);let Y=(0,g.default)("image-plus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);var J=e.i(27612);function $(e){var t;let{proposal:r,onUpdate:n}=e,a=(0,f.useMemo)(()=>{var e;return null!=(e=r.advantages)?e:[]},[r.advantages]),l=null!=(t=r.advantagesColumns)?t:3,o=(0,f.useCallback)(e=>{n("advantages",e)},[n]),i=(0,f.useCallback)(()=>{if(a.length>=3)return;let e=[...a,{id:"adv-".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,8)),title:"",description:""}];o(e),3===e.length&&l<3&&n("advantagesColumns",3)},[a,l,n,o]),s=(0,f.useCallback)(e=>{o(a.filter((t,r)=>r!==e))},[a,o]),d=(0,f.useCallback)((e,t)=>{o(a.map((r,n)=>n===e?{...r,...t}:r))},[a,o]),c=(0,f.useCallback)(async(e,t)=>{if(t)try{let r=new FormData;r.append("file",t);let n=await fetch("/api/upload",{method:"POST",body:r});if(!n.ok)throw Error(await n.text());let a=await n.json();d(e,{iconUrl:a.url})}catch(e){console.error("Failed to upload advantage icon:",e),alert("Не удалось загрузить иконку")}},[d]);return(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("h3",{className:"mb-2 block text-sm font-medium",style:{color:"#3d3d3a"},children:"Преимущества"}),(0,p.jsxs)("p",{className:"text-xs",style:{color:"#73726c"},children:["Добавьте до ",3," карточек: иконка, заголовок и описание."]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"advantages-columns",className:"mb-2 block text-sm font-medium",style:{color:"#3d3d3a"},children:"Колонки в блоке"}),(0,p.jsxs)("select",{id:"advantages-columns",value:l,onChange:e=>n("advantagesColumns",Number(e.target.value)),className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-[#3d3d3a] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",children:[(0,p.jsx)("option",{value:1,children:"1 колонка"}),(0,p.jsx)("option",{value:2,children:"2 колонки"}),(0,p.jsx)("option",{value:3,children:"3 колонки"})]})]}),(0,p.jsx)("div",{className:"space-y-4",children:a.map((e,t)=>{var r;return(0,p.jsxs)("div",{className:"space-y-4 rounded-lg border bg-[#FAFAFA] p-4",style:{borderColor:"hsl(30deg 3.3% 11.8% / 15%)"},children:[(0,p.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,p.jsxs)("p",{className:"text-sm font-medium",style:{color:"#3d3d3a"},children:["Карточка ",t+1]}),(0,p.jsx)("button",{type:"button",onClick:()=>s(t),className:"rounded-md p-2 text-[#73726c] transition-colors hover:bg-[#f4f2ec] hover:text-red-600","aria-label":"Удалить карточку",children:(0,p.jsx)(J.Trash2,{className:"h-4 w-4"})})]}),(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsxs)("label",{className:"relative flex h-16 w-16 cursor-pointer items-center justify-center overflow-hidden rounded-full border border-dashed bg-white",style:{borderColor:"hsl(30deg 3.3% 11.8% / 25%)"},children:[e.iconUrl?(0,p.jsx)(W.default,{src:e.iconUrl,alt:"Иконка преимущества",width:64,height:64,className:"h-full w-full object-cover"}):(0,p.jsx)(Y,{className:"h-5 w-5",style:{color:"#a5a29b"}}),(0,p.jsx)("input",{type:"file",accept:"image/*",className:"absolute inset-0 cursor-pointer opacity-0",onChange:e=>{var r,n;c(t,null!=(n=null==(r=e.target.files)?void 0:r[0])?n:null)}})]}),(0,p.jsx)("p",{className:"text-xs",style:{color:"#73726c"},children:"Иконка (PNG/JPG)"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"mb-2 block text-sm font-medium",style:{color:"#3d3d3a"},children:"Заголовок"}),(0,p.jsx)("input",{type:"text",value:e.title,onChange:e=>d(t,{title:e.target.value}),placeholder:"Например: Прозрачная смета",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-[#3d3d3a] placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"mb-2 block text-sm font-medium",style:{color:"#3d3d3a"},children:"Описание"}),(0,p.jsx)("textarea",{value:e.description,onChange:e=>d(t,{description:e.target.value}),placeholder:"Короткое описание преимущества",rows:3,className:"w-full resize-y rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-[#3d3d3a] placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})]})]},null!=(r=e.id)?r:t)})}),a.length<3&&(0,p.jsxs)("button",{type:"button",onClick:i,className:"inline-flex items-center gap-2 rounded-lg border bg-white px-4 py-2 text-sm font-medium text-[#3d3d3a] transition-colors hover:bg-[#f4f2ec]",style:{borderColor:"hsl(30deg 3.3% 11.8% / 15%)"},children:[(0,p.jsx)(U.Plus,{className:"h-4 w-4"}),"Добавить карточку"]})]})}var Z=e.i(74080);let Q="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function ee(e){let t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function et(e){return"nodeType"in e}function er(e){var t,r;return e?ee(e)?e:et(e)&&null!=(t=null==(r=e.ownerDocument)?void 0:r.defaultView)?t:window:window}function en(e){let{Document:t}=er(e);return e instanceof t}function ea(e){return!ee(e)&&e instanceof er(e).HTMLElement}function el(e){return e instanceof er(e).SVGElement}function eo(e){return e?ee(e)?e.document:et(e)?en(e)?e:ea(e)||el(e)?e.ownerDocument:document:document:document}let ei=Q?f.useLayoutEffect:f.useEffect;function es(e){let t=(0,f.useRef)(e);return ei(()=>{t.current=e}),(0,f.useCallback)(function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return null==t.current?void 0:t.current(...r)},[])}function ed(e,t){void 0===t&&(t=[e]);let r=(0,f.useRef)(e);return ei(()=>{r.current!==e&&(r.current=e)},t),r}function ec(e,t){let r=(0,f.useRef)();return(0,f.useMemo)(()=>{let t=e(r.current);return r.current=t,t},[...t])}function eu(e){let t=es(e),r=(0,f.useRef)(null),n=(0,f.useCallback)(e=>{e!==r.current&&(null==t||t(e,r.current)),r.current=e},[]);return[r,n]}function ep(e){let t=(0,f.useRef)();return(0,f.useEffect)(()=>{t.current=e},[e]),t.current}let ef={};function em(e,t){return(0,f.useMemo)(()=>{if(t)return t;let r=null==ef[e]?0:ef[e]+1;return ef[e]=r,e+"-"+r},[e,t])}function eh(e){return function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return n.reduce((t,r)=>{for(let[n,a]of Object.entries(r)){let r=t[n];null!=r&&(t[n]=r+e*a)}return t},{...t})}}let ex=eh(1),eg=eh(-1);function ev(e){if(!e)return!1;let{KeyboardEvent:t}=er(e.target);return t&&e instanceof t}function eb(e){if(function(e){if(!e)return!1;let{TouchEvent:t}=er(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){let{clientX:t,clientY:r}=e.touches[0];return{x:t,y:r}}else if(e.changedTouches&&e.changedTouches.length){let{clientX:t,clientY:r}=e.changedTouches[0];return{x:t,y:r}}}return"clientX"in e&&"clientY"in e?{x:e.clientX,y:e.clientY}:null}let ey=Object.freeze({Translate:{toString(e){if(!e)return;let{x:t,y:r}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;let{scaleX:t,scaleY:r}=e;return"scaleX("+t+") scaleY("+r+")"}},Transform:{toString(e){if(e)return[ey.Translate.toString(e),ey.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:r,easing:n}=e;return t+" "+r+"ms "+n}}}),ew="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]",ej={display:"none"};function eN(e){let{id:t,value:r}=e;return f.default.createElement("div",{id:t,style:ej},r)}function eC(e){let{id:t,announcement:r,ariaLiveType:n="assertive"}=e;return f.default.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":n,"aria-atomic":!0},r)}let ek=(0,f.createContext)(null),eE={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},eD={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:r}=e;return r?"Draggable item "+t.id+" was moved over droppable area "+r.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:r}=e;return r?"Draggable item "+t.id+" was dropped over droppable area "+r.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function eS(e){let{announcements:t=eD,container:r,hiddenTextDescribedById:n,screenReaderInstructions:a=eE}=e,{announce:l,announcement:o}=function(){let[e,t]=(0,f.useState)("");return{announce:(0,f.useCallback)(e=>{null!=e&&t(e)},[]),announcement:e}}(),i=em("DndLiveRegion"),[s,d]=(0,f.useState)(!1);(0,f.useEffect)(()=>{d(!0)},[]);var c=(0,f.useMemo)(()=>({onDragStart(e){let{active:r}=e;l(t.onDragStart({active:r}))},onDragMove(e){let{active:r,over:n}=e;t.onDragMove&&l(t.onDragMove({active:r,over:n}))},onDragOver(e){let{active:r,over:n}=e;l(t.onDragOver({active:r,over:n}))},onDragEnd(e){let{active:r,over:n}=e;l(t.onDragEnd({active:r,over:n}))},onDragCancel(e){let{active:r,over:n}=e;l(t.onDragCancel({active:r,over:n}))}}),[l,t]);let u=(0,f.useContext)(ek);if((0,f.useEffect)(()=>{if(!u)throw Error("useDndMonitor must be used within a children of <DndContext>");return u(c)},[c,u]),!s)return null;let p=f.default.createElement(f.default.Fragment,null,f.default.createElement(eN,{id:n,value:a.draggable}),f.default.createElement(eC,{id:i,announcement:o}));return r?(0,Z.createPortal)(p,r):p}function eM(){}function eR(e,t){return(0,f.useMemo)(()=>({sensor:e,options:null!=t?t:{}}),[e,t])}!function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"}(r||(r={}));let eF=Object.freeze({x:0,y:0});function eA(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function eP(e,t){let{data:{value:r}}=e,{data:{value:n}}=t;return r-n}function eI(e,t){let{data:{value:r}}=e,{data:{value:n}}=t;return n-r}function eO(e){let{left:t,top:r,height:n,width:a}=e;return[{x:t,y:r},{x:t+a,y:r},{x:t,y:r+n},{x:t+a,y:r+n}]}function eT(e,t){if(!e||0===e.length)return null;let[r]=e;return t?r[t]:r}function e_(e,t,r){return void 0===t&&(t=e.left),void 0===r&&(r=e.top),{x:t+.5*e.width,y:r+.5*e.height}}let ez=e=>{let{collisionRect:t,droppableRects:r,droppableContainers:n}=e,a=e_(t,t.left,t.top),l=[];for(let e of n){let{id:t}=e,n=r.get(t);if(n){let r=eA(e_(n),a);l.push({id:t,data:{droppableContainer:e,value:r}})}}return l.sort(eP)},eL=e=>{let{collisionRect:t,droppableRects:r,droppableContainers:n}=e,a=[];for(let e of n){let{id:n}=e,l=r.get(n);if(l){let r=function(e,t){let r=Math.max(t.top,e.top),n=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),l=Math.min(t.top+t.height,e.top+e.height);if(n<a&&r<l){let o=t.width*t.height,i=e.width*e.height,s=(a-n)*(l-r);return Number((s/(o+i-s)).toFixed(4))}return 0}(l,t);r>0&&a.push({id:n,data:{droppableContainer:e,value:r}})}}return a.sort(eI)};function eV(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:eF}let eU=function(e){return function(t){for(var r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];return n.reduce((t,r)=>({...t,top:t.top+e*r.y,bottom:t.bottom+e*r.y,left:t.left+e*r.x,right:t.right+e*r.x}),{...t})}}(1),eB={ignoreTransform:!1};function eH(e,t){void 0===t&&(t=eB);let r=e.getBoundingClientRect();if(t.ignoreTransform){let{transform:t,transformOrigin:n}=er(e).getComputedStyle(e);t&&(r=function(e,t,r){let n=function(e){if(e.startsWith("matrix3d(")){let t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){let t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}(t);if(!n)return e;let{scaleX:a,scaleY:l,x:o,y:i}=n,s=e.left-o-(1-a)*parseFloat(r),d=e.top-i-(1-l)*parseFloat(r.slice(r.indexOf(" ")+1)),c=a?e.width/a:e.width,u=l?e.height/l:e.height;return{width:c,height:u,top:d,right:s+c,bottom:d+u,left:s}}(r,t,n))}let{top:n,left:a,width:l,height:o,bottom:i,right:s}=r;return{top:n,left:a,width:l,height:o,bottom:i,right:s}}function eq(e){return eH(e,{ignoreTransform:!0})}function eK(e,t){let r=[];return e?function n(a){var l;if(null!=t&&r.length>=t||!a)return r;if(en(a)&&null!=a.scrollingElement&&!r.includes(a.scrollingElement))return r.push(a.scrollingElement),r;if(!ea(a)||el(a)||r.includes(a))return r;let o=er(e).getComputedStyle(a);return(a!==e&&function(e,t){void 0===t&&(t=er(e).getComputedStyle(e));let r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{let n=t[e];return"string"==typeof n&&r.test(n)})}(a,o)&&r.push(a),void 0===(l=o)&&(l=er(a).getComputedStyle(a)),"fixed"===l.position)?r:n(a.parentNode)}(e):r}function eG(e){let[t]=eK(e,1);return null!=t?t:null}function eX(e){return Q&&e?ee(e)?e:et(e)?en(e)||e===eo(e).scrollingElement?window:ea(e)?e:null:null:null}function eW(e){return ee(e)?e.scrollX:e.scrollLeft}function eY(e){return ee(e)?e.scrollY:e.scrollTop}function eJ(e){return{x:eW(e),y:eY(e)}}function e$(e){return!!Q&&!!e&&e===document.scrollingElement}function eZ(e){let t={x:0,y:0},r=e$(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},n={x:e.scrollWidth-r.width,y:e.scrollHeight-r.height},a=e.scrollTop<=t.y,l=e.scrollLeft<=t.x;return{isTop:a,isLeft:l,isBottom:e.scrollTop>=n.y,isRight:e.scrollLeft>=n.x,maxScroll:n,minScroll:t}}!function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"}(n||(n={}));let eQ={x:.2,y:.2};function e0(e){return e.reduce((e,t)=>ex(e,eJ(t)),eF)}let e1=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+eW(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+eY(t),0)}]];class e2{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;let r=eK(t),n=e0(r);for(let[t,a,l]of(this.rect={...e},this.width=e.width,this.height=e.height,e1))for(let e of a)Object.defineProperty(this,e,{get:()=>{let a=l(r),o=n[t]-a;return this.rect[e]+o},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class e3{add(e,t,r){var n;null==(n=this.target)||n.addEventListener(e,t,r),this.listeners.push([e,t,r])}constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}}function e5(e,t){let r=Math.abs(e.x),n=Math.abs(e.y);return"number"==typeof t?Math.sqrt(r**2+n**2)>t:"x"in t&&"y"in t?r>t.x&&n>t.y:"x"in t?r>t.x:"y"in t&&n>t.y}function e6(e){e.preventDefault()}function e4(e){e.stopPropagation()}!function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"}(a||(a={})),function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"}(l||(l={}));let e7={start:[l.Space,l.Enter],cancel:[l.Esc],end:[l.Space,l.Enter,l.Tab]},e8=(e,t)=>{let{currentCoordinates:r}=t;switch(e.code){case l.Right:return{...r,x:r.x+25};case l.Left:return{...r,x:r.x-25};case l.Down:return{...r,y:r.y+25};case l.Up:return{...r,y:r.y-25}}};class e9{attach(){this.handleStart(),this.windowListeners.add(a.Resize,this.handleCancel),this.windowListeners.add(a.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(a.Keydown,this.handleKeyDown))}handleStart(){let{activeNode:e,onStart:t}=this.props,r=e.node.current;r&&function(e,t){if(void 0===t&&(t=eH),!e)return;let{top:r,left:n,bottom:a,right:l}=t(e);eG(e)&&(a<=0||l<=0||r>=window.innerHeight||n>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}(r),t(eF)}handleKeyDown(e){if(ev(e)){let{active:t,context:r,options:n}=this.props,{keyboardCodes:a=e7,coordinateGetter:o=e8,scrollBehavior:i="smooth"}=n,{code:s}=e;if(a.end.includes(s))return void this.handleEnd(e);if(a.cancel.includes(s))return void this.handleCancel(e);let{collisionRect:d}=r.current,c=d?{x:d.left,y:d.top}:eF;this.referenceCoordinates||(this.referenceCoordinates=c);let u=o(e,{active:t,context:r.current,currentCoordinates:c});if(u){let t=eg(u,c),n={x:0,y:0},{scrollableAncestors:a}=r.current;for(let r of a){let a=e.code,{isTop:o,isRight:s,isLeft:d,isBottom:c,maxScroll:p,minScroll:f}=eZ(r),m=function(e){if(e===document.scrollingElement){let{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}let{top:t,left:r,right:n,bottom:a}=e.getBoundingClientRect();return{top:t,left:r,right:n,bottom:a,width:e.clientWidth,height:e.clientHeight}}(r),h={x:Math.min(a===l.Right?m.right-m.width/2:m.right,Math.max(a===l.Right?m.left:m.left+m.width/2,u.x)),y:Math.min(a===l.Down?m.bottom-m.height/2:m.bottom,Math.max(a===l.Down?m.top:m.top+m.height/2,u.y))},x=a===l.Right&&!s||a===l.Left&&!d,g=a===l.Down&&!c||a===l.Up&&!o;if(x&&h.x!==u.x){let e=r.scrollLeft+t.x,o=a===l.Right&&e<=p.x||a===l.Left&&e>=f.x;if(o&&!t.y)return void r.scrollTo({left:e,behavior:i});o?n.x=r.scrollLeft-e:n.x=a===l.Right?r.scrollLeft-p.x:r.scrollLeft-f.x,n.x&&r.scrollBy({left:-n.x,behavior:i});break}if(g&&h.y!==u.y){let e=r.scrollTop+t.y,o=a===l.Down&&e<=p.y||a===l.Up&&e>=f.y;if(o&&!t.x)return void r.scrollTo({top:e,behavior:i});o?n.y=r.scrollTop-e:n.y=a===l.Down?r.scrollTop-p.y:r.scrollTop-f.y,n.y&&r.scrollBy({top:-n.y,behavior:i});break}}this.handleMove(e,ex(eg(u,this.referenceCoordinates),n))}}}handleMove(e,t){let{onMove:r}=this.props;e.preventDefault(),r(t)}handleEnd(e){let{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){let{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;let{event:{target:t}}=e;this.props=e,this.listeners=new e3(eo(t)),this.windowListeners=new e3(er(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}}function te(e){return!!(e&&"distance"in e)}function tt(e){return!!(e&&"delay"in e)}e9.activators=[{eventName:"onKeyDown",handler:(e,t,r)=>{let{keyboardCodes:n=e7,onActivation:a}=t,{active:l}=r,{code:o}=e.nativeEvent;if(n.start.includes(o)){let t=l.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==a||a({event:e.nativeEvent}),!0)}return!1}}];class tr{attach(){let{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:r}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(a.Resize,this.handleCancel),this.windowListeners.add(a.DragStart,e6),this.windowListeners.add(a.VisibilityChange,this.handleCancel),this.windowListeners.add(a.ContextMenu,e6),this.documentListeners.add(a.Keydown,this.handleKeydown),t){if(null!=r&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(tt(t)){this.timeoutId=setTimeout(this.handleStart,t.delay),this.handlePending(t);return}if(te(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){let{active:r,onPending:n}=this.props;n(r,e,this.initialCoordinates,t)}handleStart(){let{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(a.Click,e4,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(a.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;let{activated:r,initialCoordinates:n,props:a}=this,{onMove:l,options:{activationConstraint:o}}=a;if(!n)return;let i=null!=(t=eb(e))?t:eF,s=eg(n,i);if(!r&&o){if(te(o)){if(null!=o.tolerance&&e5(s,o.tolerance))return this.handleCancel();if(e5(s,o.distance))return this.handleStart()}return tt(o)&&e5(s,o.tolerance)?this.handleCancel():void this.handlePending(o,s)}e.cancelable&&e.preventDefault(),l(i)}handleEnd(){let{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){let{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===l.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}constructor(e,t,r){var n;void 0===r&&(r=function(e){let{EventTarget:t}=er(e);return e instanceof t?e:eo(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;let{event:a}=e,{target:l}=a;this.props=e,this.events=t,this.document=eo(l),this.documentListeners=new e3(this.document),this.listeners=new e3(r),this.windowListeners=new e3(er(l)),this.initialCoordinates=null!=(n=eb(a))?n:eF,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}}let tn={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class ta extends tr{constructor(e){let{event:t}=e;super(e,tn,eo(t.target))}}ta.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:r}=e,{onActivation:n}=t;return!!r.isPrimary&&0===r.button&&(null==n||n({event:r}),!0)}}];!function(e){e[e.RightClick=2]="RightClick"}(o||(o={}));!function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"}(i||(i={})),function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"}(s||(s={}));let tl={x:{[n.Backward]:!1,[n.Forward]:!1},y:{[n.Backward]:!1,[n.Forward]:!1}};!function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"}(d||(d={})),(c||(c={})).Optimized="optimized";let to=new Map;function ti(e,t){return ec(r=>e?r||("function"==typeof t?t(e):e):null,[t,e])}function ts(e){let{callback:t,disabled:r}=e,n=es(t),a=(0,f.useMemo)(()=>{if(r||"undefined"==typeof window||void 0===window.ResizeObserver)return;let{ResizeObserver:e}=window;return new e(n)},[r]);return(0,f.useEffect)(()=>()=>null==a?void 0:a.disconnect(),[a]),a}function td(e){return new e2(eH(e),e)}function tc(e,t,r){void 0===t&&(t=td);let[n,a]=(0,f.useState)(null);function l(){a(n=>{if(!e)return null;if(!1===e.isConnected){var a;return null!=(a=null!=n?n:r)?a:null}let l=t(e);return JSON.stringify(n)===JSON.stringify(l)?n:l})}let o=function(e){let{callback:t,disabled:r}=e,n=es(t),a=(0,f.useMemo)(()=>{if(r||"undefined"==typeof window||void 0===window.MutationObserver)return;let{MutationObserver:e}=window;return new e(n)},[n,r]);return(0,f.useEffect)(()=>()=>null==a?void 0:a.disconnect(),[a]),a}({callback(t){if(e)for(let r of t){let{type:t,target:n}=r;if("childList"===t&&n instanceof HTMLElement&&n.contains(e)){l();break}}}}),i=ts({callback:l});return ei(()=>{l(),e?(null==i||i.observe(e),null==o||o.observe(document.body,{childList:!0,subtree:!0})):(null==i||i.disconnect(),null==o||o.disconnect())},[e]),n}let tu=[];function tp(e,t){void 0===t&&(t=[]);let r=(0,f.useRef)(null);return(0,f.useEffect)(()=>{r.current=null},t),(0,f.useEffect)(()=>{let t=e!==eF;t&&!r.current&&(r.current=e),!t&&r.current&&(r.current=null)},[e]),r.current?eg(e,r.current):eF}function tf(e){return(0,f.useMemo)(()=>e?function(e){let t=e.innerWidth,r=e.innerHeight;return{top:0,left:0,right:t,bottom:r,width:t,height:r}}(e):null,[e])}let tm=[],th=[{sensor:ta,options:{}},{sensor:e9,options:{}}],tx={current:{}},tg={draggable:{measure:eq},droppable:{measure:eq,strategy:d.WhileDragging,frequency:c.Optimized},dragOverlay:{measure:eH}};class tv extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,r;return null!=(t=null==(r=this.get(e))?void 0:r.node.current)?t:void 0}}let tb={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new tv,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:eM},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:tg,measureDroppableContainers:eM,windowRect:null,measuringScheduled:!1},ty={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:eM,draggableNodes:new Map,over:null,measureDroppableContainers:eM},tw=(0,f.createContext)(ty),tj=(0,f.createContext)(tb);function tN(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new tv}}}function tC(e,t){switch(t.type){case r.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case r.DragMove:if(null==e.draggable.active)return e;return{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case r.DragEnd:case r.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case r.RegisterDroppable:{let{element:r}=t,{id:n}=r,a=new tv(e.droppable.containers);return a.set(n,r),{...e,droppable:{...e.droppable,containers:a}}}case r.SetDroppableDisabled:{let{id:r,key:n,disabled:a}=t,l=e.droppable.containers.get(r);if(!l||n!==l.key)return e;let o=new tv(e.droppable.containers);return o.set(r,{...l,disabled:a}),{...e,droppable:{...e.droppable,containers:o}}}case r.UnregisterDroppable:{let{id:r,key:n}=t,a=e.droppable.containers.get(r);if(!a||n!==a.key)return e;let l=new tv(e.droppable.containers);return l.delete(r),{...e,droppable:{...e.droppable,containers:l}}}default:return e}}function tk(e){let{disabled:t}=e,{active:r,activatorEvent:n,draggableNodes:a}=(0,f.useContext)(tw),l=ep(n),o=ep(null==r?void 0:r.id);return(0,f.useEffect)(()=>{if(!t&&!n&&l&&null!=o){if(!ev(l)||document.activeElement===l.target)return;let e=a.get(o);if(!e)return;let{activatorNode:t,node:r}=e;(t.current||r.current)&&requestAnimationFrame(()=>{for(let e of[t.current,r.current]){if(!e)continue;let t=e.matches(ew)?e:e.querySelector(ew);if(t){t.focus();break}}})}},[n,t,a,o,l]),null}let tE=(0,f.createContext)({...eF,scaleX:1,scaleY:1});!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"}(u||(u={}));let tD=(0,f.memo)(function(e){var t,a,l,o,c,p;let{id:m,accessibility:h,autoScroll:x=!0,children:g,sensors:v=th,collisionDetection:b=eL,measuring:y,modifiers:w,...j}=e,[N,C]=(0,f.useReducer)(tC,void 0,tN),[k,E]=function(){let[e]=(0,f.useState)(()=>new Set),t=(0,f.useCallback)(t=>(e.add(t),()=>e.delete(t)),[e]);return[(0,f.useCallback)(t=>{let{type:r,event:n}=t;e.forEach(e=>{var t;return null==(t=e[r])?void 0:t.call(e,n)})},[e]),t]}(),[D,S]=(0,f.useState)(u.Uninitialized),M=D===u.Initialized,{draggable:{active:R,nodes:F,translate:A},droppable:{containers:P}}=N,I=null!=R?F.get(R):null,O=(0,f.useRef)({initial:null,translated:null}),T=(0,f.useMemo)(()=>{var e;return null!=R?{id:R,data:null!=(e=null==I?void 0:I.data)?e:tx,rect:O}:null},[R,I]),_=(0,f.useRef)(null),[z,L]=(0,f.useState)(null),[V,U]=(0,f.useState)(null),B=ed(j,Object.values(j)),H=em("DndDescribedBy",m),q=(0,f.useMemo)(()=>P.getEnabled(),[P]),K=(0,f.useMemo)(()=>({draggable:{...tg.draggable,...null==y?void 0:y.draggable},droppable:{...tg.droppable,...null==y?void 0:y.droppable},dragOverlay:{...tg.dragOverlay,...null==y?void 0:y.dragOverlay}}),[null==y?void 0:y.draggable,null==y?void 0:y.droppable,null==y?void 0:y.dragOverlay]),{droppableRects:G,measureDroppableContainers:X,measuringScheduled:W}=function(e,t){let{dragging:r,dependencies:n,config:a}=t,[l,o]=(0,f.useState)(null),{frequency:i,measure:s,strategy:c}=a,u=(0,f.useRef)(e),p=function(){switch(c){case d.Always:return!1;case d.BeforeDragging:return r;default:return!r}}(),m=ed(p),h=(0,f.useCallback)(function(e){void 0===e&&(e=[]),m.current||o(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[m]),x=(0,f.useRef)(null),g=ec(t=>{if(p&&!r)return to;if(!t||t===to||u.current!==e||null!=l){let t=new Map;for(let r of e){if(!r)continue;if(l&&l.length>0&&!l.includes(r.id)&&r.rect.current){t.set(r.id,r.rect.current);continue}let e=r.node.current,n=e?new e2(s(e),e):null;r.rect.current=n,n&&t.set(r.id,n)}return t}return t},[e,l,r,p,s]);return(0,f.useEffect)(()=>{u.current=e},[e]),(0,f.useEffect)(()=>{p||h()},[r,p]),(0,f.useEffect)(()=>{l&&l.length>0&&o(null)},[JSON.stringify(l)]),(0,f.useEffect)(()=>{p||"number"!=typeof i||null!==x.current||(x.current=setTimeout(()=>{h(),x.current=null},i))},[i,p,h,...n]),{droppableRects:g,measureDroppableContainers:h,measuringScheduled:null!=l}}(q,{dragging:M,dependencies:[A.x,A.y],config:K.droppable}),Y=function(e,t){let r=null!=t?e.get(t):void 0,n=r?r.node.current:null;return ec(e=>{var r;return null==t?null:null!=(r=null!=n?n:e)?r:null},[n,t])}(F,R),J=(0,f.useMemo)(()=>V?eb(V):null,[V]),$=function(){let e=(null==z?void 0:z.autoScrollEnabled)===!1,t="object"==typeof x?!1===x.enabled:!1===x,r=M&&!e&&!t;return"object"==typeof x?{...x,enabled:r}:{enabled:r}}(),ee=ti(Y,K.draggable.measure);!function(e){let{activeNode:t,measure:r,initialRect:n,config:a=!0}=e,l=(0,f.useRef)(!1),{x:o,y:i}="boolean"==typeof a?{x:a,y:a}:a;ei(()=>{if(!o&&!i||!t){l.current=!1;return}if(l.current||!n)return;let e=null==t?void 0:t.node.current;if(!e||!1===e.isConnected)return;let a=eV(r(e),n);if(o||(a.x=0),i||(a.y=0),l.current=!0,Math.abs(a.x)>0||Math.abs(a.y)>0){let t=eG(e);t&&t.scrollBy({top:a.y,left:a.x})}},[t,o,i,n,r])}({activeNode:null!=R?F.get(R):null,config:$.layoutShiftCompensation,initialRect:ee,measure:K.draggable.measure});let et=tc(Y,K.draggable.measure,ee),en=tc(Y?Y.parentElement:null),el=(0,f.useRef)({activatorEvent:null,active:null,activeNode:Y,collisionRect:null,collisions:null,droppableRects:G,draggableNodes:F,draggingNode:null,draggingNodeRect:null,droppableContainers:P,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),eo=P.getNodeFor(null==(t=el.current.over)?void 0:t.id),es=function(e){let{measure:t}=e,[r,n]=(0,f.useState)(null),a=ts({callback:(0,f.useCallback)(e=>{for(let{target:r}of e)if(ea(r)){n(e=>{let n=t(r);return e?{...e,width:n.width,height:n.height}:n});break}},[t])}),[l,o]=eu((0,f.useCallback)(e=>{let r=function(e){if(!e)return null;if(e.children.length>1)return e;let t=e.children[0];return ea(t)?t:e}(e);null==a||a.disconnect(),r&&(null==a||a.observe(r)),n(r?t(r):null)},[t,a]));return(0,f.useMemo)(()=>({nodeRef:l,rect:r,setRef:o}),[r,l,o])}({measure:K.dragOverlay.measure}),ef=null!=(a=es.nodeRef.current)?a:Y,eh=M?null!=(l=es.rect)?l:et:null,eg=!!(es.nodeRef.current&&es.rect),ev=function(e){let t=ti(e);return eV(e,t)}(eg?null:et),ey=tf(ef?er(ef):null),ew=function(e){let t=(0,f.useRef)(e),r=ec(r=>e?r&&r!==tu&&e&&t.current&&e.parentNode===t.current.parentNode?r:eK(e):tu,[e]);return(0,f.useEffect)(()=>{t.current=e},[e]),r}(M?null!=eo?eo:Y:null),ej=function(e,t){void 0===t&&(t=eH);let[r]=e,n=tf(r?er(r):null),[a,l]=(0,f.useState)(tm);function o(){l(()=>e.length?e.map(e=>e$(e)?n:new e2(t(e),e)):tm)}let i=ts({callback:o});return ei(()=>{null==i||i.disconnect(),o(),e.forEach(e=>null==i?void 0:i.observe(e))},[e]),a}(ew),eN=function(e,t){let{transform:r,...n}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...n}),r):r}(w,{transform:{x:A.x-ev.x,y:A.y-ev.y,scaleX:1,scaleY:1},activatorEvent:V,active:T,activeNodeRect:et,containerNodeRect:en,draggingNodeRect:eh,over:el.current.over,overlayNodeRect:es.rect,scrollableAncestors:ew,scrollableAncestorRects:ej,windowRect:ey}),eC=J?ex(J,A):null,eE=function(e){let[t,r]=(0,f.useState)(null),n=(0,f.useRef)(e),a=(0,f.useCallback)(e=>{let t=eX(e.target);t&&r(e=>e?(e.set(t,eJ(t)),new Map(e)):null)},[]);return(0,f.useEffect)(()=>{let t=n.current;if(e!==t){l(t);let o=e.map(e=>{let t=eX(e);return t?(t.addEventListener("scroll",a,{passive:!0}),[t,eJ(t)]):null}).filter(e=>null!=e);r(o.length?new Map(o):null),n.current=e}return()=>{l(e),l(t)};function l(e){e.forEach(e=>{let t=eX(e);null==t||t.removeEventListener("scroll",a)})}},[a,e]),(0,f.useMemo)(()=>e.length?t?Array.from(t.values()).reduce((e,t)=>ex(e,t),eF):e0(e):eF,[e,t])}(ew),eD=tp(eE),eM=tp(eE,[et]),eR=ex(eN,eD),eA=eh?eU(eh,eN):null,eP=T&&eA?b({active:T,collisionRect:eA,droppableRects:G,droppableContainers:q,pointerCoordinates:eC}):null,eI=eT(eP,"id"),[eO,e_]=(0,f.useState)(null),ez=(c=eg?eN:ex(eN,eM),p=null!=(o=null==eO?void 0:eO.rect)?o:null,{...c,scaleX:p&&et?p.width/et.width:1,scaleY:p&&et?p.height/et.height:1}),eB=(0,f.useRef)(null),eq=(0,f.useCallback)((e,t)=>{let{sensor:n,options:a}=t;if(null==_.current)return;let l=F.get(_.current);if(!l)return;let o=e.nativeEvent,i=new n({active:_.current,activeNode:l,event:o,options:a,context:el,onAbort(e){if(!F.get(e))return;let{onDragAbort:t}=B.current,r={id:e};null==t||t(r),k({type:"onDragAbort",event:r})},onPending(e,t,r,n){if(!F.get(e))return;let{onDragPending:a}=B.current,l={id:e,constraint:t,initialCoordinates:r,offset:n};null==a||a(l),k({type:"onDragPending",event:l})},onStart(e){let t=_.current;if(null==t)return;let n=F.get(t);if(!n)return;let{onDragStart:a}=B.current,l={activatorEvent:o,active:{id:t,data:n.data,rect:O}};(0,Z.unstable_batchedUpdates)(()=>{null==a||a(l),S(u.Initializing),C({type:r.DragStart,initialCoordinates:e,active:t}),k({type:"onDragStart",event:l}),L(eB.current),U(o)})},onMove(e){C({type:r.DragMove,coordinates:e})},onEnd:s(r.DragEnd),onCancel:s(r.DragCancel)});function s(e){return async function(){let{active:t,collisions:n,over:a,scrollAdjustedTranslate:l}=el.current,i=null;if(t&&l){let{cancelDrop:s}=B.current;i={activatorEvent:o,active:t,collisions:n,delta:l,over:a},e===r.DragEnd&&"function"==typeof s&&await Promise.resolve(s(i))&&(e=r.DragCancel)}_.current=null,(0,Z.unstable_batchedUpdates)(()=>{C({type:e}),S(u.Uninitialized),e_(null),L(null),U(null),eB.current=null;let t=e===r.DragEnd?"onDragEnd":"onDragCancel";if(i){let e=B.current[t];null==e||e(i),k({type:t,event:i})}})}}eB.current=i},[F]),eW=(0,f.useCallback)((e,t)=>(r,n)=>{let a=r.nativeEvent,l=F.get(n);null!==_.current||!l||a.dndKit||a.defaultPrevented||!0===e(r,t.options,{active:l})&&(a.dndKit={capturedBy:t.sensor},_.current=n,eq(r,t))},[F,eq]),eY=(0,f.useMemo)(()=>v.reduce((e,t)=>{let{sensor:r}=t;return[...e,...r.activators.map(e=>({eventName:e.eventName,handler:eW(e.handler,t)}))]},[]),[v,eW]);(0,f.useEffect)(()=>{if(!Q)return;let e=v.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(let t of e)null==t||t()}},v.map(e=>{let{sensor:t}=e;return t})),ei(()=>{et&&D===u.Initializing&&S(u.Initialized)},[et,D]),(0,f.useEffect)(()=>{let{onDragMove:e}=B.current,{active:t,activatorEvent:r,collisions:n,over:a}=el.current;if(!t||!r)return;let l={active:t,activatorEvent:r,collisions:n,delta:{x:eR.x,y:eR.y},over:a};(0,Z.unstable_batchedUpdates)(()=>{null==e||e(l),k({type:"onDragMove",event:l})})},[eR.x,eR.y]),(0,f.useEffect)(()=>{let{active:e,activatorEvent:t,collisions:r,droppableContainers:n,scrollAdjustedTranslate:a}=el.current;if(!e||null==_.current||!t||!a)return;let{onDragOver:l}=B.current,o=n.get(eI),i=o&&o.rect.current?{id:o.id,rect:o.rect.current,data:o.data,disabled:o.disabled}:null,s={active:e,activatorEvent:t,collisions:r,delta:{x:a.x,y:a.y},over:i};(0,Z.unstable_batchedUpdates)(()=>{e_(i),null==l||l(s),k({type:"onDragOver",event:s})})},[eI]),ei(()=>{el.current={activatorEvent:V,active:T,activeNode:Y,collisionRect:eA,collisions:eP,droppableRects:G,draggableNodes:F,draggingNode:ef,draggingNodeRect:eh,droppableContainers:P,over:eO,scrollableAncestors:ew,scrollAdjustedTranslate:eR},O.current={initial:eh,translated:eA}},[T,Y,eP,eA,F,ef,eh,G,P,eO,ew,eR]),function(e){let{acceleration:t,activator:r=i.Pointer,canScroll:a,draggingRect:l,enabled:o,interval:d=5,order:c=s.TreeOrder,pointerCoordinates:u,scrollableAncestors:p,scrollableAncestorRects:m,delta:h,threshold:x}=e,g=function(e){let{delta:t,disabled:r}=e,a=ep(t);return ec(e=>{if(r||!a||!e)return tl;let l={x:Math.sign(t.x-a.x),y:Math.sign(t.y-a.y)};return{x:{[n.Backward]:e.x[n.Backward]||-1===l.x,[n.Forward]:e.x[n.Forward]||1===l.x},y:{[n.Backward]:e.y[n.Backward]||-1===l.y,[n.Forward]:e.y[n.Forward]||1===l.y}}},[r,t,a])}({delta:h,disabled:!o}),[v,b]=function(){let e=(0,f.useRef)(null);return[(0,f.useCallback)((t,r)=>{e.current=setInterval(t,r)},[]),(0,f.useCallback)(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),y=(0,f.useRef)({x:0,y:0}),w=(0,f.useRef)({x:0,y:0}),j=(0,f.useMemo)(()=>{switch(r){case i.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case i.DraggableRect:return l}},[r,l,u]),N=(0,f.useRef)(null),C=(0,f.useCallback)(()=>{let e=N.current;if(!e)return;let t=y.current.x*w.current.x,r=y.current.y*w.current.y;e.scrollBy(t,r)},[]),k=(0,f.useMemo)(()=>c===s.TreeOrder?[...p].reverse():p,[c,p]);(0,f.useEffect)(()=>{if(!o||!p.length||!j)return void b();for(let e of k){if((null==a?void 0:a(e))===!1)continue;let r=m[p.indexOf(e)];if(!r)continue;let{direction:l,speed:o}=function(e,t,r,a,l){let{top:o,left:i,right:s,bottom:d}=r;void 0===a&&(a=10),void 0===l&&(l=eQ);let{isTop:c,isBottom:u,isLeft:p,isRight:f}=eZ(e),m={x:0,y:0},h={x:0,y:0},x={height:t.height*l.y,width:t.width*l.x};return!c&&o<=t.top+x.height?(m.y=n.Backward,h.y=a*Math.abs((t.top+x.height-o)/x.height)):!u&&d>=t.bottom-x.height&&(m.y=n.Forward,h.y=a*Math.abs((t.bottom-x.height-d)/x.height)),!f&&s>=t.right-x.width?(m.x=n.Forward,h.x=a*Math.abs((t.right-x.width-s)/x.width)):!p&&i<=t.left+x.width&&(m.x=n.Backward,h.x=a*Math.abs((t.left+x.width-i)/x.width)),{direction:m,speed:h}}(e,r,j,t,x);for(let e of["x","y"])g[e][l[e]]||(o[e]=0,l[e]=0);if(o.x>0||o.y>0){b(),N.current=e,v(C,d),y.current=o,w.current=l;return}}y.current={x:0,y:0},w.current={x:0,y:0},b()},[t,C,a,b,o,d,JSON.stringify(j),JSON.stringify(g),v,p,k,m,JSON.stringify(x)])}({...$,delta:A,draggingRect:eA,pointerCoordinates:eC,scrollableAncestors:ew,scrollableAncestorRects:ej});let e1=(0,f.useMemo)(()=>({active:T,activeNode:Y,activeNodeRect:et,activatorEvent:V,collisions:eP,containerNodeRect:en,dragOverlay:es,draggableNodes:F,droppableContainers:P,droppableRects:G,over:eO,measureDroppableContainers:X,scrollableAncestors:ew,scrollableAncestorRects:ej,measuringConfiguration:K,measuringScheduled:W,windowRect:ey}),[T,Y,et,V,eP,en,es,F,P,G,eO,X,ew,ej,K,W,ey]),e3=(0,f.useMemo)(()=>({activatorEvent:V,activators:eY,active:T,activeNodeRect:et,ariaDescribedById:{draggable:H},dispatch:C,draggableNodes:F,over:eO,measureDroppableContainers:X}),[V,eY,T,et,C,H,F,eO,X]);return f.default.createElement(ek.Provider,{value:E},f.default.createElement(tw.Provider,{value:e3},f.default.createElement(tj.Provider,{value:e1},f.default.createElement(tE.Provider,{value:ez},g)),f.default.createElement(tk,{disabled:(null==h?void 0:h.restoreFocus)===!1})),f.default.createElement(eS,{...h,hiddenTextDescribedById:H}))}),tS=(0,f.createContext)(null),tM="button",tR={timeout:25},tF={position:"fixed",touchAction:"none"},tA=e=>ev(e)?"transform 250ms ease":void 0;t={styles:{active:{opacity:"0"}}},e=>{let{active:r,dragOverlay:n}=e,a={},{styles:l,className:o}=t;if(null!=l&&l.active)for(let[e,t]of Object.entries(l.active))void 0!==t&&(a[e]=r.node.style.getPropertyValue(e),r.node.style.setProperty(e,t));if(null!=l&&l.dragOverlay)for(let[e,t]of Object.entries(l.dragOverlay))void 0!==t&&n.node.style.setProperty(e,t);return null!=o&&o.active&&r.node.classList.add(o.active),null!=o&&o.dragOverlay&&n.node.classList.add(o.dragOverlay),function(){for(let[e,t]of Object.entries(a))r.node.style.setProperty(e,t);null!=o&&o.active&&r.node.classList.remove(o.active)}};function tP(e,t,r){let n=e.slice();return n.splice(r<0?n.length+r:r,0,n.splice(t,1)[0]),n}function tI(e){return null!==e&&e>=0}let tO=e=>{let{rects:t,activeIndex:r,overIndex:n,index:a}=e,l=tP(t,n,r),o=t[a],i=l[a];return i&&o?{x:i.left-o.left,y:i.top-o.top,scaleX:i.width/o.width,scaleY:i.height/o.height}:null},tT={scaleX:1,scaleY:1},t_=e=>{var t;let{activeIndex:r,activeNodeRect:n,index:a,rects:l,overIndex:o}=e,i=null!=(t=l[r])?t:n;if(!i)return null;if(a===r){let e=l[o];return e?{x:0,y:r<o?e.top+e.height-(i.top+i.height):e.top-i.top,...tT}:null}let s=function(e,t,r){let n=e[t],a=e[t-1],l=e[t+1];return n?r<t?a?n.top-(a.top+a.height):l?l.top-(n.top+n.height):0:l?l.top-(n.top+n.height):a?n.top-(a.top+a.height):0:0}(l,a,r);return a>r&&a<=o?{x:0,y:-i.height-s,...tT}:a<r&&a>=o?{x:0,y:i.height+s,...tT}:{x:0,y:0,...tT}},tz="Sortable",tL=f.default.createContext({activeIndex:-1,containerId:tz,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:tO,disabled:{draggable:!1,droppable:!1}});function tV(e){let{children:t,id:r,items:n,strategy:a=tO,disabled:l=!1}=e,{active:o,dragOverlay:i,droppableRects:s,over:d,measureDroppableContainers:c}=(0,f.useContext)(tj),u=em(tz,r),p=null!==i.rect,m=(0,f.useMemo)(()=>n.map(e=>"object"==typeof e&&"id"in e?e.id:e),[n]),h=null!=o,x=o?m.indexOf(o.id):-1,g=d?m.indexOf(d.id):-1,v=(0,f.useRef)(m),b=!function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(m,v.current),y=-1!==g&&-1===x||b,w="boolean"==typeof l?{draggable:l,droppable:l}:l;ei(()=>{b&&h&&c(m)},[b,m,h,c]),(0,f.useEffect)(()=>{v.current=m},[m]);let j=(0,f.useMemo)(()=>({activeIndex:x,containerId:u,disabled:w,disableTransforms:y,items:m,overIndex:g,useDragOverlay:p,sortedRects:m.reduce((e,t,r)=>{let n=s.get(t);return n&&(e[r]=n),e},Array(m.length)),strategy:a}),[x,u,w.draggable,w.droppable,y,m,g,s,p,a]);return f.default.createElement(tL.Provider,{value:j},t)}let tU=e=>{let{id:t,items:r,activeIndex:n,overIndex:a}=e;return tP(r,n,a).indexOf(t)},tB=e=>{let{containerId:t,isSorting:r,wasDragging:n,index:a,items:l,newIndex:o,previousItems:i,previousContainerId:s,transition:d}=e;return!!d&&!!n&&(i===l||a!==o)&&(!!r||o!==a&&t===s)},tH={duration:200,easing:"ease"},tq="transform",tK=ey.Transition.toString({property:tq,duration:0,easing:"linear"}),tG={roleDescription:"sortable"};function tX(e){if(!e)return!1;let t=e.data.current;return!!t&&"sortable"in t&&"object"==typeof t.sortable&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable}let tW=[l.Down,l.Right,l.Up,l.Left],tY=(e,t)=>{let{context:{active:r,collisionRect:n,droppableRects:a,droppableContainers:o,over:i,scrollableAncestors:s}}=t;if(tW.includes(e.code)){if(e.preventDefault(),!r||!n)return;let t=[];o.getEnabled().forEach(r=>{if(!r||null!=r&&r.disabled)return;let o=a.get(r.id);if(o)switch(e.code){case l.Down:n.top<o.top&&t.push(r);break;case l.Up:n.top>o.top&&t.push(r);break;case l.Left:n.left>o.left&&t.push(r);break;case l.Right:n.left<o.left&&t.push(r)}});let d=(e=>{let{collisionRect:t,droppableRects:r,droppableContainers:n}=e,a=eO(t),l=[];for(let e of n){let{id:t}=e,n=r.get(t);if(n){let r=eO(n),o=Number((a.reduce((e,t,n)=>e+eA(r[n],t),0)/4).toFixed(4));l.push({id:t,data:{droppableContainer:e,value:o}})}}return l.sort(eP)})({active:r,collisionRect:n,droppableRects:a,droppableContainers:t,pointerCoordinates:null}),c=eT(d,"id");if(c===(null==i?void 0:i.id)&&d.length>1&&(c=d[1].id),null!=c){let e=o.get(r.id),t=o.get(c),l=t?a.get(t.id):null,i=null==t?void 0:t.node.current;if(i&&l&&e&&t){let r=eK(i).some((e,t)=>s[t]!==e),a=tJ(e,t),o=function(e,t){return!!tX(e)&&!!tX(t)&&!!tJ(e,t)&&e.data.current.sortable.index<t.data.current.sortable.index}(e,t),d=r||!a?{x:0,y:0}:{x:o?n.width-l.width:0,y:o?n.height-l.height:0},c={x:l.left,y:l.top};return d.x&&d.y?c:eg(c,d)}}}};function tJ(e,t){return!!tX(e)&&!!tX(t)&&e.data.current.sortable.containerId===t.data.current.sortable.containerId}var t$=e.i(78745),t$=t$;let tZ=(0,g.default)("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),tQ=(0,g.default)("grip-vertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);var t0=e.i(31278);let t1=(0,g.default)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),t2=(0,g.default)("percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),t3=(0,g.default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),t5=(0,g.default)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);var t6=e.i(52917),t4=e.i(81140),t7=e.i(20783),t8=e.i(30030),t9=e.i(69340),re=e.i(48425),rt=e.i(75830),rr=e.i(86318),rn=e.i(26330),ra=e.i(3536),rl=e.i(65491),ro=e.i(10772),ri=e.i(53660),rs=e.i(74606),rd=e.i(96626),rc=e.i(42727),ru=e.i(91918),rp=e.i(30207),rf=e.i(86312),rm=e.i(85369),rh=["Enter"," "],rx=["ArrowUp","PageDown","End"],rg=["ArrowDown","PageUp","Home",...rx],rv={ltr:[...rh,"ArrowRight"],rtl:[...rh,"ArrowLeft"]},rb={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ry="Menu",[rw,rj,rN]=(0,rt.createCollection)(ry),[rC,rk]=(0,t8.createContextScope)(ry,[rN,ri.createPopperScope,rc.createRovingFocusGroupScope]),rE=(0,ri.createPopperScope)(),rD=(0,rc.createRovingFocusGroupScope)(),[rS,rM]=rC(ry),[rR,rF]=rC(ry),rA=e=>{let{__scopeMenu:t,open:r=!1,children:n,dir:a,onOpenChange:l,modal:o=!0}=e,i=rE(t),[s,d]=f.useState(null),c=f.useRef(!1),u=(0,rp.useCallbackRef)(l),m=(0,rr.useDirection)(a);return f.useEffect(()=>{let e=()=>{c.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>c.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),(0,p.jsx)(ri.Root,{...i,children:(0,p.jsx)(rS,{scope:t,open:r,onOpenChange:u,content:s,onContentChange:d,children:(0,p.jsx)(rR,{scope:t,onClose:f.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:c,dir:m,modal:o,children:n})})})};rA.displayName=ry;var rP=f.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e,a=rE(r);return(0,p.jsx)(ri.Anchor,{...a,...n,ref:t})});rP.displayName="MenuAnchor";var rI="MenuPortal",[rO,rT]=rC(rI,{forceMount:void 0}),r_=e=>{let{__scopeMenu:t,forceMount:r,children:n,container:a}=e,l=rM(rI,t);return(0,p.jsx)(rO,{scope:t,forceMount:r,children:(0,p.jsx)(rd.Presence,{present:r||l.open,children:(0,p.jsx)(rs.Portal,{asChild:!0,container:a,children:n})})})};r_.displayName=rI;var rz="MenuContent",[rL,rV]=rC(rz),rU=f.forwardRef((e,t)=>{let r=rT(rz,e.__scopeMenu),{forceMount:n=r.forceMount,...a}=e,l=rM(rz,e.__scopeMenu),o=rF(rz,e.__scopeMenu);return(0,p.jsx)(rw.Provider,{scope:e.__scopeMenu,children:(0,p.jsx)(rd.Presence,{present:n||l.open,children:(0,p.jsx)(rw.Slot,{scope:e.__scopeMenu,children:o.modal?(0,p.jsx)(rB,{...a,ref:t}):(0,p.jsx)(rH,{...a,ref:t})})})})}),rB=f.forwardRef((e,t)=>{let r=rM(rz,e.__scopeMenu),n=f.useRef(null),a=(0,t7.useComposedRefs)(t,n);return f.useEffect(()=>{let e=n.current;if(e)return(0,rf.hideOthers)(e)},[]),(0,p.jsx)(rK,{...e,ref:a,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:(0,t4.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),rH=f.forwardRef((e,t)=>{let r=rM(rz,e.__scopeMenu);return(0,p.jsx)(rK,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),rq=(0,ru.createSlot)("MenuContent.ScrollLock"),rK=f.forwardRef((e,t)=>{let{__scopeMenu:r,loop:n=!1,trapFocus:a,onOpenAutoFocus:l,onCloseAutoFocus:o,disableOutsidePointerEvents:i,onEntryFocus:s,onEscapeKeyDown:d,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:m,onDismiss:h,disableOutsideScroll:x,...g}=e,v=rM(rz,r),b=rF(rz,r),y=rE(r),w=rD(r),j=rj(r),[N,C]=f.useState(null),k=f.useRef(null),E=(0,t7.useComposedRefs)(t,k,v.onContentChange),D=f.useRef(0),S=f.useRef(""),M=f.useRef(0),R=f.useRef(null),F=f.useRef("right"),A=f.useRef(0),P=x?rm.RemoveScroll:f.Fragment;f.useEffect(()=>()=>window.clearTimeout(D.current),[]),(0,ra.useFocusGuards)();let I=f.useCallback(e=>{var t,r;return F.current===(null==(t=R.current)?void 0:t.side)&&function(e,t){return!!t&&function(e,t){let{x:r,y:n}=e,a=!1;for(let e=0,l=t.length-1;e<t.length;l=e++){let o=t[e],i=t[l],s=o.x,d=o.y,c=i.x,u=i.y;d>n!=u>n&&r<(c-s)*(n-d)/(u-d)+s&&(a=!a)}return a}({x:e.clientX,y:e.clientY},t)}(e,null==(r=R.current)?void 0:r.area)},[]);return(0,p.jsx)(rL,{scope:r,searchRef:S,onItemEnter:f.useCallback(e=>{I(e)&&e.preventDefault()},[I]),onItemLeave:f.useCallback(e=>{var t;I(e)||(null==(t=k.current)||t.focus(),C(null))},[I]),onTriggerLeave:f.useCallback(e=>{I(e)&&e.preventDefault()},[I]),pointerGraceTimerRef:M,onPointerGraceIntentChange:f.useCallback(e=>{R.current=e},[]),children:(0,p.jsx)(P,{...x?{as:rq,allowPinchZoom:!0}:void 0,children:(0,p.jsx)(rl.FocusScope,{asChild:!0,trapped:a,onMountAutoFocus:(0,t4.composeEventHandlers)(l,e=>{var t;e.preventDefault(),null==(t=k.current)||t.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:(0,p.jsx)(rn.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:d,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:m,onDismiss:h,children:(0,p.jsx)(rc.Root,{asChild:!0,...w,dir:b.dir,orientation:"vertical",loop:n,currentTabStopId:N,onCurrentTabStopIdChange:C,onEntryFocus:(0,t4.composeEventHandlers)(s,e=>{b.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:(0,p.jsx)(ri.Content,{role:"menu","aria-orientation":"vertical","data-state":ni(v.open),"data-radix-menu-content":"",dir:b.dir,...y,...g,ref:E,style:{outline:"none",...g.style},onKeyDown:(0,t4.composeEventHandlers)(g.onKeyDown,e=>{let t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,r=e.ctrlKey||e.altKey||e.metaKey,n=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!r&&n&&(e=>{var t,r;let n=S.current+e,a=j().filter(e=>!e.disabled),l=document.activeElement,o=null==(t=a.find(e=>e.ref.current===l))?void 0:t.textValue,i=function(e,t,r){var n;let a=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,l=r?e.indexOf(r):-1,o=(n=Math.max(l,0),e.map((t,r)=>e[(n+r)%e.length]));1===a.length&&(o=o.filter(e=>e!==r));let i=o.find(e=>e.toLowerCase().startsWith(a.toLowerCase()));return i!==r?i:void 0}(a.map(e=>e.textValue),n,o),s=null==(r=a.find(e=>e.textValue===i))?void 0:r.ref.current;!function e(t){S.current=t,window.clearTimeout(D.current),""!==t&&(D.current=window.setTimeout(()=>e(""),1e3))}(n),s&&setTimeout(()=>s.focus())})(e.key));let a=k.current;if(e.target!==a||!rg.includes(e.key))return;e.preventDefault();let l=j().filter(e=>!e.disabled).map(e=>e.ref.current);rx.includes(e.key)&&l.reverse(),function(e){let t=document.activeElement;for(let r of e)if(r===t||(r.focus(),document.activeElement!==t))return}(l)}),onBlur:(0,t4.composeEventHandlers)(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(D.current),S.current="")}),onPointerMove:(0,t4.composeEventHandlers)(e.onPointerMove,nc(e=>{let t=e.target,r=A.current!==e.clientX;e.currentTarget.contains(t)&&r&&(F.current=e.clientX>A.current?"right":"left",A.current=e.clientX)}))})})})})})})});rU.displayName=rz;var rG=f.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,p.jsx)(re.Primitive.div,{role:"group",...n,ref:t})});rG.displayName="MenuGroup";var rX=f.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,p.jsx)(re.Primitive.div,{...n,ref:t})});rX.displayName="MenuLabel";var rW="MenuItem",rY="menu.itemSelect",rJ=f.forwardRef((e,t)=>{let{disabled:r=!1,onSelect:n,...a}=e,l=f.useRef(null),o=rF(rW,e.__scopeMenu),i=rV(rW,e.__scopeMenu),s=(0,t7.useComposedRefs)(t,l),d=f.useRef(!1);return(0,p.jsx)(r$,{...a,ref:s,disabled:r,onClick:(0,t4.composeEventHandlers)(e.onClick,()=>{let e=l.current;if(!r&&e){let t=new CustomEvent(rY,{bubbles:!0,cancelable:!0});e.addEventListener(rY,e=>null==n?void 0:n(e),{once:!0}),(0,re.dispatchDiscreteCustomEvent)(e,t),t.defaultPrevented?d.current=!1:o.onClose()}}),onPointerDown:t=>{var r;null==(r=e.onPointerDown)||r.call(e,t),d.current=!0},onPointerUp:(0,t4.composeEventHandlers)(e.onPointerUp,e=>{var t;d.current||null==(t=e.currentTarget)||t.click()}),onKeyDown:(0,t4.composeEventHandlers)(e.onKeyDown,e=>{let t=""!==i.searchRef.current;r||t&&" "===e.key||rh.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});rJ.displayName=rW;var r$=f.forwardRef((e,t)=>{let{__scopeMenu:r,disabled:n=!1,textValue:a,...l}=e,o=rV(rW,r),i=rD(r),s=f.useRef(null),d=(0,t7.useComposedRefs)(t,s),[c,u]=f.useState(!1),[m,h]=f.useState("");return f.useEffect(()=>{let e=s.current;if(e){var t;h((null!=(t=e.textContent)?t:"").trim())}},[l.children]),(0,p.jsx)(rw.ItemSlot,{scope:r,disabled:n,textValue:null!=a?a:m,children:(0,p.jsx)(rc.Item,{asChild:!0,...i,focusable:!n,children:(0,p.jsx)(re.Primitive.div,{role:"menuitem","data-highlighted":c?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...l,ref:d,onPointerMove:(0,t4.composeEventHandlers)(e.onPointerMove,nc(e=>{n?o.onItemLeave(e):(o.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:(0,t4.composeEventHandlers)(e.onPointerLeave,nc(e=>o.onItemLeave(e))),onFocus:(0,t4.composeEventHandlers)(e.onFocus,()=>u(!0)),onBlur:(0,t4.composeEventHandlers)(e.onBlur,()=>u(!1))})})})}),rZ=f.forwardRef((e,t)=>{let{checked:r=!1,onCheckedChange:n,...a}=e;return(0,p.jsx)(r4,{scope:e.__scopeMenu,checked:r,children:(0,p.jsx)(rJ,{role:"menuitemcheckbox","aria-checked":ns(r)?"mixed":r,...a,ref:t,"data-state":nd(r),onSelect:(0,t4.composeEventHandlers)(a.onSelect,()=>null==n?void 0:n(!!ns(r)||!r),{checkForDefaultPrevented:!1})})})});rZ.displayName="MenuCheckboxItem";var rQ="MenuRadioGroup",[r0,r1]=rC(rQ,{value:void 0,onValueChange:()=>{}}),r2=f.forwardRef((e,t)=>{let{value:r,onValueChange:n,...a}=e,l=(0,rp.useCallbackRef)(n);return(0,p.jsx)(r0,{scope:e.__scopeMenu,value:r,onValueChange:l,children:(0,p.jsx)(rG,{...a,ref:t})})});r2.displayName=rQ;var r3="MenuRadioItem",r5=f.forwardRef((e,t)=>{let{value:r,...n}=e,a=r1(r3,e.__scopeMenu),l=r===a.value;return(0,p.jsx)(r4,{scope:e.__scopeMenu,checked:l,children:(0,p.jsx)(rJ,{role:"menuitemradio","aria-checked":l,...n,ref:t,"data-state":nd(l),onSelect:(0,t4.composeEventHandlers)(n.onSelect,()=>{var e;return null==(e=a.onValueChange)?void 0:e.call(a,r)},{checkForDefaultPrevented:!1})})})});r5.displayName=r3;var r6="MenuItemIndicator",[r4,r7]=rC(r6,{checked:!1}),r8=f.forwardRef((e,t)=>{let{__scopeMenu:r,forceMount:n,...a}=e,l=r7(r6,r);return(0,p.jsx)(rd.Presence,{present:n||ns(l.checked)||!0===l.checked,children:(0,p.jsx)(re.Primitive.span,{...a,ref:t,"data-state":nd(l.checked)})})});r8.displayName=r6;var r9=f.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e;return(0,p.jsx)(re.Primitive.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});r9.displayName="MenuSeparator";var ne=f.forwardRef((e,t)=>{let{__scopeMenu:r,...n}=e,a=rE(r);return(0,p.jsx)(ri.Arrow,{...a,...n,ref:t})});ne.displayName="MenuArrow";var[nt,nr]=rC("MenuSub"),nn="MenuSubTrigger",na=f.forwardRef((e,t)=>{let r=rM(nn,e.__scopeMenu),n=rF(nn,e.__scopeMenu),a=nr(nn,e.__scopeMenu),l=rV(nn,e.__scopeMenu),o=f.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:s}=l,d={__scopeMenu:e.__scopeMenu},c=f.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return f.useEffect(()=>c,[c]),f.useEffect(()=>{let e=i.current;return()=>{window.clearTimeout(e),s(null)}},[i,s]),(0,p.jsx)(rP,{asChild:!0,...d,children:(0,p.jsx)(r$,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":a.contentId,"data-state":ni(r.open),...e,ref:(0,t7.composeRefs)(t,a.onTriggerChange),onClick:t=>{var n;null==(n=e.onClick)||n.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:(0,t4.composeEventHandlers)(e.onPointerMove,nc(t=>{l.onItemEnter(t),!t.defaultPrevented&&(e.disabled||r.open||o.current||(l.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{r.onOpenChange(!0),c()},100)))})),onPointerLeave:(0,t4.composeEventHandlers)(e.onPointerLeave,nc(e=>{var t,n;c();let a=null==(t=r.content)?void 0:t.getBoundingClientRect();if(a){let t=null==(n=r.content)?void 0:n.dataset.side,o="right"===t,s=a[o?"left":"right"],d=a[o?"right":"left"];l.onPointerGraceIntentChange({area:[{x:e.clientX+(o?-5:5),y:e.clientY},{x:s,y:a.top},{x:d,y:a.top},{x:d,y:a.bottom},{x:s,y:a.bottom}],side:t}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>l.onPointerGraceIntentChange(null),300)}else{if(l.onTriggerLeave(e),e.defaultPrevented)return;l.onPointerGraceIntentChange(null)}})),onKeyDown:(0,t4.composeEventHandlers)(e.onKeyDown,t=>{let a=""!==l.searchRef.current;if(!e.disabled&&(!a||" "!==t.key)&&rv[n.dir].includes(t.key)){var o;r.onOpenChange(!0),null==(o=r.content)||o.focus(),t.preventDefault()}})})})});na.displayName=nn;var nl="MenuSubContent",no=f.forwardRef((e,t)=>{let r=rT(rz,e.__scopeMenu),{forceMount:n=r.forceMount,...a}=e,l=rM(rz,e.__scopeMenu),o=rF(rz,e.__scopeMenu),i=nr(nl,e.__scopeMenu),s=f.useRef(null),d=(0,t7.useComposedRefs)(t,s);return(0,p.jsx)(rw.Provider,{scope:e.__scopeMenu,children:(0,p.jsx)(rd.Presence,{present:n||l.open,children:(0,p.jsx)(rw.Slot,{scope:e.__scopeMenu,children:(0,p.jsx)(rK,{id:i.contentId,"aria-labelledby":i.triggerId,...a,ref:d,align:"start",side:"rtl"===o.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;o.isUsingKeyboardRef.current&&(null==(t=s.current)||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:(0,t4.composeEventHandlers)(e.onFocusOutside,e=>{e.target!==i.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:(0,t4.composeEventHandlers)(e.onEscapeKeyDown,e=>{o.onClose(),e.preventDefault()}),onKeyDown:(0,t4.composeEventHandlers)(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),r=rb[o.dir].includes(e.key);if(t&&r){var n;l.onOpenChange(!1),null==(n=i.trigger)||n.focus(),e.preventDefault()}})})})})})});function ni(e){return e?"open":"closed"}function ns(e){return"indeterminate"===e}function nd(e){return ns(e)?"indeterminate":e?"checked":"unchecked"}function nc(e){return t=>"mouse"===t.pointerType?e(t):void 0}no.displayName=nl;var nu="DropdownMenu",[np,nf]=(0,t8.createContextScope)(nu,[rk]),nm=rk(),[nh,nx]=np(nu),ng=e=>{let{__scopeDropdownMenu:t,children:r,dir:n,open:a,defaultOpen:l,onOpenChange:o,modal:i=!0}=e,s=nm(t),d=f.useRef(null),[c,u]=(0,t9.useControllableState)({prop:a,defaultProp:null!=l&&l,onChange:o,caller:nu});return(0,p.jsx)(nh,{scope:t,triggerId:(0,ro.useId)(),triggerRef:d,contentId:(0,ro.useId)(),open:c,onOpenChange:u,onOpenToggle:f.useCallback(()=>u(e=>!e),[u]),modal:i,children:(0,p.jsx)(rA,{...s,open:c,onOpenChange:u,dir:n,modal:i,children:r})})};ng.displayName=nu;var nv="DropdownMenuTrigger",nb=f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,disabled:n=!1,...a}=e,l=nx(nv,r),o=nm(r);return(0,p.jsx)(rP,{asChild:!0,...o,children:(0,p.jsx)(re.Primitive.button,{type:"button",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":l.open?l.contentId:void 0,"data-state":l.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...a,ref:(0,t7.composeRefs)(t,l.triggerRef),onPointerDown:(0,t4.composeEventHandlers)(e.onPointerDown,e=>{!n&&0===e.button&&!1===e.ctrlKey&&(l.onOpenToggle(),l.open||e.preventDefault())}),onKeyDown:(0,t4.composeEventHandlers)(e.onKeyDown,e=>{!n&&(["Enter"," "].includes(e.key)&&l.onOpenToggle(),"ArrowDown"===e.key&&l.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});nb.displayName=nv;var ny=e=>{let{__scopeDropdownMenu:t,...r}=e,n=nm(t);return(0,p.jsx)(r_,{...n,...r})};ny.displayName="DropdownMenuPortal";var nw="DropdownMenuContent",nj=f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nx(nw,r),l=nm(r),o=f.useRef(!1);return(0,p.jsx)(rU,{id:a.contentId,"aria-labelledby":a.triggerId,...l,...n,ref:t,onCloseAutoFocus:(0,t4.composeEventHandlers)(e.onCloseAutoFocus,e=>{var t;o.current||null==(t=a.triggerRef.current)||t.focus(),o.current=!1,e.preventDefault()}),onInteractOutside:(0,t4.composeEventHandlers)(e.onInteractOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,n=2===t.button||r;(!a.modal||n)&&(o.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});nj.displayName=nw,f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nm(r);return(0,p.jsx)(rG,{...a,...n,ref:t})}).displayName="DropdownMenuGroup",f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nm(r);return(0,p.jsx)(rX,{...a,...n,ref:t})}).displayName="DropdownMenuLabel";var nN=f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nm(r);return(0,p.jsx)(rJ,{...a,...n,ref:t})});nN.displayName="DropdownMenuItem",f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nm(r);return(0,p.jsx)(rZ,{...a,...n,ref:t})}).displayName="DropdownMenuCheckboxItem",f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nm(r);return(0,p.jsx)(r2,{...a,...n,ref:t})}).displayName="DropdownMenuRadioGroup",f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nm(r);return(0,p.jsx)(r5,{...a,...n,ref:t})}).displayName="DropdownMenuRadioItem",f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nm(r);return(0,p.jsx)(r8,{...a,...n,ref:t})}).displayName="DropdownMenuItemIndicator",f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nm(r);return(0,p.jsx)(r9,{...a,...n,ref:t})}).displayName="DropdownMenuSeparator",f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nm(r);return(0,p.jsx)(ne,{...a,...n,ref:t})}).displayName="DropdownMenuArrow",f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nm(r);return(0,p.jsx)(na,{...a,...n,ref:t})}).displayName="DropdownMenuSubTrigger",f.forwardRef((e,t)=>{let{__scopeDropdownMenu:r,...n}=e,a=nm(r);return(0,p.jsx)(no,{...a,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}).displayName="DropdownMenuSubContent",e.i(78784),e.i(46349),(0,g.default)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var nC=e.i(47163);function nk(e){let{...t}=e;return(0,p.jsx)(ng,{"data-slot":"dropdown-menu",...t})}function nE(e){let{...t}=e;return(0,p.jsx)(nb,{"data-slot":"dropdown-menu-trigger",...t})}function nD(e){let{className:t,sideOffset:r=4,...n}=e;return(0,p.jsx)(ny,{children:(0,p.jsx)(nj,{"data-slot":"dropdown-menu-content",sideOffset:r,className:(0,nC.cn)("bg-white text-neutral-950 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border border-neutral-200 p-1 shadow-md dark:bg-neutral-950 dark:text-neutral-50 dark:border-neutral-800",t),...n})})}function nS(e){let{className:t,inset:r,variant:n="default",...a}=e;return(0,p.jsx)(nN,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":n,className:(0,nC.cn)("focus:bg-neutral-100 focus:text-neutral-900 data-[variant=destructive]:text-red-500 data-[variant=destructive]:focus:bg-red-500/10 dark:data-[variant=destructive]:focus:bg-red-500/20 data-[variant=destructive]:focus:text-red-500 data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-neutral-500 relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 dark:focus:bg-neutral-800 dark:focus:text-neutral-50 dark:data-[variant=destructive]:text-red-900 dark:data-[variant=destructive]:focus:bg-red-900/10 dark:dark:data-[variant=destructive]:focus:bg-red-900/20 dark:data-[variant=destructive]:focus:text-red-900 dark:[&_svg:not([class*='text-'])]:text-neutral-400",t),...a})}let nM="var(--field-border)",nR="#3d3d3a",nF="#73726c",nA=e=>"".concat(e,"-").concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),nP=e=>"item"===e.type,nI=e=>({id:e.id,productId:e.productId,name:e.name,description:e.description,qty:e.qty,price:e.price,discount:e.discount,unit:e.unit}),nO=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{id:nA("variant"),name:e,description:"",isRecommended:t,rows:[]}},nT=function(){var e,t,r;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:"item",id:nA("item"),name:null!=(e=n.name)?e:"",description:null!=(t=n.description)?t:"",qty:Number.isFinite(n.qty)?Number(n.qty):1,price:Number.isFinite(n.price)?Number(n.price):0,discount:Number.isFinite(n.discount)?Number(n.discount):0,unit:null!=(r=n.unit)?r:"шт",productId:n.productId,groupId:n.groupId}},n_=(e,t)=>new Intl.NumberFormat("ru-RU",{style:"currency",currency:t,maximumFractionDigits:2}).format(e);function nz(e){let{id:t,className:n,style:a,children:l}=e,{attributes:o,listeners:i,setActivatorNodeRef:s,setNodeRef:d,transform:c,transition:u,isDragging:m}=function(e){var t,n,a,l;let{animateLayoutChanges:o=tB,attributes:i,disabled:s,data:d,getNewIndex:c=tU,id:u,strategy:p,resizeObserverConfig:m,transition:h=tH}=e,{items:x,containerId:g,activeIndex:v,disabled:b,disableTransforms:y,sortedRects:w,overIndex:j,useDragOverlay:N,strategy:C}=(0,f.useContext)(tL),k=(t=s,n=b,"boolean"==typeof t?{draggable:t,droppable:!1}:{draggable:null!=(a=null==t?void 0:t.draggable)?a:n.draggable,droppable:null!=(l=null==t?void 0:t.droppable)?l:n.droppable}),E=x.indexOf(u),D=(0,f.useMemo)(()=>({sortable:{containerId:g,index:E,items:x},...d}),[g,d,E,x]),S=(0,f.useMemo)(()=>x.slice(x.indexOf(u)),[x,u]),{rect:M,node:R,isOver:F,setNodeRef:A}=function(e){let{data:t,disabled:n=!1,id:a,resizeObserverConfig:l}=e,o=em("Droppable"),{active:i,dispatch:s,over:d,measureDroppableContainers:c}=(0,f.useContext)(tw),u=(0,f.useRef)({disabled:n}),p=(0,f.useRef)(!1),m=(0,f.useRef)(null),h=(0,f.useRef)(null),{disabled:x,updateMeasurementsFor:g,timeout:v}={...tR,...l},b=ed(null!=g?g:a),y=ts({callback:(0,f.useCallback)(()=>{if(!p.current){p.current=!0;return}null!=h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{c(Array.isArray(b.current)?b.current:[b.current]),h.current=null},v)},[v]),disabled:x||!i}),[w,j]=eu((0,f.useCallback)((e,t)=>{y&&(t&&(y.unobserve(t),p.current=!1),e&&y.observe(e))},[y])),N=ed(t);return(0,f.useEffect)(()=>{y&&w.current&&(y.disconnect(),p.current=!1,y.observe(w.current))},[w,y]),(0,f.useEffect)(()=>(s({type:r.RegisterDroppable,element:{id:a,key:o,disabled:n,node:w,rect:m,data:N}}),()=>s({type:r.UnregisterDroppable,key:o,id:a})),[a]),(0,f.useEffect)(()=>{n!==u.current.disabled&&(s({type:r.SetDroppableDisabled,id:a,key:o,disabled:n}),u.current.disabled=n)},[a,o,n,s]),{active:i,rect:m,isOver:(null==d?void 0:d.id)===a,node:w,over:d,setNodeRef:j}}({id:u,data:D,disabled:k.droppable,resizeObserverConfig:{updateMeasurementsFor:S,...m}}),{active:P,activatorEvent:I,activeNodeRect:O,attributes:T,setNodeRef:_,listeners:z,isDragging:L,over:V,setActivatorNodeRef:U,transform:B}=function(e){let{id:t,data:r,disabled:n=!1,attributes:a}=e,l=em("Draggable"),{activators:o,activatorEvent:i,active:s,activeNodeRect:d,ariaDescribedById:c,draggableNodes:u,over:p}=(0,f.useContext)(tw),{role:m=tM,roleDescription:h="draggable",tabIndex:x=0}=null!=a?a:{},g=(null==s?void 0:s.id)===t,v=(0,f.useContext)(g?tE:tS),[b,y]=eu(),[w,j]=eu(),N=(0,f.useMemo)(()=>o.reduce((e,r)=>{let{eventName:n,handler:a}=r;return e[n]=e=>{a(e,t)},e},{}),[o,t]),C=ed(r);return ei(()=>(u.set(t,{id:t,key:l,node:b,activatorNode:w,data:C}),()=>{let e=u.get(t);e&&e.key===l&&u.delete(t)}),[u,t]),{active:s,activatorEvent:i,activeNodeRect:d,attributes:(0,f.useMemo)(()=>({role:m,tabIndex:x,"aria-disabled":n,"aria-pressed":!!g&&m===tM||void 0,"aria-roledescription":h,"aria-describedby":c.draggable}),[n,m,x,g,h,c.draggable]),isDragging:g,listeners:n?void 0:N,node:b,over:p,setNodeRef:y,setActivatorNodeRef:j,transform:v}}({id:u,data:D,attributes:{...tG,...i},disabled:k.draggable}),H=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,f.useMemo)(()=>e=>{t.forEach(t=>t(e))},t)}(A,_),q=!!P,K=q&&!y&&tI(v)&&tI(j),G=!N&&L,X=G&&K?B:null,W=K?null!=X?X:(null!=p?p:C)({rects:w,activeNodeRect:O,activeIndex:v,overIndex:j,index:E}):null,Y=tI(v)&&tI(j)?c({id:u,items:x,activeIndex:v,overIndex:j}):E,J=null==P?void 0:P.id,$=(0,f.useRef)({activeId:J,items:x,newIndex:Y,containerId:g}),Z=x!==$.current.items,Q=o({active:P,containerId:g,isDragging:L,isSorting:q,id:u,index:E,items:x,newIndex:$.current.newIndex,previousItems:$.current.items,previousContainerId:$.current.containerId,transition:h,wasDragging:null!=$.current.activeId}),ee=function(e){let{disabled:t,index:r,node:n,rect:a}=e,[l,o]=(0,f.useState)(null),i=(0,f.useRef)(r);return ei(()=>{if(!t&&r!==i.current&&n.current){let e=a.current;if(e){let t=eH(n.current,{ignoreTransform:!0}),r={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(r.x||r.y)&&o(r)}}r!==i.current&&(i.current=r)},[t,r,n,a]),(0,f.useEffect)(()=>{l&&o(null)},[l]),l}({disabled:!Q,index:E,node:R,rect:M});return(0,f.useEffect)(()=>{q&&$.current.newIndex!==Y&&($.current.newIndex=Y),g!==$.current.containerId&&($.current.containerId=g),x!==$.current.items&&($.current.items=x)},[q,Y,g,x]),(0,f.useEffect)(()=>{if(J===$.current.activeId)return;if(null!=J&&null==$.current.activeId){$.current.activeId=J;return}let e=setTimeout(()=>{$.current.activeId=J},50);return()=>clearTimeout(e)},[J]),{active:P,activeIndex:v,attributes:T,data:D,rect:M,index:E,newIndex:Y,items:x,isOver:F,isSorting:q,isDragging:L,listeners:z,node:R,overIndex:j,over:V,setNodeRef:H,setActivatorNodeRef:U,setDroppableNodeRef:A,setDraggableNodeRef:_,transform:null!=ee?ee:W,transition:ee||Z&&$.current.newIndex===E?tK:(!G||ev(I))&&h&&(q||Q)?ey.Transition.toString({...h,property:tq}):void 0}}({id:t}),h={...a,transform:ey.Transform.toString(c),transition:u,opacity:m?.9:1,zIndex:m?2:1,position:"relative"};return(0,p.jsx)("tr",{ref:d,className:n,style:h,children:l({attributes:o,listeners:i,setActivatorNodeRef:s})})}function nL(e){var t,r,n,a;let{proposal:l,onUpdate:o}=e,[i,s]=(0,f.useState)(!1),[d,c]=(0,f.useState)([]),[u,m]=(0,f.useState)([]),[h,x]=(0,f.useState)(""),[g,v]=(0,f.useState)(!1),[b,y]=(0,f.useState)(new Set),w=(0,f.useMemo)(()=>(e=>{if("variants"===e.pricingMode&&Array.isArray(e.productVariants)&&e.productVariants.length>0)return e.productVariants;let t=Array.isArray(e.items)?e.items:[];return[{...nO("Вариант 1",!0),rows:t.map(e=>nT({id:e.id||nA("item"),productId:e.productId,name:e.name,description:e.description,qty:e.qty,price:e.price,discount:e.discount,unit:e.unit}))}]})(l),[l]),j=(0,f.useMemo)(()=>{var e,t,r,n;return{showDiscountColumn:null==(r=null==(e=l.productsView)?void 0:e.showDiscountColumn)||r,showUnitColumn:null==(n=null==(t=l.productsView)?void 0:t.showUnitColumn)||n}},[l.productsView]),N=w.some(e=>e.id===l.activeVariantId)?l.activeVariantId:null==(t=w[0])?void 0:t.id,C=(0,f.useMemo)(()=>{var e,t;return null!=(t=null!=(e=w.find(e=>e.id===N))?e:w[0])?t:null},[w,N]),k=(0,f.useCallback)((e,t)=>{var r,n,a;let l=e.some(e=>e.id===t)?t:null==(r=e[0])?void 0:r.id,i=null!=(n=e.find(e=>e.id===l))?n:e[0],s=(null!=(a=null==i?void 0:i.rows)?a:[]).filter(nP).map(nI);o("pricingMode","variants"),o("productVariants",e),o("activeVariantId",l),o("productsView",j),o("items",s)},[o,j]);(0,f.useEffect)(()=>{"variants"===l.pricingMode&&Array.isArray(l.productVariants)&&0!==l.productVariants.length&&l.activeVariantId&&l.productsView||k(w,N)},[l.pricingMode,l.productVariants,l.activeVariantId,l.productsView,N,k,w]);let E=(0,f.useCallback)(e=>{C&&N&&k(w.map(t=>t.id===N?{...t,rows:e(t.rows)}:t),N)},[C,N,k,w]),D=(0,f.useCallback)(async()=>{v(!0);try{let e=await fetch("/api/products");if(e.ok){let t=await e.json(),r=Array.isArray(t.products)?t.products:[];c(r),m(r)}}catch(e){console.error("Failed to fetch catalog products:",e)}finally{v(!1)}},[]);(0,f.useEffect)(()=>{i&&0===d.length&&D()},[d.length,D,i]),(0,f.useEffect)(()=>{if(!h.trim())return void m(d);let e=h.toLowerCase();m(d.filter(t=>{var r,n;return t.name.toLowerCase().includes(e)||(null==(r=t.sku)?void 0:r.toLowerCase().includes(e))||(null==(n=t.description)?void 0:n.toLowerCase().includes(e))}))},[d,h]);let S=(0,f.useMemo)(()=>C?C.rows.filter(nP):[],[C]),M=O(S),R=_({...l,items:S}),F=T({...l,items:S}),A=null!=(a=({RUB:"₽",USD:"$",EUR:"€"})[n=l.currency])?a:n,P=3+ +!!j.showUnitColumn+ +!!j.showDiscountColumn,z=e=>{C&&N&&k(w.map(t=>t.id===N?{...t,...e}:t),N)},L=()=>{E(e=>[...e,{id:nA("group"),type:"group",title:"Группа ".concat(e.filter(e=>"group"===e.type).length+1)}])},V=()=>{E(e=>{let t=[...e].reverse().find(e=>"group"===e.type);return[...e,nT({groupId:null==t?void 0:t.id})]})},B=(e,t)=>{E(r=>r.map(r=>r.id===e&&"item"===r.type?{...r,...t}:r))},H=e=>{E(t=>t.filter(t=>t.id!==e))},q=(0,f.useMemo)(()=>C?C.rows.map(e=>e.id):[],[C]),K=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,f.useMemo)(()=>[...t].filter(e=>null!=e),[...t])}(eR(ta,{activationConstraint:{distance:6}}),eR(e9,{coordinateGetter:tY})),G=(0,f.useCallback)(e=>{let{active:t,over:r}=e;r&&t.id!==r.id&&E(e=>{let n=e.findIndex(e=>e.id===String(t.id)),a=e.findIndex(e=>e.id===String(r.id));return n<0||a<0||n===a?e:tP(e,n,a)})},[E]),X="inline-flex items-center gap-1.5 rounded-md border bg-white px-2.5 py-1.5 text-[13px] font-medium transition-colors hover:bg-[#fafaf7] focus:outline-none focus:ring-2 focus:ring-[var(--field-ring)]";return(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{className:"space-y-0",children:[(0,p.jsxs)("div",{className:"relative z-[1] -mb-px flex flex-wrap items-end gap-2",children:[w.map(e=>{let t=e.id===N;return(0,p.jsxs)("button",{type:"button",onClick:()=>{k(w,e.id)},className:"rounded-t-xl border px-4 py-2 text-left transition-colors",style:{borderColor:nM,borderBottomColor:t?"#ffffff":nM,backgroundColor:t?"#ffffff":"rgb(243, 242, 240)",color:nR,minWidth:180,zIndex:t?2:1},children:[(0,p.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,p.jsx)("span",{className:"text-sm font-semibold",children:e.name}),e.isRecommended?(0,p.jsx)("span",{className:"rounded-full bg-[#3CB371] px-2 py-0.5 text-[10px] font-semibold text-white",children:"Рекомендуем"}):null]}),(0,p.jsx)("p",{className:"mt-1 text-xs",style:{color:nF},children:n_(O(e.rows.filter(nP)),l.currency)})]},e.id)}),w.length<3?(0,p.jsx)("button",{type:"button",onClick:()=>{if(w.length>=3)return;let e=nO("Вариант ".concat(w.length+1)),t=w.map(e=>({...e,isRecommended:!!e.isRecommended}));t.some(e=>e.isRecommended)||(t[0]={...t[0],isRecommended:!0}),k([...t,e],e.id)},className:"inline-flex min-w-[180px] items-center rounded-t-xl border px-4 py-2 text-left transition-colors hover:bg-[#eceae3] focus:outline-none focus:ring-2 focus:ring-[var(--field-ring)]",style:{color:nR,borderColor:nM,backgroundColor:"rgb(243, 242, 240)"},children:(0,p.jsx)("span",{className:"text-sm font-semibold",children:"+ Вариант"})}):null]}),C?(0,p.jsxs)("div",{className:"rounded-b-xl rounded-tr-xl border bg-white p-4",style:{borderColor:nM},children:[(0,p.jsxs)("div",{className:"grid gap-4 md:grid-cols-[1.4fr_1fr]",children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{className:"mb-2 flex h-7 items-center gap-2",children:[(0,p.jsx)("label",{className:"text-sm font-medium",style:{color:nR},children:"Название варианта"}),(0,p.jsxs)("button",{type:"button",onClick:()=>{var e;return e=C.id,void k(w.map(t=>({...t,isRecommended:t.id===e})),N)},className:"inline-flex items-center gap-1 rounded-md px-1.5 py-0.5 text-xs font-medium transition-colors hover:bg-[#f4f2ec] focus:outline-none focus:ring-2 focus:ring-[var(--field-ring)]",style:{color:nR},"aria-label":"Отметить вариант как рекомендуемый",title:"Отметить вариант как рекомендуемый",children:[(0,p.jsx)(t5,{className:"h-3.5 w-3.5 ".concat(C.isRecommended?"fill-current":""),style:{color:C.isRecommended?"#3CB371":nF}}),"Рекомендуем"]})]}),(0,p.jsx)("input",{type:"text",value:C.name,onChange:e=>z({name:e.target.value}),className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",placeholder:"Вариант Стандартный"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("div",{className:"mb-2 flex h-7 items-center",children:(0,p.jsx)("label",{className:"text-sm font-medium",style:{color:nR},children:"Описание варианта"})}),(0,p.jsx)("input",{type:"text",value:null!=(r=C.description)?r:"",onChange:e=>z({description:e.target.value}),className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",placeholder:"Краткое описание"})]})]}),(0,p.jsxs)("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-2",children:[(0,p.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,p.jsxs)("button",{type:"button",onClick:V,className:X,style:{color:nR,borderColor:nM},children:[(0,p.jsx)(U.Plus,{className:"h-3.5 w-3.5"}),"Товар"]}),(0,p.jsxs)("button",{type:"button",onClick:L,className:X,style:{color:nR,borderColor:nM},children:[(0,p.jsx)(tZ,{className:"h-3.5 w-3.5"}),"Группа"]}),(0,p.jsxs)("button",{type:"button",onClick:()=>s(!0),className:X,style:{color:nR,borderColor:nM},children:[(0,p.jsx)(t1,{className:"h-3.5 w-3.5"}),"Из каталога"]}),(0,p.jsxs)("button",{type:"button",onClick:()=>{var e;return e={showDiscountColumn:!j.showDiscountColumn},void o("productsView",{...j,...e})},className:X,style:{color:nR,borderColor:nM},children:[(0,p.jsx)(t2,{className:"h-3.5 w-3.5"}),j.showDiscountColumn?"Скрыть скидку":"Показать скидку"]})]}),w.length>1?(0,p.jsx)("button",{type:"button",onClick:()=>{var e;if(!C||w.length<=1)return;let t=w.filter(e=>e.id!==C.id);t.some(e=>e.isRecommended)||(t[0]={...t[0],isRecommended:!0}),k(t,null==(e=t[0])?void 0:e.id)},className:"inline-flex h-8 w-8 items-center justify-center rounded-md border bg-white transition-colors hover:bg-rose-50 focus:outline-none focus:ring-2 focus:ring-[var(--field-ring)]",style:{color:"#b91c1c",borderColor:nM},"aria-label":"Удалить вариант",title:"Удалить вариант",children:(0,p.jsx)(J.Trash2,{className:"h-4 w-4"})}):null]})]}):null]}),(0,p.jsx)(t6.Sheet,{open:i,onOpenChange:s,children:(0,p.jsxs)(t6.SheetContent,{side:"right",className:"w-full gap-0 border-l bg-[#F3F2F0] p-0 sm:max-w-xl",style:{borderColor:nM},children:[(0,p.jsxs)(t6.SheetHeader,{className:"border-b px-5 py-4",style:{borderColor:nM},children:[(0,p.jsx)(t6.SheetTitle,{className:"text-[15px] font-semibold tracking-[-0.2px]",style:{color:nR},children:"Добавить из каталога"}),(0,p.jsx)(t6.SheetDescription,{className:"text-[13px] leading-5",style:{color:nF},children:"Выберите товары для добавления в активный вариант"})]}),(0,p.jsxs)("div",{className:"flex min-h-0 flex-1 flex-col gap-3 p-4",children:[(0,p.jsxs)("div",{className:"relative",children:[(0,p.jsx)(t3,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2",style:{color:nF}}),(0,p.jsx)("input",{type:"text",value:h,onChange:e=>x(e.target.value),placeholder:"Поиск по названию или артикулу...",className:"w-full rounded-lg border border-[var(--field-border)] bg-white py-2.5 pl-10 pr-4 text-sm placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})]}),(0,p.jsx)("div",{className:"min-h-0 flex-1 overflow-y-auto rounded-lg border bg-white p-2",style:{borderColor:nM},children:g?(0,p.jsxs)("div",{className:"flex items-center justify-center py-12",children:[(0,p.jsx)(t0.Loader2,{className:"h-6 w-6 animate-spin text-[var(--field-focus)]"}),(0,p.jsx)("span",{className:"ml-2 text-sm",style:{color:nF},children:"Загрузка каталога..."})]}):0===u.length?(0,p.jsxs)("div",{className:"py-12 text-center",children:[(0,p.jsx)(t1,{className:"mx-auto h-10 w-10",style:{color:"#c8c6be"}}),(0,p.jsx)("p",{className:"mt-2 text-sm",style:{color:nF},children:h?"Товары не найдены":"Каталог пуст"})]}):(0,p.jsx)("div",{className:"space-y-2",children:u.map(e=>{let t,r=b.has(e.id),n=(t=e.id,S.some(e=>e.productId===t));return(0,p.jsx)("button",{type:"button",disabled:n,onClick:()=>{var t;return t=e.id,void y(e=>{let r=new Set(e);return r.has(t)?r.delete(t):r.add(t),r})},className:"w-full rounded-lg border p-3 text-left transition-colors ".concat(n?"cursor-not-allowed opacity-70":"hover:bg-[#fafaf7]"),style:{borderColor:r?"#C6613F":n?"#d7d3c7":nM,backgroundColor:n?"#f5f4ef":r?"#FAEFEB":"#ffffff",...r?{boxShadow:"0 0 0 1px rgba(198, 97, 63, 0.18)"}:{}},children:(0,p.jsxs)("div",{className:"flex items-start gap-3",children:[(0,p.jsx)("div",{className:"mt-0.5 flex h-5 w-5 shrink-0 items-center justify-center rounded border",style:{borderColor:r?"#C6613F":nM,backgroundColor:n?"#d9d7cc":r?"#C6613F":"#ffffff"},children:(r||n)&&(0,p.jsx)(t$.default,{className:"h-3.5 w-3.5",style:{color:n?"#73726c":"#ffffff"}})}),(0,p.jsxs)("div",{className:"flex min-w-0 flex-1 items-center gap-3",children:[(0,p.jsx)("span",{className:"truncate text-sm font-medium",style:{color:nR},children:e.name}),e.sku?(0,p.jsx)("span",{className:"shrink-0 whitespace-nowrap text-xs",style:{color:nF},children:e.sku}):null,(0,p.jsx)("span",{className:"ml-auto shrink-0 whitespace-nowrap text-sm font-semibold",style:{color:nR},children:n_(e.basePrice,l.currency)}),n?(0,p.jsx)("span",{className:"shrink-0 whitespace-nowrap text-xs",style:{color:nF},children:"Уже добавлен"}):null]})]})},e.id)})})}),b.size>0?(0,p.jsxs)("div",{className:"rounded-lg border bg-white p-3",style:{borderColor:nM},children:[(0,p.jsxs)("p",{className:"mb-2 text-xs",style:{color:nF},children:["Выбрано товаров: ",b.size]}),(0,p.jsxs)("button",{type:"button",onClick:()=>{C&&(E(e=>{let t=[...e].reverse().find(e=>"group"===e.type),r=[];return b.forEach(e=>{var n;let a=d.find(t=>t.id===e);a&&r.push(nT({productId:a.id,name:a.name,description:null!=(n=a.description)?n:"",qty:1,price:Number(a.basePrice)||0,unit:"шт",discount:0,groupId:null==t?void 0:t.id}))}),[...e,...r]}),y(new Set),s(!1),x(""))},className:"w-full rounded-lg bg-[#C6613F] px-4 py-2.5 text-sm font-medium text-white transition-colors hover:bg-[#b95738] focus:outline-none focus:ring-2 focus:ring-[var(--field-ring)]",children:["Добавить выбранные (",b.size,")"]})]}):null]})]})}),C&&0!==C.rows.length?(0,p.jsxs)("div",{className:"overflow-hidden rounded-lg border text-[12px]",style:{borderColor:nM},children:[(0,p.jsx)(tD,{sensors:K,collisionDetection:ez,onDragEnd:G,children:(0,p.jsx)(tV,{items:q,strategy:t_,children:(0,p.jsx)("div",{className:"overflow-x-auto",children:(0,p.jsxs)("table",{className:"w-full min-w-[980px] table-fixed border-collapse",children:[(0,p.jsx)("thead",{style:{backgroundColor:"#FAFAFA"},children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{className:"w-[44px] border-b border-r border-[#E3E1D9] px-1 py-2 text-center text-[11px] font-semibold uppercase tracking-wide",style:{color:nF},children:(0,p.jsxs)(nk,{children:[(0,p.jsx)(nE,{asChild:!0,children:(0,p.jsx)("button",{type:"button",className:"inline-flex h-7 w-7 items-center justify-center rounded-md border bg-white text-[#3d3d3a] hover:bg-[#f4f2ec] focus:outline-none focus:ring-1 focus:ring-[var(--field-ring)]",style:{borderColor:nM},"aria-label":"Добавить строку",children:(0,p.jsx)(U.Plus,{className:"h-4 w-4"})})}),(0,p.jsxs)(nD,{align:"start",sideOffset:6,className:"w-56 border-[#E3E1D9]",children:[(0,p.jsxs)(nS,{onSelect:()=>V(),children:[(0,p.jsx)(U.Plus,{className:"h-4 w-4"}),"Добавить товар"]}),(0,p.jsxs)(nS,{onSelect:()=>L(),children:[(0,p.jsx)(tZ,{className:"h-4 w-4"}),"Добавить группу товаров"]})]})]})}),(0,p.jsx)("th",{className:"border-b border-r border-[#E3E1D9] px-2 py-2 text-left text-[11px] font-semibold uppercase tracking-wide",style:{color:nF},children:"Наименование"}),(0,p.jsx)("th",{className:"w-[90px] border-b border-r border-[#E3E1D9] px-2 py-2 text-right text-[11px] font-semibold uppercase tracking-wide",style:{color:nF},children:"Кол-во"}),j.showUnitColumn?(0,p.jsx)("th",{className:"w-[72px] border-b border-r border-[#E3E1D9] px-2 py-2 text-left text-[11px] font-semibold uppercase tracking-wide",style:{color:nF},children:"Ед."}):null,(0,p.jsxs)("th",{className:"w-[120px] border-b border-r border-[#E3E1D9] px-2 py-2 text-right text-[11px] font-semibold uppercase tracking-wide",style:{color:nF},children:["Цена, ",A]}),j.showDiscountColumn?(0,p.jsx)("th",{className:"w-[76px] border-b border-r border-[#E3E1D9] px-2 py-2 text-right text-[11px] font-semibold uppercase tracking-wide",style:{color:nF},children:"Скидка"}):null,(0,p.jsxs)("th",{className:"w-[140px] border-b border-r border-[#E3E1D9] px-2 py-2 text-right text-[11px] font-semibold uppercase tracking-wide",style:{color:nF},children:["Сумма, ",A]}),(0,p.jsx)("th",{className:"w-[44px] border-b border-[#E3E1D9] px-1 py-2 text-right text-[11px] font-semibold uppercase tracking-wide",style:{color:nF}})]})}),(0,p.jsx)("tbody",{className:"bg-white",style:{borderTop:"1px solid ".concat(nM)},children:C.rows.map(e=>{if("group"===e.type)return(0,p.jsx)(nz,{id:e.id,style:{borderTop:"1px solid ".concat(nM),backgroundColor:"rgb(243, 242, 240)"},children:t=>{let{attributes:r,listeners:n,setActivatorNodeRef:a}=t;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("td",{className:"border-r border-[#E3E1D9] px-1 py-1.5 text-center",children:(0,p.jsx)("button",{type:"button",ref:a,...r,...n,className:"inline-flex h-7 w-7 cursor-grab items-center justify-center rounded-md text-[#73726c] hover:bg-[#e8e6de] active:cursor-grabbing","aria-label":"Перетащить строку группы",children:(0,p.jsx)(tQ,{className:"h-4 w-4"})})}),(0,p.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,p.jsx)("input",{type:"text",value:e.title,onChange:t=>{var r,n;return r=e.id,n=t.target.value,void E(e=>e.map(e=>e.id===r&&"group"===e.type?{...e,title:n}:e))},className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-2 text-[12px] font-semibold text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",placeholder:"Название группы"})}),(0,p.jsx)("td",{colSpan:P,className:"border-r border-[#E3E1D9] px-2 py-1.5"}),(0,p.jsx)("td",{className:"px-1 py-1.5 text-center",children:(0,p.jsx)("button",{type:"button",onClick:()=>H(e.id),className:"inline-flex h-7 w-7 items-center justify-center rounded-md hover:bg-rose-50",style:{color:"#b91c1c"},children:(0,p.jsx)(J.Trash2,{className:"h-4 w-4"})})})]})}},e.id);let t=I(e);return(0,p.jsx)(nz,{id:e.id,style:{borderTop:"1px solid ".concat(nM)},className:"hover:bg-[#fafaf7]",children:r=>{var n,a;let{attributes:l,listeners:o,setActivatorNodeRef:i}=r;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("td",{className:"border-r border-[#E3E1D9] px-1 py-1.5 text-center",children:(0,p.jsx)("button",{type:"button",ref:i,...l,...o,className:"inline-flex h-7 w-7 cursor-grab items-center justify-center rounded-md text-[#73726c] hover:bg-[#f1f0eb] active:cursor-grabbing","aria-label":"Перетащить строку товара",children:(0,p.jsx)(tQ,{className:"h-4 w-4"})})}),(0,p.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,p.jsx)("input",{type:"text",value:e.name,onChange:t=>B(e.id,{name:t.target.value}),className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-2 text-[12px] text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",placeholder:"Название товара"})}),(0,p.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,p.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.qty,onChange:t=>B(e.id,{qty:Number(t.target.value)||0}),className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-2 text-right text-[12px] text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})}),j.showUnitColumn?(0,p.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,p.jsx)("input",{type:"text",value:null!=(n=e.unit)?n:"шт",onChange:t=>B(e.id,{unit:t.target.value}),className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-2 text-[12px] text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})}):null,(0,p.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,p.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.price,onChange:t=>B(e.id,{price:Number(t.target.value)||0}),className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-2 text-right text-[12px] text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})}),j.showDiscountColumn?(0,p.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5",children:(0,p.jsx)("input",{type:"number",min:"0",max:"100",step:"0.1",value:null!=(a=e.discount)?a:0,onChange:t=>B(e.id,{discount:Number(t.target.value)||0}),className:"h-8 w-full rounded-md border border-[var(--field-border)] bg-white px-1.5 text-right text-[12px] text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"})}):null,(0,p.jsx)("td",{className:"border-r border-[#E3E1D9] px-2 py-1.5 text-right text-[12px] font-semibold tabular-nums",style:{color:nR},children:new Intl.NumberFormat("ru-RU",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}),(0,p.jsx)("td",{className:"px-1 py-1.5 text-center",children:(0,p.jsx)("button",{type:"button",onClick:()=>H(e.id),className:"inline-flex h-7 w-7 items-center justify-center rounded-md hover:bg-rose-50",style:{color:"#b91c1c"},children:(0,p.jsx)(J.Trash2,{className:"h-4 w-4"})})})]})}},e.id)})})]})})})}),(0,p.jsx)("div",{className:"border-t px-2 py-2",style:{borderColor:nM,backgroundColor:"#FAFAFA"},children:(0,p.jsxs)("div",{className:"ml-auto w-full max-w-[320px] space-y-1 text-[12px]",style:{color:nR},children:[(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsx)("span",{children:"Сумма без НДС"}),(0,p.jsx)("span",{className:"font-medium",children:n_(M,l.currency)})]}),l.includeVat?(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("span",{children:["НДС (",l.vatRate,"%)"]}),(0,p.jsx)("span",{className:"font-medium",children:n_(R,l.currency)})]}):null,(0,p.jsxs)("div",{className:"flex items-center justify-between border-t pt-2 text-[12px] font-semibold",style:{borderColor:nM},children:[(0,p.jsx)("span",{children:"Итого"}),(0,p.jsx)("span",{children:n_(F,l.currency)})]})]})})]}):(0,p.jsxs)("div",{className:"rounded-lg border border-dashed bg-[#FAFAFA] px-6 py-12 text-center",style:{borderColor:nM},children:[(0,p.jsx)(t1,{className:"mx-auto h-12 w-12 text-slate-400"}),(0,p.jsx)("p",{className:"mt-3 text-sm font-medium",style:{color:nR},children:"Нет товаров или услуг"}),(0,p.jsx)("p",{className:"mt-1 text-xs",style:{color:nF},children:"Добавьте позиции вручную, группами или из каталога"})]})]})}function nV(e){let{proposal:t,onUpdate:r}=e,n="custom"===t.paymentTerms;return(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"deadline",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Сроки выполнения"}),(0,p.jsx)("input",{id:"deadline",type:"text",value:t.deadline||"",onChange:e=>r("deadline",e.target.value),placeholder:"Например: 2 недели, до 31.12.2024",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,p.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Укажите примерный срок выполнения работ"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"payment-terms",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Условия оплаты"}),(0,p.jsx)("select",{id:"payment-terms",value:t.paymentTerms||"prepaid",onChange:e=>r("paymentTerms",e.target.value),className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]",children:R.map(e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.value))})]}),n&&(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"payment-custom",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Свои условия оплаты"}),(0,p.jsx)("textarea",{id:"payment-custom",value:t.paymentCustom||"",onChange:e=>r("paymentCustom",e.target.value),placeholder:"Опишите свои условия оплаты...",rows:3,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"valid-until",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Срок действия КП"}),(0,p.jsx)("input",{id:"valid-until",type:"date",value:t.validUntil?new Date(t.validUntil).toISOString().split("T")[0]:"",onChange:e=>r("validUntil",e.target.value?new Date(e.target.value):void 0),className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,p.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"По умолчанию +30 дней от даты создания"})]}),(0,p.jsxs)("div",{className:"flex items-center gap-3 rounded-lg bg-[#FAFAFA] p-4",children:[(0,p.jsx)("input",{id:"include-vat",type:"checkbox",checked:t.includeVat,onChange:e=>r("includeVat",e.target.checked),className:"h-4 w-4 rounded border-[var(--field-border)] text-[var(--field-focus)] focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,p.jsx)("label",{htmlFor:"include-vat",className:"flex-1 text-sm font-medium",style:{color:"#3d3d3a"},children:"Включить НДС"}),t.includeVat&&(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("label",{htmlFor:"vat-rate",className:"text-sm",style:{color:"#3d3d3a"},children:"Ставка:"}),(0,p.jsx)("input",{id:"vat-rate",type:"number",min:"0",max:"100",step:"1",value:t.vatRate,onChange:e=>r("vatRate",parseInt(e.target.value)||0),className:"w-16 rounded-lg border border-[var(--field-border)] bg-white px-2 py-1 text-sm text-slate-900 transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,p.jsx)("span",{className:"text-sm",style:{color:"#3d3d3a"},children:"%"})]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Примечания"}),(0,p.jsx)("textarea",{id:"notes",value:t.notes||"",onChange:e=>r("notes",e.target.value),placeholder:"Дополнительные условия, примечания...",rows:3,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"}),(0,p.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Необязательное поле для дополнительных примечаний"})]})]})}let nU=(0,g.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var nB=e.i(41947),nB=nB;let nH=(0,g.default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),nq="hsl(30deg 3.3% 11.8% / 15%)",nK="#3d3d3a",nG="#73726c";function nX(e){let{proposal:t,onUpdate:r}=e,[n,a]=(0,f.useState)(!1),l=t.galleryImages||[],o=(0,f.useCallback)(async e=>{if(!e||0===e.length)return;let t=6-l.length;if(t<=0)return void alert("Максимум 6 изображений в галерее");let n=Array.from(e).slice(0,t);a(!0);try{let e=n.map(async e=>{let t=new FormData;t.append("file",e);let r=await fetch("/api/upload",{method:"POST",body:t});if(!r.ok)throw Error("Upload failed");return(await r.json()).url}),t=await Promise.all(e);r("galleryImages",[...l,...t])}catch(e){console.error("Failed to upload images:",e),alert("Не удалось загрузить изображения")}finally{a(!1)}},[l,r]),i=(0,f.useCallback)(e=>{r("galleryImages",l.filter((t,r)=>r!==e))},[l,r]),s=(0,f.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),d=(0,f.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),o(e.dataTransfer.files)},[o]);return(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("h3",{className:"mb-2 text-sm font-medium",style:{color:nK},children:"Галерея изображений"}),(0,p.jsx)("p",{className:"text-xs",style:{color:nG},children:"Добавьте до 6 изображений для демонстрации ваших работ или продукта"})]}),l.length<6&&(0,p.jsxs)("div",{onDragOver:s,onDrop:d,className:"relative rounded-lg border border-dashed bg-[#FAFAFA] px-6 py-8 text-center transition-colors",style:{borderColor:nq},children:[(0,p.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>o(e.target.files),disabled:n,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer disabled:cursor-not-allowed"}),(0,p.jsx)(nU,{className:"mx-auto h-12 w-12",style:{color:nG}}),(0,p.jsx)("p",{className:"mt-2 text-sm font-medium",style:{color:nK},children:n?"Загрузка...":"Перетащите изображения или нажмите для выбора"}),(0,p.jsxs)("p",{className:"mt-1 text-xs",style:{color:nG},children:["PNG, JPG до 5MB. Осталось слотов: ",6-l.length]})]}),l.length>0&&(0,p.jsx)("div",{className:"grid grid-cols-2 gap-4",children:l.map((e,t)=>(0,p.jsxs)("div",{className:"group relative aspect-video overflow-hidden rounded-lg border bg-white",style:{borderColor:nq},children:[(0,p.jsx)("img",{src:e,alt:"Gallery image ".concat(t+1),className:"h-full w-full object-cover"}),(0,p.jsx)("button",{type:"button",onClick:()=>i(t),className:"absolute right-2 top-2 rounded-full bg-[#3d3d3a] p-1.5 text-white opacity-0 transition-opacity group-hover:opacity-100 hover:bg-red-600",title:"Удалить изображение",children:(0,p.jsx)(nB.default,{className:"h-4 w-4"})})]},t))}),0===l.length&&(0,p.jsxs)("div",{className:"rounded-lg border bg-[#FAFAFA] px-6 py-8 text-center",style:{borderColor:nq},children:[(0,p.jsx)(nH,{className:"mx-auto h-12 w-12",style:{color:nG,opacity:.55}}),(0,p.jsx)("p",{className:"mt-3 text-sm font-medium",style:{color:nK},children:"Галерея пуста"}),(0,p.jsx)("p",{className:"mt-1 text-xs",style:{color:nG},children:"Добавьте изображения, чтобы они отображались в КП"})]})]})}function nW(e){let{proposal:t,onUpdate:r}=e;return(0,p.jsxs)("div",{className:"space-y-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"cta-text",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Призыв к действию (CTA)"}),(0,p.jsx)("textarea",{id:"cta-text",value:t.ctaText||"",onChange:e=>r("ctaText",e.target.value),placeholder:"Свяжитесь с нами для уточнения деталей и согласования сроков...",rows:3,className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)] resize-y"}),(0,p.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Призыв к действию для клиента (например, «Свяжитесь с нами...»)"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"cta-phone",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Телефон для связи"}),(0,p.jsx)("input",{id:"cta-phone",type:"tel",value:t.ctaPhone||"",onChange:e=>r("ctaPhone",e.target.value),placeholder:"+7 (999) 123-45-67",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,p.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Телефон будет отображаться в конце КП"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"cta-email",className:"block text-sm font-medium mb-2",style:{color:"#3d3d3a"},children:"Email для связи"}),(0,p.jsx)("input",{id:"cta-email",type:"email",value:t.ctaEmail||"",onChange:e=>r("ctaEmail",e.target.value),placeholder:"info@company.ru",className:"w-full rounded-lg border border-[var(--field-border)] bg-white px-4 py-2.5 text-sm text-slate-900 placeholder:text-[var(--field-placeholder)] transition-[color,box-shadow,border-color] focus:border-[var(--field-focus)] focus:outline-none focus:ring-[3px] focus:ring-[var(--field-ring)]"}),(0,p.jsx)("p",{className:"mt-1.5 text-xs",style:{color:"#73726c"},children:"Email будет отображаться в конце КП"})]}),(0,p.jsx)("div",{className:"rounded-lg border bg-[#FAEFEB] p-4",style:{borderColor:"#D8A18E"},children:(0,p.jsxs)("p",{className:"text-sm",style:{color:"#A04F33"},children:["💡 ",(0,p.jsx)("strong",{children:"Совет:"})," Если вы не заполните контакты здесь, они будут автоматически взяты из настроек вашего профиля компании."]})})]})}let nY=(0,g.default)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),nJ=(0,g.default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),n$=[{id:"preset-minimal",name:"Минимальный",description:"Только основное: товары и условия",category:"minimal",defaults:{},sections:["basic","products","terms"],isDefault:!1},{id:"preset-standard",name:"Стандартный",description:"С описанием проблемы и решения",category:"standard",defaults:{},sections:["basic","context","advantages","products","terms","contacts"],isDefault:!0},{id:"preset-portfolio",name:"С портфолио",description:"Включает галерею работ",category:"with-gallery",defaults:{},sections:["basic","context","advantages","products","terms","gallery","contacts"],isDefault:!1}],nZ={minimal:nY,standard:nJ,"with-gallery":nH,custom:N};function nQ(e){let{onSelect:t,onClose:r}=e,[n,a]=(0,f.useState)([]),[l,o]=(0,f.useState)(!0);(0,f.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/proposal-templates");if(e.ok){let t=await e.json();a(t)}}catch(e){console.error("Failed to fetch templates:",e)}finally{o(!1)}})()},[]);let i=n.some(e=>e.isDefault),s=[...n$.map(e=>({...e,isDefault:!i&&e.isDefault})),...n],d=e=>{t(e),r()};return(0,p.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,p.jsxs)("div",{className:"w-full max-w-3xl rounded-2xl bg-white p-6 shadow-2xl",children:[(0,p.jsxs)("div",{className:"mb-6",children:[(0,p.jsx)("h2",{className:"text-2xl font-bold text-slate-900",children:"Выберите шаблон"}),(0,p.jsx)("p",{className:"mt-1 text-sm text-slate-600",children:"Начните с готового шаблона или создайте КП с нуля"})]}),l?(0,p.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,p.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-[#C6613F] border-t-transparent"})}):(0,p.jsxs)("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[(0,p.jsxs)("button",{type:"button",onClick:()=>d(null),className:"group flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-slate-300 p-6 text-center transition-all hover:border-[#C6613F] hover:bg-[#FAEFEB]",children:[(0,p.jsx)("div",{className:"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-slate-100 text-slate-500 transition-colors group-hover:bg-[#F3DFD8] group-hover:text-[var(--field-focus)]",children:(0,p.jsx)(U.Plus,{className:"h-6 w-6"})}),(0,p.jsx)("h3",{className:"font-semibold text-slate-900",children:"Пустой"}),(0,p.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:"Начать с нуля"})]}),s.map(e=>{let t=nZ[e.category||"custom"]||N,r=e.id.startsWith("preset-");return(0,p.jsxs)("button",{type:"button",onClick:()=>d(e),className:"group flex flex-col items-center rounded-xl border-2 p-6 text-center transition-all hover:border-[#C6613F] hover:bg-[#FAEFEB] ".concat(e.isDefault?"border-[#D8A18E] bg-[#FAEFEB]":"border-slate-200 bg-white"),children:[(0,p.jsx)("div",{className:"mb-3 flex h-12 w-12 items-center justify-center rounded-full transition-colors ".concat(e.isDefault?"bg-[#F3DFD8] text-[var(--field-focus)]":"bg-slate-100 text-slate-500 group-hover:bg-[#F3DFD8] group-hover:text-[var(--field-focus)]"),children:(0,p.jsx)(t,{className:"h-6 w-6"})}),(0,p.jsx)("h3",{className:"font-semibold text-slate-900",children:e.name}),e.description&&(0,p.jsx)("p",{className:"mt-1 text-xs text-slate-500",children:e.description}),(0,p.jsxs)("div",{className:"mt-3 flex flex-wrap justify-center gap-1",children:[e.sections.slice(0,4).map(e=>(0,p.jsxs)("span",{className:"rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-medium text-slate-600",children:["basic"===e&&"Основное","context"===e&&"Контекст","advantages"===e&&"Преимущества","products"===e&&"Товары","terms"===e&&"Условия","gallery"===e&&"Галерея","contacts"===e&&"Контакты"]},e)),e.sections.length>4&&(0,p.jsxs)("span",{className:"rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-medium text-slate-600",children:["+",e.sections.length-4]})]}),e.isDefault&&(0,p.jsx)("span",{className:"mt-2 rounded-full bg-[#C6613F] px-2 py-0.5 text-[10px] font-medium text-white",children:"По умолчанию"}),!r&&!e.isDefault&&(0,p.jsx)("span",{className:"mt-2 rounded-full bg-slate-200 px-2 py-0.5 text-[10px] font-medium text-slate-600",children:"Пользовательский"})]},e.id)})]}),(0,p.jsx)("div",{className:"mt-6 flex justify-end",children:(0,p.jsx)("button",{type:"button",onClick:r,className:"rounded-lg px-4 py-2 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-100",children:"Отмена"})})]})})}var n0=e.i(88699);let n1=["basic","context","advantages","products","terms","gallery","contacts"],n2=["problemDesc","solutionDesc","additionalDesc","items","currency","pricingMode","productVariants","activeVariantId","productsView","deadline","paymentTerms","paymentCustom","includeVat","vatRate","galleryImages","advantages","advantagesColumns","ctaText","notes"],n3=new Set(n1),n5=e=>"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?"".concat(e,"-").concat(crypto.randomUUID()):"".concat(e,"-").concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,9)),n6=e=>null==e?e:JSON.parse(JSON.stringify(e)),n4=e=>{if(!Array.isArray(e))return[...n1];let t=Array.from(new Set(e.filter(e=>"string"==typeof e&&n3.has(e))));return t.length>0?t:[...n1]},n7=async e=>{let t=await e.text();try{let r=JSON.parse(t);return r.message||r.error||t||"HTTP ".concat(e.status)}catch(r){return t||"HTTP ".concat(e.status)}};function n8(e){let{isOpen:t,proposal:r,visibleSections:n,onClose:a,onTemplatesChanged:l}=e,[o,i]=(0,f.useState)([]),[s,d]=(0,f.useState)(!1),[c,u]=(0,f.useState)(!1),[m,h]=(0,f.useState)(null),[x,g]=(0,f.useState)(""),[v,b]=(0,f.useState)(""),[y,w]=(0,f.useState)(!1),j=o.length>0,N=(0,f.useCallback)(async()=>{d(!0);try{let e=await fetch("/api/proposal-templates");if(!e.ok)throw Error(await n7(e));let t=await e.json();i(t)}catch(e){console.error("Failed to load templates:",e),alert("Не удалось загрузить шаблоны")}finally{d(!1)}},[]);(0,f.useEffect)(()=>{t&&N()},[t,N]);let C=(0,f.useMemo)(()=>[...o].sort((e,t)=>e.isDefault===t.isDefault?0:e.isDefault?-1:1),[o]),k=async()=>{let e=x.trim();if(!e)return void alert("Введите название шаблона");u(!0);try{let{defaults:t,sections:a}={defaults:(e=>{if("object"!=typeof e||null===e||Array.isArray(e))return{};let t={};for(let r of n2){if(!(r in e))continue;let n=e[r];void 0!==n&&(t[r]=n6(n))}return t})(r),sections:n4(null!=n?n:r.visibleSections)},o=await fetch("/api/proposal-templates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,description:v.trim()||null,category:"custom",defaults:t,sections:a,isDefault:y})});if(!o.ok)throw Error(await n7(o));g(""),b(""),w(!1),await N(),null==l||l(),alert("Шаблон сохранён")}catch(e){console.error("Failed to create template:",e),alert("Не удалось сохранить шаблон: ".concat(e instanceof Error?e.message:"Ошибка"))}finally{u(!1)}},E=async(e,t)=>{h(e);try{let r=await fetch("/api/proposal-templates",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,...t})});if(!r.ok)throw Error(await n7(r));await N(),null==l||l()}finally{h(null)}},D=async e=>{let t=window.prompt("Новое название шаблона",e.name);if(null===t)return;let r=t.trim();if(!r)return void alert("Название не может быть пустым");try{await E(e.id,{name:r})}catch(e){console.error("Failed to rename template:",e),alert("Не удалось переименовать шаблон: ".concat(e instanceof Error?e.message:"Ошибка"))}},S=async e=>{var t;let r=window.prompt("Описание шаблона (можно оставить пустым)",null!=(t=e.description)?t:"");if(null!==r)try{await E(e.id,{description:r})}catch(e){console.error("Failed to update description:",e),alert("Не удалось обновить описание: ".concat(e instanceof Error?e.message:"Ошибка"))}},M=async e=>{if(!e.isDefault)try{await E(e.id,{isDefault:!0})}catch(e){console.error("Failed to set default template:",e),alert("Не удалось обновить шаблон по умолчанию: ".concat(e instanceof Error?e.message:"Ошибка"))}},R=async e=>{if(window.confirm("Удалить шаблон «".concat(e.name,"»?"))){h(e.id);try{let t=await fetch("/api/proposal-templates",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})});if(!t.ok)throw Error(await n7(t));await N(),null==l||l()}catch(e){console.error("Failed to delete template:",e),alert("Не удалось удалить шаблон: ".concat(e instanceof Error?e.message:"Ошибка"))}finally{h(null)}}};return t?(0,p.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,p.jsxs)("div",{className:"w-full max-w-4xl rounded-2xl bg-white p-6 shadow-2xl",children:[(0,p.jsxs)("div",{className:"mb-6",children:[(0,p.jsx)("h2",{className:"text-2xl font-bold text-slate-900",children:"Шаблоны"}),(0,p.jsx)("p",{className:"mt-1 text-sm text-slate-600",children:"Сохраняйте текущее КП как шаблон и управляйте шаблонами команды"})]}),(0,p.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[1.2fr_1fr]",children:[(0,p.jsxs)("section",{className:"rounded-xl border border-slate-200 p-4",children:[(0,p.jsx)("h3",{className:"mb-3 text-sm font-semibold text-slate-800",children:"Новый шаблон из текущего КП"}),(0,p.jsxs)("div",{className:"space-y-3",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"template-name",className:"mb-1 block text-xs font-medium text-slate-600",children:"Название"}),(0,p.jsx)("input",{id:"template-name",value:x,onChange:e=>g(e.target.value),placeholder:"Например: Продажа услуг / Базовый",className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 outline-none transition focus:border-[#C6613F]"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{htmlFor:"template-description",className:"mb-1 block text-xs font-medium text-slate-600",children:"Описание"}),(0,p.jsx)("textarea",{id:"template-description",value:v,onChange:e=>b(e.target.value),rows:3,placeholder:"Кратко: для какого сценария используется",className:"w-full rounded-lg border border-slate-300 px-3 py-2 text-sm text-slate-900 outline-none transition focus:border-[#C6613F]"})]}),(0,p.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-700",children:[(0,p.jsx)("input",{type:"checkbox",checked:y,onChange:e=>w(e.target.checked),className:"h-4 w-4 rounded border-slate-300 accent-[#C6613F]"}),"Сделать шаблоном по умолчанию"]}),(0,p.jsxs)("button",{type:"button",disabled:c,onClick:k,className:"inline-flex h-9 items-center gap-2 rounded-xl bg-[#C6613F] px-4 text-sm font-medium text-white transition hover:bg-[#A04F33] disabled:opacity-60",children:[c?(0,p.jsx)(t0.Loader2,{className:"h-4 w-4 animate-spin"}):null,"Сохранить как шаблон"]})]})]}),(0,p.jsxs)("section",{className:"rounded-xl border border-slate-200 p-4",children:[(0,p.jsx)("h3",{className:"mb-3 text-sm font-semibold text-slate-800",children:"Мои шаблоны"}),s?(0,p.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,p.jsx)(t0.Loader2,{className:"h-6 w-6 animate-spin text-[#C6613F]"})}):j?(0,p.jsx)("div",{className:"space-y-2",children:C.map(e=>{let t=m===e.id;return(0,p.jsxs)("div",{className:"rounded-lg border p-3 ".concat(e.isDefault?"border-[#D8A18E] bg-[#FAEFEB]":"border-slate-200 bg-white"),children:[(0,p.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"text-sm font-semibold text-slate-900",children:e.name}),e.description?(0,p.jsx)("p",{className:"mt-0.5 text-xs text-slate-500",children:e.description}):null]}),e.isDefault?(0,p.jsx)("span",{className:"rounded-full bg-[#C6613F] px-2 py-0.5 text-[10px] font-medium text-white",children:"По умолчанию"}):null]}),(0,p.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,p.jsxs)("button",{type:"button",disabled:t,onClick:()=>D(e),className:"inline-flex h-7 items-center gap-1 rounded-md border border-slate-300 px-2 text-xs text-slate-700 transition hover:bg-slate-50 disabled:opacity-60",children:[(0,p.jsx)(n0.Pencil,{className:"h-3.5 w-3.5"}),"Переименовать"]}),(0,p.jsxs)("button",{type:"button",disabled:t,onClick:()=>S(e),className:"inline-flex h-7 items-center gap-1 rounded-md border border-slate-300 px-2 text-xs text-slate-700 transition hover:bg-slate-50 disabled:opacity-60",children:[(0,p.jsx)(n0.Pencil,{className:"h-3.5 w-3.5"}),"Описание"]}),(0,p.jsxs)("button",{type:"button",disabled:t||e.isDefault,onClick:()=>M(e),className:"inline-flex h-7 items-center gap-1 rounded-md border border-slate-300 px-2 text-xs text-slate-700 transition hover:bg-slate-50 disabled:opacity-60",children:[(0,p.jsx)(t5,{className:"h-3.5 w-3.5"}),"По умолчанию"]}),(0,p.jsxs)("button",{type:"button",disabled:t,onClick:()=>R(e),className:"inline-flex h-7 items-center gap-1 rounded-md border border-red-200 px-2 text-xs text-red-700 transition hover:bg-red-50 disabled:opacity-60",children:[t?(0,p.jsx)(t0.Loader2,{className:"h-3.5 w-3.5 animate-spin"}):(0,p.jsx)(J.Trash2,{className:"h-3.5 w-3.5"}),"Удалить"]})]})]},e.id)})}):(0,p.jsx)("p",{className:"text-sm text-slate-500",children:"Пока нет пользовательских шаблонов"})]})]}),(0,p.jsx)("div",{className:"mt-6 flex justify-end",children:(0,p.jsx)("button",{type:"button",onClick:a,className:"rounded-lg px-4 py-2 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-100",children:"Закрыть"})})]})}):null}let n9=[{id:"basic",title:"Основное",icon:"📄"},{id:"context",title:"Контекст",icon:"💡"},{id:"advantages",title:"Преимущества",icon:"✨"},{id:"products",title:"Продукты",icon:"📦"},{id:"terms",title:"Условия",icon:"📋"},{id:"gallery",title:"Галерея",icon:"🖼️"},{id:"contacts",title:"Контакты",icon:"📞"}],ae=["basic","context","advantages","products","terms","gallery","contacts"],at="hsl(30deg 3.3% 11.8% / 15%)",ar="#3d3d3a";function an(){var e,t,r,n,a,l;let{data:o,status:i}=(0,h.useSession)(),s=null!=(n=(0,m.useSearchParams)().get("proposalId"))?n:void 0,{proposal:d,updateField:c,save:u,exportPdf:g,isLoading:R,isSaving:U,isDirty:B,lastSaved:H}=function(e){let{proposalId:t,workspaceId:r,userId:n}=e,a=(0,m.useRouter)(),[l,o]=(0,f.useState)(()=>M(r,n)),[i,s]=(0,f.useState)(!1),[d,c]=(0,f.useState)(!1),[u,p]=(0,f.useState)(!1),[h,x]=(0,f.useState)(null),g=(0,f.useRef)(null);(0,f.useEffect)(()=>{t&&(s(!0),fetch("/api/proposals/".concat(t)).then(e=>{if(404===e.status)return null;if(!e.ok)throw Error("Не удалось загрузить КП (".concat(e.status,")"));return e.json()}).then(e=>{var l;if(!e){console.warn("Proposal not found: ".concat(t)),o(M(r,n)),p(!1),x(null);let e=new URLSearchParams(window.location.search);e.delete("proposalId");let l=e.toString();a.replace(l?"".concat(window.location.pathname,"?").concat(l):window.location.pathname,{scroll:!1});return}o({...(e=>{var t,r,n,a,l;let o=Array.isArray(e.productVariants)?e.productVariants:[],i=o.length>0?o:[{...S("Вариант 1"),rows:Array.isArray(e.items)?e.items.map(e=>D({...e,id:e.id||E("item")})):[]}],s=i.some(t=>t.id===e.activeVariantId)?e.activeVariantId:null==(t=i[0])?void 0:t.id;return{...e,pricingMode:"variants",productVariants:i,activeVariantId:s,productsView:{showDiscountColumn:null==(a=null==(r=e.productsView)?void 0:r.showDiscountColumn)||a,showUnitColumn:null==(l=null==(n=e.productsView)?void 0:n.showUnitColumn)||l}}})(e),visibleSections:Array.isArray(l=e.visibleSections)&&0!==l.length?Array.from(new Set(l)):[...k]}),p(!1),x(new Date(e.updatedAt||Date.now()))}).catch(e=>{console.error("Failed to load proposal:",e),alert("Не удалось загрузить коммерческое предложение")}).finally(()=>s(!1)))},[t,a,n,r]);let v=(0,f.useCallback)((e,t)=>{o(r=>({...r,[e]:t})),p(!0)},[]),b=(0,f.useCallback)(e=>{let t={...e,id:E("item")};o(e=>({...e,items:[...e.items,t],..."variants"===e.pricingMode&&Array.isArray(e.productVariants)&&e.productVariants.length>0?{productVariants:e.productVariants.map(r=>r.id===e.activeVariantId?{...r,rows:[...r.rows,D(t)]}:r)}:{}})),p(!0)},[]),y=(0,f.useCallback)(e=>{o(t=>({...t,items:t.items.filter(t=>t.id!==e),..."variants"===t.pricingMode&&Array.isArray(t.productVariants)?{productVariants:t.productVariants.map(t=>({...t,rows:t.rows.filter(t=>t.id!==e)}))}:{}})),p(!0)},[]),w=(0,f.useCallback)((e,t)=>{o(r=>({...r,items:r.items.map(r=>r.id===e?{...r,...t}:r),..."variants"===r.pricingMode&&Array.isArray(r.productVariants)?{productVariants:r.productVariants.map(r=>({...r,rows:r.rows.map(r=>"item"===r.type&&r.id===e?{...r,...t}:r)}))}:{}})),p(!0)},[]),j=(0,f.useCallback)(async function(){var e;let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(!r||!n)return t&&alert("Ошибка: не удалось определить пользователя. Обновите страницу."),!1;let i=(null!=(e=l.title)?e:"").trim();c(!0);try{let e=await fetch("/api/proposals",{method:l.id?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l,title:i,updatedBy:n})});if(!e.ok){let t=await e.text(),r=(e=>{if(!e)return"Ошибка сервера";try{let r=JSON.parse(e);if("Validation error"===r.error&&Array.isArray(r.details)&&r.details.length>0){var t;return(null==(t=r.details[0])?void 0:t.message)||"Ошибка валидации"}if("string"==typeof r.message&&r.message.trim().length>0)return r.message;if("string"==typeof r.error&&r.error.trim().length>0)return r.error}catch(e){}return e})(t);throw e.status>=500&&console.error("Server error response:",t),Error(r||"Ошибка сервера")}let r=await e.json();if(o(r),p(!1),x(new Date),!l.id&&r.id){let e=new URLSearchParams(window.location.search);e.set("proposalId",r.id),a.replace("".concat(window.location.pathname,"?").concat(e.toString()),{scroll:!1})}return t&&alert("Коммерческое предложение сохранено"),!0}catch(e){if(console.error("Failed to save proposal:",e),t){let t=e instanceof Error?e.message:"Неизвестная ошибка";alert("Не удалось сохранить коммерческое предложение: ".concat(t))}return!1}finally{c(!1)}},[l,n,r,a]),N=(0,f.useCallback)(async()=>{await j(!0)},[j]);(0,f.useEffect)(()=>(g.current&&clearTimeout(g.current),u&&l.id&&!d&&(g.current=setTimeout(()=>{console.log("[Autosave] Saving..."),j(!1)},3e3)),()=>{g.current&&clearTimeout(g.current)}),[u,l.id,d,j]);let C=(0,f.useCallback)(async()=>{if(!l.id)return void alert("Сохраните коммерческое предложение перед экспортом в PDF");try{let e=await fetch("/api/pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({proposalId:l.id})});if(!e.ok)throw Error(await e.text());let t=await e.blob(),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download="".concat(l.title||"proposal",".pdf"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}catch(e){console.error("Failed to export PDF:",e),alert("Не удалось экспортировать PDF")}},[l]);return{proposal:l,updateField:v,addItem:b,removeItem:y,updateItem:w,save:N,exportPdf:C,isLoading:i,isSaving:d,isDirty:u,lastSaved:h}}({proposalId:s,workspaceId:null!=(a=null==o||null==(e=o.user)?void 0:e.workspaceId)?a:"",userId:null!=(l=null==o||null==(t=o.user)?void 0:t.id)?l:""}),[q,K]=(0,f.useState)("basic"),[W,Y]=(0,f.useState)(!s),[J,Z]=(0,f.useState)(!1),[Q,ee]=(0,f.useState)(ae),[et,er]=(0,f.useState)(null),[en,ea]=(0,f.useState)(null),[el,eo]=(0,f.useState)(1),[ei,es]=(0,f.useState)(!1),ed=(0,f.useRef)(null),ec=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,[r,n]=(0,f.useState)(e);return(0,f.useEffect)(()=>{let r=setTimeout(()=>n(e),t);return()=>clearTimeout(r)},[e,t]),r}(d,500);(0,f.useEffect)(()=>{if(d.visibleSections&&d.visibleSections.length>0)return void ee(d.visibleSections);ee(ae)},[d.visibleSections]),(0,f.useEffect)(()=>{if("authenticated"!==i)return;let e=!0;return fetch("/api/workspace/settings").then(e=>e.ok?e.json():null).then(t=>{e&&t&&er(t)}).catch(()=>{if(!e)return}),()=>{e=!1}},[i]),(0,f.useEffect)(()=>{let e=e=>{(null==e?void 0:e.data)&&"resize"===e.data.type&&"number"==typeof e.data.height&&ea(e.data.height)};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[]),(0,f.useEffect)(()=>{let e=ed.current;if(!e)return;let t=()=>{let t=e.clientWidth;t&&eo(Math.min(1,t/794))};t();let r=new ResizeObserver(t);return r.observe(e),()=>r.disconnect()},[]);let eu=(0,f.useMemo)(()=>{let e=e=>Q.includes(e),t=e("basic"),r=e("context"),n=e("advantages"),a=e("products"),l=e("terms"),o=e("gallery"),i=e("contacts");return{...ec,title:t?ec.title:"",recipientName:t?ec.recipientName:void 0,problemDesc:r?ec.problemDesc:void 0,solutionDesc:r?ec.solutionDesc:void 0,additionalDesc:r?ec.additionalDesc:void 0,advantages:n?ec.advantages:[],advantagesColumns:n?ec.advantagesColumns:void 0,items:a?ec.items:[],pricingMode:a?ec.pricingMode:"single",productVariants:a?ec.productVariants:[],activeVariantId:a?ec.activeVariantId:void 0,productsView:a?ec.productsView:void 0,deadline:l?ec.deadline:void 0,paymentTerms:l?ec.paymentTerms:void 0,paymentCustom:l?ec.paymentCustom:void 0,validUntil:l?ec.validUntil:void 0,notes:l?ec.notes:void 0,galleryImages:o?ec.galleryImages:[],ctaText:i?ec.ctaText:void 0,ctaPhone:i?ec.ctaPhone:void 0,ctaEmail:i?ec.ctaEmail:void 0}},[ec,Q]),ep=(0,f.useMemo)(()=>{try{return function(e){var t,r;let n,{proposal:a,workspace:l,client:o}=e,i=P(a),s=A(a),d=(null==(t=a.productsView)?void 0:t.showUnitColumn)!==!1,c=(null==(r=a.productsView)?void 0:r.showDiscountColumn)!==!1,u=5+ +!!d+ +!!c,p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"RUB";return({RUB:"₽",USD:"$",EUR:"€"})[e]||e}(a.currency),f=Array.isArray(null==s?void 0:s.rows)?s.rows:[],m=f.length>0,h=m||i.length>0,x=O(i),g=_(a),v=T(a),b=Array.isArray(a.advantages)?a.advantages:[],y="number"==typeof a.advantagesColumns?Math.min(3,Math.max(1,a.advantagesColumns)):3,w=b.length>=3?3:y,j=Array.isArray(a.visibleSections)?a.visibleSections:null,N=e=>!j||j.includes(e);return'<!DOCTYPE html>\n<html lang="ru">\n<head>\n  <meta charset="utf-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1">\n  <title>'.concat(z(a.title),"</title>\n  <style>\n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    \n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n      font-size: 14px;\n      line-height: 1.6;\n      color: #1a1a1a;\n      padding: 40px;\n      background: #ffffff;\n    }\n    \n    @media print {\n      body {\n        padding: 0;\n      }\n    }\n    \n    @page {\n      size: A4;\n      margin: 20mm 15mm;\n    }\n    \n    .header {\n      display: flex;\n      justify-content: space-between;\n      align-items: flex-start;\n      margin-bottom: 30px;\n      padding-bottom: 20px;\n      border-bottom: 2px solid #e5e5e5;\n    }\n    \n    .logo {\n      max-width: 200px;\n      max-height: 80px;\n    }\n    \n    .company-info {\n      text-align: right;\n      font-size: 12px;\n      color: #666;\n    }\n    \n    h1 {\n      font-size: 24px;\n      font-weight: 700;\n      margin-bottom: 20px;\n      color: #1a1a1a;\n    }\n    \n    .greeting {\n      font-size: 16px;\n      margin-bottom: 20px;\n    }\n    \n    .section {\n      margin-bottom: 25px;\n    }\n    \n    .section-title {\n      font-size: 16px;\n      font-weight: 600;\n      margin-bottom: 10px;\n      color: #333;\n    }\n    \n    .section-content {\n      font-size: 14px;\n      line-height: 1.8;\n      color: #444;\n      white-space: pre-wrap;\n    }\n\n    .advantages-grid {\n      display: grid;\n      grid-template-columns: repeat(var(--advantages-columns, 3), minmax(0, 1fr));\n      gap: 12px;\n      margin-top: 10px;\n    }\n\n    .advantage-card {\n      border: 1px solid #e5e7eb;\n      border-radius: 12px;\n      padding: 14px;\n      background: #fafafa;\n      min-height: 130px;\n    }\n\n    .advantage-icon {\n      width: 42px;\n      height: 42px;\n      border-radius: 9999px;\n      overflow: hidden;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: #f0f0f0;\n      margin-bottom: 10px;\n      font-size: 18px;\n    }\n\n    .advantage-icon img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n    }\n\n    .advantage-title {\n      font-size: 14px;\n      font-weight: 600;\n      color: #111827;\n      margin-bottom: 6px;\n      line-height: 1.3;\n    }\n\n    .advantage-description {\n      font-size: 12px;\n      line-height: 1.45;\n      color: #4b5563;\n      white-space: pre-wrap;\n    }\n    \n    .price-table {\n      width: 100%;\n      border-collapse: collapse;\n      margin: 20px 0;\n      font-size: 13px;\n    }\n    \n    .price-table th {\n      background-color: #f5f5f5;\n      padding: 12px 10px;\n      text-align: left;\n      font-weight: 600;\n      border: 1px solid #ddd;\n    }\n    \n    .price-table td {\n      padding: 10px;\n      border: 1px solid #ddd;\n    }\n    \n    .price-table tr:nth-child(even) {\n      background-color: #fafafa;\n    }\n    \n    .price-table .text-right {\n      text-align: right;\n    }\n    \n    .price-table .text-center {\n      text-align: center;\n    }\n\n    .price-table .group-row td {\n      background-color: #f3f2f0;\n      font-weight: 600;\n      color: #3d3d3a;\n    }\n\n    .variant-meta {\n      margin: 12px 0 8px;\n      padding: 10px 12px;\n      border-radius: 10px;\n      background: #f7f6f3;\n      border: 1px solid #e6e4de;\n    }\n\n    .variant-name {\n      font-size: 13px;\n      font-weight: 600;\n      color: #252525;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .variant-badge {\n      padding: 2px 8px;\n      border-radius: 9999px;\n      font-size: 10px;\n      font-weight: 600;\n      background: #3cb371;\n      color: #fff;\n    }\n\n    .variant-description {\n      margin-top: 6px;\n      font-size: 12px;\n      color: #666;\n      white-space: pre-wrap;\n    }\n    \n    .totals {\n      margin-top: 10px;\n      text-align: right;\n    }\n    \n    .totals-row {\n      display: flex;\n      justify-content: flex-end;\n      padding: 5px 0;\n      font-size: 14px;\n    }\n    \n    .totals-row.total {\n      font-size: 18px;\n      font-weight: 700;\n      margin-top: 10px;\n      padding-top: 10px;\n      border-top: 2px solid #333;\n    }\n    \n    .totals-label {\n      margin-right: 20px;\n    }\n    \n    .totals-value {\n      min-width: 150px;\n      text-align: right;\n      font-weight: 600;\n    }\n    \n    .terms {\n      display: grid;\n      grid-template-columns: 1fr 1fr;\n      gap: 20px;\n      margin: 20px 0;\n      padding: 15px;\n      background-color: #f9f9f9;\n      border-radius: 8px;\n    }\n    \n    .term-item {\n      font-size: 13px;\n    }\n    \n    .term-label {\n      font-weight: 600;\n      color: #666;\n      margin-bottom: 5px;\n    }\n    \n    .term-value {\n      color: #333;\n    }\n    \n    .gallery {\n      display: grid;\n      grid-template-columns: repeat(3, 1fr);\n      gap: 15px;\n      margin: 20px 0;\n    }\n    \n    .gallery img {\n      width: 100%;\n      height: auto;\n      border-radius: 8px;\n      object-fit: cover;\n    }\n    \n    .cta {\n      margin: 30px 0;\n      padding: 20px;\n      background-color: #f0f0f0;\n      border-radius: 8px;\n      text-align: center;\n    }\n    \n    .cta-text {\n      font-size: 15px;\n      margin-bottom: 15px;\n    }\n    \n    .cta-contacts {\n      font-size: 14px;\n      font-weight: 600;\n    }\n    \n    .footer {\n      margin-top: 50px;\n      padding-top: 20px;\n      border-top: 1px solid #ddd;\n      font-size: 11px;\n      color: #666;\n    }\n    \n    .requisites {\n      margin-bottom: 20px;\n    }\n    \n    .requisites-grid {\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 8px;\n      margin-top: 10px;\n    }\n    \n    .signatures {\n      display: flex;\n      justify-content: flex-end;\n      gap: 30px;\n      margin-top: 30px;\n    }\n    \n    .signature-item img {\n      max-width: 150px;\n      max-height: 80px;\n    }\n  </style>\n</head>\n<body>\n  <!-- Шапка -->\n  <div class=\"header\">\n    <div>\n      ").concat((null==l?void 0:l.logoUrl)?'<img src="'.concat(z(l.logoUrl),'" alt="Logo" class="logo">'):"",'\n    </div>\n    <div class="company-info">\n      ').concat((null==l?void 0:l.companyName)?"<div><strong>".concat(z(l.companyName),"</strong></div>"):"","\n      ").concat((null==l?void 0:l.inn)?"<div>ИНН: ".concat(z(l.inn),"</div>"):"","\n    </div>\n  </div>\n\n  <!-- Заголовок -->\n  ").concat(N("basic")&&a.title?"<h1>".concat(z(a.title),"</h1>"):"","\n\n  <!-- Обращение -->\n  ").concat(N("basic")&&a.recipientName?'<div class="greeting">'.concat(z(a.recipientName),"</div>"):"","\n\n  <!-- Описание проблемы (Point A) -->\n  ").concat(N("context")&&a.problemDesc?'\n    <div class="section">\n      <div class="section-content">'.concat(z(a.problemDesc),"</div>\n    </div>\n  "):"","\n\n  <!-- Предлагаемое решение (Point B) -->\n  ").concat(N("context")&&a.solutionDesc?'\n    <div class="section">\n      <div class="section-content">'.concat(z(a.solutionDesc),"</div>\n    </div>\n  "):"","\n\n  <!-- Дополнительное описание -->\n  ").concat(N("context")&&a.additionalDesc?'\n    <div class="section">\n      <div class="section-content">'.concat(z(a.additionalDesc),"</div>\n    </div>\n  "):"","\n\n  <!-- Преимущества -->\n  ").concat(N("advantages")&&b.length>0?'\n    <div class="section">\n      <div class="section-title">Преимущества</div>\n      <div class="advantages-grid" style="--advantages-columns: '.concat(w,'">\n        ').concat(b.map(e=>'\n          <div class="advantage-card">\n            <div class="advantage-icon">\n              '.concat(e.iconUrl?'<img src="'.concat(z(e.iconUrl),'" alt="Иконка преимущества">'):"★",'\n            </div>\n            <div class="advantage-title">').concat(z(e.title||"Без названия"),'</div>\n            <div class="advantage-description">').concat(z(e.description||""),"</div>\n          </div>\n        ")).join(""),"\n      </div>\n    </div>\n  "):"","\n\n  <!-- Таблица товаров/услуг -->\n  ").concat(N("products")&&h?"\n    ".concat(s?'\n      <div class="variant-meta">\n        <div class="variant-name">\n          '.concat(z(s.name),"\n          ").concat(s.isRecommended?'<span class="variant-badge">Рекомендуем</span>':"","\n        </div>\n        ").concat(s.description?'<div class="variant-description">'.concat(z(s.description),"</div>"):"","\n      </div>\n    "):"",'\n    <table class="price-table">\n      <thead>\n        <tr>\n          <th>№</th>\n          <th>Наименование</th>\n          <th class="text-center">Кол-во</th>\n          ').concat(d?'<th class="text-center">Ед.</th>':"",'\n          <th class="text-right">Цена, ').concat(p,"</th>\n          ").concat(c?'<th class="text-right">Скидка</th>':"",'\n          <th class="text-right">Сумма, ').concat(p,"</th>\n        </tr>\n      </thead>\n      <tbody>\n        ").concat(m?(n=0,f.map(e=>F(e)?(n+=1,'\n                <tr>\n                  <td class="text-center">'.concat(n,"</td>\n                  <td>\n                    <strong>").concat(z(e.name),"</strong>\n                    ").concat(e.description?'<br><small style="color: #666;">'.concat(z(e.description),"</small>"):"",'\n                  </td>\n                  <td class="text-center">').concat(e.qty,"</td>\n                  ").concat(d?'<td class="text-center">'.concat(z(e.unit||"шт"),"</td>"):"",'\n                  <td class="text-right">').concat(V(e.price),"</td>\n                  ").concat(c?'<td class="text-right">'.concat(e.discount?"".concat(e.discount,"%"):"0%","</td>"):"",'\n                  <td class="text-right"><strong>').concat(V(I(e)),"</strong></td>\n                </tr>\n              ")):'\n                  <tr class="group-row">\n                    <td colspan="'.concat(u,'">').concat(z(e.title||"Группа"),"</td>\n                  </tr>\n                ")).join("")):i.map((e,t)=>'\n          <tr>\n            <td class="text-center">'.concat(t+1,"</td>\n            <td>\n              <strong>").concat(z(e.name),"</strong>\n              ").concat(e.description?'<br><small style="color: #666;">'.concat(z(e.description),"</small>"):"",'\n            </td>\n            <td class="text-center">').concat(e.qty,"</td>\n            ").concat(d?'<td class="text-center">'.concat(z(e.unit||"шт"),"</td>"):"",'\n            <td class="text-right">').concat(V(e.price),"</td>\n            ").concat(c?'<td class="text-right">'.concat(e.discount?"".concat(e.discount,"%"):"0%","</td>"):"",'\n            <td class="text-right"><strong>').concat(V(I(e)),"</strong></td>\n          </tr>\n        ")).join(""),'\n      </tbody>\n    </table>\n\n    <!-- Итоги -->\n    <div class="totals">\n      <div class="totals-row">\n        <span class="totals-label">Итого:</span>\n        <span class="totals-value">').concat(L(x,a.currency),"</span>\n      </div>\n      ").concat(a.includeVat?'\n        <div class="totals-row">\n          <span class="totals-label">НДС '.concat(a.vatRate,'%:</span>\n          <span class="totals-value">').concat(L(g,a.currency),'</span>\n        </div>\n        <div class="totals-row total">\n          <span class="totals-label">Всего с НДС:</span>\n          <span class="totals-value">').concat(L(v,a.currency),"</span>\n        </div>\n      "):'\n        <div class="totals-row total">\n          <span class="totals-label">Всего:</span>\n          <span class="totals-value">'.concat(L(v,a.currency),"</span>\n        </div>\n      "),"\n    </div>\n  "):"","\n\n  <!-- Условия -->\n  ").concat(N("terms")&&(a.deadline||a.paymentTerms||a.validUntil)?'\n    <div class="terms">\n      '.concat(a.deadline?'\n        <div class="term-item">\n          <div class="term-label">Срок выполнения:</div>\n          <div class="term-value">'.concat(z(a.deadline),"</div>\n        </div>\n      "):"","\n      ").concat(a.paymentTerms?'\n        <div class="term-item">\n          <div class="term-label">Условия оплаты:</div>\n          <div class="term-value">'.concat("prepaid"===a.paymentTerms?"100% предоплата":"50-50"===a.paymentTerms?"50% предоплата / 50% по завершении":"postpaid"===a.paymentTerms?"Постоплата":a.paymentCustom?z(a.paymentCustom):z(a.paymentTerms),"</div>\n        </div>\n      "):"","\n      ").concat(a.validUntil?'\n        <div class="term-item">\n          <div class="term-label">Срок действия предложения:</div>\n          <div class="term-value">'.concat(new Date(a.validUntil).toLocaleDateString("ru-RU"),"</div>\n        </div>\n      "):"","\n    </div>\n  "):"","\n\n  <!-- Галерея -->\n  ").concat(N("gallery")&&a.galleryImages&&a.galleryImages.length>0?'\n    <div class="section">\n      <div class="section-title">Примеры работ</div>\n      <div class="gallery">\n        '.concat(a.galleryImages.map(e=>'<img src="'.concat(z(e),'" alt="Portfolio image">')).join(""),"\n      </div>\n    </div>\n  "):"","\n\n  <!-- CTA -->\n  ").concat(N("contacts")&&(a.ctaText||a.ctaPhone||a.ctaEmail)?'\n    <div class="cta">\n      '.concat(a.ctaText?'<div class="cta-text">'.concat(z(a.ctaText),"</div>"):"",'\n      <div class="cta-contacts">\n        ').concat(a.ctaPhone?"📞 ".concat(z(a.ctaPhone)):"","\n        ").concat(a.ctaPhone&&a.ctaEmail?" • ":"","\n        ").concat(a.ctaEmail?"✉️ ".concat(z(a.ctaEmail)):"","\n      </div>\n    </div>\n  "):"","\n\n  <!-- Примечания -->\n  ").concat(N("terms")&&a.notes?'\n    <div class="section">\n      <div class="section-title">Примечания</div>\n      <div class="section-content">'.concat(z(a.notes),"</div>\n    </div>\n  "):"","\n\n  <!-- Футер с реквизитами -->\n  ").concat(l?'\n    <div class="footer">\n      <div class="requisites">\n        <div><strong>Реквизиты:</strong></div>\n        <div class="requisites-grid">\n          '.concat(l.companyName?"<div>Наименование: ".concat(z(l.companyName),"</div>"):"","\n          ").concat(l.inn?"<div>ИНН: ".concat(z(l.inn),"</div>"):"","\n          ").concat(l.ogrn?"<div>ОГРН: ".concat(z(l.ogrn),"</div>"):"","\n          ").concat(l.legalAddress?'<div style="grid-column: 1 / -1;">Юр. адрес: '.concat(z(l.legalAddress),"</div>"):"","\n          ").concat(l.bankName?"<div>Банк: ".concat(z(l.bankName),"</div>"):"","\n          ").concat(l.bik?"<div>БИК: ".concat(z(l.bik),"</div>"):"","\n          ").concat(l.accountNumber?'<div style="grid-column: 1 / -1;">Р/С: '.concat(z(l.accountNumber),"</div>"):"","\n        </div>\n      </div>\n      \n      ").concat(l.signatureUrl||l.stampUrl?'\n        <div class="signatures">\n          '.concat(l.signatureUrl?'\n            <div class="signature-item">\n              <img src="'.concat(z(l.signatureUrl),'" alt="Подпись">\n            </div>\n          '):"","\n          ").concat(l.stampUrl?'\n            <div class="signature-item">\n              <img src="'.concat(z(l.stampUrl),'" alt="Печать">\n            </div>\n          '):"","\n        </div>\n      "):"","\n    </div>\n  "):"","\n\n  <script>\n    // Автоматическая высота для iframe\n    if (window.parent !== window) {\n      function sendHeight() {\n        const height = document.documentElement.scrollHeight;\n        window.parent.postMessage({ type: 'resize', height: height }, '*');\n      }\n      window.addEventListener('load', sendHeight);\n      window.addEventListener('resize', sendHeight);\n      // Отправляем высоту сразу\n      setTimeout(sendHeight, 100);\n    }\n  </script>\n</body>\n</html>")}({proposal:eu,workspace:null!=et?et:void 0})}catch(e){return console.error("Failed to render preview html:",e),'<!doctype html><html><body style="font-family: sans-serif; padding: 24px;">Не удалось собрать превью.</body></html>'}},[eu,et]),ef=Math.max(null!=en?en:0,1123);(0,f.useEffect)(()=>{var e;Q.includes(q)||K(null!=(e=Q[0])?e:"basic")},[q,Q]);let em="products"===q;(0,f.useEffect)(()=>{es(em)},[em]);let eh=async()=>{if(!d.id)return void alert("Сохраните КП перед предпросмотром");try{let e=await fetch("/api/proposals/".concat(d.id,"/share"),{method:"POST"});if(!e.ok)throw Error("Не удалось создать ссылку для предпросмотра");let{token:t}=await e.json();window.open("/p/".concat(t),"_blank")}catch(e){console.error("Preview error:",e),alert("Не удалось открыть предпросмотр")}},ex="flex cursor-pointer items-center justify-center gap-2 rounded-xl border bg-white px-4 py-2 text-sm font-medium text-[#0F172B] tracking-[-0.42px] transition hover:bg-slate-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#C6613F] disabled:cursor-not-allowed disabled:opacity-50",eg={"--tw-shadow":"0 1px 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .06)), 0 0 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .3))","--tw-shadow-color":"rgba(0, 0, 0, 0.1)",boxShadow:"var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow)",borderColor:"hsl(30deg 3.3% 11.8% / 15%)"},ev=(0,f.useMemo)(()=>{switch(q){case"basic":return(0,p.jsx)(G,{proposal:d,onUpdate:c});case"context":return(0,p.jsx)(X,{proposal:d,onUpdate:c});case"products":return(0,p.jsx)(nL,{proposal:d,onUpdate:c});case"advantages":return(0,p.jsx)($,{proposal:d,onUpdate:c});case"terms":return(0,p.jsx)(nV,{proposal:d,onUpdate:c});case"gallery":return(0,p.jsx)(nX,{proposal:d,onUpdate:c});case"contacts":return(0,p.jsx)(nW,{proposal:d,onUpdate:c});default:return null}},[q,d,c]);return"loading"===i?(0,p.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-[#F3F2F0]",children:(0,p.jsxs)("div",{className:"text-center",children:[(0,p.jsx)("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-[#C6613F] border-t-transparent mx-auto"}),(0,p.jsx)("p",{className:"mt-4 text-sm text-slate-600",children:"Загрузка сессии..."})]})}):R?(0,p.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-[#F3F2F0]",children:(0,p.jsxs)("div",{className:"text-center",children:[(0,p.jsx)("div",{className:"h-12 w-12 animate-spin rounded-full border-4 border-[#C6613F] border-t-transparent mx-auto"}),(0,p.jsx)("p",{className:"mt-4 text-sm text-slate-600",children:"Загрузка коммерческого предложения..."})]})}):(0,p.jsxs)("div",{className:"min-h-screen w-full bg-[#F3F2F0] py-6 text-slate-900",children:[(0,p.jsxs)("div",{className:"mx-auto flex w-full max-w-[1400px] flex-col gap-6 px-6",children:[(0,p.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,p.jsxs)(x.default,{href:"/",className:ex,style:eg,children:[(0,p.jsx)(v,{className:"h-4 w-4"}),"Вернуться назад"]}),(0,p.jsxs)("div",{className:"flex flex-1 items-center justify-center",children:[(0,p.jsx)("h1",{className:"text-xl font-semibold text-slate-800",children:d.title||"Новое КП"}),U?(0,p.jsxs)("span",{className:"ml-3 flex items-center gap-1.5 rounded-full bg-[#FAEFEB] px-3 py-1 text-xs font-medium text-[#A04F33]",children:[(0,p.jsx)("span",{className:"h-2 w-2 animate-pulse rounded-full bg-[#C6613F]"}),"Сохранение..."]}):B?(0,p.jsx)("span",{className:"ml-3 rounded-full bg-amber-100 px-3 py-1 text-xs font-medium text-amber-800",children:"Не сохранено"}):H?(0,p.jsxs)("span",{className:"ml-3 rounded-full bg-green-100 px-3 py-1 text-xs font-medium text-green-800",children:["Сохранено в ",H.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})]}):null]}),(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsxs)("button",{className:ex,style:eg,onClick:()=>Y(!0),children:[(0,p.jsx)(C,{className:"h-4 w-4"}),"Применить шаблон"]}),(0,p.jsxs)("button",{className:ex,style:eg,onClick:()=>Z(!0),children:[(0,p.jsx)(N,{className:"h-4 w-4"}),"Шаблоны"]}),(0,p.jsxs)("button",{className:ex,style:eg,onClick:eh,disabled:!d.id,children:[(0,p.jsx)(w,{className:"h-4 w-4"}),"Предпросмотр"]}),(0,p.jsxs)("button",{className:ex,style:eg,onClick:g,disabled:!d.id,children:[(0,p.jsx)(y,{className:"h-4 w-4"}),"PDF"]}),(0,p.jsxs)("button",{className:"flex cursor-pointer items-center justify-center gap-2 h-9 rounded-xl bg-[#C6613F] px-4 text-sm font-medium text-[#FAFAFA] shadow-[0px_1px_2px_0px_rgba(10,10,10,0.06)] transition hover:bg-[#A04F33] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#C6613F] disabled:cursor-not-allowed disabled:opacity-60",onClick:u,disabled:U,children:[(0,p.jsx)(b,{className:"h-4 w-4"}),U?"Сохранение...":"Сохранить"]})]})]}),(0,p.jsxs)("div",{className:"flex gap-6",children:[(0,p.jsx)("aside",{className:"w-64 flex-shrink-0",children:(0,p.jsxs)("div",{className:"sticky top-6 rounded-[0.75rem] bg-white p-4",style:{"--tw-shadow":"0 1px 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .06)), 0 0 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .3))","--tw-shadow-color":"rgba(0, 0, 0, 0.1)",boxShadow:"var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow)"},children:[(0,p.jsx)("h2",{className:"mb-3 text-xs font-semibold uppercase tracking-wide",style:{color:ar},children:"Разделы"}),(0,p.jsx)("nav",{className:"space-y-1",children:n9.map(e=>{let t=Q.includes(e.id),r=q===e.id;return(0,p.jsxs)("div",{role:"button",tabIndex:0,onClick:()=>{t&&K(e.id)},onKeyDown:r=>{("Enter"===r.key||" "===r.key)&&(r.preventDefault(),t&&K(e.id))},className:"flex w-full items-center gap-3 rounded-lg px-3 py-2 text-left text-sm font-medium tracking-[-0.42px] transition ".concat(r?"bg-[#FAFAFA] text-[#FF5929]":"hover:bg-[#FAFAFA]"," ").concat(t?"cursor-pointer":"cursor-default"),style:r?void 0:{color:t?"#3d3d3a":"#a8a39a"},children:[(0,p.jsx)("span",{className:"text-lg",children:e.icon}),(0,p.jsx)("span",{className:"flex-1",children:e.title}),(0,p.jsx)("button",{type:"button",role:"switch","aria-checked":t,onClick:t=>{var r;t.stopPropagation(),r=e.id,ee(e=>{let t=e.includes(r)?e.filter(e=>e!==r):[...e,r];return 0===t.length?e:(c("visibleSections",t),t)})},className:"relative inline-flex h-[12px] w-[22px] shrink-0 items-center rounded-full border transition ".concat(t?"border-[#C6613F] bg-[#C6613F]":"border-slate-200 bg-slate-200"),children:(0,p.jsx)("span",{className:"inline-block h-[10px] w-[10px] transform rounded-full bg-white shadow transition ".concat(t?"translate-x-[10px]":"translate-x-[1px]")})})]},e.id)})})]})}),(0,p.jsx)("main",{className:"flex-1 min-w-0",children:(0,p.jsxs)("div",{className:"rounded-[0.75rem] bg-white p-6",style:{"--tw-shadow":"0 1px 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .06)), 0 0 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .3))","--tw-shadow-color":"rgba(0, 0, 0, 0.1)",boxShadow:"var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow)"},children:[(0,p.jsxs)("div",{className:"mb-6",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,p.jsx)("h2",{className:"text-lg font-semibold",style:{color:"#3d3d3a"},children:null==(r=n9.find(e=>e.id===q))?void 0:r.title}),em?(0,p.jsxs)("button",{type:"button",onClick:()=>es(e=>!e),className:"hidden xl:inline-flex h-8 items-center gap-1.5 rounded-lg border bg-white px-2.5 text-xs font-medium tracking-[-0.2px] text-[#3d3d3a] transition hover:bg-[#FAFAFA] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[#C6613F]",style:{borderColor:at,boxShadow:"0 1px 1px 0 rgba(0,0,0,0.06), 0 0 1px 0 rgba(0,0,0,0.3)"},title:ei?"Показать превью":"Скрыть превью","aria-label":ei?"Показать превью":"Скрыть превью",children:[ei?(0,p.jsx)(j,{className:"h-4 w-4"}):(0,p.jsx)(w,{className:"h-4 w-4"}),ei?"Показать превью":"Скрыть превью"]}):null]}),(0,p.jsx)("div",{className:"mt-1 h-1 w-12 rounded-full bg-[#C6613F]"})]}),(0,p.jsx)("div",{className:em&&ei?"max-w-none":"max-w-3xl",children:ev})]})}),em&&ei?null:(0,p.jsx)("aside",{className:"hidden xl:block w-[360px] flex-shrink-0",children:(0,p.jsxs)("div",{className:"sticky top-6 rounded-[0.75rem] bg-white p-4",style:{"--tw-shadow":"0 1px 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .06)), 0 0 1px 0 var(--tw-shadow-color, rgba(0, 0, 0, .3))","--tw-shadow-color":"rgba(0, 0, 0, 0.1)",boxShadow:"var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow)"},children:[(0,p.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,p.jsx)("h2",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:ar},children:"Превью"}),(0,p.jsx)("span",{className:"text-[10px] font-medium uppercase tracking-wide",style:{color:"#73726c"},children:"Live"})]}),(0,p.jsx)("div",{className:"overflow-hidden rounded-lg border bg-white",style:{borderColor:at},children:(0,p.jsx)("div",{ref:ed,className:"max-h-[calc(100vh-12rem)] overflow-auto bg-[#f6f5f3]",children:(0,p.jsx)("div",{style:{width:"".concat(794*el,"px"),height:"".concat(ef*el,"px"),margin:"0 auto",position:"relative"},children:(0,p.jsx)("div",{style:{width:"".concat(794,"px"),height:"".concat(ef,"px"),transform:"scale(".concat(el,")"),transformOrigin:"top left",position:"absolute",top:0,left:0},children:(0,p.jsx)("iframe",{title:"Предпросмотр коммерческого предложения",className:"border-0",srcDoc:ep,style:{width:"".concat(794,"px"),height:"".concat(ef,"px"),display:"block"}})})})})})]})})]})]}),W&&(0,p.jsx)(nQ,{onSelect:e=>{if(Y(!1),e){let t=n4(e.sections),r=(e=>{let t=n6(e);if(!t)return{};if(Array.isArray(t.items)&&(t.items=t.items.map(e=>({...e,id:n5("item")}))),Array.isArray(t.advantages)&&(t.advantages=t.advantages.map(e=>({...e,id:n5("adv")}))),Array.isArray(t.productVariants)){var r,n,a;let e=new Map,l=t.productVariants.map(t=>{let r=t.id,n=n5("variant");e.set(r,n);let a=new Map,l=Array.isArray(t.rows)?t.rows:[];for(let e of l)"group"===e.type&&a.set(e.id,n5("group"));let o=l.map(e=>{var t,r;if("group"===e.type){let r=null!=(t=a.get(e.id))?t:n5("group");return{...e,id:r}}return{...e,id:n5("item"),groupId:e.groupId&&null!=(r=a.get(e.groupId))?r:void 0}});return{...t,id:n,rows:o}}),o=t.activeVariantId?null!=(a=e.get(t.activeVariantId))?a:null==(r=l[0])?void 0:r.id:null==(n=l[0])?void 0:n.id;t.productVariants=l,t.activeVariantId=o}return t})(e.defaults);ee(t),c("visibleSections",t),Object.entries(r).forEach(e=>{let[t,r]=e;c(t,r)})}},onClose:()=>Y(!1)}),J&&(0,p.jsx)(n8,{isOpen:J,proposal:d,visibleSections:Q,onClose:()=>Z(!1)})]})}}]);